{"version":3,"sources":["serializer.js"],"names":[],"mappings":"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","file":"serializer-compiled.js","sourcesContent":["'use strict';\r\n\r\nvar DefaultTreeAdapter = require('../tree_adapters/default'),\r\n    Doctype = require('../common/doctype'),\r\n    Utils = require('../common/utils'),\r\n    HTML = require('../common/html');\r\n\r\n//Aliases\r\nvar $ = HTML.TAG_NAMES,\r\n    NS = HTML.NAMESPACES;\r\n\r\n//Default serializer options\r\nvar DEFAULT_OPTIONS = {\r\n    encodeHtmlEntities: true\r\n};\r\n\r\n//Escaping regexes\r\nvar AMP_REGEX = /&/g,\r\n    NBSP_REGEX = /\\u00a0/g,\r\n    DOUBLE_QUOTE_REGEX = /\"/g,\r\n    LT_REGEX = /</g,\r\n    GT_REGEX = />/g;\r\n\r\n//Escape string\r\nfunction escapeString(str, attrMode) {\r\n    str = str\r\n        .replace(AMP_REGEX, '&amp;')\r\n        .replace(NBSP_REGEX, '&nbsp;');\r\n\r\n    if (attrMode)\r\n        str = str.replace(DOUBLE_QUOTE_REGEX, '&quot;');\r\n\r\n    else {\r\n        str = str\r\n            .replace(LT_REGEX, '&lt;')\r\n            .replace(GT_REGEX, '&gt;');\r\n    }\r\n\r\n    return str;\r\n}\r\n\r\n\r\n//Enquote doctype ID\r\n\r\n\r\n\r\n//Serializer\r\nvar Serializer = module.exports = function (treeAdapter, options) {\r\n    this.treeAdapter = treeAdapter || DefaultTreeAdapter;\r\n    this.options = Utils.mergeOptions(DEFAULT_OPTIONS, options);\r\n};\r\n\r\n\r\n//API\r\nSerializer.prototype.serialize = function (node) {\r\n    this.html = '';\r\n    this._serializeChildNodes(node);\r\n\r\n    return this.html;\r\n};\r\n\r\n\r\n//Internals\r\nSerializer.prototype._serializeChildNodes = function (parentNode) {\r\n    var childNodes = this.treeAdapter.getChildNodes(parentNode);\r\n\r\n    if (childNodes) {\r\n        for (var i = 0, cnLength = childNodes.length; i < cnLength; i++) {\r\n            var currentNode = childNodes[i];\r\n\r\n            if (this.treeAdapter.isElementNode(currentNode))\r\n                this._serializeElement(currentNode);\r\n\r\n            else if (this.treeAdapter.isTextNode(currentNode))\r\n                this._serializeTextNode(currentNode);\r\n\r\n            else if (this.treeAdapter.isCommentNode(currentNode))\r\n                this._serializeCommentNode(currentNode);\r\n\r\n            else if (this.treeAdapter.isDocumentTypeNode(currentNode))\r\n                this._serializeDocumentTypeNode(currentNode);\r\n        }\r\n    }\r\n};\r\n\r\nSerializer.prototype._serializeElement = function (node) {\r\n    var tn = this.treeAdapter.getTagName(node),\r\n        ns = this.treeAdapter.getNamespaceURI(node);\r\n\r\n    this.html += '<' + tn;\r\n    this._serializeAttributes(node);\r\n    this.html += '>';\r\n\r\n    if (tn !== $.AREA && tn !== $.BASE && tn !== $.BASEFONT && tn !== $.BGSOUND && tn !== $.BR && tn !== $.BR &&\r\n        tn !== $.COL && tn !== $.EMBED && tn !== $.FRAME && tn !== $.HR && tn !== $.IMG && tn !== $.INPUT &&\r\n        tn !== $.KEYGEN && tn !== $.LINK && tn !== $.MENUITEM && tn !== $.META && tn !== $.PARAM && tn !== $.SOURCE &&\r\n        tn !== $.TRACK && tn !== $.WBR) {\r\n\r\n        if (tn === $.PRE || tn === $.TEXTAREA || tn === $.LISTING) {\r\n            var firstChild = this.treeAdapter.getFirstChild(node);\r\n\r\n            if (firstChild && this.treeAdapter.isTextNode(firstChild)) {\r\n                var content = this.treeAdapter.getTextNodeContent(firstChild);\r\n\r\n                if (content[0] === '\\n')\r\n                    this.html += '\\n';\r\n            }\r\n        }\r\n\r\n        var childNodesHolder = tn === $.TEMPLATE && ns === NS.HTML ?\r\n                               this.treeAdapter.getChildNodes(node)[0] :\r\n                               node;\r\n\r\n        this._serializeChildNodes(childNodesHolder);\r\n        this.html += '</' + tn + '>';\r\n    }\r\n};\r\n\r\nSerializer.prototype._serializeAttributes = function (node) {\r\n    var attrs = this.treeAdapter.getAttrList(node);\r\n\r\n    for (var i = 0, attrsLength = attrs.length; i < attrsLength; i++) {\r\n        var attr = attrs[i],\r\n            value = this.options.encodeHtmlEntities ? escapeString(attr.value, true) : attr.value;\r\n\r\n        this.html += ' ';\r\n\r\n        if (!attr.namespace)\r\n            this.html += attr.name;\r\n\r\n        else if (attr.namespace === NS.XML)\r\n            this.html += 'xml:' + attr.name;\r\n\r\n        else if (attr.namespace === NS.XMLNS) {\r\n            if (attr.name !== 'xmlns')\r\n                this.html += 'xmlns:';\r\n\r\n            this.html += attr.name;\r\n        }\r\n\r\n        else if (attr.namespace === NS.XLINK)\r\n            this.html += 'xlink:' + attr.name;\r\n\r\n        else\r\n            this.html += attr.namespace + ':' + attr.name;\r\n\r\n        this.html += '=\"' + value + '\"';\r\n    }\r\n};\r\n\r\nSerializer.prototype._serializeTextNode = function (node) {\r\n    var content = this.treeAdapter.getTextNodeContent(node),\r\n        parent = this.treeAdapter.getParentNode(node),\r\n        parentTn = void 0;\r\n\r\n    if (parent && this.treeAdapter.isElementNode(parent))\r\n        parentTn = this.treeAdapter.getTagName(parent);\r\n\r\n    if (parentTn === $.STYLE || parentTn === $.SCRIPT || parentTn === $.XMP || parentTn === $.IFRAME ||\r\n        parentTn === $.NOEMBED || parentTn === $.NOFRAMES || parentTn === $.PLAINTEXT || parentTn === $.NOSCRIPT) {\r\n        this.html += content;\r\n    }\r\n\r\n    else\r\n        this.html += this.options.encodeHtmlEntities ? escapeString(content, false) : content;\r\n};\r\n\r\nSerializer.prototype._serializeCommentNode = function (node) {\r\n    this.html += '<!--' + this.treeAdapter.getCommentNodeContent(node) + '-->';\r\n};\r\n\r\nSerializer.prototype._serializeDocumentTypeNode = function (node) {\r\n    var name = this.treeAdapter.getDocumentTypeNodeName(node),\r\n        publicId = this.treeAdapter.getDocumentTypeNodePublicId(node),\r\n        systemId = this.treeAdapter.getDocumentTypeNodeSystemId(node);\r\n\r\n    this.html += '<' + Doctype.serializeContent(name, publicId, systemId) + '>';\r\n};\r\n"]}