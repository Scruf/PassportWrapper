{"version":3,"sources":["tokenizer_proxy.js"],"names":[],"mappings":"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","file":"tokenizer_proxy-compiled.js","sourcesContent":["'use strict';\r\n\r\nvar Tokenizer = require('../tokenization/tokenizer'),\r\n    ForeignContent = require('../common/foreign_content'),\r\n    UNICODE = require('../common/unicode'),\r\n    HTML = require('../common/html');\r\n\r\n//Aliases\r\nvar $ = HTML.TAG_NAMES,\r\n    NS = HTML.NAMESPACES;\r\n\r\n\r\n//Tokenizer proxy\r\n//NOTE: this proxy simulates adjustment of the Tokenizer which performed by standard parser during tree construction.\r\nvar TokenizerProxy = module.exports = function (html, options) {\r\n    this.tokenizer = new Tokenizer(html, options);\r\n\r\n    this.namespaceStack = [];\r\n    this.namespaceStackTop = -1;\r\n    this.currentNamespace = null;\r\n    this.inForeignContent = false;\r\n};\r\n\r\n//API\r\nTokenizerProxy.prototype.getNextToken = function () {\r\n    var token = this.tokenizer.getNextToken();\r\n\r\n    if (token.type === Tokenizer.START_TAG_TOKEN)\r\n        this._handleStartTagToken(token);\r\n\r\n    else if (token.type === Tokenizer.END_TAG_TOKEN)\r\n        this._handleEndTagToken(token);\r\n\r\n    else if (token.type === Tokenizer.NULL_CHARACTER_TOKEN && this.inForeignContent) {\r\n        token.type = Tokenizer.CHARACTER_TOKEN;\r\n        token.chars = UNICODE.REPLACEMENT_CHARACTER;\r\n    }\r\n\r\n    return token;\r\n};\r\n\r\n//Namespace stack mutations\r\nTokenizerProxy.prototype._enterNamespace = function (namespace) {\r\n    this.namespaceStackTop++;\r\n    this.namespaceStack.push(namespace);\r\n\r\n    this.inForeignContent = namespace !== NS.HTML;\r\n    this.currentNamespace = namespace;\r\n    this.tokenizer.allowCDATA = this.inForeignContent;\r\n};\r\n\r\nTokenizerProxy.prototype._leaveCurrentNamespace = function () {\r\n    this.namespaceStackTop--;\r\n    this.namespaceStack.pop();\r\n\r\n    this.currentNamespace = this.namespaceStack[this.namespaceStackTop];\r\n    this.inForeignContent = this.currentNamespace !== NS.HTML;\r\n    this.tokenizer.allowCDATA = this.inForeignContent;\r\n};\r\n\r\n//Token handlers\r\nTokenizerProxy.prototype._ensureTokenizerMode = function (tn) {\r\n    if (tn === $.TEXTAREA || tn === $.TITLE)\r\n        this.tokenizer.state = Tokenizer.MODE.RCDATA;\r\n\r\n    else if (tn === $.PLAINTEXT)\r\n        this.tokenizer.state = Tokenizer.MODE.PLAINTEXT;\r\n\r\n    else if (tn === $.SCRIPT)\r\n        this.tokenizer.state = Tokenizer.MODE.SCRIPT_DATA;\r\n\r\n    else if (tn === $.STYLE || tn === $.IFRAME || tn === $.XMP ||\r\n             tn === $.NOEMBED || tn === $.NOFRAMES || tn === $.NOSCRIPT) {\r\n        this.tokenizer.state = Tokenizer.MODE.RAWTEXT;\r\n    }\r\n};\r\n\r\nTokenizerProxy.prototype._handleStartTagToken = function (token) {\r\n    var tn = token.tagName;\r\n\r\n    if (tn === $.SVG)\r\n        this._enterNamespace(NS.SVG);\r\n\r\n    else if (tn === $.MATH)\r\n        this._enterNamespace(NS.MATHML);\r\n\r\n    else {\r\n        if (this.inForeignContent) {\r\n            if (ForeignContent.causesExit(token))\r\n                this._leaveCurrentNamespace();\r\n\r\n            else if (ForeignContent.isMathMLTextIntegrationPoint(tn, this.currentNamespace) ||\r\n                     ForeignContent.isHtmlIntegrationPoint(tn, this.currentNamespace, token.attrs)) {\r\n                this._enterNamespace(NS.HTML);\r\n            }\r\n        }\r\n\r\n        else\r\n            this._ensureTokenizerMode(tn);\r\n    }\r\n};\r\n\r\nTokenizerProxy.prototype._handleEndTagToken = function (token) {\r\n    var tn = token.tagName;\r\n\r\n    if (!this.inForeignContent) {\r\n        var previousNs = this.namespaceStack[this.namespaceStackTop - 1];\r\n\r\n        //NOTE: check for exit from integration point\r\n        if (ForeignContent.isMathMLTextIntegrationPoint(tn, previousNs) ||\r\n            ForeignContent.isHtmlIntegrationPoint(tn, previousNs, token.attrs)) {\r\n            this._leaveCurrentNamespace();\r\n        }\r\n\r\n        else if (tn === $.SCRIPT)\r\n            this.tokenizer.state = Tokenizer.MODE.DATA;\r\n    }\r\n\r\n    else if ((tn === $.SVG && this.currentNamespace === NS.SVG) ||\r\n             (tn === $.MATH && this.currentNamespace === NS.MATHML))\r\n        this._leaveCurrentNamespace();\r\n};\r\n"]}