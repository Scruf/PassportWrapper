{"version":3,"sources":["open_element_stack.js"],"names":[],"mappings":"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","file":"open_element_stack-compiled.js","sourcesContent":["'use strict';\r\n\r\nvar HTML = require('../common/html');\r\n\r\n//Aliases\r\nvar $ = HTML.TAG_NAMES,\r\n    NS = HTML.NAMESPACES;\r\n\r\n//Element utils\r\n\r\n//OPTIMIZATION: Integer comparisons are low-cost, so we can use very fast tag name length filters here.\r\n//It's faster than using dictionary.\r\nfunction isImpliedEndTagRequired(tn) {\r\n    switch (tn.length) {\r\n        case 1:\r\n            return tn === $.P;\r\n\r\n        case 2:\r\n            return tn === $.RP || tn === $.RT || tn === $.DD || tn === $.DT || tn === $.LI;\r\n\r\n        case 6:\r\n            return tn === $.OPTION;\r\n\r\n        case 8:\r\n            return tn === $.OPTGROUP;\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\nfunction isScopingElement(tn, ns) {\r\n    switch (tn.length) {\r\n        case 2:\r\n            if (tn === $.TD || tn === $.TH)\r\n                return ns === NS.HTML;\r\n\r\n            else if (tn === $.MI || tn === $.MO || tn == $.MN || tn === $.MS)\r\n                return ns === NS.MATHML;\r\n\r\n            break;\r\n\r\n        case 4:\r\n            if (tn === $.HTML)\r\n                return ns === NS.HTML;\r\n\r\n            else if (tn === $.DESC)\r\n                return ns === NS.SVG;\r\n\r\n            break;\r\n\r\n        case 5:\r\n            if (tn === $.TABLE)\r\n                return ns === NS.HTML;\r\n\r\n            else if (tn === $.MTEXT)\r\n                return ns === NS.MATHML;\r\n\r\n            else if (tn === $.TITLE)\r\n                return ns === NS.SVG;\r\n\r\n            break;\r\n\r\n        case 6:\r\n            return (tn === $.APPLET || tn === $.OBJECT) && ns === NS.HTML;\r\n\r\n        case 7:\r\n            return (tn === $.CAPTION || tn === $.MARQUEE) && ns === NS.HTML;\r\n\r\n        case 8:\r\n            return tn === $.TEMPLATE && ns === NS.HTML;\r\n\r\n        case 13:\r\n            return tn === $.FOREIGN_OBJECT && ns === NS.SVG;\r\n\r\n        case 14:\r\n            return tn === $.ANNOTATION_XML && ns === NS.MATHML;\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\n//Stack of open elements\r\nvar OpenElementStack = module.exports = function (document, treeAdapter) {\r\n    this.stackTop = -1;\r\n    this.items = [];\r\n    this.current = document;\r\n    this.currentTagName = null;\r\n    this.currentTmplContent = null;\r\n    this.tmplCount = 0;\r\n    this.treeAdapter = treeAdapter;\r\n};\r\n\r\n//Index of element\r\nOpenElementStack.prototype._indexOf = function (element) {\r\n    var idx = -1;\r\n\r\n    for (var i = this.stackTop; i >= 0; i--) {\r\n        if (this.items[i] === element) {\r\n            idx = i;\r\n            break;\r\n        }\r\n    }\r\n    return idx;\r\n};\r\n\r\n//Update current element\r\nOpenElementStack.prototype._isInTemplate = function () {\r\n    if (this.currentTagName !== $.TEMPLATE)\r\n        return false;\r\n\r\n    return this.treeAdapter.getNamespaceURI(this.current) === NS.HTML;\r\n};\r\n\r\nOpenElementStack.prototype._updateCurrentElement = function () {\r\n    this.current = this.items[this.stackTop];\r\n    this.currentTagName = this.current && this.treeAdapter.getTagName(this.current);\r\n\r\n    this.currentTmplContent = this._isInTemplate() ? this.treeAdapter.getChildNodes(this.current)[0] : null;\r\n};\r\n\r\n//Mutations\r\nOpenElementStack.prototype.push = function (element) {\r\n    this.items[++this.stackTop] = element;\r\n    this._updateCurrentElement();\r\n\r\n    if (this._isInTemplate())\r\n        this.tmplCount++;\r\n\r\n};\r\n\r\nOpenElementStack.prototype.pop = function () {\r\n    this.stackTop--;\r\n\r\n    if (this.tmplCount > 0 && this._isInTemplate())\r\n        this.tmplCount--;\r\n\r\n    this._updateCurrentElement();\r\n};\r\n\r\nOpenElementStack.prototype.replace = function (oldElement, newElement) {\r\n    var idx = this._indexOf(oldElement);\r\n    this.items[idx] = newElement;\r\n\r\n    if (idx === this.stackTop)\r\n        this._updateCurrentElement();\r\n};\r\n\r\nOpenElementStack.prototype.insertAfter = function (referenceElement, newElement) {\r\n    var insertionIdx = this._indexOf(referenceElement) + 1;\r\n\r\n    this.items.splice(insertionIdx, 0, newElement);\r\n\r\n    if (insertionIdx == ++this.stackTop)\r\n        this._updateCurrentElement();\r\n};\r\n\r\nOpenElementStack.prototype.popUntilTagNamePopped = function (tagName) {\r\n    while (this.stackTop > -1) {\r\n        var tn = this.currentTagName;\r\n\r\n        this.pop();\r\n\r\n        if (tn === tagName)\r\n            break;\r\n    }\r\n};\r\n\r\nOpenElementStack.prototype.popUntilTemplatePopped = function () {\r\n    while (this.stackTop > -1) {\r\n        var tn = this.currentTagName,\r\n            ns = this.treeAdapter.getNamespaceURI(this.current);\r\n\r\n        this.pop();\r\n\r\n        if (tn === $.TEMPLATE && ns === NS.HTML)\r\n            break;\r\n    }\r\n};\r\n\r\nOpenElementStack.prototype.popUntilElementPopped = function (element) {\r\n    while (this.stackTop > -1) {\r\n        var poppedElement = this.current;\r\n\r\n        this.pop();\r\n\r\n        if (poppedElement === element)\r\n            break;\r\n    }\r\n};\r\n\r\nOpenElementStack.prototype.popUntilNumberedHeaderPopped = function () {\r\n    while (this.stackTop > -1) {\r\n        var tn = this.currentTagName;\r\n\r\n        this.pop();\r\n\r\n        if (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6)\r\n            break;\r\n    }\r\n};\r\n\r\nOpenElementStack.prototype.popAllUpToHtmlElement = function () {\r\n    //NOTE: here we assume that root <html> element is always first in the open element stack, so\r\n    //we perform this fast stack clean up.\r\n    this.stackTop = 0;\r\n    this._updateCurrentElement();\r\n};\r\n\r\nOpenElementStack.prototype.clearBackToTableContext = function () {\r\n    while (this.currentTagName !== $.TABLE && this.currentTagName !== $.TEMPLATE && this.currentTagName !== $.HTML)\r\n        this.pop();\r\n};\r\n\r\nOpenElementStack.prototype.clearBackToTableBodyContext = function () {\r\n    while (this.currentTagName !== $.TBODY && this.currentTagName !== $.TFOOT &&\r\n           this.currentTagName !== $.THEAD && this.currentTagName !== $.TEMPLATE &&\r\n           this.currentTagName !== $.HTML) {\r\n        this.pop();\r\n    }\r\n};\r\n\r\nOpenElementStack.prototype.clearBackToTableRowContext = function () {\r\n    while (this.currentTagName !== $.TR && this.currentTagName !== $.TEMPLATE && this.currentTagName !== $.HTML)\r\n        this.pop();\r\n};\r\n\r\nOpenElementStack.prototype.remove = function (element) {\r\n    for (var i = this.stackTop; i >= 0; i--) {\r\n        if (this.items[i] === element) {\r\n            this.items.splice(i, 1);\r\n            this.stackTop--;\r\n            this._updateCurrentElement();\r\n            break;\r\n        }\r\n    }\r\n};\r\n\r\n//Search\r\nOpenElementStack.prototype.tryPeekProperlyNestedBodyElement = function () {\r\n    //Properly nested <body> element (should be second element in stack).\r\n    var element = this.items[1];\r\n    return element && this.treeAdapter.getTagName(element) === $.BODY ? element : null;\r\n};\r\n\r\nOpenElementStack.prototype.contains = function (element) {\r\n    return this._indexOf(element) > -1;\r\n};\r\n\r\nOpenElementStack.prototype.getCommonAncestor = function (element) {\r\n    var elementIdx = this._indexOf(element);\r\n\r\n    return --elementIdx >= 0 ? this.items[elementIdx] : null;\r\n};\r\n\r\nOpenElementStack.prototype.isRootHtmlElementCurrent = function () {\r\n    return this.stackTop === 0 && this.currentTagName === $.HTML;\r\n};\r\n\r\n//Element in scope\r\nOpenElementStack.prototype.hasInScope = function (tagName) {\r\n    for (var i = this.stackTop; i >= 0; i--) {\r\n        var tn = this.treeAdapter.getTagName(this.items[i]);\r\n\r\n        if (tn === tagName)\r\n            return true;\r\n\r\n        var ns = this.treeAdapter.getNamespaceURI(this.items[i]);\r\n\r\n        if (isScopingElement(tn, ns))\r\n            return false;\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\nOpenElementStack.prototype.hasNumberedHeaderInScope = function () {\r\n    for (var i = this.stackTop; i >= 0; i--) {\r\n        var tn = this.treeAdapter.getTagName(this.items[i]);\r\n\r\n        if (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6)\r\n            return true;\r\n\r\n        if (isScopingElement(tn, this.treeAdapter.getNamespaceURI(this.items[i])))\r\n            return false;\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\nOpenElementStack.prototype.hasInListItemScope = function (tagName) {\r\n    for (var i = this.stackTop; i >= 0; i--) {\r\n        var tn = this.treeAdapter.getTagName(this.items[i]);\r\n\r\n        if (tn === tagName)\r\n            return true;\r\n\r\n        var ns = this.treeAdapter.getNamespaceURI(this.items[i]);\r\n\r\n        if (((tn === $.UL || tn === $.OL) && ns === NS.HTML) || isScopingElement(tn, ns))\r\n            return false;\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\nOpenElementStack.prototype.hasInButtonScope = function (tagName) {\r\n    for (var i = this.stackTop; i >= 0; i--) {\r\n        var tn = this.treeAdapter.getTagName(this.items[i]);\r\n\r\n        if (tn === tagName)\r\n            return true;\r\n\r\n        var ns = this.treeAdapter.getNamespaceURI(this.items[i]);\r\n\r\n        if ((tn === $.BUTTON && ns === NS.HTML) || isScopingElement(tn, ns))\r\n            return false;\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\nOpenElementStack.prototype.hasInTableScope = function (tagName) {\r\n    for (var i = this.stackTop; i >= 0; i--) {\r\n        var tn = this.treeAdapter.getTagName(this.items[i]);\r\n\r\n        if (tn === tagName)\r\n            return true;\r\n\r\n        var ns = this.treeAdapter.getNamespaceURI(this.items[i]);\r\n\r\n        if ((tn === $.TABLE || tn === $.TEMPLATE || tn === $.HTML) && ns === NS.HTML)\r\n            return false;\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\nOpenElementStack.prototype.hasTableBodyContextInTableScope = function () {\r\n    for (var i = this.stackTop; i >= 0; i--) {\r\n        var tn = this.treeAdapter.getTagName(this.items[i]);\r\n\r\n        if (tn === $.TBODY || tn === $.THEAD || tn === $.TFOOT)\r\n            return true;\r\n\r\n        var ns = this.treeAdapter.getNamespaceURI(this.items[i]);\r\n\r\n        if ((tn === $.TABLE || tn === $.HTML) && ns === NS.HTML)\r\n            return false;\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\nOpenElementStack.prototype.hasInSelectScope = function (tagName) {\r\n    for (var i = this.stackTop; i >= 0; i--) {\r\n        var tn = this.treeAdapter.getTagName(this.items[i]);\r\n\r\n        if (tn === tagName)\r\n            return true;\r\n\r\n        var ns = this.treeAdapter.getNamespaceURI(this.items[i]);\r\n\r\n        if (tn !== $.OPTION && tn !== $.OPTGROUP && ns === NS.HTML)\r\n            return false;\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\n//Implied end tags\r\nOpenElementStack.prototype.generateImpliedEndTags = function () {\r\n    while (isImpliedEndTagRequired(this.currentTagName))\r\n        this.pop();\r\n};\r\n\r\nOpenElementStack.prototype.generateImpliedEndTagsWithExclusion = function (exclusionTagName) {\r\n    while (isImpliedEndTagRequired(this.currentTagName) && this.currentTagName !== exclusionTagName)\r\n        this.pop();\r\n};\r\n"]}