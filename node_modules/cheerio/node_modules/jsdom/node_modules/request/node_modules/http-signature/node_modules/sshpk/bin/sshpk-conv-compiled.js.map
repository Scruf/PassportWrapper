{"version":3,"sources":["sshpk-conv"],"names":[],"mappings":"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","file":"sshpk-conv-compiled.js","sourcesContent":["#!/usr/bin/env node\n// -*- mode: js -*-\n// vim: set filetype=javascript :\n// Copyright 2015 Joyent, Inc.  All rights reserved.\n\nvar dashdash = require('dashdash');\nvar sshpk = require('../lib/index');\nvar fs = require('fs');\nvar path = require('path');\n\nvar options = [\n\t{\n\t\tnames: ['outformat', 't'],\n\t\ttype: 'string',\n\t\thelp: 'Output format'\n\t},\n\t{\n\t\tnames: ['informat', 'T'],\n\t\ttype: 'string',\n\t\thelp: 'Input format'\n\t},\n\t{\n\t\tnames: ['file', 'f'],\n\t\ttype: 'string',\n\t\thelp: 'Input file name (default stdin)'\n\t},\n\t{\n\t\tnames: ['out', 'o'],\n\t\ttype: 'string',\n\t\thelp: 'Output file name (default stdout)'\n\t},\n\t{\n\t\tnames: ['private', 'p'],\n\t\ttype: 'bool',\n\t\thelp: 'Produce a private key as output'\n\t},\n\t{\n\t\tnames: ['derive', 'd'],\n\t\ttype: 'string',\n\t\thelp: 'Output a new key derived from this one, with given algo'\n\t},\n\t{\n\t\tnames: ['identify', 'i'],\n\t\ttype: 'bool',\n\t\thelp: 'Print key metadata instead of converting'\n\t},\n\t{\n\t\tnames: ['comment', 'c'],\n\t\ttype: 'string',\n\t\thelp: 'Set key comment, if output format supports'\n\t},\n\t{\n\t\tnames: ['help', 'h'],\n\t\ttype: 'bool',\n\t\thelp: 'Shows this help text'\n\t}\n];\n\nif (require.main === module) {\n\tvar parser = dashdash.createParser({\n\t\toptions: options\n\t});\n\n\ttry {\n\t\tvar opts = parser.parse(process.argv);\n\t} catch (e) {\n\t\tconsole.error('sshpk-conv: error: %s', e.message);\n\t\tprocess.exit(1);\n\t}\n\n\tif (opts.help || opts._args.length > 1) {\n\t\tvar help = parser.help({}).trimRight();\n\t\tconsole.error('sshpk-conv: converts between SSH key formats\\n');\n\t\tconsole.error(help);\n\t\tconsole.error('\\navailable formats:');\n\t\tconsole.error('  - pem, pkcs1     eg id_rsa');\n\t\tconsole.error('  - ssh            eg id_rsa.pub');\n\t\tconsole.error('  - pkcs8          format you want for openssl');\n\t\tconsole.error('  - openssh        like output of ssh-keygen -o');\n\t\tconsole.error('  - rfc4253        raw OpenSSH wire format');\n\t\tprocess.exit(1);\n\t}\n\n\t/*\n\t * Key derivation can only be done on private keys, so use of the -d\n\t * option necessarily implies -p.\n\t */\n\tif (opts.derive)\n\t\topts.private = true;\n\n\tvar inFile = process.stdin;\n\tvar inFileName = 'stdin';\n\n\tvar inFilePath;\n\tif (opts.file) {\n\t\tinFilePath = opts.file;\n\t} else if (opts._args.length === 1) {\n\t\tinFilePath = opts._args[0];\n\t}\n\n\tif (inFilePath)\n\t\tinFileName = path.basename(inFilePath);\n\n\ttry {\n\t\tif (inFilePath) {\n\t\t\tfs.accessSync(inFilePath, fs.R_OK);\n\t\t\tinFile = fs.createReadStream(inFilePath);\n\t\t}\n\t} catch (e) {\n\t\tconsole.error('sshpk-conv: error opening input file' +\n\t\t     ': ' + e.name + ': ' + e.message);\n\t\tprocess.exit(1);\n\t}\n\n\tvar outFile = process.stdout;\n\n\ttry {\n\t\tif (opts.out && !opts.identify) {\n\t\t\tfs.accessSync(path.dirname(opts.out), fs.W_OK);\n\t\t\toutFile = fs.createWriteStream(opts.out);\n\t\t}\n\t} catch (e) {\n\t\tconsole.error('sshpk-conv: error opening output file' +\n\t\t    ': ' + e.name + ': ' + e.message);\n\t\tprocess.exit(1);\n\t}\n\n\tvar bufs = [];\n\tinFile.on('readable', function () {\n\t\tvar data;\n\t\twhile ((data = inFile.read()))\n\t\t\tbufs.push(data);\n\t});\n\tinFile.on('end', function () {\n\t\tvar buf = Buffer.concat(bufs);\n\t\tvar fmt = 'auto';\n\t\tif (opts.informat)\n\t\t\tfmt = opts.informat;\n\t\tvar f = sshpk.parseKey;\n\t\tif (opts.private)\n\t\t\tf = sshpk.parsePrivateKey;\n\t\ttry {\n\t\t\tvar key = f(buf, fmt, inFileName);\n\t\t} catch (e) {\n\t\t\tconsole.error('sshpk-conv: ' +\n\t\t\t    e.name + ': ' + e.message);\n\t\t\tprocess.exit(1);\n\t\t}\n\n\t\tif (opts.derive)\n\t\t\tkey = key.derive(opts.derive);\n\n\t\tif (opts.comment)\n\t\t\tkey.comment = opts.comment;\n\n\t\tif (!opts.identify) {\n\t\t\tfmt = undefined;\n\t\t\tif (opts.outformat)\n\t\t\t\tfmt = opts.outformat;\n\t\t\toutFile.write(key.toBuffer(fmt));\n\t\t\tif (fmt === 'ssh' ||\n\t\t\t    (!opts.private && fmt === undefined))\n\t\t\t\toutFile.write('\\n');\n\t\t\toutFile.once('drain', function () {\n\t\t\t\tprocess.exit(0);\n\t\t\t});\n\t\t} else {\n\t\t\tvar kind = 'public';\n\t\t\tif (sshpk.PrivateKey.isPrivateKey(key))\n\t\t\t\tkind = 'private';\n\t\t\tconsole.log('%s: a %d bit %s %s key', inFileName,\n\t\t\t    key.size, key.type.toUpperCase(), kind);\n\t\t\tif (key.type === 'ecdsa')\n\t\t\t\tconsole.log('ECDSA curve: %s', key.curve);\n\t\t\tif (key.comment)\n\t\t\t\tconsole.log('Comment: %s', key.comment);\n\t\t\tconsole.log('Fingerprint:');\n\t\t\tconsole.log('  ' + key.fingerprint().toString());\n\t\t\tconsole.log('  ' + key.fingerprint('md5').toString());\n\t\t\tprocess.exit(0);\n\t\t}\n\t});\n}\n"]}