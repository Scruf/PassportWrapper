{"version":3,"sources":["dhe.js"],"names":[],"mappings":"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","file":"dhe-compiled.js","sourcesContent":["// Copyright 2015 Joyent, Inc.\n\nmodule.exports = DiffieHellman;\n\nvar assert = require('assert-plus');\nvar crypto = require('crypto');\nvar algs = require('./algs');\nvar utils = require('./utils');\nvar ed;\n\nvar Key = require('./key');\nvar PrivateKey = require('./private-key');\n\nvar CRYPTO_HAVE_ECDH = (crypto.createECDH !== undefined);\n\nvar ecdh, ec, jsbn;\n\nfunction DiffieHellman(key) {\n\tutils.assertCompatible(key, Key, [1, 4], 'key');\n\tthis._isPriv = PrivateKey.isPrivateKey(key, [1, 3]);\n\tthis._algo = key.type;\n\tthis._curve = key.curve;\n\tthis._key = key;\n\tif (key.type === 'dsa') {\n\t\tif (!CRYPTO_HAVE_ECDH) {\n\t\t\tthrow (new Error('Due to bugs in the node 0.10 ' +\n\t\t\t    'crypto API, node 0.12.x or later is required ' +\n\t\t\t    'to use DH'));\n\t\t}\n\t\tthis._dh = crypto.createDiffieHellman(\n\t\t    key.part.p.data, undefined,\n\t\t    key.part.g.data, undefined);\n\t\tthis._p = key.part.p;\n\t\tthis._g = key.part.g;\n\t\tif (this._isPriv)\n\t\t\tthis._dh.setPrivateKey(key.part.x.data);\n\t\tthis._dh.setPublicKey(key.part.y.data);\n\n\t} else if (key.type === 'ecdsa') {\n\t\tif (!CRYPTO_HAVE_ECDH) {\n\t\t\tif (ecdh === undefined)\n\t\t\t\tecdh = require('ecc-jsbn');\n\t\t\tif (ec === undefined)\n\t\t\t\tec = require('ecc-jsbn/lib/ec');\n\t\t\tif (jsbn === undefined)\n\t\t\t\tjsbn = require('jsbn').BigInteger;\n\n\t\t\tthis._ecParams = new X9ECParameters(this._curve);\n\n\t\t\tif (this._isPriv) {\n\t\t\t\tthis._priv = new ECPrivate(\n\t\t\t\t    this._ecParams, key.part.d.data);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tvar curve = {\n\t\t\t'nistp256': 'prime256v1',\n\t\t\t'nistp384': 'secp384r1',\n\t\t\t'nistp521': 'secp521r1'\n\t\t}[key.curve];\n\t\tthis._dh = crypto.createECDH(curve);\n\t\tif (typeof (this._dh) !== 'object' ||\n\t\t    typeof (this._dh.setPrivateKey) !== 'function') {\n\t\t\tCRYPTO_HAVE_ECDH = false;\n\t\t\tDiffieHellman.call(this, key);\n\t\t\treturn;\n\t\t}\n\t\tif (this._isPriv)\n\t\t\tthis._dh.setPrivateKey(key.part.d.data);\n\t\tthis._dh.setPublicKey(key.part.Q.data);\n\n\t} else if (key.type === 'curve25519') {\n\t\tif (ed === undefined)\n\t\t\ted = require('jodid25519');\n\n\t\tif (this._isPriv) {\n\t\t\tthis._priv = key.part.r.data;\n\t\t\tif (this._priv[0] === 0x00)\n\t\t\t\tthis._priv = this._priv.slice(1);\n\t\t\tthis._priv = this._priv.slice(0, 32);\n\t\t}\n\n\t} else {\n\t\tthrow (new Error('DH not supported for ' + key.type + ' keys'));\n\t}\n}\n\nDiffieHellman.prototype.getPublicKey = function () {\n\tif (this._isPriv)\n\t\treturn (this._key.toPublic());\n\treturn (this._key);\n};\n\nDiffieHellman.prototype.getPrivateKey = function () {\n\tif (this._isPriv)\n\t\treturn (this._key);\n\telse\n\t\treturn (undefined);\n};\nDiffieHellman.prototype.getKey = DiffieHellman.prototype.getPrivateKey;\n\nDiffieHellman.prototype._keyCheck = function (pk, isPub) {\n\tassert.object(pk, 'key');\n\tif (!isPub)\n\t\tutils.assertCompatible(pk, PrivateKey, [1, 3], 'key');\n\tutils.assertCompatible(pk, Key, [1, 4], 'key');\n\n\tif (pk.type !== this._algo) {\n\t\tthrow (new Error('A ' + pk.type + ' key cannot be used in ' +\n\t\t    this._algo + ' Diffie-Hellman'));\n\t}\n\n\tif (pk.curve !== this._curve) {\n\t\tthrow (new Error('A key from the ' + pk.curve + ' curve ' +\n\t\t    'cannot be used with a ' + this._curve +\n\t\t    ' Diffie-Hellman'));\n\t}\n\n\tif (pk.type === 'dsa') {\n\t\tassert.deepEqual(pk.part.p, this._p,\n\t\t    'DSA key prime does not match');\n\t\tassert.deepEqual(pk.part.g, this._g,\n\t\t    'DSA key generator does not match');\n\t}\n};\n\nDiffieHellman.prototype.setKey = function (pk) {\n\tthis._keyCheck(pk);\n\n\tif (pk.type === 'dsa') {\n\t\tthis._dh.setPrivateKey(pk.part.x.data);\n\t\tthis._dh.setPublicKey(pk.part.y.data);\n\n\t} else if (pk.type === 'ecdsa') {\n\t\tif (CRYPTO_HAVE_ECDH) {\n\t\t\tthis._dh.setPrivateKey(pk.part.d.data);\n\t\t\tthis._dh.setPublicKey(pk.part.Q.data);\n\t\t} else {\n\t\t\tthis._priv = new ECPrivate(\n\t\t\t    this._ecParams, pk.part.d.data);\n\t\t}\n\n\t} else if (pk.type === 'curve25519') {\n\t\tthis._priv = pk.part.r.data;\n\t\tif (this._priv[0] === 0x00)\n\t\t\tthis._priv = this._priv.slice(1);\n\t\tthis._priv = this._priv.slice(0, 32);\n\t}\n\tthis._key = pk;\n\tthis._isPriv = true;\n};\nDiffieHellman.prototype.setPrivateKey = DiffieHellman.prototype.setKey;\n\nDiffieHellman.prototype.computeSecret = function (otherpk) {\n\tthis._keyCheck(otherpk, true);\n\tif (!this._isPriv)\n\t\tthrow (new Error('DH exchange has not been initialized with ' +\n\t\t    'a private key yet'));\n\n\tvar pub;\n\tif (this._algo === 'dsa') {\n\t\treturn (this._dh.computeSecret(\n\t\t    otherpk.part.y.data));\n\n\t} else if (this._algo === 'ecdsa') {\n\t\tif (CRYPTO_HAVE_ECDH) {\n\t\t\treturn (this._dh.computeSecret(\n\t\t\t    otherpk.part.Q.data));\n\t\t} else {\n\t\t\tpub = new ECPublic(\n\t\t\t    this._ecParams, otherpk.part.Q.data);\n\t\t\treturn (this._priv.deriveSharedSecret(pub));\n\t\t}\n\n\t} else if (this._algo === 'curve25519') {\n\t\tpub = otherpk.part.R.data;\n\t\tif (pub[0] === 0x00)\n\t\t\tpub = pub.slice(1);\n\n\t\tvar secret = ed.dh.computeKey(\n\t\t    this._priv.toString('binary'),\n\t\t    pub.toString('binary'));\n\n\t\treturn (new Buffer(secret, 'binary'));\n\t}\n\n\tthrow (new Error('Invalid algorithm: ' + this._algo));\n};\n\nDiffieHellman.prototype.generateKey = function () {\n\tvar parts = [];\n\tvar priv, pub;\n\tif (this._algo === 'dsa') {\n\t\tthis._dh.generateKeys();\n\n\t\tparts.push({name: 'p', data: this._p.data});\n\t\tparts.push({name: 'q', data: this._key.part.q.data});\n\t\tparts.push({name: 'g', data: this._g.data});\n\t\tparts.push({name: 'y', data: this._dh.getPublicKey()});\n\t\tparts.push({name: 'x', data: this._dh.getPrivateKey()});\n\t\tthis._key = new PrivateKey({\n\t\t\ttype: 'dsa',\n\t\t\tparts: parts\n\t\t});\n\t\tthis._isPriv = true;\n\t\treturn (this._key);\n\n\t} else if (this._algo === 'ecdsa') {\n\t\tif (CRYPTO_HAVE_ECDH) {\n\t\t\tthis._dh.generateKeys();\n\n\t\t\tparts.push({name: 'curve',\n\t\t\t    data: new Buffer(this._curve)});\n\t\t\tparts.push({name: 'Q', data: this._dh.getPublicKey()});\n\t\t\tparts.push({name: 'd', data: this._dh.getPrivateKey()});\n\t\t\tthis._key = new PrivateKey({\n\t\t\t\ttype: 'ecdsa',\n\t\t\t\tcurve: this._curve,\n\t\t\t\tparts: parts\n\t\t\t});\n\t\t\tthis._isPriv = true;\n\t\t\treturn (this._key);\n\n\t\t} else {\n\t\t\tvar n = this._ecParams.getN();\n\t\t\tvar r = new jsbn(crypto.randomBytes(n.bitLength()));\n\t\t\tvar n1 = n.subtract(jsbn.ONE);\n\t\t\tpriv = r.mod(n1).add(jsbn.ONE);\n\t\t\tpub = this._ecParams.getG().multiply(priv);\n\n\t\t\tpriv = new Buffer(priv.toByteArray());\n\t\t\tpub = new Buffer(this._ecParams.getCurve().\n\t\t\t    encodePointHex(pub), 'hex');\n\n\t\t\tthis._priv = new ECPrivate(this._ecParams, priv);\n\n\t\t\tparts.push({name: 'curve',\n\t\t\t    data: new Buffer(this._curve)});\n\t\t\tparts.push({name: 'Q', data: pub});\n\t\t\tparts.push({name: 'd', data: priv});\n\n\t\t\tthis._key = new PrivateKey({\n\t\t\t\ttype: 'ecdsa',\n\t\t\t\tcurve: this._curve,\n\t\t\t\tparts: parts\n\t\t\t});\n\t\t\tthis._isPriv = true;\n\t\t\treturn (this._key);\n\t\t}\n\n\t} else if (this._algo === 'curve25519') {\n\t\tpriv = ed.dh.generateKey();\n\t\tpub = ed.dh.publicKey(priv);\n\t\tthis._priv = priv = new Buffer(priv, 'binary');\n\t\tpub = new Buffer(pub, 'binary');\n\n\t\tparts.push({name: 'R', data: pub});\n\t\tparts.push({name: 'r', data: Buffer.concat([priv, pub])});\n\t\tthis._key = new PrivateKey({\n\t\t\ttype: 'curve25519',\n\t\t\tparts: parts\n\t\t});\n\t\tthis._isPriv = true;\n\t\treturn (this._key);\n\t}\n\n\tthrow (new Error('Invalid algorithm: ' + this._algo));\n};\nDiffieHellman.prototype.generateKeys = DiffieHellman.prototype.generateKey;\n\n/* These are helpers for using ecc-jsbn (for node 0.10 compatibility). */\n\nfunction X9ECParameters(name) {\n\tvar params = algs.curves[name];\n\tassert.object(params);\n\n\tvar p = new jsbn(params.p);\n\tvar a = new jsbn(params.a);\n\tvar b = new jsbn(params.b);\n\tvar n = new jsbn(params.n);\n\tvar h = jsbn.ONE;\n\tvar curve = new ec.ECCurveFp(p, a, b);\n\tvar G = curve.decodePointHex(params.G.toString('hex'));\n\n\tthis.curve = curve;\n\tthis.g = G;\n\tthis.n = n;\n\tthis.h = h;\n}\nX9ECParameters.prototype.getCurve = function () { return (this.curve); };\nX9ECParameters.prototype.getG = function () { return (this.g); };\nX9ECParameters.prototype.getN = function () { return (this.n); };\nX9ECParameters.prototype.getH = function () { return (this.h); };\n\nfunction ECPublic(params, buffer) {\n\tthis._params = params;\n\tif (buffer[0] === 0x00)\n\t\tbuffer = buffer.slice(1);\n\tthis._pub = params.getCurve().decodePointHex(buffer.toString('hex'));\n}\n\nfunction ECPrivate(params, buffer) {\n\tthis._params = params;\n\tthis._priv = new jsbn(utils.mpNormalize(buffer));\n}\nECPrivate.prototype.deriveSharedSecret = function (pubKey) {\n\tassert.ok(pubKey instanceof ECPublic);\n\tvar S = pubKey._pub.multiply(this._priv);\n\treturn (new Buffer(S.getX().toBigInteger().toByteArray()));\n};\n"]}