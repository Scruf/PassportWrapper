{"version":3,"sources":["fingerprint.js"],"names":[],"mappings":"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","file":"fingerprint-compiled.js","sourcesContent":["// Copyright 2015 Joyent, Inc.\n\nmodule.exports = Fingerprint;\n\nvar assert = require('assert-plus');\nvar algs = require('./algs');\nvar crypto = require('crypto');\nvar errs = require('./errors');\nvar Key = require('./key');\nvar utils = require('./utils');\n\nvar FingerprintFormatError = errs.FingerprintFormatError;\nvar InvalidAlgorithmError = errs.InvalidAlgorithmError;\n\nfunction Fingerprint(opts) {\n\tassert.object(opts, 'options');\n\tassert.buffer(opts.hash, 'options.hash');\n\tassert.string(opts.algorithm, 'options.algorithm');\n\n\tthis.algorithm = opts.algorithm.toLowerCase();\n\tif (algs.hashAlgs[this.algorithm] !== true)\n\t\tthrow (new InvalidAlgorithmError(this.algorithm));\n\n\tthis.hash = opts.hash;\n}\n\nFingerprint.prototype.toString = function (format) {\n\tif (format === undefined) {\n\t\tif (this.algorithm === 'md5')\n\t\t\tformat = 'hex';\n\t\telse\n\t\t\tformat = 'base64';\n\t}\n\tassert.string(format);\n\n\tswitch (format) {\n\tcase 'hex':\n\t\treturn (addColons(this.hash.toString('hex')));\n\tcase 'base64':\n\t\treturn (sshBase64Format(this.algorithm,\n\t\t    this.hash.toString('base64')));\n\tdefault:\n\t\tthrow (new FingerprintFormatError(undefined, format));\n\t}\n};\n\nFingerprint.prototype.matches = function (key) {\n\tassert.object(key, 'key');\n\tutils.assertCompatible(key, Key, [1, 0], 'key');\n\n\tvar theirHash = key.hash(this.algorithm);\n\tvar theirHash2 = crypto.createHash(this.algorithm).\n\t    update(theirHash).digest('base64');\n\n\tif (this.hash2 === undefined)\n\t\tthis.hash2 = crypto.createHash(this.algorithm).\n\t\t    update(this.hash).digest('base64');\n\n\treturn (this.hash2 === theirHash2);\n};\n\nFingerprint.parse = function (fp, enAlgs) {\n\tassert.string(fp, 'fingerprint');\n\n\tvar alg, hash;\n\tassert.optionalArrayOfString(enAlgs, 'algorithms');\n\n\tvar parts = fp.split(':');\n\tif (parts.length == 2) {\n\t\talg = parts[0].toLowerCase();\n\t\t/*JSSTYLED*/\n\t\tvar base64RE = /^[A-Za-z0-9+\\/=]+$/;\n\t\tif (!base64RE.test(parts[1]))\n\t\t\tthrow (new FingerprintFormatError(fp));\n\t\ttry {\n\t\t\thash = new Buffer(parts[1], 'base64');\n\t\t} catch (e) {\n\t\t\tthrow (new FingerprintFormatError(fp));\n\t\t}\n\t} else if (parts.length > 2) {\n\t\talg = 'md5';\n\t\tif (parts[0].toLowerCase() === 'md5')\n\t\t\tparts = parts.slice(1);\n\t\tparts = parts.join('');\n\t\t/*JSSTYLED*/\n\t\tvar md5RE = /^[a-fA-F0-9]+$/;\n\t\tif (!md5RE.test(parts))\n\t\t\tthrow (new FingerprintFormatError(fp));\n\t\ttry {\n\t\t\thash = new Buffer(parts, 'hex');\n\t\t} catch (e) {\n\t\t\tthrow (new FingerprintFormatError(fp));\n\t\t}\n\t}\n\n\tif (alg === undefined)\n\t\tthrow (new FingerprintFormatError(fp));\n\n\tif (algs.hashAlgs[alg] === undefined)\n\t\tthrow (new InvalidAlgorithmError(alg));\n\n\tif (enAlgs !== undefined) {\n\t\tenAlgs = enAlgs.map(function (a) { return a.toLowerCase(); });\n\t\tif (enAlgs.indexOf(alg) === -1)\n\t\t\tthrow (new InvalidAlgorithmError(alg));\n\t}\n\n\treturn (new Fingerprint({algorithm: alg, hash: hash}));\n};\n\nfunction addColons(s) {\n\t/*JSSTYLED*/\n\treturn (s.replace(/(.{2})(?=.)/g, '$1:'));\n}\n\nfunction base64Strip(s) {\n\t/*JSSTYLED*/\n\treturn (s.replace(/=*$/, ''));\n}\n\nfunction sshBase64Format(alg, h) {\n\treturn (alg.toUpperCase() + ':' + base64Strip(h));\n}\n\nFingerprint.isFingerprint = function (obj, ver) {\n\treturn (utils.isCompatible(obj, Fingerprint, ver));\n};\n\n/*\n * API versions for Fingerprint:\n * [1,0] -- initial ver\n * [1,1] -- first tagged ver\n */\nFingerprint.prototype._sshpkApiVersion = [1, 1];\n\nFingerprint._oldVersionDetect = function (obj) {\n\tassert.func(obj.toString);\n\tassert.func(obj.matches);\n\treturn ([1, 0]);\n};\n"]}