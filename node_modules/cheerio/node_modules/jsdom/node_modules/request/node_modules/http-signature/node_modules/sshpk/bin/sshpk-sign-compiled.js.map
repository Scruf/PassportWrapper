{"version":3,"sources":["sshpk-sign"],"names":[],"mappings":"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","file":"sshpk-sign-compiled.js","sourcesContent":["#!/usr/bin/env node\n// -*- mode: js -*-\n// vim: set filetype=javascript :\n// Copyright 2015 Joyent, Inc.  All rights reserved.\n\nvar dashdash = require('dashdash');\nvar sshpk = require('../lib/index');\nvar fs = require('fs');\nvar path = require('path');\n\nvar options = [\n\t{\n\t\tnames: ['hash', 'H'],\n\t\ttype: 'string',\n\t\thelp: 'Hash algorithm (sha1, sha256, sha384, sha512)'\n\t},\n\t{\n\t\tnames: ['verbose', 'v'],\n\t\ttype: 'bool',\n\t\thelp: 'Display verbose info about key and hash used'\n\t},\n\t{\n\t\tnames: ['identity', 'i'],\n\t\ttype: 'string',\n\t\thelp: 'Path to key to use'\n\t},\n\t{\n\t\tnames: ['file', 'f'],\n\t\ttype: 'string',\n\t\thelp: 'Input filename'\n\t},\n\t{\n\t\tnames: ['out', 'o'],\n\t\ttype: 'string',\n\t\thelp: 'Output filename'\n\t},\n\t{\n\t\tnames: ['format', 't'],\n\t\ttype: 'string',\n\t\thelp: 'Signature format (asn1, ssh, raw)'\n\t},\n\t{\n\t\tnames: ['binary', 'b'],\n\t\ttype: 'bool',\n\t\thelp: 'Output raw binary instead of base64'\n\t},\n\t{\n\t\tnames: ['help', 'h'],\n\t\ttype: 'bool',\n\t\thelp: 'Shows this help text'\n\t}\n];\n\nif (require.main === module) {\n\tvar parser = dashdash.createParser({\n\t\toptions: options\n\t});\n\n\ttry {\n\t\tvar opts = parser.parse(process.argv);\n\t} catch (e) {\n\t\tconsole.error('sshpk-sign: error: %s', e.message);\n\t\tprocess.exit(1);\n\t}\n\n\tif (opts.help || opts._args.length > 1) {\n\t\tvar help = parser.help({}).trimRight();\n\t\tconsole.error('sshpk-sign: sign data using an SSH key\\n');\n\t\tconsole.error(help);\n\t\tprocess.exit(1);\n\t}\n\n\tif (!opts.identity) {\n\t\tvar help = parser.help({}).trimRight();\n\t\tconsole.error('sshpk-sign: the -i or --identity option ' +\n\t\t    'is required\\n');\n\t\tconsole.error(help);\n\t\tprocess.exit(1);\n\t}\n\n\tvar keyData = fs.readFileSync(opts.identity);\n\n\tvar key;\n\ttry {\n\t\tkey = sshpk.parsePrivateKey(keyData);\n\t} catch (e) {\n\t\tconsole.error('sshpk-sign: error loading private key \"' +\n\t\t    opts.identity + '\": ' + e.name + ': ' + e.message);\n\t\tprocess.exit(1);\n\t}\n\n\tvar hash = opts.hash || key.defaultHashAlgorithm();\n\n\tvar signer;\n\ttry {\n\t\tsigner = key.createSign(hash);\n\t} catch (e) {\n\t\tconsole.error('sshpk-sign: error creating signer: ' +\n\t\t    e.name + ': ' + e.message);\n\t\tprocess.exit(1);\n\t}\n\n\tif (opts.verbose) {\n\t\tconsole.error('sshpk-sign: using %s-%s with a %d bit key',\n\t\t    key.type, hash, key.size);\n\t}\n\n\tvar inFile = process.stdin;\n\tvar inFileName = 'stdin';\n\n\tvar inFilePath;\n\tif (opts.file) {\n\t\tinFilePath = opts.file;\n\t} else if (opts._args.length === 1) {\n\t\tinFilePath = opts._args[0];\n\t}\n\n\tif (inFilePath)\n\t\tinFileName = path.basename(inFilePath);\n\n\ttry {\n\t\tif (inFilePath) {\n\t\t\tfs.accessSync(inFilePath, fs.R_OK);\n\t\t\tinFile = fs.createReadStream(inFilePath);\n\t\t}\n\t} catch (e) {\n\t\tconsole.error('sshpk-sign: error opening input file' +\n\t\t     ': ' + e.name + ': ' + e.message);\n\t\tprocess.exit(1);\n\t}\n\n\tvar outFile = process.stdout;\n\n\ttry {\n\t\tif (opts.out && !opts.identify) {\n\t\t\tfs.accessSync(path.dirname(opts.out), fs.W_OK);\n\t\t\toutFile = fs.createWriteStream(opts.out);\n\t\t}\n\t} catch (e) {\n\t\tconsole.error('sshpk-sign: error opening output file' +\n\t\t    ': ' + e.name + ': ' + e.message);\n\t\tprocess.exit(1);\n\t}\n\n\tinFile.pipe(signer);\n\tinFile.on('end', function () {\n\t\tvar sig;\n\t\ttry {\n\t\t\tsig = signer.sign();\n\t\t} catch (e) {\n\t\t\tconsole.error('sshpk-sign: error signing data: ' +\n\t\t\t    e.name + ': ' + e.message);\n\t\t\tprocess.exit(1);\n\t\t}\n\n\t\tvar fmt = opts.format || 'asn1';\n\t\tvar output;\n\t\ttry {\n\t\t\toutput = sig.toBuffer(fmt);\n\t\t\tif (!opts.binary)\n\t\t\t\toutput = output.toString('base64');\n\t\t} catch (e) {\n\t\t\tconsole.error('sshpk-sign: error converting signature' +\n\t\t\t    ' to ' + fmt + ' format: ' + e.name + ': ' +\n\t\t\t    e.message);\n\t\t\tprocess.exit(1);\n\t\t}\n\n\t\toutFile.write(output);\n\t\tif (!opts.binary)\n\t\t\toutFile.write('\\n');\n\t\toutFile.once('drain', function () {\n\t\t\tprocess.exit(0);\n\t\t});\n\t});\n}\n"]}