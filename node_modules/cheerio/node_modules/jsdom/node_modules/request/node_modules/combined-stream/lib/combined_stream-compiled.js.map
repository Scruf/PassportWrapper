{"version":3,"sources":["combined_stream.js"],"names":[],"mappings":"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","file":"combined_stream-compiled.js","sourcesContent":["var util = require('util');\nvar Stream = require('stream').Stream;\nvar DelayedStream = require('delayed-stream');\n\nmodule.exports = CombinedStream;\nfunction CombinedStream() {\n  this.writable = false;\n  this.readable = true;\n  this.dataSize = 0;\n  this.maxDataSize = 2 * 1024 * 1024;\n  this.pauseStreams = true;\n\n  this._released = false;\n  this._streams = [];\n  this._currentStream = null;\n}\nutil.inherits(CombinedStream, Stream);\n\nCombinedStream.create = function(options) {\n  var combinedStream = new this();\n\n  options = options || {};\n  for (var option in options) {\n    combinedStream[option] = options[option];\n  }\n\n  return combinedStream;\n};\n\nCombinedStream.isStreamLike = function(stream) {\n  return (typeof stream !== 'function')\n    && (typeof stream !== 'string')\n    && (typeof stream !== 'boolean')\n    && (typeof stream !== 'number')\n    && (!Buffer.isBuffer(stream));\n};\n\nCombinedStream.prototype.append = function(stream) {\n  var isStreamLike = CombinedStream.isStreamLike(stream);\n\n  if (isStreamLike) {\n    if (!(stream instanceof DelayedStream)) {\n      var newStream = DelayedStream.create(stream, {\n        maxDataSize: Infinity,\n        pauseStream: this.pauseStreams,\n      });\n      stream.on('data', this._checkDataSize.bind(this));\n      stream = newStream;\n    }\n\n    this._handleErrors(stream);\n\n    if (this.pauseStreams) {\n      stream.pause();\n    }\n  }\n\n  this._streams.push(stream);\n  return this;\n};\n\nCombinedStream.prototype.pipe = function(dest, options) {\n  Stream.prototype.pipe.call(this, dest, options);\n  this.resume();\n  return dest;\n};\n\nCombinedStream.prototype._getNext = function() {\n  this._currentStream = null;\n  var stream = this._streams.shift();\n\n\n  if (typeof stream == 'undefined') {\n    this.end();\n    return;\n  }\n\n  if (typeof stream !== 'function') {\n    this._pipeNext(stream);\n    return;\n  }\n\n  var getStream = stream;\n  getStream(function(stream) {\n    var isStreamLike = CombinedStream.isStreamLike(stream);\n    if (isStreamLike) {\n      stream.on('data', this._checkDataSize.bind(this));\n      this._handleErrors(stream);\n    }\n\n    this._pipeNext(stream);\n  }.bind(this));\n};\n\nCombinedStream.prototype._pipeNext = function(stream) {\n  this._currentStream = stream;\n\n  var isStreamLike = CombinedStream.isStreamLike(stream);\n  if (isStreamLike) {\n    stream.on('end', this._getNext.bind(this));\n    stream.pipe(this, {end: false});\n    return;\n  }\n\n  var value = stream;\n  this.write(value);\n  this._getNext();\n};\n\nCombinedStream.prototype._handleErrors = function(stream) {\n  var self = this;\n  stream.on('error', function(err) {\n    self._emitError(err);\n  });\n};\n\nCombinedStream.prototype.write = function(data) {\n  this.emit('data', data);\n};\n\nCombinedStream.prototype.pause = function() {\n  if (!this.pauseStreams) {\n    return;\n  }\n\n  if(this.pauseStreams && this._currentStream && typeof(this._currentStream.pause) == 'function') this._currentStream.pause();\n  this.emit('pause');\n};\n\nCombinedStream.prototype.resume = function() {\n  if (!this._released) {\n    this._released = true;\n    this.writable = true;\n    this._getNext();\n  }\n\n  if(this.pauseStreams && this._currentStream && typeof(this._currentStream.resume) == 'function') this._currentStream.resume();\n  this.emit('resume');\n};\n\nCombinedStream.prototype.end = function() {\n  this._reset();\n  this.emit('end');\n};\n\nCombinedStream.prototype.destroy = function() {\n  this._reset();\n  this.emit('close');\n};\n\nCombinedStream.prototype._reset = function() {\n  this.writable = false;\n  this._streams = [];\n  this._currentStream = null;\n};\n\nCombinedStream.prototype._checkDataSize = function() {\n  this._updateDataSize();\n  if (this.dataSize <= this.maxDataSize) {\n    return;\n  }\n\n  var message =\n    'DelayedStream#maxDataSize of ' + this.maxDataSize + ' bytes exceeded.';\n  this._emitError(new Error(message));\n};\n\nCombinedStream.prototype._updateDataSize = function() {\n  this.dataSize = 0;\n\n  var self = this;\n  this._streams.forEach(function(stream) {\n    if (!stream.dataSize) {\n      return;\n    }\n\n    self.dataSize += stream.dataSize;\n  });\n\n  if (this._currentStream && this._currentStream.dataSize) {\n    this.dataSize += this._currentStream.dataSize;\n  }\n};\n\nCombinedStream.prototype._emitError = function(err) {\n  this._reset();\n  this.emit('error', err);\n};\n"]}