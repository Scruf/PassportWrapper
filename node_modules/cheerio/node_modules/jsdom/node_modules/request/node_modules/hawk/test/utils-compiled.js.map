{"version":3,"sources":["utils.js"],"names":[],"mappings":"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","file":"utils-compiled.js","sourcesContent":["// Load modules\r\n\r\nvar Code = require('code');\r\nvar Hawk = require('../lib');\r\nvar Lab = require('lab');\r\nvar Package = require('../package.json');\r\n\r\n\r\n// Declare internals\r\n\r\nvar internals = {};\r\n\r\n\r\n// Test shortcuts\r\n\r\nvar lab = exports.lab = Lab.script();\r\nvar describe = lab.experiment;\r\nvar it = lab.test;\r\nvar expect = Code.expect;\r\n\r\n\r\ndescribe('Utils', function () {\r\n\r\n    describe('parseHost()', function () {\r\n\r\n        it('returns port 80 for non tls node request', function (done) {\r\n\r\n            var req = {\r\n                method: 'POST',\r\n                url: '/resource/4?filter=a',\r\n                headers: {\r\n                    host: 'example.com',\r\n                    'content-type': 'text/plain;x=y'\r\n                }\r\n            };\r\n\r\n            expect(Hawk.utils.parseHost(req, 'Host').port).to.equal(80);\r\n            done();\r\n        });\r\n\r\n        it('returns port 443 for non tls node request', function (done) {\r\n\r\n            var req = {\r\n                method: 'POST',\r\n                url: '/resource/4?filter=a',\r\n                headers: {\r\n                    host: 'example.com',\r\n                    'content-type': 'text/plain;x=y'\r\n                },\r\n                connection: {\r\n                    encrypted: true\r\n                }\r\n            };\r\n\r\n            expect(Hawk.utils.parseHost(req, 'Host').port).to.equal(443);\r\n            done();\r\n        });\r\n\r\n        it('returns port 443 for non tls node request (IPv6)', function (done) {\r\n\r\n            var req = {\r\n                method: 'POST',\r\n                url: '/resource/4?filter=a',\r\n                headers: {\r\n                    host: '[123:123:123]',\r\n                    'content-type': 'text/plain;x=y'\r\n                },\r\n                connection: {\r\n                    encrypted: true\r\n                }\r\n            };\r\n\r\n            expect(Hawk.utils.parseHost(req, 'Host').port).to.equal(443);\r\n            done();\r\n        });\r\n\r\n        it('parses IPv6 headers', function (done) {\r\n\r\n            var req = {\r\n                method: 'POST',\r\n                url: '/resource/4?filter=a',\r\n                headers: {\r\n                    host: '[123:123:123]:8000',\r\n                    'content-type': 'text/plain;x=y'\r\n                },\r\n                connection: {\r\n                    encrypted: true\r\n                }\r\n            };\r\n\r\n            var host = Hawk.utils.parseHost(req, 'Host');\r\n            expect(host.port).to.equal('8000');\r\n            expect(host.name).to.equal('[123:123:123]');\r\n            done();\r\n        });\r\n\r\n        it('errors on header too long', function (done) {\r\n\r\n            var long = '';\r\n            for (var i = 0; i < 5000; ++i) {\r\n                long += 'x';\r\n            }\r\n\r\n            expect(Hawk.utils.parseHost({ headers: { host: long } })).to.be.null();\r\n            done();\r\n        });\r\n    });\r\n\r\n    describe('parseAuthorizationHeader()', function () {\r\n\r\n        it('errors on header too long', function (done) {\r\n\r\n            var long = 'Scheme a=\"';\r\n            for (var i = 0; i < 5000; ++i) {\r\n                long += 'x';\r\n            }\r\n            long += '\"';\r\n\r\n            var err = Hawk.utils.parseAuthorizationHeader(long, ['a']);\r\n            expect(err).to.be.instanceof(Error);\r\n            expect(err.message).to.equal('Header length too long');\r\n            done();\r\n        });\r\n    });\r\n\r\n    describe('version()', function () {\r\n\r\n        it('returns the correct package version number', function (done) {\r\n\r\n            expect(Hawk.utils.version()).to.equal(Package.version);\r\n            done();\r\n        });\r\n    });\r\n\r\n    describe('unauthorized()', function () {\r\n\r\n        it('returns a hawk 401', function (done) {\r\n\r\n            expect(Hawk.utils.unauthorized('kaboom').output.headers['WWW-Authenticate']).to.equal('Hawk error=\"kaboom\"');\r\n            done();\r\n        });\r\n\r\n        it('supports attributes', function (done) {\r\n\r\n            expect(Hawk.utils.unauthorized('kaboom', { a: 'b' }).output.headers['WWW-Authenticate']).to.equal('Hawk a=\"b\", error=\"kaboom\"');\r\n            done();\r\n        });\r\n    });\r\n});\r\n"]}