{"version":3,"sources":["server.js"],"names":[],"mappings":"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","file":"server-compiled.js","sourcesContent":["// Load modules\r\n\r\nvar Url = require('url');\r\nvar Code = require('code');\r\nvar Hawk = require('../lib');\r\nvar Hoek = require('hoek');\r\nvar Lab = require('lab');\r\n\r\n\r\n// Declare internals\r\n\r\nvar internals = {};\r\n\r\n\r\n// Test shortcuts\r\n\r\nvar lab = exports.lab = Lab.script();\r\nvar describe = lab.experiment;\r\nvar it = lab.test;\r\nvar expect = Code.expect;\r\n\r\n\r\ndescribe('Server', function () {\r\n\r\n    var credentialsFunc = function (id, callback) {\r\n\r\n        var credentials = {\r\n            id: id,\r\n            key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n            algorithm: (id === '1' ? 'sha1' : 'sha256'),\r\n            user: 'steve'\r\n        };\r\n\r\n        return callback(null, credentials);\r\n    };\r\n\r\n    describe('authenticate()', function () {\r\n\r\n        it('parses a valid authentication header (sha1)', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"1\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"zy79QQ5/EYFmQqutVnYb73gAc/U=\", ext=\"hello\"'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials.user).to.equal('steve');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('parses a valid authentication header (sha256)', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/1?b=1&a=2',\r\n                host: 'example.com',\r\n                port: 8000,\r\n                authorization: 'Hawk id=\"dh37fgj492je\", ts=\"1353832234\", nonce=\"j4h3g2\", mac=\"m8r1rHbXN6NgO+KIIhjO7sFRyd78RNGVUwehe8Cp2dU=\", ext=\"some-app-data\"'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353832234000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials.user).to.equal('steve');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('parses a valid authentication header (host override)', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                headers: {\r\n                    host: 'example1.com:8080',\r\n                    authorization: 'Hawk id=\"1\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"zy79QQ5/EYFmQqutVnYb73gAc/U=\", ext=\"hello\"'\r\n                }\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { host: 'example.com', localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials.user).to.equal('steve');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('parses a valid authentication header (host port override)', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                headers: {\r\n                    host: 'example1.com:80',\r\n                    authorization: 'Hawk id=\"1\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"zy79QQ5/EYFmQqutVnYb73gAc/U=\", ext=\"hello\"'\r\n                }\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { host: 'example.com', port: 8080, localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials.user).to.equal('steve');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('parses a valid authentication header (POST with payload)', function (done) {\r\n\r\n            var req = {\r\n                method: 'POST',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123456\", ts=\"1357926341\", nonce=\"1AwuJD\", hash=\"qAiXIVv+yjDATneWxZP2YCTa9aHRgQdnH9b3Wc+o3dg=\", ext=\"some-app-data\", mac=\"UeYcj5UoTVaAWXNvJfLVia7kU3VabxCqrccXP8sUGC4=\"'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1357926341000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials.user).to.equal('steve');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on missing hash', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/1?b=1&a=2',\r\n                host: 'example.com',\r\n                port: 8000,\r\n                authorization: 'Hawk id=\"dh37fgj492je\", ts=\"1353832234\", nonce=\"j4h3g2\", mac=\"m8r1rHbXN6NgO+KIIhjO7sFRyd78RNGVUwehe8Cp2dU=\", ext=\"some-app-data\"'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { payload: 'body', localtimeOffsetMsec: 1353832234000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Missing required payload hash');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on a stale timestamp', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123456\", ts=\"1362337299\", nonce=\"UzmxSs\", ext=\"some-app-data\", mac=\"wnNUxchvvryMH2RxckTdZ/gY3ijzvccx4keVvELC61w=\"'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Stale timestamp');\r\n                var header = err.output.headers['WWW-Authenticate'];\r\n                var ts = header.match(/^Hawk ts\\=\\\"(\\d+)\\\"\\, tsm\\=\\\"([^\\\"]+)\\\"\\, error=\\\"Stale timestamp\\\"$/);\r\n                var now = Hawk.utils.now();\r\n                expect(parseInt(ts[1], 10) * 1000).to.be.within(now - 1000, now + 1000);\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'www-authenticate': header\r\n                    }\r\n                };\r\n\r\n                expect(Hawk.client.authenticate(res, credentials, artifacts)).to.equal(true);\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on a replay', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"bXx7a7p1h9QYQNZ8x7QhvDQym8ACgab4m3lVSFn4DBw=\", ext=\"hello\"'\r\n            };\r\n\r\n            var memoryCache = {};\r\n            var options = {\r\n                localtimeOffsetMsec: 1353788437000 - Hawk.utils.now(),\r\n                nonceFunc: function (key, nonce, ts, callback) {\r\n\r\n                    if (memoryCache[key + nonce]) {\r\n                        return callback(new Error());\r\n                    }\r\n\r\n                    memoryCache[key + nonce] = true;\r\n                    return callback();\r\n                }\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, options, function (err, credentials1, artifacts1) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials1.user).to.equal('steve');\r\n\r\n                Hawk.server.authenticate(req, credentialsFunc, options, function (err, credentials2, artifacts2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.output.payload.message).to.equal('Invalid nonce');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('does not error on nonce collision if keys differ', function (done) {\r\n\r\n            var reqSteve = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"bXx7a7p1h9QYQNZ8x7QhvDQym8ACgab4m3lVSFn4DBw=\", ext=\"hello\"'\r\n            };\r\n\r\n            var reqBob = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"456\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"LXfmTnRzrLd9TD7yfH+4se46Bx6AHyhpM94hLCiNia4=\", ext=\"hello\"'\r\n            };\r\n\r\n            var credentialsFuncion = function (id, callback) {\r\n\r\n                var credentials = {\r\n                    '123': {\r\n                        id: id,\r\n                        key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                        algorithm: (id === '1' ? 'sha1' : 'sha256'),\r\n                        user: 'steve'\r\n                    },\r\n                    '456': {\r\n                        id: id,\r\n                        key: 'xrunpaw3489ruxnpa98w4rxnwerxhqb98rpaxn39848',\r\n                        algorithm: (id === '1' ? 'sha1' : 'sha256'),\r\n                        user: 'bob'\r\n                    }\r\n                };\r\n\r\n                return callback(null, credentials[id]);\r\n            };\r\n\r\n            var memoryCache = {};\r\n            var options = {\r\n                localtimeOffsetMsec: 1353788437000 - Hawk.utils.now(),\r\n                nonceFunc: function (key, nonce, ts, callback) {\r\n\r\n                    if (memoryCache[key + nonce]) {\r\n                        return callback(new Error());\r\n                    }\r\n\r\n                    memoryCache[key + nonce] = true;\r\n                    return callback();\r\n                }\r\n            };\r\n\r\n            Hawk.server.authenticate(reqSteve, credentialsFuncion, options, function (err, credentials1, artifacts1) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials1.user).to.equal('steve');\r\n\r\n                Hawk.server.authenticate(reqBob, credentialsFuncion, options, function (err, credentials2, artifacts2) {\r\n\r\n                    expect(err).to.not.exist();\r\n                    expect(credentials2.user).to.equal('bob');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('errors on an invalid authentication header: wrong scheme', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Basic asdasdasdasd'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.not.exist();\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on an invalid authentication header: no scheme', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: '!@#'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Invalid header syntax');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on an missing authorization header', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.isMissing).to.equal(true);\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on an missing host header', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                headers: {\r\n                    authorization: 'Hawk id=\"123\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n                }\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Invalid Host header');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on an missing authorization attribute (id)', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Missing attributes');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on an missing authorization attribute (ts)', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Missing attributes');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on an missing authorization attribute (nonce)', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\", ts=\"1353788437\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Missing attributes');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on an missing authorization attribute (mac)', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\", ts=\"1353788437\", nonce=\"k3j4h2\", ext=\"hello\"'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Missing attributes');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on an unknown authorization attribute', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\", ts=\"1353788437\", nonce=\"k3j4h2\", x=\"3\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Unknown attribute: x');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on an bad authorization header format', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\\\\\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Bad header format');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on an bad authorization attribute value', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"\\t\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Bad attribute value: id');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on an empty authorization attribute value', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Bad attribute value: id');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on duplicated authorization attribute key', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\", id=\"456\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Duplicate attribute: id');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on an invalid authorization header format', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Invalid header syntax');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on an bad host header (missing host)', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                headers: {\r\n                    host: ':8080',\r\n                    authorization: 'Hawk id=\"123\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n                }\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Invalid Host header');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on an bad host header (pad port)', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                headers: {\r\n                    host: 'example.com:something',\r\n                    authorization: 'Hawk id=\"123\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n                }\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Invalid Host header');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on credentialsFunc error', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            var credentialsFuncion = function (id, callback) {\r\n\r\n                return callback(new Error('Unknown user'));\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFuncion, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.message).to.equal('Unknown user');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on credentialsFunc error (with credentials)', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            var credentialsFuncion = function (id, callback) {\r\n\r\n                return callback(new Error('Unknown user'), { some: 'value' });\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFuncion, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.message).to.equal('Unknown user');\r\n                expect(credentials.some).to.equal('value');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on missing credentials', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            var credentialsFuncion = function (id, callback) {\r\n\r\n                return callback(null, null);\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFuncion, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Unknown credentials');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on invalid credentials (id)', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            var credentialsFuncion = function (id, callback) {\r\n\r\n                var credentials = {\r\n                    key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                    user: 'steve'\r\n                };\r\n\r\n                return callback(null, credentials);\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFuncion, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.message).to.equal('Invalid credentials');\r\n                expect(err.output.payload.message).to.equal('An internal server error occurred');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on invalid credentials (key)', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            var credentialsFuncion = function (id, callback) {\r\n\r\n                var credentials = {\r\n                    id: '23434d3q4d5345d',\r\n                    user: 'steve'\r\n                };\r\n\r\n                return callback(null, credentials);\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFuncion, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.message).to.equal('Invalid credentials');\r\n                expect(err.output.payload.message).to.equal('An internal server error occurred');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on unknown credentials algorithm', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            var credentialsFuncion = function (id, callback) {\r\n\r\n                var credentials = {\r\n                    key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                    algorithm: 'hmac-sha-0',\r\n                    user: 'steve'\r\n                };\r\n\r\n                return callback(null, credentials);\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFuncion, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.message).to.equal('Unknown algorithm');\r\n                expect(err.output.payload.message).to.equal('An internal server error occurred');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on unknown bad mac', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcU4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            var credentialsFuncion = function (id, callback) {\r\n\r\n                var credentials = {\r\n                    key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                    algorithm: 'sha256',\r\n                    user: 'steve'\r\n                };\r\n\r\n                return callback(null, credentials);\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFuncion, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Bad mac');\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    describe('header()', function () {\r\n\r\n        it('generates header', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                algorithm: 'sha256',\r\n                user: 'steve'\r\n            };\r\n\r\n            var artifacts = {\r\n                method: 'POST',\r\n                host: 'example.com',\r\n                port: '8080',\r\n                resource: '/resource/4?filter=a',\r\n                ts: '1398546787',\r\n                nonce: 'xUwusx',\r\n                hash: 'nJjkVtBE5Y/Bk38Aiokwn0jiJxt/0S2WRSUwWLCf5xk=',\r\n                ext: 'some-app-data',\r\n                mac: 'dvIvMThwi28J61Jc3P0ryAhuKpanU63GXdx6hkmQkJA=',\r\n                id: '123456'\r\n            };\r\n\r\n            var header = Hawk.server.header(credentials, artifacts, { payload: 'some reply', contentType: 'text/plain', ext: 'response-specific' });\r\n            expect(header).to.equal('Hawk mac=\\\"n14wVJK4cOxAytPUMc5bPezQzuJGl5n7MYXhFQgEKsE=\\\", hash=\\\"f9cDF/TDm7TkYRLnGwRMfeDzT6LixQVLvrIKhh0vgmM=\\\", ext=\\\"response-specific\\\"');\r\n            done();\r\n        });\r\n\r\n        it('generates header (empty payload)', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                algorithm: 'sha256',\r\n                user: 'steve'\r\n            };\r\n\r\n            var artifacts = {\r\n                method: 'POST',\r\n                host: 'example.com',\r\n                port: '8080',\r\n                resource: '/resource/4?filter=a',\r\n                ts: '1398546787',\r\n                nonce: 'xUwusx',\r\n                hash: 'nJjkVtBE5Y/Bk38Aiokwn0jiJxt/0S2WRSUwWLCf5xk=',\r\n                ext: 'some-app-data',\r\n                mac: 'dvIvMThwi28J61Jc3P0ryAhuKpanU63GXdx6hkmQkJA=',\r\n                id: '123456'\r\n            };\r\n\r\n            var header = Hawk.server.header(credentials, artifacts, { payload: '', contentType: 'text/plain', ext: 'response-specific' });\r\n            expect(header).to.equal('Hawk mac=\\\"i8/kUBDx0QF+PpCtW860kkV/fa9dbwEoe/FpGUXowf0=\\\", hash=\\\"q/t+NNAkQZNlq/aAD6PlexImwQTxwgT2MahfTa9XRLA=\\\", ext=\\\"response-specific\\\"');\r\n            done();\r\n        });\r\n\r\n        it('generates header (pre calculated hash)', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                algorithm: 'sha256',\r\n                user: 'steve'\r\n            };\r\n\r\n            var artifacts = {\r\n                method: 'POST',\r\n                host: 'example.com',\r\n                port: '8080',\r\n                resource: '/resource/4?filter=a',\r\n                ts: '1398546787',\r\n                nonce: 'xUwusx',\r\n                hash: 'nJjkVtBE5Y/Bk38Aiokwn0jiJxt/0S2WRSUwWLCf5xk=',\r\n                ext: 'some-app-data',\r\n                mac: 'dvIvMThwi28J61Jc3P0ryAhuKpanU63GXdx6hkmQkJA=',\r\n                id: '123456'\r\n            };\r\n\r\n            var options = { payload: 'some reply', contentType: 'text/plain', ext: 'response-specific' };\r\n            options.hash = Hawk.crypto.calculatePayloadHash(options.payload, credentials.algorithm, options.contentType);\r\n            var header = Hawk.server.header(credentials, artifacts, options);\r\n            expect(header).to.equal('Hawk mac=\\\"n14wVJK4cOxAytPUMc5bPezQzuJGl5n7MYXhFQgEKsE=\\\", hash=\\\"f9cDF/TDm7TkYRLnGwRMfeDzT6LixQVLvrIKhh0vgmM=\\\", ext=\\\"response-specific\\\"');\r\n            done();\r\n        });\r\n\r\n        it('generates header (null ext)', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                algorithm: 'sha256',\r\n                user: 'steve'\r\n            };\r\n\r\n            var artifacts = {\r\n                method: 'POST',\r\n                host: 'example.com',\r\n                port: '8080',\r\n                resource: '/resource/4?filter=a',\r\n                ts: '1398546787',\r\n                nonce: 'xUwusx',\r\n                hash: 'nJjkVtBE5Y/Bk38Aiokwn0jiJxt/0S2WRSUwWLCf5xk=',\r\n                mac: 'dvIvMThwi28J61Jc3P0ryAhuKpanU63GXdx6hkmQkJA=',\r\n                id: '123456'\r\n            };\r\n\r\n            var header = Hawk.server.header(credentials, artifacts, { payload: 'some reply', contentType: 'text/plain', ext: null });\r\n            expect(header).to.equal('Hawk mac=\\\"6PrybJTJs20jsgBw5eilXpcytD8kUbaIKNYXL+6g0ns=\\\", hash=\\\"f9cDF/TDm7TkYRLnGwRMfeDzT6LixQVLvrIKhh0vgmM=\\\"');\r\n            done();\r\n        });\r\n\r\n        it('errors on missing artifacts', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                algorithm: 'sha256',\r\n                user: 'steve'\r\n            };\r\n\r\n            var header = Hawk.server.header(credentials, null, { payload: 'some reply', contentType: 'text/plain', ext: 'response-specific' });\r\n            expect(header).to.equal('');\r\n            done();\r\n        });\r\n\r\n        it('errors on invalid artifacts', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                algorithm: 'sha256',\r\n                user: 'steve'\r\n            };\r\n\r\n            var header = Hawk.server.header(credentials, 5, { payload: 'some reply', contentType: 'text/plain', ext: 'response-specific' });\r\n            expect(header).to.equal('');\r\n            done();\r\n        });\r\n\r\n        it('errors on missing credentials', function (done) {\r\n\r\n            var artifacts = {\r\n                method: 'POST',\r\n                host: 'example.com',\r\n                port: '8080',\r\n                resource: '/resource/4?filter=a',\r\n                ts: '1398546787',\r\n                nonce: 'xUwusx',\r\n                hash: 'nJjkVtBE5Y/Bk38Aiokwn0jiJxt/0S2WRSUwWLCf5xk=',\r\n                ext: 'some-app-data',\r\n                mac: 'dvIvMThwi28J61Jc3P0ryAhuKpanU63GXdx6hkmQkJA=',\r\n                id: '123456'\r\n            };\r\n\r\n            var header = Hawk.server.header(null, artifacts, { payload: 'some reply', contentType: 'text/plain', ext: 'response-specific' });\r\n            expect(header).to.equal('');\r\n            done();\r\n        });\r\n\r\n        it('errors on invalid credentials (key)', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                algorithm: 'sha256',\r\n                user: 'steve'\r\n            };\r\n\r\n            var artifacts = {\r\n                method: 'POST',\r\n                host: 'example.com',\r\n                port: '8080',\r\n                resource: '/resource/4?filter=a',\r\n                ts: '1398546787',\r\n                nonce: 'xUwusx',\r\n                hash: 'nJjkVtBE5Y/Bk38Aiokwn0jiJxt/0S2WRSUwWLCf5xk=',\r\n                ext: 'some-app-data',\r\n                mac: 'dvIvMThwi28J61Jc3P0ryAhuKpanU63GXdx6hkmQkJA=',\r\n                id: '123456'\r\n            };\r\n\r\n            var header = Hawk.server.header(credentials, artifacts, { payload: 'some reply', contentType: 'text/plain', ext: 'response-specific' });\r\n            expect(header).to.equal('');\r\n            done();\r\n        });\r\n\r\n        it('errors on invalid algorithm', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                algorithm: 'x',\r\n                user: 'steve'\r\n            };\r\n\r\n            var artifacts = {\r\n                method: 'POST',\r\n                host: 'example.com',\r\n                port: '8080',\r\n                resource: '/resource/4?filter=a',\r\n                ts: '1398546787',\r\n                nonce: 'xUwusx',\r\n                hash: 'nJjkVtBE5Y/Bk38Aiokwn0jiJxt/0S2WRSUwWLCf5xk=',\r\n                ext: 'some-app-data',\r\n                mac: 'dvIvMThwi28J61Jc3P0ryAhuKpanU63GXdx6hkmQkJA=',\r\n                id: '123456'\r\n            };\r\n\r\n            var header = Hawk.server.header(credentials, artifacts, { payload: 'some reply', contentType: 'text/plain', ext: 'response-specific' });\r\n            expect(header).to.equal('');\r\n            done();\r\n        });\r\n    });\r\n\r\n    describe('authenticateBewit()', function () {\r\n\r\n        it('errors on uri too long', function (done) {\r\n\r\n            var long = '/';\r\n            for (var i = 0; i < 5000; ++i) {\r\n                long += 'x';\r\n            }\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: long,\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"1\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"zy79QQ5/EYFmQqutVnYb73gAc/U=\", ext=\"hello\"'\r\n            };\r\n\r\n            Hawk.server.authenticateBewit(req, credentialsFunc, {}, function (err, credentials, bewit) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.statusCode).to.equal(400);\r\n                expect(err.message).to.equal('Resource path exceeds max length');\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    describe('authenticateMessage()', function () {\r\n\r\n        it('errors on invalid authorization (ts)', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                delete auth.ts;\r\n\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, credentialsFunc, {}, function (err, credentials2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.message).to.equal('Invalid authorization');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('errors on invalid authorization (nonce)', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                delete auth.nonce;\r\n\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, credentialsFunc, {}, function (err, credentials2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.message).to.equal('Invalid authorization');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('errors on invalid authorization (hash)', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                delete auth.hash;\r\n\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, credentialsFunc, {}, function (err, credentials2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.message).to.equal('Invalid authorization');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('errors with credentials', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, function (id, callback) {\r\n\r\n                    callback(new Error('something'), { some: 'value' });\r\n                }, {}, function (err, credentials2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.message).to.equal('something');\r\n                    expect(credentials2.some).to.equal('value');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('errors on nonce collision', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, credentialsFunc, {\r\n                    nonceFunc: function (key, nonce, ts, nonceCallback) {\r\n\r\n                        nonceCallback(true);\r\n                    }\r\n                }, function (err, credentials2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.message).to.equal('Invalid nonce');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('should generate an authorization then successfully parse it', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                expect(auth).to.exist();\r\n\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, credentialsFunc, {}, function (err, credentials2) {\r\n\r\n                    expect(err).to.not.exist();\r\n                    expect(credentials2.user).to.equal('steve');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('should fail authorization on mismatching host', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                expect(auth).to.exist();\r\n\r\n                Hawk.server.authenticateMessage('example1.com', 8080, 'some message', auth, credentialsFunc, {}, function (err, credentials2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.message).to.equal('Bad mac');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('should fail authorization on stale timestamp', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                expect(auth).to.exist();\r\n\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, credentialsFunc, { localtimeOffsetMsec: 100000 }, function (err, credentials2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.message).to.equal('Stale timestamp');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('overrides timestampSkewSec', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1, localtimeOffsetMsec: 100000 });\r\n                expect(auth).to.exist();\r\n\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, credentialsFunc, { timestampSkewSec: 500 }, function (err, credentials2) {\r\n\r\n                    expect(err).to.not.exist();\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('should fail authorization on invalid authorization', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                expect(auth).to.exist();\r\n                delete auth.id;\r\n\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, credentialsFunc, {}, function (err, credentials2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.message).to.equal('Invalid authorization');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('should fail authorization on bad hash', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                expect(auth).to.exist();\r\n\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message1', auth, credentialsFunc, {}, function (err, credentials2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.message).to.equal('Bad message hash');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('should fail authorization on nonce error', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                expect(auth).to.exist();\r\n\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, credentialsFunc, {\r\n                    nonceFunc: function (key, nonce, ts, callback) {\r\n\r\n                        callback(new Error('kaboom'));\r\n                    }\r\n                }, function (err, credentials2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.message).to.equal('Invalid nonce');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('should fail authorization on credentials error', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                expect(auth).to.exist();\r\n\r\n                var errFunc = function (id, callback) {\r\n\r\n                    callback(new Error('kablooey'));\r\n                };\r\n\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, errFunc, {}, function (err, credentials2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.message).to.equal('kablooey');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('should fail authorization on missing credentials', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                expect(auth).to.exist();\r\n\r\n                var errFunc = function (id, callback) {\r\n\r\n                    callback();\r\n                };\r\n\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, errFunc, {}, function (err, credentials2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.message).to.equal('Unknown credentials');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('should fail authorization on invalid credentials', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                expect(auth).to.exist();\r\n\r\n                var errFunc = function (id, callback) {\r\n\r\n                    callback(null, {});\r\n                };\r\n\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, errFunc, {}, function (err, credentials2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.message).to.equal('Invalid credentials');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('should fail authorization on invalid credentials algorithm', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                expect(auth).to.exist();\r\n\r\n                var errFunc = function (id, callback) {\r\n\r\n                    callback(null, { key: '123', algorithm: '456' });\r\n                };\r\n\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, errFunc, {}, function (err, credentials2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.message).to.equal('Unknown algorithm');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('should fail on missing host', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials) {\r\n\r\n                var auth = Hawk.client.message(null, 8080, 'some message', { credentials: credentials });\r\n                expect(auth).to.not.exist();\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('should fail on missing credentials', function (done) {\r\n\r\n            var auth = Hawk.client.message('example.com', 8080, 'some message', {});\r\n            expect(auth).to.not.exist();\r\n            done();\r\n        });\r\n\r\n        it('should fail on invalid algorithm', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials) {\r\n\r\n                var creds = Hoek.clone(credentials);\r\n                creds.algorithm = 'blah';\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: creds });\r\n                expect(auth).to.not.exist();\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    describe('authenticatePayloadHash()', function () {\r\n\r\n        it('checks payload hash', function (done) {\r\n\r\n            expect(Hawk.server.authenticatePayloadHash('abcdefg', { hash: 'abcdefg' })).to.equal(true);\r\n            expect(Hawk.server.authenticatePayloadHash('1234567', { hash: 'abcdefg' })).to.equal(false);\r\n            done();\r\n        });\r\n    });\r\n});\r\n\r\n"]}