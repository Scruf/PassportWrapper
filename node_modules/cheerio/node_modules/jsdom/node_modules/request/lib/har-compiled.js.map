{"version":3,"sources":["har.js"],"names":[],"mappings":"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","file":"har-compiled.js","sourcesContent":["'use strict'\n\nvar fs = require('fs')\nvar qs = require('querystring')\nvar validate = require('har-validator')\nvar extend = require('extend')\n\nfunction Har (request) {\n  this.request = request\n}\n\nHar.prototype.reducer = function (obj, pair) {\n  // new property ?\n  if (obj[pair.name] === undefined) {\n    obj[pair.name] = pair.value\n    return obj\n  }\n\n  // existing? convert to array\n  var arr = [\n    obj[pair.name],\n    pair.value\n  ]\n\n  obj[pair.name] = arr\n\n  return obj\n}\n\nHar.prototype.prep = function (data) {\n  // construct utility properties\n  data.queryObj = {}\n  data.headersObj = {}\n  data.postData.jsonObj = false\n  data.postData.paramsObj = false\n\n  // construct query objects\n  if (data.queryString && data.queryString.length) {\n    data.queryObj = data.queryString.reduce(this.reducer, {})\n  }\n\n  // construct headers objects\n  if (data.headers && data.headers.length) {\n    // loweCase header keys\n    data.headersObj = data.headers.reduceRight(function (headers, header) {\n      headers[header.name] = header.value\n      return headers\n    }, {})\n  }\n\n  // construct Cookie header\n  if (data.cookies && data.cookies.length) {\n    var cookies = data.cookies.map(function (cookie) {\n      return cookie.name + '=' + cookie.value\n    })\n\n    if (cookies.length) {\n      data.headersObj.cookie = cookies.join('; ')\n    }\n  }\n\n  // prep body\n  function some (arr) {\n    return arr.some(function (type) {\n      return data.postData.mimeType.indexOf(type) === 0\n    })\n  }\n\n  if (some([\n    'multipart/mixed',\n    'multipart/related',\n    'multipart/form-data',\n    'multipart/alternative'])) {\n\n    // reset values\n    data.postData.mimeType = 'multipart/form-data'\n  }\n\n  else if (some([\n    'application/x-www-form-urlencoded'])) {\n\n    if (!data.postData.params) {\n      data.postData.text = ''\n    } else {\n      data.postData.paramsObj = data.postData.params.reduce(this.reducer, {})\n\n      // always overwrite\n      data.postData.text = qs.stringify(data.postData.paramsObj)\n    }\n  }\n\n  else if (some([\n    'text/json',\n    'text/x-json',\n    'application/json',\n    'application/x-json'])) {\n\n    data.postData.mimeType = 'application/json'\n\n    if (data.postData.text) {\n      try {\n        data.postData.jsonObj = JSON.parse(data.postData.text)\n      } catch (e) {\n        this.request.debug(e)\n\n        // force back to text/plain\n        data.postData.mimeType = 'text/plain'\n      }\n    }\n  }\n\n  return data\n}\n\nHar.prototype.options = function (options) {\n  // skip if no har property defined\n  if (!options.har) {\n    return options\n  }\n\n  var har = {}\n  extend(har, options.har)\n\n  // only process the first entry\n  if (har.log && har.log.entries) {\n    har = har.log.entries[0]\n  }\n\n  // add optional properties to make validation successful\n  har.url = har.url || options.url || options.uri || options.baseUrl || '/'\n  har.httpVersion = har.httpVersion || 'HTTP/1.1'\n  har.queryString = har.queryString || []\n  har.headers = har.headers || []\n  har.cookies = har.cookies || []\n  har.postData = har.postData || {}\n  har.postData.mimeType = har.postData.mimeType || 'application/octet-stream'\n\n  har.bodySize = 0\n  har.headersSize = 0\n  har.postData.size = 0\n\n  if (!validate.request(har)) {\n    return options\n  }\n\n  // clean up and get some utility properties\n  var req = this.prep(har)\n\n  // construct new options\n  if (req.url) {\n    options.url = req.url\n  }\n\n  if (req.method) {\n    options.method = req.method\n  }\n\n  if (Object.keys(req.queryObj).length) {\n    options.qs = req.queryObj\n  }\n\n  if (Object.keys(req.headersObj).length) {\n    options.headers = req.headersObj\n  }\n\n  function test (type) {\n    return req.postData.mimeType.indexOf(type) === 0\n  }\n  if (test('application/x-www-form-urlencoded')) {\n    options.form = req.postData.paramsObj\n  }\n  else if (test('application/json')) {\n    if (req.postData.jsonObj) {\n      options.body = req.postData.jsonObj\n      options.json = true\n    }\n  }\n  else if (test('multipart/form-data')) {\n    options.formData = {}\n\n    req.postData.params.forEach(function (param) {\n      var attachment = {}\n\n      if (!param.fileName && !param.fileName && !param.contentType) {\n        options.formData[param.name] = param.value\n        return\n      }\n\n      // attempt to read from disk!\n      if (param.fileName && !param.value) {\n        attachment.value = fs.createReadStream(param.fileName)\n      } else if (param.value) {\n        attachment.value = param.value\n      }\n\n      if (param.fileName) {\n        attachment.options = {\n          filename: param.fileName,\n          contentType: param.contentType ? param.contentType : null\n        }\n      }\n\n      options.formData[param.name] = attachment\n    })\n  }\n  else {\n    if (req.postData.text) {\n      options.body = req.postData.text\n    }\n  }\n\n  return options\n}\n\nexports.Har = Har\n"]}