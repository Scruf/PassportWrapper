{"version":3,"sources":["jsdom.js"],"names":[],"mappings":"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","file":"jsdom-compiled.js","sourcesContent":["\"use strict\";\n/* eslint-disable no-unused-expressions */\n() => `jsdom 7.x onward only works on Node.js 4 or newer: https://github.com/tmpvar/jsdom#install`;\n/* eslint-enable no-unused-expressions */\n\nconst fs = require(\"fs\");\nconst path = require(\"path\");\nconst CookieJar = require(\"tough-cookie\").CookieJar;\n\nconst toFileUrl = require(\"./jsdom/utils\").toFileUrl;\nconst defineGetter = require(\"./jsdom/utils\").defineGetter;\nconst defineSetter = require(\"./jsdom/utils\").defineSetter;\nconst documentFeatures = require(\"./jsdom/browser/documentfeatures\");\nconst domToHtml = require(\"./jsdom/browser/domtohtml\").domToHtml;\nconst Window = require(\"./jsdom/browser/Window\");\nconst resourceLoader = require(\"./jsdom/browser/resource-loader\");\nconst VirtualConsole = require(\"./jsdom/virtual-console\");\nconst locationInfo = require(\"./jsdom/living/helpers/internal-constants\").locationInfo;\n\nrequire(\"./jsdom/living\"); // Enable living standard features\n\n/* eslint-disable no-restricted-modules */\n// TODO: stop using the built-in URL in favor of the spec-compliant whatwg-url package\n// This legacy usage is in the process of being purged.\nconst URL = require(\"url\");\n/* eslint-enable no-restricted-modules */\n\nconst canReadFilesFromFS = Boolean(fs.readFile); // in a browserify environment, this isn't present\n\nexports.createVirtualConsole = function (options) {\n  return new VirtualConsole(options);\n};\n\nexports.getVirtualConsole = function (window) {\n  return window._virtualConsole;\n};\n\nexports.createCookieJar = function () {\n  return new CookieJar(null, { looseMode: true });\n};\n\nexports.nodeLocation = function (node) {\n  return node[locationInfo];\n};\n\nexports.reconfigureWindow = function (window, newProps) {\n  if (\"top\" in newProps) {\n    window._top = newProps.top;\n  }\n};\n\nexports.debugMode = false;\n\n// Proxy feature functions to features module.\nfor (const propName of [\"availableDocumentFeatures\", \"defaultDocumentFeatures\", \"applyDocumentFeatures\"]) {\n  defineGetter(exports, propName, () => documentFeatures[propName]);\n  defineSetter(exports, propName, val => documentFeatures[propName] = val);\n}\n\nexports.jsdom = function (html, options) {\n  if (options === undefined) {\n    options = {};\n  }\n  if (options.parsingMode === undefined || options.parsingMode === \"auto\") {\n    options.parsingMode = \"html\";\n  }\n\n  if (options.parsingMode !== \"html\" && options.parsingMode !== \"xml\") {\n    throw new RangeError(`Invalid parsingMode option ${JSON.stringify(options.parsingMode)}; must be either \"html\", ` +\n      `\"xml\", \"auto\", or undefined`);\n  }\n\n  setGlobalDefaultConfig(options);\n\n  // Back-compat hack: we have previously suggested nesting these under document, for jsdom.env at least.\n  // So we need to support that.\n  if (options.document) {\n    if (options.document.cookie !== undefined) {\n      options.cookie = options.document.cookie;\n    }\n    if (options.document.referrer !== undefined) {\n      options.referrer = options.document.referrer;\n    }\n  }\n\n  // List options explicitly to be clear which are passed through\n  const window = new Window({\n    parsingMode: options.parsingMode,\n    contentType: options.contentType,\n    parser: options.parser,\n    url: options.url,\n    referrer: options.referrer,\n    cookieJar: options.cookieJar,\n    cookie: options.cookie,\n    resourceLoader: options.resourceLoader,\n    deferClose: options.deferClose,\n    concurrentNodeIterators: options.concurrentNodeIterators,\n    virtualConsole: options.virtualConsole,\n    pool: options.pool,\n    agentOptions: options.agentOptions,\n    userAgent: options.userAgent\n  });\n\n  documentFeatures.applyDocumentFeatures(window.document, options.features);\n\n  if (options.created) {\n    options.created(null, window.document.defaultView);\n  }\n\n  if (options.parsingMode === \"html\") {\n    if (html === undefined || html === \"\") {\n      html = \"<html><head></head><body></body></html>\";\n    }\n\n    window.document.write(html);\n  }\n  if (options.parsingMode === \"xml\") {\n    if (html !== undefined) {\n      window.document._htmlToDom.appendHtmlToDocument(html, window.document);\n    }\n  }\n\n  if (window.document.close && !options.deferClose) {\n    window.document.close();\n  }\n\n  return window.document;\n};\n\nexports.jQueryify = exports.jsdom.jQueryify = function (window, jqueryUrl, callback) {\n  if (!window || !window.document) {\n    return;\n  }\n\n  const features = window.document.implementation._features;\n  window.document.implementation._addFeature(\"FetchExternalResources\", [\"script\"]);\n  window.document.implementation._addFeature(\"ProcessExternalResources\", [\"script\"]);\n  window.document.implementation._addFeature(\"MutationEvents\", [\"2.0\"]);\n\n  const scriptEl = window.document.createElement(\"script\");\n  scriptEl.className = \"jsdom\";\n  scriptEl.src = jqueryUrl;\n  scriptEl.onload = scriptEl.onerror = () => {\n    window.document.implementation._features = features;\n\n    if (callback) {\n      callback(window, window.jQuery);\n    }\n  };\n\n  window.document.body.appendChild(scriptEl);\n};\n\nexports.env = exports.jsdom.env = function () {\n  const config = getConfigFromArguments(arguments);\n  let req = null;\n\n  if (config.file && canReadFilesFromFS) {\n    req = resourceLoader.readFile(config.file, (err, text) => {\n      if (err) {\n        reportInitError(err, config);\n        return;\n      }\n\n      setParsingModeFromExtension(config, config.file);\n\n      config.html = text;\n      processHTML(config);\n    });\n  } else if (config.html !== undefined) {\n    processHTML(config);\n  } else if (config.url) {\n    req = handleUrl(config);\n  } else if (config.somethingToAutodetect !== undefined) {\n    const url = URL.parse(config.somethingToAutodetect);\n    if (url.protocol && url.hostname) {\n      config.url = config.somethingToAutodetect;\n      req = handleUrl(config.somethingToAutodetect);\n    } else if (canReadFilesFromFS) {\n      req = resourceLoader.readFile(config.somethingToAutodetect, (err, text) => {\n        if (err) {\n          if (err.code === \"ENOENT\" || err.code === \"ENAMETOOLONG\") {\n            config.html = config.somethingToAutodetect;\n            processHTML(config);\n          } else {\n            reportInitError(err, config);\n          }\n        } else {\n          setParsingModeFromExtension(config, config.somethingToAutodetect);\n\n          config.html = text;\n          config.url = toFileUrl(config.somethingToAutodetect);\n          processHTML(config);\n        }\n      });\n    } else {\n      config.html = config.somethingToAutodetect;\n      processHTML(config);\n    }\n  }\n\n  function handleUrl() {\n    const options = {\n      encoding: config.encoding || \"utf8\",\n      headers: config.headers || {},\n      pool: config.pool,\n      agentOptions: config.agentOptions\n    };\n\n    if (config.proxy) {\n      options.proxy = config.proxy;\n    }\n\n    options.headers[\"User-Agent\"] = config.userAgent;\n\n    config.cookieJar = config.cookieJar || exports.createCookieJar();\n\n    return resourceLoader.download(config.url, options, config.cookieJar, null, (err, responseText, res) => {\n      if (err) {\n        reportInitError(err, config);\n        return;\n      }\n\n      // The use of `res.request.uri.href` ensures that `window.location.href`\n      // is updated when `request` follows redirects.\n      config.html = responseText;\n      config.url = res.request.uri.href;\n\n      const contentType = res.headers[\"content-type\"];\n\n      if (config.parsingMode === \"auto\" && (\n        contentType === \"application/xml\" ||\n        contentType === \"text/xml\" ||\n        contentType === \"application/xhtml+xml\")) {\n        config.parsingMode = \"xml\";\n      }\n\n      processHTML(config);\n    });\n  }\n  return req;\n};\n\nexports.serializeDocument = function (doc) {\n  return domToHtml([doc]);\n};\n\nfunction processHTML(config) {\n  const window = exports.jsdom(config.html, config).defaultView;\n  const features = JSON.parse(JSON.stringify(window.document.implementation._features));\n\n  let docsLoaded = 0;\n  const totalDocs = config.scripts.length + config.src.length;\n\n  if (!window || !window.document) {\n    reportInitError(new Error(\"JSDOM: a window object could not be created.\"), config);\n    return;\n  }\n\n  function scriptComplete() {\n    docsLoaded++;\n\n    if (docsLoaded >= totalDocs) {\n      window.document.implementation._features = features;\n\n      process.nextTick(() => {\n        if (config.onload) {\n          config.onload(window);\n        }\n        if (config.done) {\n          config.done(null, window);\n        }\n      });\n    }\n  }\n\n  function handleScriptError() {\n    // nextTick so that an exception within scriptComplete won't cause\n    // another script onerror (which would be an infinite loop)\n    process.nextTick(scriptComplete);\n  }\n\n  if (config.scripts.length > 0 || config.src.length > 0) {\n    window.document.implementation._addFeature(\"FetchExternalResources\", [\"script\"]);\n    window.document.implementation._addFeature(\"ProcessExternalResources\", [\"script\"]);\n    window.document.implementation._addFeature(\"MutationEvents\", [\"2.0\"]);\n\n    for (const scriptSrc of config.scripts) {\n      const script = window.document.createElement(\"script\");\n      script.className = \"jsdom\";\n      script.onload = scriptComplete;\n      script.onerror = handleScriptError;\n      script.src = scriptSrc;\n\n      window.document.body.appendChild(script);\n    }\n\n    for (const scriptText of config.src) {\n      const script = window.document.createElement(\"script\");\n      script.onload = scriptComplete;\n      script.onerror = handleScriptError;\n      script.text = scriptText;\n\n      window.document.documentElement.appendChild(script);\n      window.document.documentElement.removeChild(script);\n    }\n  } else if (window.document.readyState === \"complete\") {\n    scriptComplete();\n  } else {\n    window.addEventListener(\"load\", scriptComplete);\n  }\n}\n\nfunction setGlobalDefaultConfig(config) {\n  config.pool = config.pool !== undefined ? config.pool : {\n    maxSockets: 6\n  };\n\n  config.agentOptions = config.agentOptions !== undefined ? config.agentOptions : {\n    keepAlive: true,\n    keepAliveMsecs: 115 * 1000\n  };\n\n  config.userAgent = config.userAgent || \"Node.js (\" + process.platform + \"; U; rv:\" + process.version + \")\";\n}\n\nfunction getConfigFromArguments(args) {\n  const config = {};\n  if (typeof args[0] === \"object\") {\n    Object.assign(config, args[0]);\n  } else {\n    for (const arg of args) {\n      switch (typeof arg) {\n        case \"string\":\n          config.somethingToAutodetect = arg;\n          break;\n        case \"function\":\n          config.done = arg;\n          break;\n        case \"object\":\n          if (Array.isArray(arg)) {\n            config.scripts = arg;\n          } else {\n            Object.assign(config, arg);\n          }\n          break;\n      }\n    }\n  }\n\n  if (!config.done && !config.created && !config.onload) {\n    throw new Error(\"Must pass a \\\"created\\\", \\\"onload\\\", or \\\"done\\\" option, or a callback, to jsdom.env\");\n  }\n\n  if (config.somethingToAutodetect === undefined &&\n      config.html === undefined && !config.file && !config.url) {\n    throw new Error(\"Must pass a \\\"html\\\", \\\"file\\\", or \\\"url\\\" option, or a string, to jsdom.env\");\n  }\n\n  config.scripts = ensureArray(config.scripts);\n  config.src = ensureArray(config.src);\n  config.parsingMode = config.parsingMode || \"auto\";\n\n  config.features = config.features || {\n    FetchExternalResources: false,\n    ProcessExternalResources: false,\n    SkipExternalResources: false\n  };\n\n  if (!config.url && config.file) {\n    config.url = toFileUrl(config.file);\n  }\n\n  setGlobalDefaultConfig(config);\n\n  return config;\n}\n\nfunction reportInitError(err, config) {\n  if (config.created) {\n    config.created(err);\n  }\n  if (config.done) {\n    config.done(err);\n  }\n}\n\nfunction ensureArray(value) {\n  let array = value || [];\n  if (typeof array === \"string\") {\n    array = [array];\n  }\n  return array;\n}\n\nfunction setParsingModeFromExtension(config, filename) {\n  if (config.parsingMode === \"auto\") {\n    const ext = path.extname(filename);\n    if (ext === \".xhtml\" || ext === \".xml\") {\n      config.parsingMode = \"xml\";\n    }\n  }\n}\n"]}