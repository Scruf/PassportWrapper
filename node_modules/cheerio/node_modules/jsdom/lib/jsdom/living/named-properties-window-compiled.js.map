{"version":3,"sources":["named-properties-window.js"],"names":[],"mappings":"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","file":"named-properties-window-compiled.js","sourcesContent":["\"use strict\";\nconst hasOwnProp = Object.prototype.hasOwnProperty;\nconst namedPropertiesTracker = require(\"../named-properties-tracker\");\nconst NODE_TYPE = require(\"./node-type\");\nconst createHTMLCollection = require(\"./html-collection\").create;\nconst treeOrderSorter = require(\"../utils\").treeOrderSorter;\n\nfunction isNamedPropertyElement(element) {\n  // (for the name attribute)\n\n  // use hasOwnProperty to make sure contentWindow comes from the prototype,\n  // and is not set directly on the node by a script.\n  if (\"contentWindow\" in element && !hasOwnProp.call(element, \"contentWindow\")) {\n    return true;\n  }\n\n  switch (element.nodeName) {\n    case \"A\":\n    case \"APPLET\":\n    case \"AREA\":\n    case \"EMBED\":\n    case \"FORM\":\n    case \"FRAMESET\":\n    case \"IMG\":\n    case \"OBJECT\":\n      return true;\n    default:\n      return false;\n  }\n}\n\nfunction namedPropertyResolver(HTMLCollection, window, name, values) {\n  function getResult() {\n    const results = [];\n\n    for (const node of values().keys()) {\n      if (node.nodeType !== NODE_TYPE.ELEMENT_NODE) {\n        continue;\n      }\n\n      if (node.getAttribute(\"id\") === name) {\n        results.push(node);\n      } else if (node.getAttribute(\"name\") === name && isNamedPropertyElement(node)) {\n        results.push(node);\n      }\n    }\n\n    results.sort(treeOrderSorter);\n\n    return results;\n  }\n\n  const document = window._document;\n  const objects = createHTMLCollection(document.documentElement, getResult);\n\n  const length = objects.length;\n  for (let i = 0; i < length; ++i) {\n    const node = objects[i];\n\n    if (\"contentWindow\" in node && !hasOwnProp.call(node, \"contentWindow\")) {\n      return node.contentWindow;\n    }\n  }\n\n  if (length === 0) {\n    return undefined;\n  }\n\n  if (length === 1) {\n    return objects[0];\n  }\n\n  return objects;\n}\n\nexports.initializeWindow = function (window, HTMLCollection) {\n  namedPropertiesTracker.create(window, namedPropertyResolver.bind(null, HTMLCollection));\n};\n\nexports.elementAttributeModified = function (element, name, value, oldValue) {\n  if (!element._attached) {\n    return;\n  }\n\n  const useName = isNamedPropertyElement(element);\n\n  if (name === \"id\" || (name === \"name\" && useName)) {\n    const tracker = namedPropertiesTracker.get(element._ownerDocument._global);\n\n    // (tracker will be null if the document has no Window)\n    if (tracker) {\n      if (name === \"id\" && (!useName || element.getAttribute(\"name\") !== oldValue)) {\n        tracker.untrack(oldValue, element);\n      }\n\n      if (name === \"name\" && element.getAttribute(\"id\") !== oldValue) {\n        tracker.untrack(oldValue, element);\n      }\n\n      tracker.track(value, element);\n    }\n  }\n};\n\nexports.nodeAttachedToDocument = function (node) {\n  if (node.nodeType !== NODE_TYPE.ELEMENT_NODE) {\n    return;\n  }\n\n  const tracker = namedPropertiesTracker.get(node._ownerDocument._global);\n  if (!tracker) {\n    return;\n  }\n\n  tracker.track(node.getAttribute(\"id\"), node);\n\n  if (isNamedPropertyElement(node)) {\n    tracker.track(node.getAttribute(\"name\"), node);\n  }\n};\n\nexports.nodeDetachedFromDocument = function (node) {\n  if (node.nodeType !== NODE_TYPE.ELEMENT_NODE) {\n    return;\n  }\n\n  const tracker = namedPropertiesTracker.get(node._ownerDocument._global);\n  if (!tracker) {\n    return;\n  }\n\n  tracker.untrack(node.getAttribute(\"id\"), node);\n\n  if (isNamedPropertyElement(node)) {\n    tracker.untrack(node.getAttribute(\"name\"), node);\n  }\n};\n"]}