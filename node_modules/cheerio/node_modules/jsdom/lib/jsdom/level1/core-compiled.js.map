{"version":3,"sources":["core.js"],"names":[],"mappings":"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","file":"core-compiled.js","sourcesContent":["\"use strict\";\n/*\n  ServerJS Javascript DOM Level 1\n*/\nvar inheritFrom = require(\"../utils\").inheritFrom;\nvar domToHtml = require(\"../browser/domtohtml\").domToHtml;\nvar defineGetter = require(\"../utils\").defineGetter;\nvar memoizeQuery = require(\"../utils\").memoizeQuery;\nvar validateName = require('../living/helpers/validate-names').name;\nvar HtmlToDom = require(\"../browser/htmltodom\").HtmlToDom;\nvar Location = require(\"../browser/location\");\nvar vm = require(\"vm\");\nvar CookieJar = require('tough-cookie').CookieJar;\nvar EventTarget = require(\"../living/generated/EventTarget\");\nvar attributes = require(\"../living/attributes\");\nvar mapper = require(\"../utils\").mapper;\nvar clone = require(\"../living/node\").clone;\nvar namedPropertiesWindow = require(\"../living/named-properties-window\");\nvar Window = require('../browser/Window');\nvar proxiedWindowEventHandlers = require(\"../living/helpers/proxied-window-event-handlers\");\nconst URL = require(\"../utils\").URL;\nconst domSymbolTree = require(\"../living/helpers/internal-constants\").domSymbolTree;\nconst NODE_TYPE = require(\"../living/node-type\");\nconst resetDOMTokenList = require(\"../living/dom-token-list\").reset;\nconst createLiveNodeList = require(\"../living/node-list\").createLive;\nconst updateNodeList = require(\"../living/node-list\").update;\nconst updateHTMLCollection = require(\"../living/html-collection\").update;\n\n// utility functions\nvar attachId = function(id,elm,doc) {\n  if (id && elm && doc) {\n    if (!doc._ids[id]) {\n      doc._ids[id] = [];\n    }\n    doc._ids[id].push(elm);\n  }\n};\nvar detachId = function(id,elm,doc) {\n  var elms, i;\n  if (id && elm && doc) {\n    if (doc._ids && doc._ids[id]) {\n      elms = doc._ids[id];\n      for (i=0;i<elms.length;i++) {\n        if (elms[i] === elm) {\n          elms.splice(i,1);\n          i--;\n        }\n      }\n      if (elms.length === 0) {\n        delete doc._ids[id];\n      }\n    }\n  }\n};\n\nfunction setInnerHTML(document, node, html) {\n  // Clear the children first:\n  if (node._templateContents) {\n    clearChildNodes(node._templateContents);\n  } else {\n    clearChildNodes(node);\n  }\n\n  if (html !== \"\") {\n    if (node.nodeName === \"#document\") {\n      document._htmlToDom.appendHtmlToDocument(html, node);\n    } else {\n      document._htmlToDom.appendHtmlToElement(html, node);\n    }\n  }\n}\n\nfunction clearChildNodes(node) {\n  for (let child = null; child = domSymbolTree.firstChild(node);) {\n    node.removeChild(child);\n  }\n}\n\nvar core = exports;\n\ncore.DOMException = require(\"../web-idl/DOMException\");\ncore.NamedNodeMap = require(\"../living/attributes\").NamedNodeMap;\n\ncore.DOMImplementation = function DOMImplementation(document, /* Object */ features) {\n  throw new TypeError(\"Illegal constructor\");\n};\n\ncore.DOMImplementation.prototype = {\n  // All of these are legacy, left because jsdom uses them internally :(. jsdom confused the idea of browser features\n  // and jsdom features\n  _removeFeature : function(feature, version) {\n    feature = feature.toLowerCase();\n    if (this._features[feature]) {\n      if (version) {\n        var j        = 0,\n            versions = this._features[feature],\n            l        = versions.length;\n\n        for (j; j<l; j++) {\n          if (versions[j] === version) {\n            versions.splice(j,1);\n            return;\n          }\n        }\n      } else {\n        delete this._features[feature];\n      }\n    }\n  },\n\n  _addFeature: function(feature, version) {\n    feature = feature.toLowerCase();\n\n    if (version) {\n\n      if (!this._features[feature]) {\n        this._features[feature] = [];\n      }\n\n      if (version instanceof Array) {\n        Array.prototype.push.apply(this._features[feature], version);\n      } else {\n        this._features[feature].push(version);\n      }\n\n      if (feature === \"processexternalresources\" &&\n          (version === \"script\" || (version.indexOf && version.indexOf(\"script\") !== -1)) &&\n          !vm.isContext(this._ownerDocument._global)) {\n        vm.createContext(this._ownerDocument._global);\n        this._ownerDocument._defaultView._globalProxy = vm.runInContext(\"this\", this._ownerDocument._global);\n        this._ownerDocument._defaultView = this._ownerDocument._defaultView._globalProxy;\n      }\n    }\n  },\n\n  // The real hasFeature is in living/dom-implementation.js, and returns true always.\n  // This one is used internally\n  _hasFeature: function(/* string */ feature, /* string */ version) {\n    feature = (feature) ? feature.toLowerCase() : '';\n    var versions = (this._features[feature]) ?\n                    this._features[feature]  :\n                    false;\n\n    if (!version && versions.length && versions.length > 0) {\n      return true;\n    } else if (typeof versions === 'string') {\n      return versions === version;\n    } else if (versions.indexOf && versions.length > 0) {\n      for (var i = 0; i < versions.length; i++) {\n        var found = versions[i] instanceof RegExp ?\n          versions[i].test(version) :\n          versions[i] === version;\n        if (found) { return true; }\n      }\n      return false;\n    } else {\n      return false;\n    }\n  }\n};\n\ncore.Node = function Node(ownerDocument) {\n  EventTarget.setup(this);\n\n  domSymbolTree.initialize(this);\n  this._childNodesList = null;\n  this._ownerDocument = ownerDocument;\n  this._childrenList = null;\n  this._version = 0;\n  this._memoizedQueries = {};\n  this._readonly = false;\n};\n\ncore.Node.ELEMENT_NODE                = NODE_TYPE.ELEMENT_NODE;\ncore.Node.ATTRIBUTE_NODE              = NODE_TYPE.ATTRIBUTE_NODE;\ncore.Node.TEXT_NODE                   = NODE_TYPE.TEXT_NODE;\ncore.Node.CDATA_SECTION_NODE          = NODE_TYPE.CDATA_SECTION_NODE;\ncore.Node.ENTITY_REFERENCE_NODE       = NODE_TYPE.ENTITY_REFERENCE_NODE;\ncore.Node.ENTITY_NODE                 = NODE_TYPE.ENTITY_NODE;\ncore.Node.PROCESSING_INSTRUCTION_NODE = NODE_TYPE.PROCESSING_INSTRUCTION_NODE;\ncore.Node.COMMENT_NODE                = NODE_TYPE.COMMENT_NODE;\ncore.Node.DOCUMENT_NODE               = NODE_TYPE.DOCUMENT_NODE;\ncore.Node.DOCUMENT_TYPE_NODE          = NODE_TYPE.DOCUMENT_TYPE_NODE;\ncore.Node.DOCUMENT_FRAGMENT_NODE      = NODE_TYPE.DOCUMENT_FRAGMENT_NODE;\ncore.Node.NOTATION_NODE               = NODE_TYPE.NOTATION_NODE;\n\ncore.Node.prototype = {\n  ELEMENT_NODE                : NODE_TYPE.ELEMENT_NODE,\n  ATTRIBUTE_NODE              : NODE_TYPE.ATTRIBUTE_NODE,\n  TEXT_NODE                   : NODE_TYPE.TEXT_NODE,\n  CDATA_SECTION_NODE          : NODE_TYPE.CDATA_SECTION_NODE,\n  ENTITY_REFERENCE_NODE       : NODE_TYPE.ENTITY_REFERENCE_NODE,\n  ENTITY_NODE                 : NODE_TYPE.ENTITY_NODE,\n  PROCESSING_INSTRUCTION_NODE : NODE_TYPE.PROCESSING_INSTRUCTION_NODE,\n  COMMENT_NODE                : NODE_TYPE.COMMENT_NODE,\n  DOCUMENT_NODE               : NODE_TYPE.DOCUMENT_NODE,\n  DOCUMENT_TYPE_NODE          : NODE_TYPE.DOCUMENT_TYPE_NODE,\n  DOCUMENT_FRAGMENT_NODE      : NODE_TYPE.DOCUMENT_FRAGMENT_NODE,\n  NOTATION_NODE               : NODE_TYPE.NOTATION_NODE,\n\n  get nodeValue() {\n    if (this.nodeType === NODE_TYPE.TEXT_NODE ||\n        this.nodeType === NODE_TYPE.COMMENT_NODE ||\n        this.nodeType === NODE_TYPE.PROCESSING_INSTRUCTION_NODE) {\n      return this._data;\n    }\n\n    return null;\n  },\n  set nodeValue(value) {\n    if (this.nodeType === NODE_TYPE.TEXT_NODE ||\n        this.nodeType === NODE_TYPE.COMMENT_NODE ||\n        this.nodeType === NODE_TYPE.PROCESSING_INSTRUCTION_NODE) {\n      this.replaceData(0, this.length, value);\n    }\n  },\n  get parentNode() {\n    return domSymbolTree.parent(this);\n  },\n\n  get nodeName() {\n    switch (this.nodeType) {\n      case NODE_TYPE.ELEMENT_NODE:\n        return this.tagName;\n      case NODE_TYPE.TEXT_NODE:\n        return \"#text\";\n      case NODE_TYPE.PROCESSING_INSTRUCTION_NODE:\n        return this.target;\n      case NODE_TYPE.COMMENT_NODE:\n        return \"#comment\";\n      case NODE_TYPE.DOCUMENT_NODE:\n        return \"#document\";\n      case NODE_TYPE.DOCUMENT_TYPE_NODE:\n        return this.name;\n      case NODE_TYPE.DOCUMENT_FRAGMENT_NODE:\n        return \"#document-fragment\";\n    }\n  },\n  set nodeName(unused) { throw new core.DOMException();},\n  get firstChild() {\n    return domSymbolTree.firstChild(this);\n  },\n  get ownerDocument() {\n    // TODO: when we move nodeType to Node.prototype and add an internal _nodeType, consult that instead.\n    return this.nodeType === NODE_TYPE.DOCUMENT_NODE ? null : this._ownerDocument;\n  },\n  get readonly() { return this._readonly;},\n\n  get lastChild() {\n    return domSymbolTree.lastChild(this);\n  },\n\n  get childNodes() {\n    if (!this._childNodesList) {\n      var self = this;\n      this._childNodesList = createLiveNodeList(this, function() {\n        return domSymbolTree.childrenToArray(self);\n      });\n    } else {\n      updateNodeList(this._childNodesList);\n    }\n\n    return this._childNodesList;\n  },\n  set childNodes(unused) { throw new core.DOMException();},\n\n  get nextSibling() {\n    return domSymbolTree.nextSibling(this);\n  },\n  set nextSibling(unused) { throw new core.DOMException();},\n\n  get previousSibling() {\n    return domSymbolTree.previousSibling(this);\n  },\n  set previousSibling(unused) { throw new core.DOMException();},\n\n  /* returns Node */\n  insertBefore :  function(/* Node */ newChild, /* Node*/ refChild) {\n    if (arguments.length < 2) {\n      throw new TypeError(\"Not enough arguments to Node.prototype.insertBefore\");\n    }\n    if (refChild === undefined) {\n      refChild = null;\n    }\n\n    // TODO branding\n    if (!newChild || !(\"nodeType\" in newChild)) {\n      throw new TypeError(\"First argument to Node.prototype.insertBefore must be a Node\");\n    }\n    if (refChild !== null && !(\"nodeType\" in refChild)) {\n      throw new TypeError(\"Second argument to Node.prototype.insertBefore must be a Node or null or undefined\");\n    }\n\n    if (this._readonly === true) {\n      throw new core.DOMException(core.DOMException.NO_MODIFICATION_ALLOWED_ERR, 'Attempting to modify a read-only node');\n    }\n\n    // DocumentType must be implicitly adopted\n    if (newChild.nodeType === NODE_TYPE.DOCUMENT_TYPE_NODE) newChild._ownerDocument = this._ownerDocument;\n\n    // TODO - if (!newChild) then?\n    if (!(this instanceof core.Document) && newChild._ownerDocument !== this._ownerDocument) {\n      throw new core.DOMException(core.DOMException.WRONG_DOCUMENT_ERR);\n    }\n\n    if (newChild.nodeType && newChild.nodeType === NODE_TYPE.ATTRIBUTE_NODE) {\n      throw new core.DOMException(core.DOMException.HIERARCHY_REQUEST_ERR);\n    }\n\n    // search for parents matching the newChild\n    for (const ancestor of domSymbolTree.ancestorsIterator(this)) {\n      if (ancestor === newChild) {\n        throw new core.DOMException(core.DOMException.HIERARCHY_REQUEST_ERR);\n      }\n    }\n\n    // fragments are merged into the element (except parser-created fragments in <template>)\n    if (newChild.nodeType === NODE_TYPE.DOCUMENT_FRAGMENT_NODE) {\n\n      let grandChild;\n      while ((grandChild = domSymbolTree.firstChild(newChild))) {\n        newChild.removeChild(grandChild);\n        this.insertBefore(grandChild, refChild);\n      }\n\n    } else if (newChild === refChild) {\n      return newChild;\n    } else {\n      const oldParent = domSymbolTree.parent(newChild);\n      // if the newChild is already in the tree elsewhere, remove it first\n      if (oldParent) {\n        oldParent.removeChild(newChild);\n      }\n\n      if (refChild == null) {\n        domSymbolTree.appendChild(this, newChild);\n      } else {\n        if (domSymbolTree.parent(refChild) !== this) {\n          throw new core.DOMException(core.DOMException.NOT_FOUND_ERR);\n        }\n\n        domSymbolTree.insertBefore(refChild, newChild);\n      }\n\n      this._modified();\n\n      if (this._attached && newChild._attach) {\n        newChild._attach();\n      }\n\n      this._descendantAdded(this, newChild);\n    }\n\n    return newChild;\n  }, // raises(DOMException);\n\n  _modified: function() {\n    this._version++;\n    if (this._ownerDocument) {\n      this._ownerDocument._version++;\n    }\n\n    if (this._childrenList) {\n      updateHTMLCollection(this._childrenList);\n    }\n    if (this._childNodesList) {\n      updateNodeList(this._childNodesList);\n    }\n    this._clearMemoizedQueries();\n  },\n\n  _clearMemoizedQueries: function() {\n    this._memoizedQueries = {};\n    const myParent = domSymbolTree.parent(this);\n    if (myParent) {\n      myParent._clearMemoizedQueries();\n    }\n  },\n\n  _descendantRemoved: function(parent, child) {\n    const myParent = domSymbolTree.parent(this);\n    if (myParent) {\n      myParent._descendantRemoved(parent, child);\n    }\n  },\n\n  _descendantAdded: function(parent, child) {\n    const myParent = domSymbolTree.parent(this);\n    if (myParent) {\n      myParent._descendantAdded(parent, child);\n    }\n  },\n\n  _attrModified: function(name, value, oldValue) {\n    this._modified();\n    namedPropertiesWindow.elementAttributeModified(this, name, value, oldValue);\n\n    if (name == 'id' && this._attached) {\n      var doc = this._ownerDocument;\n      detachId(oldValue,this,doc);\n      attachId(value,this,doc);\n    }\n\n    // TODO event handlers:\n    // The correct way to do this is lazy, and a bit more complicated; see\n    // https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-content-attributes\n    // It would only be possible if we had proper getters/setters for every event handler, which we don't right now.\n    if (name.length > 2 && name[0] === 'o' && name[1] === 'n') {\n      if (value) {\n        var w = this._ownerDocument._global;\n        var self = proxiedWindowEventHandlers.has(name) && this._localName === 'body' ? w : this;\n        var vmOptions = { filename: this._ownerDocument._URL, displayErrors: false };\n\n        // The handler code probably refers to functions declared globally on the window, so we need to run it in\n        // that context. In fact, it's worse; see\n        // https://code.google.com/p/chromium/codesearch#chromium/src/third_party/WebKit/Source/bindings/core/v8/V8LazyEventListener.cpp\n        // plus the spec, which show how multiple nested scopes are technically required. We won't implement that\n        // until someone asks for it, though.\n\n        // https://html.spec.whatwg.org/multipage/webappapis.html#the-event-handler-processing-algorithm\n\n        if (name === \"onerror\" && self === w) {\n          // https://html.spec.whatwg.org/multipage/webappapis.html#getting-the-current-value-of-the-event-handler\n          // step 10\n\n          self[name] = function (event, source, lineno, colno, error) {\n            w.__tempEventHandlerThis = this;\n            w.__tempEventHandlerEvent = event;\n            w.__tempEventHandlerSource = source;\n            w.__tempEventHandlerLineno = lineno;\n            w.__tempEventHandlerColno = colno;\n            w.__tempEventHandlerError = error;\n\n            try {\n              return vm.runInContext(`\n                (function (event, source, lineno, colno, error) {\n                  ${value}\n                }).call(__tempEventHandlerThis, __tempEventHandlerEvent, __tempEventHandlerSource,\n                        __tempEventHandlerLineno, __tempEventHandlerColno, __tempEventHandlerError)`, w, vmOptions);\n            } finally {\n              delete w.__tempEventHandlerThis;\n              delete w.__tempEventHandlerEvent;\n              delete w.__tempEventHandlerSource;\n              delete w.__tempEventHandlerLineno;\n              delete w.__tempEventHandlerColno;\n              delete w.__tempEventHandlerError;\n            }\n          };\n        } else {\n          self[name] = function (event) {\n            w.__tempEventHandlerThis = this;\n            w.__tempEventHandlerEvent = event;\n\n            try {\n              return vm.runInContext(`\n                (function (event) {\n                  ${value}\n                }).call(__tempEventHandlerThis, __tempEventHandlerEvent)`, w, vmOptions);\n            } finally {\n              delete w.__tempEventHandlerThis;\n              delete w.__tempEventHandlerEvent;\n            }\n          };\n        }\n      } else {\n        this[name] = null;\n      }\n    }\n\n    // TODO remove MutationEvents completely at some point\n    if (value !== oldValue && this._ownerDocument &&\n        this._ownerDocument.implementation._hasFeature('MutationEvents')) {\n      var ev = this._ownerDocument.createEvent(\"MutationEvents\");\n\n      var attrChange = core.MutationEvent.MODIFICATION;\n      if (value === null) {\n        attrChange = core.MutationEvent.REMOVAL;\n      }\n      if (oldValue === null) {\n        attrChange = core.MutationEvent.ADDITION;\n      }\n\n      ev.initMutationEvent(\"DOMAttrModified\", true, false, this, oldValue, value, name, attrChange);\n      this.dispatchEvent(ev);\n    }\n\n    // update classList\n    if (name === \"class\" && value !== this.classList.toString()) {\n      resetDOMTokenList(this.classList, value);\n    }\n  },\n\n  replaceChild(node, child) {\n    if (arguments.length < 2) {\n      throw new TypeError(\"Not enough arguments to Node.prototype.replaceChild\");\n    }\n    // TODO branding\n    if (!node || !(\"nodeType\" in node)) {\n      throw new TypeError(\"First argument to Node.prototype.replaceChild must be a Node\");\n    }\n    if (!child || !(\"nodeType\" in child)) {\n      throw new TypeError(\"Second argument to Node.prototype.replaceChild must be a Node\");\n    }\n\n    this.insertBefore(node, child);\n    return this.removeChild(child);\n  },\n\n  /* returns void */\n  _attach : function() {\n    this._attached = true;\n    namedPropertiesWindow.nodeAttachedToDocument(this);\n\n    if (this.id) {\n      attachId(this.id,this,this._ownerDocument);\n    }\n\n    for (const child of domSymbolTree.childrenIterator(this)) {\n      if (child._attach) {\n        child._attach();\n      }\n    }\n  },\n  /* returns void */\n  _detach : function() {\n    this._attached = false;\n\n    namedPropertiesWindow.nodeDetachedFromDocument(this);\n\n    if (this.id) {\n      detachId(this.id,this,this._ownerDocument);\n    }\n\n    for (const child of domSymbolTree.childrenIterator(this)) {\n      if (child._detach) {\n        child._detach();\n      }\n    }\n  },\n\n  /* returns Node */\n  removeChild : function(/* Node */ oldChild){\n    if (this._readonly === true) {\n      throw new core.DOMException(core.DOMException.NO_MODIFICATION_ALLOWED_ERR);\n    }\n\n    if (!oldChild || domSymbolTree.parent(oldChild) !== this) {\n      throw new core.DOMException(core.DOMException.NOT_FOUND_ERR);\n    }\n\n    var oldPreviousSibling = oldChild.previousSibling;\n    domSymbolTree.remove(oldChild);\n    this._modified();\n    oldChild._detach();\n    this._descendantRemoved(this, oldChild);\n    if (this._ownerDocument) {\n      this._ownerDocument._runRemovingSteps(oldChild, this, oldPreviousSibling);\n    }\n    return oldChild;\n  }, // raises(DOMException);\n\n  /* returns Node */\n  appendChild : function(/* Node */ newChild) {\n    if (arguments.length < 1) {\n      throw new TypeError(\"Not enough arguments to Node.prototype.appendChild\");\n    }\n    // TODO branding\n    if (!(\"nodeType\" in newChild)) {\n      throw new TypeError(\"First argument to Node.prototype.appendChild must be a Node\");\n    }\n\n    return this.insertBefore(newChild, null);\n  }, // raises(DOMException);\n\n  /* returns boolean */\n  hasChildNodes : function() {\n    return domSymbolTree.hasChildren(this);\n  },\n\n  /* returns void */\n  normalize: function() {\n    for (const child of domSymbolTree.childrenIterator(this)) {\n      if (child.normalize) {\n        child.normalize();\n      }\n\n      // Level2/core clean off empty nodes\n      if (child.nodeValue === \"\") {\n        this.removeChild(child);\n        continue;\n      }\n\n      const prevChild = domSymbolTree.previousSibling(child);\n\n      if (prevChild &&\n          prevChild.nodeType === NODE_TYPE.TEXT_NODE &&\n          child.nodeType === NODE_TYPE.TEXT_NODE) {\n        // merge text nodes\n        prevChild.appendData(child.nodeValue);\n        this.removeChild(child);\n      }\n    }\n  },\n  toString: function() {\n    var id = '';\n    if (this.id) {\n        id = '#' + this.id;\n    }\n    if (this.className) {\n        var classes = this.className.split(/\\s+/);\n        for (var i = 0, len = classes.length; i < len; i++) {\n            id += '.' + classes[i];\n        }\n    }\n    return '[ ' + this.tagName + id + ' ]';\n  }\n};\n\ncore.Element = function Element(document, localName) {\n  core.Node.call(this, document);\n  this._namespaceURI = null;\n  this._prefix = null;\n  this._localName = localName;\n  this._attributes = attributes.createNamedNodeMap(this);\n};\n\ninheritFrom(core.Node, core.Element, {\n  get namespaceURI() {\n    return this._namespaceURI;\n  },\n  get prefix() {\n    return this._prefix;\n  },\n  get localName() {\n    return this._localName;\n  },\n  get tagName() {\n    var qualifiedName = this._prefix !== null ? this._prefix + \":\" + this._localName : this._localName;\n    if (this.namespaceURI === \"http://www.w3.org/1999/xhtml\" && this._ownerDocument._parsingMode === \"html\") {\n      qualifiedName = qualifiedName.toUpperCase();\n    }\n    return qualifiedName;\n  },\n\n  get id() {\n    var idAttr = this.getAttribute(\"id\");\n    if (idAttr === null) {\n      return \"\";\n    }\n    return idAttr;\n  },\n\n  nodeType : NODE_TYPE.ELEMENT_NODE,\n  get attributes() {\n    return this._attributes;\n  },\n\n  get sourceIndex() {\n    /*\n    * According to QuirksMode:\n    * Get the sourceIndex of element x. This is also the index number for\n    * the element in the document.getElementsByTagName('*') array.\n    * http://www.quirksmode.org/dom/w3c_core.html#t77\n    */\n    var items = this.ownerDocument.getElementsByTagName('*'),\n        len = items.length;\n\n    for (var i = 0; i < len; i++) {\n      if (items[i] === this) {\n        return i;\n      }\n    }\n  },\n\n  get outerHTML() {\n    return domToHtml([this]);\n  },\n\n  set outerHTML(html) {\n    if (html === null) {\n      html = \"\";\n    }\n\n    var parent = domSymbolTree.parent(this);\n    var document = this._ownerDocument;\n\n    if (!parent) {\n      return;\n    }\n\n    var contextElement;\n    if (parent.nodeType === NODE_TYPE.DOCUMENT_NODE) {\n      throw new core.DOMException(core.DOMException.NO_MODIFICATION_ALLOWED_ERR,\n                                  \"Modifications are not allowed for this document\");\n    } else if (parent.nodeType === NODE_TYPE.DOCUMENT_FRAGMENT_NODE) {\n      contextElement = document.createElementNS(\"http://www.w3.org/1999/xhtml\", \"body\");\n    } else if (parent.nodeType === NODE_TYPE.ELEMENT_NODE) {\n      contextElement = clone(core, parent, undefined, false);\n    } else {\n      throw new TypeError(\"This should never happen\");\n    }\n\n    document._htmlToDom.appendHtmlToElement(html, contextElement);\n\n    while (contextElement.firstChild) {\n      parent.insertBefore(contextElement.firstChild, this);\n    }\n\n    parent.removeChild(this);\n  },\n\n  get innerHTML() {\n    var tagName = this.tagName;\n    if (tagName === 'SCRIPT' || tagName === 'STYLE') {\n      var type = this.getAttribute('type');\n      if (!type || /^text\\//i.test(type) || /\\/javascript$/i.test(type)) {\n        return domToHtml(domSymbolTree.childrenIterator(this));\n      }\n    }\n\n    // In case of <template> we should pass its \"template contents\" fragment as a serialization root if we have one\n    if (this._templateContents) {\n      return domToHtml(domSymbolTree.childrenIterator(this._templateContents));\n    }\n\n    return domToHtml(domSymbolTree.childrenIterator(this));\n  },\n\n  set innerHTML(html) {\n    if (html === null) {\n      html = \"\";\n    }\n\n    setInnerHTML(this.ownerDocument, this, html);\n  },\n\n  scrollTop: 0,\n  scrollLeft: 0,\n\n  /* returns NodeList */\n  getElementsByTagName: memoizeQuery(function(/* string */ name) {\n    name = name.toLowerCase();\n\n    function filterByTagName(child) {\n      if (child.nodeName && child.nodeType === NODE_TYPE.ELEMENT_NODE) {\n        return name === \"*\" || (child.nodeName.toLowerCase() === name);\n      }\n\n      return false;\n    }\n    return createLiveNodeList(this._ownerDocument || this, mapper(this, filterByTagName, true));\n  }),\n});\n\ncore.DocumentFragment = function DocumentFragment(document) {\n  core.Node.call(this, document);\n};\ninheritFrom(core.Node, core.DocumentFragment, {\n  nodeType : NODE_TYPE.DOCUMENT_FRAGMENT_NODE\n});\n\ncore.Document = function Document(options) {\n  if (!options || !options.parsingMode || (options.parsingMode !== \"html\" && options.parsingMode !== \"xml\")) {\n    throw new Error(\"options must exist and contain a parsingMode of html or xml\");\n  }\n\n  core.Node.call(this, this);\n  this._parsingMode = options.parsingMode;\n  this._htmlToDom = new HtmlToDom(core, options.parser, options.parsingMode);\n\n  this._implementation = Object.create(core.DOMImplementation.prototype);\n  this._implementation._ownerDocument = this;\n  this._implementation._features = {};\n\n  this._defaultView = options.defaultView || null;\n  this._global = options.global;\n  this._documentElement = null;\n  this._ids = Object.create(null);\n  this._attached = true;\n  this._readonly = false;\n  this._currentScript = null;\n  this._cookieJar = options.cookieJar === undefined ? new CookieJar(null, { looseMode: true }) : options.cookieJar;\n\n  this._contentType = options.contentType;\n  if (this._contentType === undefined) {\n    this._contentType = this._parsingMode === \"xml\" ? \"application/xml\" : \"text/html\";\n  }\n\n  this._URL = options.url === undefined ? \"about:blank\" : new URL(options.url).href;\n  this._location = new Location(this._URL, this);\n\n  if (options.cookie) {\n    var cookies = Array.isArray(options.cookie) ? options.cookie: [options.cookie];\n    var document = this;\n\n    cookies.forEach(function(cookieStr) {\n      document._cookieJar.setCookieSync(cookieStr, document._URL, { ignoreError : true });\n    });\n  }\n\n  this._activeNodeIterators = [];\n  this._activeNodeIteratorsMax = options.concurrentNodeIterators === undefined ?\n                                 10 :\n                                 Number(options.concurrentNodeIterators);\n\n  if (isNaN(this._activeNodeIteratorsMax)) {\n    throw new TypeError(\"The 'concurrentNodeIterators' option must be a Number\");\n  }\n\n  if (this._activeNodeIteratorsMax < 0) {\n    throw new RangeError(\"The 'concurrentNodeIterators' option must be a non negative Number\");\n  }\n};\n\ncore.Document._removingSteps = [];\n\nvar tagRegEx = /[^\\w:\\d_\\.-]+/i;\nvar entRegEx = /[^\\w\\d_\\-&;]+/;\nvar invalidAttrRegEx = /[\\s\"'>/=\\u0000-\\u001A]/;\n\ninheritFrom(core.Node, core.Document, {\n  nodeType : NODE_TYPE.DOCUMENT_NODE,\n  _elementBuilders : { },\n  _defaultElementBuilder: function(document, tagName) {\n    return new core.Element(document, tagName);\n  },\n  get contentType() { return this._contentType;},\n  get compatMode() { return (this._parsingMode === \"xml\" || this.doctype) ? \"CSS1Compat\" : \"BackCompat\"; },\n  get charset() { return \"UTF-8\"; },\n  get characterSet() { return \"UTF-8\"; },\n  get inputEncoding() { return \"UTF-8\"; },\n  get doctype() {\n    for (const childNode of domSymbolTree.childrenIterator(this)) {\n      if (childNode.nodeType === NODE_TYPE.DOCUMENT_TYPE_NODE) {\n        return childNode;\n      }\n    }\n    return null;\n  },\n  get URL() {\n    return this._URL;\n  },\n  get documentURI() {\n    return this._URL;\n  },\n  get location() {\n    return this._defaultView ? this._location : null;\n  },\n  get documentElement() {\n    if (this._documentElement) {\n      return this._documentElement;\n    }\n\n    for (const childNode of domSymbolTree.childrenIterator(this)) {\n      if (childNode.nodeType === NODE_TYPE.ELEMENT_NODE) {\n        this._documentElement = childNode;\n        return childNode;\n      }\n    }\n\n    return null;\n\n  },\n\n  get implementation() { return this._implementation;},\n  set implementation(implementation) { this._implementation = implementation;},\n  get readonly() { return this._readonly;},\n\n  get defaultView() {\n    return this._defaultView;\n  },\n\n  get currentScript() {\n    return this._currentScript;\n  },\n\n  toString: function () {\n    return '[object HTMLDocument]';\n  },\n\n  _createElementWithCorrectElementInterface: function (name, namespace) {\n    // https://dom.spec.whatwg.org/#concept-element-interface\n    // TODO: eventually we should re-write the element-builder system to be namespace aware, but for now it is not.\n    return (this._elementBuilders[name.toLowerCase()] || this._defaultElementBuilder)(this, name, namespace);\n  },\n\n  appendChild : function(/* Node */ arg) {\n    if (this.documentElement && arg.nodeType == NODE_TYPE.ELEMENT_NODE) {\n      throw new core.DOMException(core.DOMException.HIERARCHY_REQUEST_ERR);\n    }\n    return core.Node.prototype.appendChild.call(this, arg);\n  },\n\n  removeChild : function(/* Node */ arg) {\n    var ret = core.Node.prototype.removeChild.call(this, arg);\n    if (arg == this._documentElement) {\n      this._documentElement = null;// force a recalculation\n    }\n    return ret;\n  },\n\n  _descendantRemoved: function(parent, child) {\n    if (child.tagName === 'STYLE') {\n      var index = this.styleSheets.indexOf(child.sheet);\n      if (index > -1) {\n        this.styleSheets.splice(index, 1);\n      }\n    }\n  },\n\n  /* returns NodeList */\n  getElementsByTagName: memoizeQuery(function(/* string */ name) {\n    function filterByTagName(child) {\n      if (child.nodeName && child.nodeType === NODE_TYPE.ELEMENT_NODE)\n      {\n        if (name === \"*\") {\n          return true;\n\n        // case insensitivity for html\n        } else if (child._ownerDocument && child._ownerDocument._doctype &&\n                   //child._ownerDocument._doctype.name === \"html\" &&\n                   child.nodeName.toLowerCase() === name.toLowerCase())\n        {\n          return true;\n        } else if (child.nodeName.toLowerCase() === name.toLowerCase()) {\n          return true;\n        }\n      }\n      return false;\n    }\n    return createLiveNodeList(this.documentElement || this, mapper(this, filterByTagName, true));\n  }),\n\n  write: function () {\n    var text = \"\";\n    for (var i = 0; i < arguments.length; ++i) {\n      text += String(arguments[i]);\n    }\n\n    if (this._parsingMode === \"xml\") {\n      throw new core.DOMException(core.DOMException.INVALID_STATE_ERR, \"Cannot use document.write on XML documents\");\n    }\n\n    if (this._writeAfterElement) {\n      // If called from an script element directly (during the first tick),\n      // the new elements are inserted right after that element.\n      var tempDiv = this.createElement('div');\n      setInnerHTML(this, tempDiv, text);\n\n      var child = tempDiv.firstChild;\n      var previous = this._writeAfterElement;\n      var parent = this._writeAfterElement.parentNode;\n\n      while (child) {\n        var node = child;\n        child = child.nextSibling;\n        parent.insertBefore(node, previous.nextSibling);\n        previous = node;\n      }\n    } else if (this.readyState === \"loading\") {\n      // During page loading, document.write appends to the current element\n      // Find the last child that has been added to the document.\n      var node = this;\n      while (node.lastChild && node.lastChild.nodeType === NODE_TYPE.ELEMENT_NODE) {\n        node = node.lastChild;\n      }\n      setInnerHTML(this, node, text);\n    } else if (text) {\n      setInnerHTML(this, this, text);\n    }\n  },\n\n  writeln: function () {\n    const args = [];\n    for (let i = 0; i < arguments.length; ++i) {\n      args.push(arguments[i]);\n    }\n    args.push(\"\\n\");\n    this.write.apply(this, args);\n  },\n\n  _runRemovingSteps: function(oldNode, oldParent, oldPreviousSibling) {\n    var listeners = core.Document._removingSteps;\n    for (var i = 0; i < listeners.length; ++i) {\n      listeners[i](this, oldNode, oldParent, oldPreviousSibling);\n    }\n  }\n});\n"]}