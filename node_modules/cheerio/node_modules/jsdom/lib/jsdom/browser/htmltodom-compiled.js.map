{"version":3,"sources":["htmltodom.js"],"names":[],"mappings":"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","file":"htmltodom-compiled.js","sourcesContent":["\"use strict\";\n\nconst parse5 = require(\"parse5\");\nconst sax = require(\"sax\");\nconst attributes = require(\"../living/attributes\");\nconst createDocumentTypeInternal = require(\"../living/document-type\").create;\nconst locationInfo = require(\"../living/helpers/internal-constants\").locationInfo;\n\nclass HtmlToDom {\n  constructor(core, parser, parsingMode) {\n    if (!parser) {\n      if (parsingMode === \"xml\") {\n        parser = sax;\n      } else {\n        parser = parse5;\n      }\n    }\n\n    this.core = core;\n    this.parser = parser;\n    this.parsingMode = parsingMode;\n\n    if (parser.DefaultHandler) {\n      this.parserType = \"htmlparser2\";\n    } else if (parser.Parser && parser.TreeAdapters) {\n      this.parserType = \"parse5v1\";\n    } else if (parser.moduleName === \"HTML5\") {\n      this.parserType = \"html5\";\n    } else if (parser.parser) {\n      this.parserType = \"sax\";\n    }\n  }\n\n  appendHtmlToElement(html, element) {\n    if (typeof html !== \"string\") {\n      html = String(html);\n    }\n\n    return this[\"_parseWith\" + this.parserType](html, true, element);\n  }\n\n  appendHtmlToDocument(html, element) {\n    if (typeof html !== \"string\") {\n      html = String(html);\n    }\n\n    return this[\"_parseWith\" + this.parserType](html, false, element);\n  }\n\n  _parseWithhtmlparser2(html, fragment, element) {\n    const handler = new this.parser.DefaultHandler();\n    // Check if document is XML\n    const isXML = this.parsingMode === \"xml\";\n    const parserInstance = new this.parser.Parser(handler, {\n      xmlMode: isXML,\n      lowerCaseTags: !isXML,\n      lowerCaseAttributeNames: !isXML,\n      decodeEntities: true\n    });\n\n    parserInstance.includeLocation = false;\n    parserInstance.parseComplete(html);\n\n    const parsed = handler.dom;\n    for (let i = 0; i < parsed.length; i++) {\n      setChild(this.core, element, parsed[i]);\n    }\n\n    return element;\n  }\n\n  _parseWithparse5v1(html, fragment, element) {\n    if (this.parsingMode === \"xml\") {\n      throw new Error(\"Can't parse XML with parse5, please use htmlparser2 instead.\");\n    }\n\n    const htmlparser2Adapter = this.parser.TreeAdapters.htmlparser2;\n    let dom;\n    if (fragment) {\n      const instance = new this.parser.Parser(htmlparser2Adapter);\n      const parentElement = htmlparser2Adapter.createElement(element.tagName.toLowerCase(), element.namespaceURI, []);\n      dom = instance.parseFragment(html, parentElement);\n    } else {\n      const instance = new this.parser.Parser(htmlparser2Adapter, { locationInfo: true });\n      dom = instance.parse(html);\n    }\n\n    const parsed = dom.children;\n    for (let i = 0; i < parsed.length; i++) {\n      setChild(this.core, element, parsed[i]);\n    }\n\n    return element;\n  }\n\n  _parseWithhtml5(html, fragment, element) {\n    if (element.nodeType === 9) {\n      new this.parser.Parser({ document: element }).parse(html);\n    } else {\n      const p = new this.parser.Parser({ document: element.ownerDocument });\n      p.parse_fragment(html, element);\n    }\n  }\n\n  _parseWithsax(html, fragment, element) {\n    const SaxParser = this.parser.parser;\n    const parser = new SaxParser(false, { xmlns: true });\n    parser.looseCase = \"toString\";\n    const openStack = [element];\n    parser.ontext = text => {\n      setChild(this.core, openStack[openStack.length - 1], {\n        type: \"text\",\n        data: text\n      });\n    };\n    parser.onopentag = arg => {\n      const attrValues = {};\n      const attrPrefixes = {};\n      const attrNamespaces = {};\n      Object.keys(arg.attributes).forEach(key => {\n        const localName = arg.attributes[key].local;\n        attrValues[localName] = arg.attributes[key].value;\n        attrPrefixes[localName] = arg.attributes[key].prefix || null;\n        attrNamespaces[localName] = arg.attributes[key].uri || null;\n      });\n\n      if (arg.local === \"script\" && arg.uri === \"http://www.w3.org/1999/xhtml\") {\n        openStack.push({\n          type: \"tag\",\n          name: arg.local,\n          prefix: arg.prefix,\n          namespace: arg.uri,\n          attribs: attrValues,\n          \"x-attribsPrefix\": attrPrefixes,\n          \"x-attribsNamespace\": attrNamespaces\n        });\n      } else {\n        const elem = setChild(this.core, openStack[openStack.length - 1], {\n          type: \"tag\",\n          name: arg.local,\n          prefix: arg.prefix,\n          namespace: arg.uri,\n          attribs: attrValues,\n          \"x-attribsPrefix\": attrPrefixes,\n          \"x-attribsNamespace\": attrNamespaces\n        });\n        openStack.push(elem);\n      }\n    };\n    parser.onclosetag = () => {\n      const elem = openStack.pop();\n      if (elem.constructor.name === \"Object\") { // we have an empty script tag\n        setChild(this.core, openStack[openStack.length - 1], elem);\n      }\n    };\n    parser.onscript = scriptText => {\n      const tag = openStack.pop();\n      tag.children = [{ type: \"text\", data: scriptText }];\n      const elem = setChild(this.core, openStack[openStack.length - 1], tag);\n      openStack.push(elem);\n    };\n    parser.oncomment = comment => {\n      setChild(this.core, openStack[openStack.length - 1], {\n        type: \"comment\",\n        data: comment\n      });\n    };\n    parser.onprocessinginstruction = pi => {\n      setChild(this.core, openStack[openStack.length - 1], {\n        type: \"directive\",\n        name: \"?\" + pi.name,\n        data: \"?\" + pi.name + \" \" + pi.body + \"?\"\n      });\n    };\n    parser.ondoctype = dt => {\n      setChild(this.core, openStack[openStack.length - 1], {\n        type: \"directive\",\n        name: \"!doctype\",\n        data: \"!doctype \" + dt\n      });\n    };\n    parser.write(html).close();\n  }\n}\n\n// utility function for forgiving parser\nfunction setChild(core, parent, node) {\n  const currentDocument = parent._ownerDocument || parent;\n\n  let newNode;\n  let isTemplateContents = false;\n  switch (node.type) {\n    case \"tag\":\n    case \"script\":\n    case \"style\":\n      newNode = currentDocument._createElementWithCorrectElementInterface(node.name, node.namespace);\n      newNode._localName = node.name;\n      newNode._prefix = node.prefix || null;\n      newNode._namespaceURI = node.namespace || null;\n      break;\n\n    case \"root\":\n      // If we are in <template> then add all children to the parent's _templateContents; skip this virtual root node.\n      if (parent.tagName === \"TEMPLATE\" && parent._namespaceURI === \"http://www.w3.org/1999/xhtml\") {\n        newNode = parent._templateContents;\n        isTemplateContents = true;\n      }\n      break;\n\n    case \"text\":\n      // HTML entities should already be decoded by the parser, so no need to decode them\n      newNode = currentDocument.createTextNode(node.data);\n      break;\n\n    case \"comment\":\n      newNode = currentDocument.createComment(node.data);\n      break;\n\n    case \"directive\":\n      if (node.name[0] === \"?\" && node.name.toLowerCase() !== \"?xml\") {\n        const data = node.data.slice(node.name.length + 1, -1);\n        newNode = currentDocument.createProcessingInstruction(node.name.substring(1), data);\n      } else if (node.name.toLowerCase() === \"!doctype\") {\n        if (node[\"x-name\"] !== undefined) { // parse5 supports doctypes directly\n          newNode = createDocumentTypeInternal(core, currentDocument,\n            node[\"x-name\"] || \"\",\n            node[\"x-publicId\"] || \"\",\n            node[\"x-systemId\"] || \"\");\n        } else {\n          newNode = parseDocType(core, currentDocument, \"<\" + node.data + \">\");\n        }\n      }\n      break;\n  }\n\n  if (!newNode) {\n    return null;\n  }\n\n  newNode[locationInfo] = node.__location;\n\n  if (node.attribs) {\n    for (let localName in node.attribs) {\n      const value = node.attribs[localName];\n      let prefix = node[\"x-attribsPrefix\"] && node[\"x-attribsPrefix\"][localName] || null;\n      const namespace = node[\"x-attribsNamespace\"] && node[\"x-attribsNamespace\"][localName] || null;\n      if (prefix === \"xmlns\" && localName === \"\") {\n         // intended weirdness in node-sax, see https://github.com/isaacs/sax-js/issues/165\n        localName = prefix;\n        prefix = null;\n      }\n      attributes.setAttributeValue(newNode, localName, value, prefix, namespace);\n    }\n  }\n\n  if (node.children) {\n    for (let c = 0; c < node.children.length; c++) {\n      setChild(core, newNode, node.children[c]);\n    }\n  }\n\n  if (!isTemplateContents) {\n    if (parent._templateContents) {\n      // Setting innerHTML on a <template>\n      parent._templateContents.appendChild(newNode);\n    } else {\n      parent.appendChild(newNode);\n    }\n  }\n\n  return newNode;\n}\n\nconst HTML5_DOCTYPE = /<!doctype html>/i;\nconst PUBLIC_DOCTYPE = /<!doctype\\s+([^\\s]+)\\s+public\\s+\"([^\"]+)\"\\s+\"([^\"]+)\"/i;\nconst SYSTEM_DOCTYPE = /<!doctype\\s+([^\\s]+)\\s+system\\s+\"([^\"]+)\"/i;\n\nfunction parseDocType(core, doc, html) {\n  if (HTML5_DOCTYPE.test(html)) {\n    return createDocumentTypeInternal(core, doc, \"html\", \"\", \"\");\n  }\n\n  const publicPieces = PUBLIC_DOCTYPE.exec(html);\n  if (publicPieces) {\n    return createDocumentTypeInternal(core, doc, publicPieces[1], publicPieces[2], publicPieces[3]);\n  }\n\n  const systemPieces = SYSTEM_DOCTYPE.exec(html);\n  if (systemPieces) {\n    return createDocumentTypeInternal(core, doc, systemPieces[1], \"\", systemPieces[2]);\n  }\n\n  // Shouldn't get here (the parser shouldn't let us know about invalid doctypes), but our logic likely isn't\n  // real-world perfect, so let's fallback.\n  return createDocumentTypeInternal(core, doc, \"html\", \"\", \"\");\n}\n\n\nexports.HtmlToDom = HtmlToDom;\n"]}