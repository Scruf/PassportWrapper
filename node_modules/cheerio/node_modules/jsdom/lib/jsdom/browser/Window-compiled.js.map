{"version":3,"sources":["Window.js"],"names":[],"mappings":"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","file":"Window-compiled.js","sourcesContent":["\"use strict\";\n\nconst CSSStyleDeclaration = require(\"cssstyle\").CSSStyleDeclaration;\nconst notImplemented = require(\"./not-implemented\");\nconst History = require(\"./history\");\nconst VirtualConsole = require(\"../virtual-console\");\nconst define = require(\"../utils\").define;\nconst inherits = require(\"../utils\").inheritFrom;\nconst EventTarget = require(\"../living/generated/EventTarget\");\nconst namedPropertiesWindow = require(\"../living/named-properties-window\");\nconst cssom = require(\"cssom\");\nconst postMessage = require(\"../living/post-message\");\nconst DOMException = require(\"../web-idl/DOMException\");\nconst btoa = require(\"abab\").btoa;\nconst atob = require(\"abab\").atob;\nconst idlUtils = require(\"../living/generated/utils\");\nconst internalConstants = require(\"../living/helpers/internal-constants\");\nconst createFileReader = require(\"../living/file-reader\");\nconst createXMLHttpRequest = require(\"../living/xmlhttprequest\");\n\n// NB: the require() must be after assigning `module.export` because this require() is circular\nmodule.exports = Window;\nconst dom = require(\"../living\");\n\nconst cssSelectorSplitRE = /((?:[^,\"']|\"[^\"]*\"|'[^']*')+)/;\n\nconst defaultStyleSheet = cssom.parse(require(\"./default-stylesheet\"));\n\ndom.Window = Window;\n\n// NOTE: per https://heycam.github.io/webidl/#Global, all properties on the Window object must be own-properties.\n// That is why we assign everything inside of the constructor, instead of using a shared prototype.\n// You can verify this in e.g. Firefox or Internet Explorer, which do a good job with Web IDL compliance.\n\nfunction Window(options) {\n  EventTarget.setup(this);\n\n  const window = this;\n\n  ///// INTERFACES FROM THE DOM\n  // TODO: consider a mode of some sort where these are not shared between all DOM instances\n  // It'd be very memory-expensive in most cases, though.\n  define(window, dom);\n\n  ///// PRIVATE DATA PROPERTIES\n\n  // vm initialization is defered until script processing is activated (in level1/core)\n  this._globalProxy = this;\n\n  this.__timers = [];\n\n  // List options explicitly to be clear which are passed through\n  this._document = new dom.HTMLDocument({\n    parsingMode: options.parsingMode,\n    contentType: options.contentType,\n    cookieJar: options.cookieJar,\n    parser: options.parser,\n    url: options.url,\n    referrer: options.referrer,\n    cookie: options.cookie,\n    deferClose: options.deferClose,\n    resourceLoader: options.resourceLoader,\n    concurrentNodeIterators: options.concurrentNodeIterators,\n    pool: options.pool,\n    agentOptions: options.agentOptions,\n    userAgent: options.userAgent,\n    defaultView: this._globalProxy,\n    global: this\n  });\n\n\n  // Set up the window as if it's a top level window.\n  // If it's not, then references will be corrected by frame/iframe code.\n  this._parent = this._top = this._globalProxy;\n\n  // This implements window.frames.length, since window.frames returns a\n  // self reference to the window object.  This value is incremented in the\n  // HTMLFrameElement init function (see: level2/html.js).\n  this._length = 0;\n\n  if (options.virtualConsole) {\n    if (options.virtualConsole instanceof VirtualConsole) {\n      this._virtualConsole = options.virtualConsole;\n    } else {\n      throw new TypeError(\n        \"options.virtualConsole must be a VirtualConsole (from createVirtualConsole)\");\n    }\n  } else {\n    this._virtualConsole = new VirtualConsole();\n  }\n\n  ///// GETTERS\n\n  define(this, {\n    get length() {\n      return window._length;\n    },\n    get window() {\n      return window._globalProxy;\n    },\n    get frames() {\n      return window._globalProxy;\n    },\n    get self() {\n      return window._globalProxy;\n    },\n    get parent() {\n      return window._parent;\n    },\n    get top() {\n      return window._top;\n    },\n    get document() {\n      return window._document;\n    },\n    get location() {\n      return window._document._location;\n    }\n  });\n\n  namedPropertiesWindow.initializeWindow(this, dom.HTMLCollection);\n\n  ///// METHODS for [ImplicitThis] hack\n  // See https://lists.w3.org/Archives/Public/public-script-coord/2015JanMar/0109.html\n  this.addEventListener = this.addEventListener.bind(this);\n  this.removeEventListener = this.removeEventListener.bind(this);\n  this.dispatchEvent = this.dispatchEvent.bind(this);\n\n  ///// METHODS\n\n  this.setTimeout = function (fn, ms) {\n    return startTimer(window, setTimeout, clearTimeout, fn, ms);\n  };\n  this.setInterval = function (fn, ms) {\n    return startTimer(window, setInterval, clearInterval, fn, ms);\n  };\n  this.clearInterval = stopTimer.bind(this, window);\n  this.clearTimeout = stopTimer.bind(this, window);\n  this.__stopAllTimers = stopAllTimers.bind(this, window);\n\n  this.Image = function (width, height) {\n    const element = window._document.createElement(\"img\");\n    element.width = width;\n    element.height = height;\n    return element;\n  };\n\n  function wrapConsoleMethod(method) {\n    return function () {\n      const args = Array.prototype.slice.call(arguments);\n      window._virtualConsole.emit.apply(window._virtualConsole, [method].concat(args));\n    };\n  }\n\n  this.postMessage = postMessage;\n\n  this.atob = function (str) {\n    const result = atob(str);\n    if (result === null) {\n      throw new DOMException(DOMException.INVALID_CHARACTER_ERR,\n        \"The string to be decoded contains invalid characters.\");\n    }\n    return result;\n  };\n\n  this.btoa = function (str) {\n    const result = btoa(str);\n    if (result === null) {\n      throw new DOMException(DOMException.INVALID_CHARACTER_ERR,\n        \"The string to be encoded contains invalid characters.\");\n    }\n    return result;\n  };\n\n  this.FileReader = createFileReader(this);\n  this.XMLHttpRequest = createXMLHttpRequest(this);\n\n  // TODO: necessary for Blob and FileReader due to different-globals weirdness; investigate how to avoid this.\n  this.ArrayBuffer = ArrayBuffer;\n  this.Int8Array = Int8Array;\n  this.Uint8Array = Uint8Array;\n  this.Uint8ClampedArray = Uint8ClampedArray;\n  this.Int16Array = Int16Array;\n  this.Uint16Array = Uint16Array;\n  this.Int32Array = Int32Array;\n  this.Uint32Array = Uint32Array;\n  this.Float32Array = Float32Array;\n  this.Float64Array = Float64Array;\n\n  this.stop = function () {\n    if (this._document[internalConstants.requestManager]) {\n      this._document[internalConstants.requestManager].close();\n    }\n  };\n\n  this.close = function () {\n    // Recursively close child frame windows, then ourselves.\n    const currentWindow = this;\n    (function windowCleaner(windowToClean) {\n      for (let i = 0; i < windowToClean.length; i++) {\n        windowCleaner(windowToClean[i]);\n      }\n\n      // We\"re already in our own window.close().\n      if (windowToClean !== currentWindow) {\n        windowToClean.close();\n      }\n    }(this));\n\n    // Clear out all listeners. Any in-flight or upcoming events should not get delivered.\n    idlUtils.implForWrapper(this)._eventListeners = Object.create(null);\n\n    if (this._document) {\n      if (this._document.body) {\n        this._document.body.innerHTML = \"\";\n      }\n\n      if (this._document.close) {\n        // It's especially important to clear out the listeners here because document.close() causes a \"load\" event to\n        // fire.\n        this._document._listeners = Object.create(null);\n        this._document.close();\n      }\n      const doc = this._document;\n      delete this._document;\n      // Stops the connections after document deletion because the listeners will not be triggered once document deleted\n      if (doc[internalConstants.requestManager]) {\n        doc[internalConstants.requestManager].close();\n      }\n    }\n\n    stopAllTimers(currentWindow);\n  };\n\n  this.getComputedStyle = function (node) {\n    const s = node.style;\n    const cs = new CSSStyleDeclaration();\n    const forEach = Array.prototype.forEach;\n\n    function setPropertiesFromRule(rule) {\n      if (!rule.selectorText) {\n        return;\n      }\n\n      const selectors = rule.selectorText.split(cssSelectorSplitRE);\n      let matched = false;\n      for (const selectorText of selectors) {\n        if (selectorText !== \"\" && selectorText !== \",\" && !matched && matchesDontThrow(node, selectorText)) {\n          matched = true;\n          forEach.call(rule.style, property => {\n            cs.setProperty(property, rule.style.getPropertyValue(property), rule.style.getPropertyPriority(property));\n          });\n        }\n      }\n    }\n\n    function readStylesFromStyleSheet(sheet) {\n      forEach.call(sheet.cssRules, rule => {\n        if (rule.media) {\n          if (Array.prototype.indexOf.call(rule.media, \"screen\") !== -1) {\n            forEach.call(rule.cssRules, setPropertiesFromRule);\n          }\n        } else {\n          setPropertiesFromRule(rule);\n        }\n      });\n    }\n\n    readStylesFromStyleSheet(defaultStyleSheet);\n    forEach.call(node.ownerDocument.styleSheets, readStylesFromStyleSheet);\n\n    forEach.call(s, property => {\n      cs.setProperty(property, s.getPropertyValue(property), s.getPropertyPriority(property));\n    });\n\n    return cs;\n  };\n\n  ///// PUBLIC DATA PROPERTIES (TODO: should be getters)\n\n  this.history = new History(this);\n\n  this.console = {\n    assert: wrapConsoleMethod(\"assert\"),\n    clear: wrapConsoleMethod(\"clear\"),\n    count: wrapConsoleMethod(\"count\"),\n    debug: wrapConsoleMethod(\"debug\"),\n    error: wrapConsoleMethod(\"error\"),\n    group: wrapConsoleMethod(\"group\"),\n    groupCollapse: wrapConsoleMethod(\"groupCollapse\"),\n    groupEnd: wrapConsoleMethod(\"groupEnd\"),\n    info: wrapConsoleMethod(\"info\"),\n    log: wrapConsoleMethod(\"log\"),\n    table: wrapConsoleMethod(\"table\"),\n    time: wrapConsoleMethod(\"time\"),\n    timeEnd: wrapConsoleMethod(\"timeEnd\"),\n    trace: wrapConsoleMethod(\"trace\"),\n    warn: wrapConsoleMethod(\"warn\")\n  };\n\n  function notImplementedMethod(name) {\n    return function () {\n      notImplemented(name, window);\n    };\n  }\n\n  define(this, {\n    navigator: {\n      get userAgent() {\n        return options.userAgent;\n      },\n      get appName() {\n        return \"Node.js jsDom\";\n      },\n      get platform() {\n        return process.platform;\n      },\n      get appVersion() {\n        return process.version;\n      },\n      noUI: true,\n      get cookieEnabled() {\n        return true;\n      }\n    },\n\n    name: \"nodejs\",\n    innerWidth: 1024,\n    innerHeight: 768,\n    outerWidth: 1024,\n    outerHeight: 768,\n    pageXOffset: 0,\n    pageYOffset: 0,\n    screenX: 0,\n    screenY: 0,\n    screenLeft: 0,\n    screenTop: 0,\n    scrollX: 0,\n    scrollY: 0,\n    scrollTop: 0,\n    scrollLeft: 0,\n    screen: {\n      width: 0,\n      height: 0\n    },\n\n    alert: notImplementedMethod(\"window.alert\"),\n    blur: notImplementedMethod(\"window.blur\"),\n    confirm: notImplementedMethod(\"window.confirm\"),\n    createPopup: notImplementedMethod(\"window.createPopup\"),\n    focus: notImplementedMethod(\"window.focus\"),\n    moveBy: notImplementedMethod(\"window.moveBy\"),\n    moveTo: notImplementedMethod(\"window.moveTo\"),\n    open: notImplementedMethod(\"window.open\"),\n    print: notImplementedMethod(\"window.print\"),\n    prompt: notImplementedMethod(\"window.prompt\"),\n    resizeBy: notImplementedMethod(\"window.resizeBy\"),\n    resizeTo: notImplementedMethod(\"window.resizeTo\"),\n    scroll: notImplementedMethod(\"window.scroll\"),\n    scrollBy: notImplementedMethod(\"window.scrollBy\"),\n    scrollTo: notImplementedMethod(\"window.scrollTo\"),\n\n    toString: () => {\n      return \"[object Window]\";\n    }\n  });\n\n  ///// INITIALIZATION\n\n  process.nextTick(() => {\n    if (!window.document) {\n      return; // window might've been closed already\n    }\n\n    if (window.document.readyState === \"complete\") {\n      const ev = window.document.createEvent(\"HTMLEvents\");\n      ev.initEvent(\"load\", false, false);\n      window.dispatchEvent(ev);\n    } else {\n      window.document.addEventListener(\"load\", () => {\n        const ev = window.document.createEvent(\"HTMLEvents\");\n        ev.initEvent(\"load\", false, false);\n        window.dispatchEvent(ev);\n      });\n    }\n  });\n}\n\ninherits(EventTarget.interface, Window, EventTarget.interface.prototype);\n\nfunction matchesDontThrow(el, selector) {\n  try {\n    return el.matches(selector);\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction startTimer(window, startFn, stopFn, callback, ms) {\n  const res = startFn(callback, ms);\n  window.__timers.push([res, stopFn]);\n  return res;\n}\n\nfunction stopTimer(window, id) {\n  if (typeof id === \"undefined\") {\n    return;\n  }\n  for (const i in window.__timers) {\n    if (window.__timers[i][0] === id) {\n      window.__timers[i][1].call(window, id);\n      window.__timers.splice(i, 1);\n      break;\n    }\n  }\n}\n\nfunction stopAllTimers(window) {\n  for (const t of window.__timers) {\n    t[1].call(window, t[0]);\n  }\n  window.__timers = [];\n}\n\n"]}