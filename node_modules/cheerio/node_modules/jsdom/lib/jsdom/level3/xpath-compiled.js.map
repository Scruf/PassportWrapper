{"version":3,"sources":["xpath.js"],"names":[],"mappings":"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","file":"xpath-compiled.js","sourcesContent":["/** Here is yet another implementation of XPath 1.0 in Javascript.\n *\n * My goal was to make it relatively compact, but as I fixed all the axis bugs\n * the axes became more and more complicated. :-(.\n *\n * I have not implemented namespaces or case-sensitive axes for XML yet.\n *\n * How to test it in Chrome: You can make a Chrome extension that replaces\n * the WebKit XPath parser with this one. But it takes a bit of effort to\n * get around isolated world and same-origin restrictions:\n * manifest.json:\n    {\n      \"name\": \"XPathTest\",\n      \"version\": \"0.1\",\n      \"content_scripts\": [{\n        \"matches\": [\"http://localhost/*\"],  // or wildcard host\n        \"js\": [\"xpath.js\", \"injection.js\"],\n        \"all_frames\": true, \"run_at\": \"document_start\"\n      }]\n    }\n * injection.js:\n    // goal: give my xpath object to the website's JS context.\n    var script = document.createElement('script');\n    script.textContent =\n        \"document.addEventListener('xpathextend', function(e) {\\n\" +\n        \"  console.log('extending document with xpath...');\\n\" +\n        \"  e.detail(window);\" +\n        \"});\";\n    document.documentElement.appendChild(script);\n    document.documentElement.removeChild(script);\n    var evt = document.createEvent('CustomEvent');\n    evt.initCustomEvent('xpathextend', true, true, this.xpath.extend);\n    document.dispatchEvent(evt);\n */\n(function() {\n  var xpath;\n  var core;\n  if ('function' === typeof require) {\n    xpath = exports; // the tests go through this\n    core = require(\"../living\");\n  } else {\n    xpath = {};\n    core = this;\n  }\n\n  // Helper function to deal with the migration of Attr to no longer have a nodeName property despite this codebase\n  // assuming it does.\n  function getNodeName(nodeOrAttr) {\n    return nodeOrAttr.constructor.name === 'Attr' ? nodeOrAttr.name : nodeOrAttr.nodeName;\n  }\n\n  /***************************************************************************\n   *                            Tokenization                                 *\n   ***************************************************************************/\n  /**\n   * The XPath lexer is basically a single regular expression, along with\n   * some helper functions to pop different types.\n   */\n  var Stream = xpath.Stream = function Stream(str) {\n    this.original = this.str = str;\n    this.peeked = null;\n    // TODO: not really needed, but supposedly tokenizer also disambiguates\n    // a * b vs. node test *\n    this.prev = null;  // for debugging\n    this.prevprev = null;\n  }\n  Stream.prototype = {\n    peek: function() {\n      if (this.peeked) return this.peeked;\n      var m = this.re.exec(this.str);\n      if (!m) return null;\n      this.str = this.str.substr(m[0].length);\n      return this.peeked = m[1];\n    },\n    /** Peek 2 tokens ahead. */\n    peek2: function() {\n      this.peek();  // make sure this.peeked is set\n      var m = this.re.exec(this.str);\n      if (!m) return null;\n      return m[1];\n    },\n    pop: function() {\n      var r = this.peek();\n      this.peeked = null;\n      this.prevprev = this.prev;\n      this.prev = r;\n      return r;\n    },\n    trypop: function(tokens) {\n      var tok = this.peek();\n      if (tok === tokens) return this.pop();\n      if (Array.isArray(tokens)) {\n        for (var i = 0; i < tokens.length; ++i) {\n          var t = tokens[i];\n          if (t == tok) return this.pop();;\n        }\n      }\n    },\n    trypopfuncname: function() {\n      var tok = this.peek();\n      if (!this.isQnameRe.test(tok))\n        return null;\n      switch (tok) {\n        case 'comment': case 'text': case 'processing-instruction': case 'node':\n          return null;\n      }\n      if ('(' != this.peek2()) return null;\n      return this.pop();\n    },\n    trypopaxisname: function() {\n      var tok = this.peek();\n      switch (tok) {\n        case 'ancestor': case 'ancestor-or-self': case 'attribute':\n        case 'child': case 'descendant': case 'descendant-or-self':\n        case 'following': case 'following-sibling': case 'namespace':\n        case 'parent': case 'preceding': case 'preceding-sibling': case 'self':\n          if ('::' == this.peek2()) return this.pop();\n      }\n      return null;\n    },\n    trypopnametest: function() {\n      var tok = this.peek();\n      if ('*' === tok || this.startsWithNcNameRe.test(tok)) return this.pop();\n      return null;\n    },\n    trypopliteral: function() {\n      var tok = this.peek();\n      if (null == tok) return null;\n      var first = tok.charAt(0);\n      var last = tok.charAt(tok.length - 1);\n      if ('\"' === first && '\"' === last ||\n          \"'\" === first && \"'\" === last) {\n        this.pop();\n        return tok.substr(1, tok.length - 2);\n      }\n    },\n    trypopnumber: function() {\n      var tok = this.peek();\n      if (this.isNumberRe.test(tok)) return parseFloat(this.pop());\n      else return null;\n    },\n    trypopvarref: function() {\n      var tok = this.peek();\n      if (null == tok) return null;\n      if ('$' === tok.charAt(0)) return this.pop().substr(1);\n      else return null;\n    },\n    position: function() {\n      return this.original.length - this.str.length;\n    }\n  };\n  (function() {\n    // http://www.w3.org/TR/REC-xml-names/#NT-NCName\n    var nameStartCharsExceptColon =\n        'A-Z_a-z\\xc0-\\xd6\\xd8-\\xf6\\xF8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF' +\n        '\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF' +\n        '\\uFDF0-\\uFFFD';  // JS doesn't support [#x10000-#xEFFFF]\n    var nameCharExceptColon = nameStartCharsExceptColon +\n        '\\\\-\\\\.0-9\\xb7\\u0300-\\u036F\\u203F-\\u2040';\n    var ncNameChars = '[' + nameStartCharsExceptColon +\n        '][' + nameCharExceptColon + ']*'\n    // http://www.w3.org/TR/REC-xml-names/#NT-QName\n    var qNameChars = ncNameChars + '(?::' + ncNameChars + ')?';\n    var otherChars = '\\\\.\\\\.|[\\\\(\\\\)\\\\[\\\\].@,]|::';  // .. must come before [.]\n    var operatorChars =\n        'and|or|mod|div|' +\n        '//|!=|<=|>=|[*/|+\\\\-=<>]';  // //, !=, <=, >= before individual ones.\n    var literal = '\"[^\"]*\"|' + \"'[^']*'\";\n    var numberChars = '[0-9]+(?:\\\\.[0-9]*)?|\\\\.[0-9]+';\n    var variableReference = '\\\\$' + qNameChars;\n    var nameTestChars = '\\\\*|' + ncNameChars + ':\\\\*|' + qNameChars;\n    var optionalSpace = '[ \\t\\r\\n]*';  // stricter than regexp \\s.\n    var nodeType = 'comment|text|processing-instruction|node';\n    var re = new RegExp(\n        // numberChars before otherChars so that leading-decimal doesn't become .\n        '^' + optionalSpace + '(' + numberChars + '|' + otherChars + '|' +\n        nameTestChars + '|' + operatorChars + '|' + literal + '|' +\n        variableReference + ')'\n        // operatorName | nodeType | functionName | axisName are lumped into\n        // qName for now; we'll check them on pop.\n    );\n    Stream.prototype.re = re;\n    Stream.prototype.startsWithNcNameRe = new RegExp('^' + ncNameChars);\n    Stream.prototype.isQnameRe = new RegExp('^' + qNameChars + '$');\n    Stream.prototype.isNumberRe = new RegExp('^' + numberChars + '$');\n  })();\n\n  /***************************************************************************\n   *                               Parsing                                   *\n   ***************************************************************************/\n  var parse = xpath.parse = function parse(stream, a) {\n    var r = orExpr(stream,a);\n    var x, unparsed = [];\n    while (x = stream.pop()) {\n      unparsed.push(x);\n    }\n    if (unparsed.length)\n      throw new XPathException(XPathException.INVALID_EXPRESSION_ERR,\n                               'Position ' + stream.position() +\n                               ': Unparsed tokens: ' + unparsed.join(' '));\n    return r;\n  }\n\n  /**\n   * binaryL  ::= subExpr\n   *            | binaryL op subExpr\n   * so a op b op c becomes ((a op b) op c)\n   */\n  function binaryL(subExpr, stream, a, ops) {\n    var lhs = subExpr(stream, a);\n    if (lhs == null) return null;\n    var op;\n    while (op = stream.trypop(ops)) {\n      var rhs = subExpr(stream, a);\n      if (rhs == null)\n        throw new XPathException(XPathException.INVALID_EXPRESSION_ERR,\n                                 'Position ' + stream.position() +\n                                 ': Expected something after ' + op);\n      lhs = a.node(op, lhs, rhs);\n    }\n    return lhs;\n  }\n  /**\n   * Too bad this is never used. If they made a ** operator (raise to power),\n   ( we would use it.\n   * binaryR  ::= subExpr\n   *            | subExpr op binaryR\n   * so a op b op c becomes (a op (b op c))\n   */\n  function binaryR(subExpr, stream, a, ops) {\n    var lhs = subExpr(stream, a);\n    if (lhs == null) return null;\n    var op = stream.trypop(ops);\n    if (op) {\n      var rhs = binaryR(stream, a);\n      if (rhs == null)\n        throw new XPathException(XPathException.INVALID_EXPRESSION_ERR,\n                                 'Position ' + stream.position() +\n                                 ': Expected something after ' + op);\n      return a.node(op, lhs, rhs);\n    } else {\n      return lhs;// TODO\n    }\n  }\n  /** [1] LocationPath::= RelativeLocationPath | AbsoluteLocationPath\n   * e.g. a, a/b, //a/b\n   */\n  function locationPath(stream, a) {\n    return absoluteLocationPath(stream, a) ||\n           relativeLocationPath(null, stream, a);\n  }\n  /** [2] AbsoluteLocationPath::= '/' RelativeLocationPath? | AbbreviatedAbsoluteLocationPath\n   *  [10] AbbreviatedAbsoluteLocationPath::= '//' RelativeLocationPath\n   */\n  function absoluteLocationPath(stream, a) {\n    var op = stream.peek();\n    if ('/' === op || '//' === op) {\n      var lhs = a.node('Root');\n      return relativeLocationPath(lhs, stream, a, true);\n    } else {\n      return null;\n    }\n  }\n  /** [3] RelativeLocationPath::= Step | RelativeLocationPath '/' Step |\n   *                            | AbbreviatedRelativeLocationPath\n   *  [11] AbbreviatedRelativeLocationPath::= RelativeLocationPath '//' Step\n   * e.g. p/a, etc.\n   */\n  function relativeLocationPath(lhs, stream, a, isOnlyRootOk) {\n    if (null == lhs) {\n      lhs = step(stream, a);\n      if (null == lhs) return lhs;\n    }\n    var op;\n    while (op = stream.trypop(['/', '//'])) {\n      if ('//' === op) {\n        lhs = a.node('/', lhs,\n                     a.node('Axis', 'descendant-or-self', 'node', undefined));\n      }\n      var rhs = step(stream, a);\n      if (null == rhs && '/' === op && isOnlyRootOk) return lhs;\n      else isOnlyRootOk = false;\n      if (null == rhs)\n        throw new XPathException(XPathException.INVALID_EXPRESSION_ERR,\n                                 'Position ' + stream.position() +\n                                 ': Expected step after ' + op);\n      lhs = a.node('/', lhs, rhs);\n    }\n    return lhs;\n  }\n  /** [4] Step::= AxisSpecifier NodeTest Predicate* | AbbreviatedStep\n   *  [12] AbbreviatedStep::= '.' | '..'\n   * e.g. @href, self::p, p, a[@href], ., ..\n   */\n  function step(stream, a) {\n    var abbrStep = stream.trypop(['.', '..']);\n    if ('.' === abbrStep)  // A location step of . is short for self::node().\n      return a.node('Axis', 'self', 'node');\n    if ('..' === abbrStep)  // A location step of .. is short for parent::node()\n      return a.node('Axis', 'parent', 'node');\n\n    var axis = axisSpecifier(stream, a);\n    var nodeType = nodeTypeTest(stream, a);\n    var nodeName;\n    if (null == nodeType) nodeName = nodeNameTest(stream, a);\n    if (null == axis && null == nodeType && null == nodeName) return null;\n    if (null == nodeType && null == nodeName)\n        throw new XPathException(\n            XPathException.INVALID_EXPRESSION_ERR,\n            'Position ' + stream.position() +\n            ': Expected nodeTest after axisSpecifier ' + axis);\n    if (null == axis) axis = 'child';\n    if (null == nodeType) {\n      // When there's only a node name, then the node type is forced to be the\n      // principal node type of the axis.\n      // see http://www.w3.org/TR/xpath/#dt-principal-node-type\n      if ('attribute' === axis) nodeType = 'attribute';\n      else if ('namespace' === axis) nodeType = 'namespace';\n      else nodeType = 'element';\n    }\n    var lhs = a.node('Axis', axis, nodeType, nodeName);\n    var pred;\n    while (null != (pred = predicate(lhs, stream, a))) {\n      lhs = pred;\n    }\n    return lhs;\n  }\n  /** [5] AxisSpecifier::= AxisName '::' | AbbreviatedAxisSpecifier\n   *  [6] AxisName::= 'ancestor' | 'ancestor-or-self' | 'attribute' | 'child'\n   *                | 'descendant' | 'descendant-or-self' | 'following'\n   *                | 'following-sibling' | 'namespace' | 'parent' |\n   *                | 'preceding' | 'preceding-sibling' | 'self'\n   *  [13] AbbreviatedAxisSpecifier::= '@'?\n   */\n  function axisSpecifier(stream, a) {\n    var attr = stream.trypop('@');\n    if (null != attr) return 'attribute';\n    var axisName = stream.trypopaxisname();\n    if (null != axisName) {\n      var coloncolon = stream.trypop('::');\n      if (null == coloncolon)\n        throw new XPathException(XPathException.INVALID_EXPRESSION_ERR,\n                                 'Position ' + stream.position() +\n                                 ': Should not happen. Should be ::.');\n      return axisName;\n    }\n  }\n  /** [7] NodeTest::= NameTest | NodeType '(' ')' | 'processing-instruction' '(' Literal ')'\n   *  [38] NodeType::= 'comment' | 'text' | 'processing-instruction' | 'node'\n   * I've split nodeTypeTest from nodeNameTest for convenience.\n   */\n  function nodeTypeTest(stream, a) {\n    if ('(' !== stream.peek2()) {\n      return null;\n    }\n    var type = stream.trypop(['comment', 'text', 'processing-instruction', 'node']);\n    if (null != type) {\n      if (null == stream.trypop('('))\n        throw new XPathException(XPathException.INVALID_EXPRESSION_ERR,\n                                 'Position ' + stream.position() +\n                                 ': Should not happen.');\n      var param = undefined;\n      if (type == 'processing-instruction') {\n        param = stream.trypopliteral();\n      }\n      if (null == stream.trypop(')'))\n        throw new XPathException(XPathException.INVALID_EXPRESSION_ERR,\n                                 'Position ' + stream.position() +\n                                 ': Expected close parens.');\n      return type\n    }\n  }\n  function nodeNameTest(stream, a) {\n    var name = stream.trypopnametest();\n    if (name != null) return name;\n    else return null;\n  }\n  /** [8] Predicate::= '[' PredicateExpr ']'\n   *  [9] PredicateExpr::= Expr\n   */\n  function predicate(lhs, stream, a) {\n    if (null == stream.trypop('[')) return null;\n    var expr = orExpr(stream, a);\n    if (null == expr)\n      throw new XPathException(XPathException.INVALID_EXPRESSION_ERR,\n                               'Position ' + stream.position() +\n                               ': Expected expression after [');\n    if (null == stream.trypop(']'))\n      throw new XPathException(XPathException.INVALID_EXPRESSION_ERR,\n                               'Position ' + stream.position() +\n                               ': Expected ] after expression.');\n    return a.node('Predicate', lhs, expr);\n  }\n  /** [14] Expr::= OrExpr\n   */\n  /** [15] PrimaryExpr::= VariableReference | '(' Expr ')' | Literal | Number | FunctionCall\n   * e.g. $x,  (3+4),  \"hi\",  32,  f(x)\n   */\n  function primaryExpr(stream, a) {\n    var x = stream.trypopliteral();\n    if (null == x)\n      x = stream.trypopnumber();\n    if (null != x) {\n      return x;\n    }\n    var varRef = stream.trypopvarref();\n    if (null != varRef) return a.node('VariableReference', varRef);\n    var funCall = functionCall(stream, a);\n    if (null != funCall) {\n      return funCall;\n    }\n    if (stream.trypop('(')) {\n      var e = orExpr(stream, a);\n      if (null == e)\n        throw new XPathException(XPathException.INVALID_EXPRESSION_ERR,\n                                 'Position ' + stream.position() +\n                                 ': Expected expression after (.');\n      if (null == stream.trypop(')'))\n        throw new XPathException(XPathException.INVALID_EXPRESSION_ERR,\n                                 'Position ' + stream.position() +\n                                 ': Expected ) after expression.');\n      return e;\n    }\n    return null;\n  }\n  /** [16] FunctionCall::= FunctionName '(' ( Argument ( ',' Argument )* )? ')'\n   *  [17] Argument::= Expr\n   */\n  function functionCall(stream, a) {\n    var name = stream.trypopfuncname(stream, a);\n    if (null == name) return null;\n    if (null == stream.trypop('('))\n      throw new XPathException(XPathException.INVALID_EXPRESSION_ERR,\n                               'Position ' + stream.position() +\n                               ': Expected ( ) after function name.');\n    var params = [];\n    var first = true;\n    while (null == stream.trypop(')')) {\n      if (!first && null == stream.trypop(','))\n        throw new XPathException(XPathException.INVALID_EXPRESSION_ERR,\n                                 'Position ' + stream.position() +\n                                 ': Expected , between arguments of the function.');\n      first = false;\n      var param = orExpr(stream, a);\n      if (param == null)\n        throw new XPathException(XPathException.INVALID_EXPRESSION_ERR,\n                                 'Position ' + stream.position() +\n                                 ': Expected expression as argument of function.');\n      params.push(param);\n    }\n    return a.node('FunctionCall', name, params);\n  }\n\n  /** [18] UnionExpr::= PathExpr | UnionExpr '|' PathExpr\n   */\n  function unionExpr(stream, a) { return binaryL(pathExpr, stream, a, '|'); }\n  /** [19] PathExpr ::= LocationPath\n   *                  | FilterExpr\n   *                  | FilterExpr '/' RelativeLocationPath\n   *                  | FilterExpr '//' RelativeLocationPath\n   * Unlike most other nodes, this one always generates a node because\n   * at this point all reverse nodesets must turn into a forward nodeset\n   */\n  function pathExpr(stream, a) {\n    // We have to do FilterExpr before LocationPath because otherwise\n    // LocationPath will eat up the name from a function call.\n    var filter = filterExpr(stream, a);\n    if (null == filter) {\n      var loc = locationPath(stream, a);\n      if (null == loc) {\n        throw new Error\n        throw new XPathException(XPathException.INVALID_EXPRESSION_ERR,\n                                 'Position ' + stream.position() +\n                                 ': The expression shouldn\\'t be empty...');\n      }\n      return a.node('PathExpr', loc);\n    }\n    var rel = relativeLocationPath(filter, stream, a, false);\n    if (filter === rel) return rel;\n    else return a.node('PathExpr', rel);\n  }\n  /** [20] FilterExpr::= PrimaryExpr | FilterExpr Predicate\n   * aka. FilterExpr ::= PrimaryExpr Predicate*\n   */\n  function filterExpr(stream, a) {\n    var primary = primaryExpr(stream, a);\n    if (primary == null) return null;\n    var pred, lhs = primary;\n    while (null != (pred = predicate(lhs, stream, a))) {\n      lhs = pred;\n    }\n    return lhs;\n  }\n\n  /** [21] OrExpr::= AndExpr | OrExpr 'or' AndExpr\n   */\n  function orExpr(stream, a) {\n    var orig = (stream.peeked || '') + stream.str\n    var r = binaryL(andExpr, stream, a, 'or');\n    var now = (stream.peeked || '') + stream.str;\n    return r;\n  }\n  /** [22] AndExpr::= EqualityExpr | AndExpr 'and' EqualityExpr\n   */\n  function andExpr(stream, a) { return binaryL(equalityExpr, stream, a, 'and'); }\n  /** [23] EqualityExpr::= RelationalExpr | EqualityExpr '=' RelationalExpr\n   *                     | EqualityExpr '!=' RelationalExpr\n   */\n  function equalityExpr(stream, a) { return binaryL(relationalExpr, stream, a, ['=','!=']); }\n  /** [24] RelationalExpr::= AdditiveExpr | RelationalExpr '<' AdditiveExpr\n   *                       | RelationalExpr '>' AdditiveExpr\n   *                       | RelationalExpr '<=' AdditiveExpr\n   *                       | RelationalExpr '>=' AdditiveExpr\n   */\n  function relationalExpr(stream, a) { return binaryL(additiveExpr, stream, a, ['<','>','<=','>=']); }\n  /** [25] AdditiveExpr::= MultiplicativeExpr\n   *                     | AdditiveExpr '+' MultiplicativeExpr\n   *                     | AdditiveExpr '-' MultiplicativeExpr\n   */\n  function additiveExpr(stream, a) { return binaryL(multiplicativeExpr, stream, a, ['+','-']); }\n  /** [26] MultiplicativeExpr::= UnaryExpr\n   *                           | MultiplicativeExpr MultiplyOperator UnaryExpr\n   *                           | MultiplicativeExpr 'div' UnaryExpr\n   *                           | MultiplicativeExpr 'mod' UnaryExpr\n   */\n  function multiplicativeExpr(stream, a) { return binaryL(unaryExpr, stream, a, ['*','div','mod']); }\n  /** [27] UnaryExpr::= UnionExpr | '-' UnaryExpr\n   */\n  function unaryExpr(stream, a) {\n    if (stream.trypop('-')) {\n      var e = unaryExpr(stream, a);\n      if (null == e)\n        throw new XPathException(XPathException.INVALID_EXPRESSION_ERR,\n                                 'Position ' + stream.position() +\n                                 ': Expected unary expression after -');\n      return a.node('UnaryMinus', e);\n    }\n    else return unionExpr(stream, a);\n  }\n  var astFactory = {\n    node: function() {return Array.prototype.slice.call(arguments);}\n  };\n\n\n  /***************************************************************************\n   *                            Optimizations (TODO)                         *\n   ***************************************************************************/\n  /**\n   * Some things I've been considering:\n   * 1) a//b becomes a/descendant::b if there's no predicate that uses\n   *    position() or last()\n   * 2) axis[pred]: when pred doesn't use position, evaluate it just once per\n   *    node in the node-set rather than once per (node, position, last).\n   * For more optimizations, look up Gecko's optimizer:\n   * http://mxr.mozilla.org/mozilla-central/source/content/xslt/src/xpath/txXPathOptimizer.cpp\n   */\n  // TODO\n  function optimize(ast) {\n  }\n\n  /***************************************************************************\n   *                           Evaluation: axes                              *\n   ***************************************************************************/\n\n  /**\n   * Data types: For string, number, boolean, we just use Javascript types.\n   * Node-sets have the form\n   *    {nodes: [node, ...]}\n   * or {nodes: [node, ...], pos: [[1], [2], ...], lasts: [[1], [2], ...]}\n   *\n   * Most of the time, only the node is used and the position information is\n   * discarded. But if you use a predicate, we need to try every value of\n   * position and last in case the predicate calls position() or last().\n   */\n\n  /**\n   * The NodeMultiSet is a helper class to help generate\n   * {nodes:[], pos:[], lasts:[]} structures. It is useful for the\n   * descendant, descendant-or-self, following-sibling, and\n   * preceding-sibling axes for which we can use a stack to organize things.\n   */\n  function NodeMultiSet(isReverseAxis) {\n    this.nodes = [];\n    this.pos = [];\n    this.lasts = [];\n    this.nextPos = [];\n    this.seriesIndexes = [];  // index within nodes that each series begins.\n    this.isReverseAxis = isReverseAxis;\n    this._pushToNodes = isReverseAxis ? Array.prototype.unshift : Array.prototype.push;\n  }\n  NodeMultiSet.prototype = {\n    pushSeries: function pushSeries() {\n      this.nextPos.push(1);\n      this.seriesIndexes.push(this.nodes.length);\n    },\n    popSeries: function popSeries() {\n      console.assert(0 < this.nextPos.length, this.nextPos);\n      var last = this.nextPos.pop() - 1,\n          indexInPos = this.nextPos.length,\n          seriesBeginIndex = this.seriesIndexes.pop(),\n          seriesEndIndex = this.nodes.length;\n      for (var i = seriesBeginIndex; i < seriesEndIndex; ++i) {\n        console.assert(indexInPos < this.lasts[i].length);\n        console.assert(undefined === this.lasts[i][indexInPos]);\n        this.lasts[i][indexInPos] = last;\n      }\n    },\n    finalize: function() {\n      if (null == this.nextPos) return this;\n      console.assert(0 === this.nextPos.length);\n      for (var i = 0; i < this.lasts.length; ++i) {\n        for (var j = 0; j < this.lasts[i].length; ++j) {\n          console.assert(null != this.lasts[i][j], i + ',' + j + ':' + JSON.stringify(this.lasts));\n        }\n      }\n      this.pushSeries = this.popSeries = this.addNode = function() {\n        throw new Error('Already finalized.');\n      };\n      return this;\n    },\n    addNode: function addNode(node) {\n      console.assert(node);\n      this._pushToNodes.call(this.nodes, node)\n      this._pushToNodes.call(this.pos, this.nextPos.slice());\n      this._pushToNodes.call(this.lasts, new Array(this.nextPos.length));\n      for (var i = 0; i < this.nextPos.length; ++i) this.nextPos[i]++;\n    },\n    simplify: function() {\n      this.finalize();\n      return {nodes:this.nodes, pos:this.pos, lasts:this.lasts};\n    }\n  };\n  function eachContext(nodeMultiSet) {\n    var r = [];\n    for (var i = 0; i < nodeMultiSet.nodes.length; i++) {\n      var node = nodeMultiSet.nodes[i];\n      if (!nodeMultiSet.pos) {\n        r.push({nodes:[node], pos: [[i + 1]], lasts: [[nodeMultiSet.nodes.length]]});\n      } else {\n        for (var j = 0; j < nodeMultiSet.pos[i].length; ++j) {\n          r.push({nodes:[node], pos: [[nodeMultiSet.pos[i][j]]], lasts: [[nodeMultiSet.lasts[i][j]]]});\n        }\n      }\n    }\n    return r;\n  }\n  /** Matcher used in the axes.\n   */\n  function NodeMatcher(nodeTypeNum, nodeName, shouldLowerCase) {\n    this.nodeTypeNum = nodeTypeNum;\n    this.nodeName = nodeName;\n    this.shouldLowerCase = shouldLowerCase;\n    this.nodeNameTest =\n      null == nodeName ? this._alwaysTrue :\n      shouldLowerCase ? this._nodeNameLowerCaseEquals :\n      this._nodeNameEquals;\n  }\n  NodeMatcher.prototype = {\n    matches: function matches(node) {\n      if (0 === this.nodeTypeNum || this._nodeTypeMatches(node)) {\n        return this.nodeNameTest(getNodeName(node));\n      }\n\n      return false;\n    },\n    _nodeTypeMatches(nodeOrAttr) {\n      if (nodeOrAttr.constructor.name === 'Attr' && this.nodeTypeNum === 2) {\n        return true;\n      }\n      return nodeOrAttr.nodeType === this.nodeTypeNum;\n    },\n    _alwaysTrue: function(name) {return true;},\n    _nodeNameEquals: function _nodeNameEquals(name) {\n      return this.nodeName === name;\n    },\n    _nodeNameLowerCaseEquals: function _nodeNameLowerCaseEquals(name) {\n      return this.nodeName === name.toLowerCase();\n    }\n  };\n\n  function followingSiblingHelper(nodeList  /*destructive!*/, nodeTypeNum, nodeName, shouldLowerCase, shift, peek, followingNode, andSelf, isReverseAxis) {\n    var matcher = new NodeMatcher(nodeTypeNum, nodeName, shouldLowerCase);\n    var nodeMultiSet = new NodeMultiSet(isReverseAxis);\n    while (0 < nodeList.length) {  // can be if for following, preceding\n      var node = shift.call(nodeList);\n      console.assert(node != null);\n      node = followingNode(node);\n      nodeMultiSet.pushSeries();\n      var numPushed = 1;\n      while (null != node) {\n        if (! andSelf && matcher.matches(node))\n          nodeMultiSet.addNode(node);\n        if (node === peek.call(nodeList)) {\n          shift.call(nodeList);\n          nodeMultiSet.pushSeries();\n          numPushed++;\n        }\n        if (andSelf && matcher.matches(node))\n          nodeMultiSet.addNode(node);\n        node = followingNode(node);\n      }\n      while (0 < numPushed--)\n        nodeMultiSet.popSeries();\n    }\n    return nodeMultiSet;\n  }\n\n  /** Returns the next non-descendant node in document order.\n   * This is the first node in following::node(), if node is the context.\n   */\n  function followingNonDescendantNode(node) {\n    if (node.ownerElement) {\n      if (node.ownerElement.firstChild)\n        return node.ownerElement.firstChild;\n      node = node.ownerElement;\n    }\n    do {\n      if (node.nextSibling) return node.nextSibling;\n    } while (node = node.parentNode);\n    return null;\n  }\n\n  /** Returns the next node in a document-order depth-first search.\n   * See the definition of document order[1]:\n   *   1) element\n   *   2) namespace nodes\n   *   3) attributes\n   *   4) children\n   *   [1]: http://www.w3.org/TR/xpath/#dt-document-order\n   */\n  function followingNode(node) {\n    if (node.ownerElement)  // attributes: following node of element.\n      node = node.ownerElement;\n    if (null != node.firstChild)\n      return node.firstChild;\n    do {\n      if (null != node.nextSibling) {\n        return node.nextSibling;\n      }\n      node = node.parentNode;\n    } while (node);\n    return null;\n  }\n  /** Returns the previous node in document order (excluding attributes\n   * and namespace nodes).\n   */\n  function precedingNode(node) {\n    if (node.ownerElement)\n      return node.ownerElement;\n    if (null != node.previousSibling) {\n      node = node.previousSibling;\n      while (null != node.lastChild) {\n        node = node.lastChild;\n      }\n      return node;\n    }\n    if (null != node.parentNode) {\n      return node.parentNode;\n    }\n    return null;\n  }\n  /** This axis is inefficient if there are many nodes in the nodeList.\n   * But I think it's a pretty useless axis so it's ok. */\n  function followingHelper(nodeList  /*destructive!*/, nodeTypeNum, nodeName, shouldLowerCase) {\n    var matcher = new NodeMatcher(nodeTypeNum, nodeName, shouldLowerCase);\n    var nodeMultiSet = new NodeMultiSet(false);\n    var cursor = nodeList[0];\n    var unorderedFollowingStarts = [];\n    for (var i = 0; i < nodeList.length; i++) {\n      var node = nodeList[i];\n      var start = followingNonDescendantNode(node);\n      if (start)\n        unorderedFollowingStarts.push(start);\n    }\n    if (0 === unorderedFollowingStarts.length)\n      return {nodes:[]};\n    var pos = [], nextPos = [];\n    var started = 0;\n    while (cursor = followingNode(cursor)) {\n      for (var i = unorderedFollowingStarts.length - 1; i >= 0; i--){\n        if (cursor === unorderedFollowingStarts[i]) {\n          nodeMultiSet.pushSeries();\n          unorderedFollowingStarts.splice(i,i+1);\n          started++;\n        }\n      }\n      if (started && matcher.matches(cursor)) {\n        nodeMultiSet.addNode(cursor);\n      }\n    }\n    console.assert(0 === unorderedFollowingStarts.length);\n    for (var i = 0; i < started; i++)\n      nodeMultiSet.popSeries();\n    return nodeMultiSet.finalize();\n  }\n  function precedingHelper(nodeList  /*destructive!*/, nodeTypeNum, nodeName, shouldLowerCase) {\n    var matcher = new NodeMatcher(nodeTypeNum, nodeName, shouldLowerCase);\n    var cursor = nodeList.pop();\n    if (null == cursor) return {nodes:{}};\n    var r = {nodes:[], pos:[], lasts:[]};\n    var nextParents = [cursor.parentNode || cursor.ownerElement], nextPos = [1];\n    while (cursor = precedingNode(cursor)) {\n      if (cursor === nodeList[nodeList.length - 1]) {\n        nextParents.push(nodeList.pop());\n        nextPos.push(1);\n      }\n      var matches = matcher.matches(cursor);\n      var pos, someoneUsed = false;\n      if (matches)\n        pos = nextPos.slice();\n\n      for (var i = 0; i < nextParents.length; ++i) {\n        if (cursor === nextParents[i]) {\n          nextParents[i] = cursor.parentNode || cursor.ownerElement;\n          if (matches) {\n            pos[i] = null;\n          }\n        } else {\n          if (matches) {\n            pos[i] = nextPos[i]++;\n            someoneUsed = true;\n          }\n        }\n      }\n      if (someoneUsed) {\n        r.nodes.unshift(cursor);\n        r.pos.unshift(pos);\n      }\n    }\n    for (var i = 0; i < r.pos.length; ++i) {\n      var lasts = [];\n      r.lasts.push(lasts);\n      for (var j = r.pos[i].length - 1; j >= 0; j--) {\n        if (null == r.pos[i][j]) {\n          r.pos[i].splice(j, j+1);\n        } else {\n          lasts.unshift(nextPos[j] - 1);\n        }\n      }\n    }\n    return r;\n  }\n\n  /** node-set, axis -> node-set */\n  function descendantDfs(nodeMultiSet, node, remaining, matcher, andSelf, attrIndices, attrNodes) {\n    while (0 < remaining.length && null != remaining[0].ownerElement) {\n      var attr = remaining.shift();\n      if (andSelf && matcher.matches(attr)) {\n        attrNodes.push(attr);\n        attrIndices.push(nodeMultiSet.nodes.length);\n      }\n    }\n    if (null != node && !andSelf) {\n      if (matcher.matches(node))\n        nodeMultiSet.addNode(node);\n    }\n    var pushed = false;\n    if (null == node) {\n      if (0 === remaining.length) return;\n      node = remaining.shift();\n      nodeMultiSet.pushSeries();\n      pushed = true;\n    } else if (0 < remaining.length && node === remaining[0]) {\n      nodeMultiSet.pushSeries();\n      pushed = true;\n      remaining.shift();\n    }\n    if (andSelf) {\n      if (matcher.matches(node))\n        nodeMultiSet.addNode(node);\n    }\n    // TODO: use optimization. Also try element.getElementsByTagName\n    // var nodeList = 1 === nodeTypeNum && null != node.children ? node.children : node.childNodes;\n    var nodeList = node.childNodes;\n    for (var j = 0; j < nodeList.length; ++j) {\n      var child = nodeList[j];\n      descendantDfs(nodeMultiSet, child, remaining, matcher, andSelf, attrIndices, attrNodes);\n    }\n    if (pushed) {\n      nodeMultiSet.popSeries();\n    }\n  }\n  function descenantHelper(nodeList  /*destructive!*/, nodeTypeNum, nodeName, shouldLowerCase, andSelf) {\n    var matcher = new NodeMatcher(nodeTypeNum, nodeName, shouldLowerCase);\n    var nodeMultiSet = new NodeMultiSet(false);\n    var attrIndices = [], attrNodes = [];\n    while (0 < nodeList.length) {\n      // var node = nodeList.shift();\n      descendantDfs(nodeMultiSet, null, nodeList, matcher, andSelf, attrIndices, attrNodes);\n    }\n    nodeMultiSet.finalize();\n    for (var i = attrNodes.length-1; i >= 0; --i) {\n      nodeMultiSet.nodes.splice(attrIndices[i], attrIndices[i], attrNodes[i]);\n      nodeMultiSet.pos.splice(attrIndices[i], attrIndices[i], [1]);\n      nodeMultiSet.lasts.splice(attrIndices[i], attrIndices[i], [1]);\n    }\n    return nodeMultiSet;\n  }\n  /**\n   */\n  function ancestorHelper(nodeList  /*destructive!*/, nodeTypeNum, nodeName, shouldLowerCase, andSelf) {\n    var matcher = new NodeMatcher(nodeTypeNum, nodeName, shouldLowerCase);\n    var ancestors = []; // array of non-empty arrays of matching ancestors\n    for (var i = 0; i < nodeList.length; ++i) {\n      var node = nodeList[i];\n      var isFirst = true;\n      var a = [];\n      while (null != node) {\n        if (!isFirst || andSelf) {\n          if (matcher.matches(node))\n            a.push(node);\n        }\n        isFirst = false;\n        node = node.parentNode || node.ownerElement;\n      }\n      if (0 < a.length)\n        ancestors.push(a);\n    }\n    var lasts = [];\n    for (var i = 0; i < ancestors.length; ++i) lasts.push(ancestors[i].length);\n    var nodeMultiSet = new NodeMultiSet(true);\n    var newCtx = {nodes:[], pos:[], lasts:[]};\n    while (0 < ancestors.length) {\n      var pos = [ancestors[0].length];\n      var last = [lasts[0]];\n      var node = ancestors[0].pop();\n      for (var i = ancestors.length - 1; i > 0; --i) {\n        if (node === ancestors[i][ancestors[i].length - 1]) {\n          pos.push(ancestors[i].length);\n          last.push(lasts[i]);\n          ancestors[i].pop();\n          if (0 === ancestors[i].length) {\n            ancestors.splice(i, i+1);\n            lasts.splice(i, i+1);\n          }\n        }\n      }\n      if (0 === ancestors[0].length) {\n        ancestors.shift();\n        lasts.shift();\n      }\n      newCtx.nodes.push(node);\n      newCtx.pos.push(pos);\n      newCtx.lasts.push(last);\n    }\n    return newCtx;\n  }\n  /** Helper function for sortDocumentOrder. Returns a list of indices, from the\n   * node to the root, of positions within parent.\n   * For convenience, the node is the first element of the array.\n   */\n  function addressVector(node) {\n    var r = [node];\n    if (null != node.ownerElement) {\n      node = node.ownerElement;\n      r.push(-1);\n    }\n    while (null != node) {\n      var i = 0;\n      while (null != node.previousSibling) {\n        node = node.previousSibling;\n        i++;\n      }\n      r.push(i);\n      node = node.parentNode\n    }\n    return r;\n  }\n  function addressComparator(a, b) {\n    var minlen = Math.min(a.length - 1, b.length - 1),  // not including [0]=node\n        alen = a.length,\n        blen = b.length;\n    if (a[0] === b[0]) return 0;\n    var c;\n    for (var i = 0; i < minlen; ++i) {\n      c = a[alen - i - 1] - b[blen - i - 1];\n      if (0 !== c)\n        break;\n    }\n    if (null == c || 0 === c) {\n      // All equal until one of the nodes. The longer one is the descendant.\n      c = alen - blen;\n    }\n    if (0 === c)\n      c = getNodeName(a) - getNodeName(b);\n    if (0 === c)\n      c = 1;\n    return c;\n  }\n  var sortUniqDocumentOrder = xpath.sortUniqDocumentOrder = function(nodes) {\n    var a = [];\n    for (var i = 0; i < nodes.length; i++) {\n      var node = nodes[i];\n      var v = addressVector(node);\n      a.push(v);\n    }\n    a.sort(addressComparator);\n    var b = [];\n    for (var i = 0; i < a.length; i++) {\n      if (0 < i && a[i][0] === a[i - 1][0])\n        continue;\n      b.push(a[i][0]);\n    }\n    return b;\n  }\n  /** Sort node multiset. Does not do any de-duping. */\n  function sortNodeMultiSet(nodeMultiSet) {\n    var a = [];\n    for (var i = 0; i < nodeMultiSet.nodes.length; i++) {\n      var v = addressVector(nodeMultiSet.nodes[i]);\n      a.push({v:v, n:nodeMultiSet.nodes[i],\n              p:nodeMultiSet.pos[i], l:nodeMultiSet.lasts[i]});\n    }\n    a.sort(compare);\n    var r = {nodes:[], pos:[], lasts:[]};\n    for (var i = 0; i < a.length; ++i) {\n      r.nodes.push(a[i].n);\n      r.pos.push(a[i].p);\n      r.lasts.push(a[i].l);\n    }\n    function compare(x, y) {\n      return addressComparator(x.v, y.v);\n    }\n    return r;\n  }\n  /** Returns an array containing all the ancestors down to a node.\n   * The array starts with document.\n   */\n  function nodeAndAncestors(node) {\n    var ancestors = [node];\n    var p = node;\n    while (p = p.parentNode || p.ownerElement) {\n      ancestors.unshift(p);\n    }\n    return ancestors;\n  }\n  function compareSiblings(a, b) {\n    if (a === b) return 0;\n    var c = a;\n    while (c = c.previousSibling) {\n      if (c === b)\n        return 1;  // b < a\n    }\n    c = b;\n    while (c = c.previousSibling) {\n      if (c === a)\n        return -1;  // a < b\n    }\n    throw new Error('a and b are not siblings: ' + xpath.stringifyObject(a) + ' vs ' + xpath.stringifyObject(b));\n  }\n  /** The merge in merge-sort.*/\n  function mergeNodeLists(x, y) {\n    var a, b, aanc, banc, r = [];\n    if ('object' !== typeof x)\n      throw new XPathException(XPathException.INVALID_EXPRESSION_ERR,\n                               'Invalid LHS for | operator ' +\n                               '(expected node-set): ' + x);\n    if ('object' !== typeof y)\n      throw new XPathException(XPathException.INVALID_EXPRESSION_ERR,\n                               'Invalid LHS for | operator ' +\n                               '(expected node-set): ' + y);\n    while (true) {\n      if (null == a) {\n        a = x.shift();\n        if (null != a)\n          aanc = addressVector(a);\n      }\n      if (null == b) {\n        b = y.shift();\n        if (null != b)\n          banc = addressVector(b);\n      }\n      if (null == a || null == b) break;\n      var c = addressComparator(aanc, banc);\n      if (c < 0) {\n        r.push(a);\n        a = null;\n        aanc = null;\n      } else if (c > 0) {\n        r.push(b);\n        b = null;\n        banc = null;\n      } else if (getNodeName(a) < getNodeName(b)) {  // attributes\n        r.push(a);\n        a = null;\n        aanc = null;\n      } else if (getNodeName(a) > getNodeName(b)) {  // attributes\n        r.push(b);\n        b = null;\n        banc = null;\n      } else if (a !== b) {\n        // choose b arbitrarily\n        r.push(b);\n        b = null;\n        banc = null;\n      } else {\n        console.assert(a === b, c);\n        // just skip b without pushing it.\n        b = null;\n        banc = null;\n      }\n    }\n    while (a) {\n      r.push(a);\n      a = x.shift();\n    }\n    while (b) {\n      r.push(b);\n      b = y.shift();\n    }\n    return r;\n  }\n  function comparisonHelper(test, x, y, isNumericComparison) {\n    var coersion;\n    if (isNumericComparison)\n      coersion = fn.number;\n    else coersion =\n      'boolean' === typeof x || 'boolean' === typeof y ? fn['boolean'] :\n      'number' === typeof x || 'number' === typeof y ? fn.number :\n      fn.string;\n    if ('object' === typeof x && 'object' === typeof y) {\n      var aMap = {};\n      for (var i = 0; i < x.nodes.length; ++i) {\n        var xi = coersion({nodes:[x.nodes[i]]});\n        for (var j = 0; j < y.nodes.length; ++j) {\n          var yj = coersion({nodes:[y.nodes[j]]});\n          if (test(xi, yj)) return true;\n        }\n      }\n      return false;\n    } else if ('object' === typeof x && x.nodes && x.nodes.length) {\n      for (var i = 0; i < x.nodes.length; ++i) {\n        var xi = coersion({nodes:[x.nodes[i]]}), yc = coersion(y);\n        if (test(xi, yc))\n          return true;\n      }\n      return false;\n    } else if ('object' === typeof y && x.nodes && x.nodes.length) {\n      for (var i = 0; i < x.nodes.length; ++i) {\n        var yi = coersion({nodes:[y.nodes[i]]}), xc = coersion(x);\n        if (test(xc, yi))\n          return true;\n      }\n      return false;\n    } else {\n      var xc = coersion(x), yc = coersion(y);\n      return test(xc, yc);\n    }\n  }\n  var axes = xpath.axes = {\n    'ancestor':\n      function ancestor(nodeList  /*destructive!*/, nodeTypeNum, nodeName, shouldLowerCase) {\n        return ancestorHelper(\n          nodeList  /*destructive!*/, nodeTypeNum, nodeName, shouldLowerCase, false);\n      },\n    'ancestor-or-self':\n      function ancestorOrSelf(nodeList  /*destructive!*/, nodeTypeNum, nodeName, shouldLowerCase) {\n        return ancestorHelper(\n          nodeList  /*destructive!*/, nodeTypeNum, nodeName, shouldLowerCase, true);\n      },\n    'attribute':\n      function attribute(nodeList  /*destructive!*/, nodeTypeNum, nodeName, shouldLowerCase) {\n        // TODO: figure out whether positions should be undefined here.\n        var matcher = new NodeMatcher(nodeTypeNum, nodeName, shouldLowerCase);\n        var nodeMultiSet = new NodeMultiSet(false);\n        if (null != nodeName) {\n          // TODO: with namespace\n          for (var i = 0; i < nodeList.length; ++i) {\n            var node = nodeList[i];\n            if (null == node.getAttributeNode)\n              continue;  // only Element has .getAttributeNode\n            var attr = node.getAttributeNode(nodeName);\n            if (null != attr && matcher.matches(attr)) {\n              nodeMultiSet.pushSeries();\n              nodeMultiSet.addNode(attr);\n              nodeMultiSet.popSeries();\n            }\n          }\n        } else {\n          for (var i = 0; i < nodeList.length; ++i) {\n            var node = nodeList[i];\n            if (null != node.attributes) {\n              nodeMultiSet.pushSeries();\n              for (var j = 0; j < node.attributes.length; j++) {  // all nodes have .attributes\n                var attr = node.attributes[j];\n                if (matcher.matches(attr))  // TODO: I think this check is unnecessary\n                  nodeMultiSet.addNode(attr);\n              }\n              nodeMultiSet.popSeries();\n            }\n          }\n        }\n        return nodeMultiSet.finalize();\n      },\n    'child':\n      function child(nodeList  /*destructive!*/, nodeTypeNum, nodeName, shouldLowerCase) {\n        var matcher = new NodeMatcher(nodeTypeNum, nodeName, shouldLowerCase);\n        var nodeMultiSet = new NodeMultiSet(false);\n        for (var i = 0; i < nodeList.length; ++i) {\n          var n = nodeList[i];\n          if (n.ownerElement)  // skip attribute nodes' text child.\n            continue;\n          if (n.childNodes) {\n            nodeMultiSet.pushSeries();\n            var childList = 1 === nodeTypeNum && null != n.children ?\n                n.children : n.childNodes;\n            for (var j = 0; j < childList.length; ++j) {\n              var child = childList[j];\n              if (matcher.matches(child)) {\n                nodeMultiSet.addNode(child);\n              }\n              // don't have to do de-duping because children have parent,\n              // which are current context.\n            }\n            nodeMultiSet.popSeries();\n          }\n        }\n        nodeMultiSet.finalize();\n        return sortNodeMultiSet(nodeMultiSet);\n      },\n    'descendant':\n      function descenant(nodeList  /*destructive!*/, nodeTypeNum, nodeName, shouldLowerCase) {\n        return descenantHelper(\n          nodeList  /*destructive!*/, nodeTypeNum, nodeName, shouldLowerCase, false);\n      },\n    'descendant-or-self':\n      function descenantOrSelf(nodeList  /*destructive!*/, nodeTypeNum, nodeName, shouldLowerCase) {\n        return descenantHelper(\n          nodeList  /*destructive!*/, nodeTypeNum, nodeName, shouldLowerCase, true);\n      },\n    'following':\n      function following(nodeList  /*destructive!*/, nodeTypeNum, nodeName, shouldLowerCase) {\n        return followingHelper(nodeList  /*destructive!*/, nodeTypeNum, nodeName, shouldLowerCase);\n      },\n    'following-sibling':\n      function followingSibling(nodeList  /*destructive!*/, nodeTypeNum, nodeName, shouldLowerCase) {\n        return followingSiblingHelper(\n          nodeList  /*destructive!*/, nodeTypeNum, nodeName, shouldLowerCase,\n          Array.prototype.shift, function() {return this[0];},\n          function(node) {return node.nextSibling;});\n      },\n    'namespace':\n      function namespace(nodeList  /*destructive!*/, nodeTypeNum, nodeName, shouldLowerCase) {\n        // TODO\n      },\n    'parent':\n      function parent(nodeList  /*destructive!*/, nodeTypeNum, nodeName, shouldLowerCase) {\n        var matcher = new NodeMatcher(nodeTypeNum, nodeName, shouldLowerCase);\n        var nodes = [], pos = [];\n        for (var i = 0; i < nodeList.length; ++i) {\n          var parent = nodeList[i].parentNode || nodeList[i].ownerElement;\n          if (null == parent)\n            continue;\n          if (!matcher.matches(parent))\n            continue;\n          if (nodes.length > 0 && parent === nodes[nodes.length-1])\n            continue;\n          nodes.push(parent);\n          pos.push([1]);\n        }\n        return {nodes:nodes, pos:pos, lasts:pos};\n      },\n    'preceding':\n      function preceding(nodeList  /*destructive!*/, nodeTypeNum, nodeName, shouldLowerCase) {\n        return precedingHelper(\n          nodeList  /*destructive!*/, nodeTypeNum, nodeName, shouldLowerCase);\n      },\n    'preceding-sibling':\n      function precedingSibling(nodeList  /*destructive!*/, nodeTypeNum, nodeName, shouldLowerCase) {\n        return followingSiblingHelper(\n          nodeList  /*destructive!*/, nodeTypeNum, nodeName, shouldLowerCase,\n          Array.prototype.pop, function() {return this[this.length-1];},\n          function(node) {return node.previousSibling},\n          false, true);\n      },\n    'self':\n      function self(nodeList  /*destructive!*/, nodeTypeNum, nodeName, shouldLowerCase) {\n        var nodes = [], pos = [];\n        var matcher = new NodeMatcher(nodeTypeNum, nodeName, shouldLowerCase);\n        for (var i = 0; i < nodeList.length; ++i) {\n          if (matcher.matches(nodeList[i])) {\n            nodes.push(nodeList[i]);\n            pos.push([1]);\n          }\n        }\n        return {nodes: nodes, pos: pos, lasts: pos}\n      }\n  };\n\n  /***************************************************************************\n   *                         Evaluation: functions                           *\n   ***************************************************************************/\n  var fn = {\n    'number': function number(optObject) {\n      if ('number' === typeof optObject)\n        return optObject;\n      if ('string' === typeof optObject)\n        return parseFloat(optObject);  // note: parseFloat(' ') -> NaN, unlike +' ' -> 0.\n      if ('boolean' === typeof optObject)\n        return +optObject;\n      return fn.number(fn.string.call(this, optObject));  // for node-sets\n    },\n    'string': function string(optObject) {\n      if (null == optObject)\n        return fn.string(this);\n      if ('string' === typeof optObject || 'boolean' === typeof optObject ||\n          'number' === typeof optObject)\n        return '' + optObject;\n      if (0 == optObject.nodes.length) return '';\n      if (null != optObject.nodes[0].textContent)\n        return optObject.nodes[0].textContent;\n      return optObject.nodes[0].nodeValue;\n    },\n    'boolean': function booleanVal(x) {\n      return 'object' === typeof x ? x.nodes.length > 0 : !!x;\n    },\n    'last': function last() {\n      console.assert(Array.isArray(this.pos));\n      console.assert(Array.isArray(this.lasts));\n      console.assert(1 === this.pos.length);\n      console.assert(1 === this.lasts.length);\n      console.assert(1 === this.lasts[0].length);\n      return this.lasts[0][0];\n    },\n    'position': function position() {\n      console.assert(Array.isArray(this.pos));\n      console.assert(Array.isArray(this.lasts));\n      console.assert(1 === this.pos.length);\n      console.assert(1 === this.lasts.length);\n      console.assert(1 === this.pos[0].length);\n      return this.pos[0][0];\n    },\n    'count': function count(nodeSet) {\n      if ('object' !== typeof nodeSet)\n        throw new XPathException(XPathException.INVALID_EXPRESSION_ERR,\n                                 'Position ' + stream.position() +\n                                 ': Function count(node-set) ' +\n                                 'got wrong argument type: ' + nodeSet);\n      return nodeSet.nodes.length;\n    },\n    'id': function id(object) {\n      var r = {nodes: []};\n      var doc = this.nodes[0].ownerDocument || this.nodes[0];\n      console.assert(doc);\n      var ids;\n      if ('object' === typeof object) {\n        // for node-sets, map id over each node value.\n        ids = [];\n        for (var i = 0; i < object.nodes.length; ++i) {\n          var idNode = object.nodes[i];\n          var idsString = fn.string({nodes:[idNode]});\n          var a = idsString.split(/[ \\t\\r\\n]+/g);\n          Array.prototype.push.apply(ids, a);\n        }\n      } else {\n        var idsString = fn.string(object);\n        var a = idsString.split(/[ \\t\\r\\n]+/g);\n        ids = a;\n      }\n      for (var i = 0; i < ids.length; ++i) {\n        var id = ids[i];\n        if (0 === id.length)\n          continue;\n        var node = doc.getElementById(id);\n        if (null != node)\n          r.nodes.push(node);\n      }\n      r.nodes = sortUniqDocumentOrder(r.nodes);\n      return r;\n    },\n    'local-name': function(nodeSet) {\n      if (null == nodeSet)\n        return fn.name(this);\n      if (null == nodeSet.nodes) {\n        throw new XPathException(XPathException.INVALID_EXPRESSION_ERR,\n                                 'argument to name() must be a node-set. got ' + nodeSet);\n      }\n      // TODO: namespaced version\n      return nodeSet.nodes[0].localName;\n    },\n    'namespace-uri': function(nodeSet) {\n      // TODO\n      throw new Error('not implemented yet');\n    },\n    'name': function(nodeSet) {\n      if (null == nodeSet)\n        return fn.name(this);\n      if (null == nodeSet.nodes) {\n        throw new XPathException(XPathException.INVALID_EXPRESSION_ERR,\n                                 'argument to name() must be a node-set. got ' + nodeSet);\n      }\n      return nodeSet.nodes[0].name;\n    },\n    'concat': function concat(x) {\n      var l = [];\n      for (var i = 0; i < arguments.length; ++i) {\n        l.push(fn.string(arguments[i]));\n      }\n      return l.join('');\n    },\n    'starts-with': function startsWith(a, b) {\n      var as = fn.string(a), bs = fn.string(b);\n      return as.substr(0, bs.length) === bs;\n    },\n    'contains': function contains(a, b) {\n      var as = fn.string(a), bs = fn.string(b);\n      var i = as.indexOf(bs);\n      if (-1 === i) return false;\n      return true;\n    },\n    'substring-before': function substringBefore(a, b) {\n      var as = fn.string(a), bs = fn.string(b);\n      var i = as.indexOf(bs);\n      if (-1 === i) return '';\n      return as.substr(0, i);\n    },\n    'substring-after': function substringBefore(a, b) {\n      var as = fn.string(a), bs = fn.string(b);\n      var i = as.indexOf(bs);\n      if (-1 === i) return '';\n      return as.substr(i + bs.length);\n    },\n    'substring': function substring(string, start, optEnd) {\n      if (null == string || null == start) {\n        throw new XPathException(XPathException.INVALID_EXPRESSION_ERR,\n                                 'Must be at least 2 arguments to string()');\n      }\n      var sString = fn.string(string),\n          iStart = fn.round(start),\n          iEnd = optEnd == null ? null : fn.round(optEnd);\n      // Note that xpath string positions user 1-based index\n      if (iEnd == null)\n        return sString.substr(iStart - 1);\n      else\n        return sString.substr(iStart - 1, iEnd);\n    },\n    'string-length': function stringLength(optString) {\n      return fn.string.call(this, optString).length;\n    },\n    'normalize-space': function normalizeSpace(optString) {\n      var s = fn.string.call(this, optString);\n      return s.replace(/[ \\t\\r\\n]+/g, ' ').replace(/^ | $/g, '');\n    },\n    'translate': function translate(string, from, to) {\n      var sString = fn.string.call(this, string),\n          sFrom = fn.string(from),\n          sTo = fn.string(to);\n      var eachCharRe = [];\n      var map = {};\n      for (var i = 0; i < sFrom.length; ++i) {\n        var c = sFrom.charAt(i);\n        map[c] = sTo.charAt(i);  // returns '' if beyond length of sTo.\n        // copied from goog.string.regExpEscape in the Closure library.\n        eachCharRe.push(\n          c.replace(/([-()\\[\\]{}+?*.$\\^|,:#<!\\\\])/g, '\\\\$1').\n            replace(/\\x08/g, '\\\\x08'));\n      }\n      var re = new RegExp(eachCharRe.join('|'), 'g');\n      return sString.replace(re, function(c) {return map[c];});\n    },\n    /// Boolean functions\n    'not': function not(x) {\n      var bx = fn['boolean'](x);\n      return !bx;\n    },\n    'true': function trueVal() { return true; },\n    'false': function falseVal() { return false; },\n    // TODO\n    'lang': function lang(string) { throw new Error('Not implemented');},\n    'sum': function sum(optNodeSet) {\n      if (null == optNodeSet) return fn.sum(this);\n      // for node-sets, map id over each node value.\n      var sum = 0;\n      for (var i = 0; i < optNodeSet.nodes.length; ++i) {\n        var node = optNodeSet.nodes[i];\n        var x = fn.number({nodes:[node]});\n        sum += x;\n      }\n      return sum;\n    },\n    'floor': function floor(number) {\n      return Math.floor(fn.number(number));\n    },\n    'ceiling': function ceiling(number) {\n      return Math.ceil(fn.number(number));\n    },\n    'round': function round(number) {\n      return Math.round(fn.number(number));\n    }\n  };\n  /***************************************************************************\n   *                         Evaluation: operators                           *\n   ***************************************************************************/\n  var more = {\n    UnaryMinus: function(x) { return -fn.number(x); },\n    '+': function(x, y) { return fn.number(x) + fn.number(y); },\n    '-': function(x, y) { return fn.number(x) - fn.number(y); },\n    '*': function(x, y) { return fn.number(x) * fn.number(y); },\n    'div': function(x, y) { return fn.number(x) / fn.number(y); },\n    'mod': function(x, y) { return fn.number(x) % fn.number(y); },\n    '<': function(x, y) {\n      return comparisonHelper(function(x, y) { return fn.number(x) < fn.number(y);}, x, y, true);\n    },\n    '<=': function(x, y) {\n      return comparisonHelper(function(x, y) { return fn.number(x) <= fn.number(y);}, x, y, true);\n    },\n    '>':  function(x, y) {\n      return comparisonHelper(function(x, y) { return fn.number(x) > fn.number(y);}, x, y, true);\n    },\n    '>=': function(x, y) {\n      return comparisonHelper(function(x, y) { return fn.number(x) >= fn.number(y);}, x, y, true);\n    },\n    'and': function(x, y) { return fn['boolean'](x) && fn['boolean'](y); },\n    'or': function(x, y) { return fn['boolean'](x) || fn['boolean'](y); },\n    '|': function(x, y) { return {nodes: mergeNodeLists(x.nodes, y.nodes)}; },\n    '=': function(x, y) {\n      // optimization for two node-sets case: avoid n^2 comparisons.\n      if ('object' === typeof x && 'object' === typeof y) {\n        var aMap = {};\n        for (var i = 0; i < x.nodes.length; ++i) {\n          var s = fn.string({nodes:[x.nodes[i]]});\n          aMap[s] = true;\n        }\n        for (var i = 0; i < y.nodes.length; ++i) {\n          var s = fn.string({nodes:[y.nodes[i]]});\n          if (aMap[s]) return true;\n        }\n        return false;\n      } else {\n        return comparisonHelper(function(x, y) {return x === y;}, x, y);\n      }\n    },\n    '!=': function(x, y) {\n      // optimization for two node-sets case: avoid n^2 comparisons.\n      if ('object' === typeof x && 'object' === typeof y) {\n        if (0 === x.nodes.length || 0 === y.nodes.length) return false;\n        var aMap = {};\n        for (var i = 0; i < x.nodes.length; ++i) {\n          var s = fn.string({nodes:[x.nodes[i]]});\n          aMap[s] = true;\n        }\n        for (var i = 0; i < y.nodes.length; ++i) {\n          var s = fn.string({nodes:[y.nodes[i]]});\n          if (!aMap[s]) return true;\n        }\n        return false;\n      } else {\n        return comparisonHelper(function(x, y) {return x !== y;}, x, y);\n      }\n    }\n  };\n  var nodeTypes = xpath.nodeTypes = {\n    'node': 0,\n    'attribute': 2,\n    'comment': 8, // this.doc.COMMENT_NODE,\n    'text': 3, // this.doc.TEXT_NODE,\n    'processing-instruction': 7, // this.doc.PROCESSING_INSTRUCTION_NODE,\n    'element': 1  //this.doc.ELEMENT_NODE\n  };\n  /** For debugging and unit tests: returnjs a stringified version of the\n   * argument. */\n  var stringifyObject = xpath.stringifyObject = function stringifyObject(ctx) {\n    var seenKey = 'seen' + Math.floor(Math.random()*1000000000);\n    return JSON.stringify(helper(ctx));\n\n    function helper(ctx) {\n      if (Array.isArray(ctx)) {\n        return ctx.map(function(x) {return helper(x);});\n      }\n      if ('object' !== typeof ctx) return ctx;\n      if (null == ctx) return ctx;\n    //  if (ctx.toString) return ctx.toString();\n      if (null != ctx.outerHTML) return ctx.outerHTML;\n      if (null != ctx.nodeValue) return ctx.nodeName + '=' + ctx.nodeValue;\n      if (ctx[seenKey]) return '[circular]';\n      ctx[seenKey] = true;\n      var nicer = {};\n      for (var key in ctx) {\n        if (seenKey === key)\n          continue;\n        try {\n          nicer[key] = helper(ctx[key]);\n        } catch (e) {\n          nicer[key] = '[exception: ' + e.message + ']';\n        }\n      }\n      delete ctx[seenKey];\n      return nicer;\n    }\n  }\n  var Evaluator = xpath.Evaluator = function Evaluator(doc) {\n    this.doc = doc;\n  }\n  Evaluator.prototype = {\n    val: function val(ast, ctx) {\n      console.assert(ctx.nodes);\n\n      if ('number' === typeof ast || 'string' === typeof ast) return ast;\n      if (more[ast[0]]) {\n        var evaluatedParams = [];\n        for (var i = 1; i < ast.length; ++i) {\n          evaluatedParams.push(this.val(ast[i], ctx));\n        }\n        var r = more[ast[0]].apply(ctx, evaluatedParams);\n        return r;\n      }\n      switch (ast[0]) {\n        case 'Root': return {nodes: [this.doc]};\n        case 'FunctionCall':\n          var functionName = ast[1], functionParams = ast[2];\n          if (null == fn[functionName])\n            throw new XPathException(XPathException.INVALID_EXPRESSION_ERR,\n                                     'Unknown function: ' + functionName);\n          var evaluatedParams = [];\n          for (var i = 0; i < functionParams.length; ++i) {\n            evaluatedParams.push(this.val(functionParams[i], ctx));\n          }\n          var r = fn[functionName].apply(ctx, evaluatedParams);\n          return r;\n        case 'Predicate':\n          var lhs = this.val(ast[1], ctx);\n          var ret = {nodes: []};\n          var contexts = eachContext(lhs);\n          for (var i = 0; i < contexts.length; ++i) {\n            var singleNodeSet = contexts[i];\n            var rhs = this.val(ast[2], singleNodeSet);\n            var success;\n            if ('number' === typeof rhs) {\n              success = rhs === singleNodeSet.pos[0][0];\n            } else {\n              success = fn['boolean'](rhs);\n            }\n            if (success) {\n              var node = singleNodeSet.nodes[0];\n              ret.nodes.push(node);\n              // skip over all the rest of the same node.\n              while (i+1 < contexts.length && node === contexts[i+1].nodes[0]) {\n                i++;\n              }\n            }\n          }\n          return ret;\n        case 'PathExpr':\n          // turn the path into an expressoin; i.e., remove the position\n          // information of the last axis.\n          var x = this.val(ast[1], ctx);\n          // Make the nodeset a forward-direction-only one.\n          if (x.finalize) {  // it is a NodeMultiSet\n            return {nodes: x.nodes};\n          } else {\n            return x;\n          }\n        case '/':\n          // TODO: don't generate '/' nodes, just Axis nodes.\n          var lhs = this.val(ast[1], ctx);\n          console.assert(null != lhs);\n          var r = this.val(ast[2], lhs);\n          console.assert(null != r);\n          return r;\n        case 'Axis':\n          // All the axis tests from Step. We only get AxisSpecifier NodeTest,\n          // not the predicate (which is applied later)\n          var axis = ast[1],\n              nodeType = ast[2],\n              nodeTypeNum = nodeTypes[nodeType],\n              shouldLowerCase = true,  // TODO: give option\n              nodeName = ast[3] && shouldLowerCase ? ast[3].toLowerCase() : ast[3];\n          nodeName = nodeName === '*' ? null : nodeName;\n          if ('object' !== typeof ctx) return {nodes:[], pos:[]};\n          var nodeList = ctx.nodes.slice();  // TODO: is copy needed?\n          var r = axes[axis](nodeList  /*destructive!*/, nodeTypeNum, nodeName, shouldLowerCase);\n          return r;\n      }\n    }\n  };\n  var evaluate = xpath.evaluate = function evaluate(expr, doc, context) {\n    //var astFactory = new AstEvaluatorFactory(doc, context);\n    var stream = new Stream(expr);\n    var ast = parse(stream, astFactory);\n    var val = new Evaluator(doc).val(ast, {nodes: [context]});\n    return val;\n  }\n\n  /***************************************************************************\n   *                           DOM interface                                 *\n   ***************************************************************************/\n  var XPathException = xpath.XPathException = function XPathException(code, message) {\n    var e = new Error(message);\n    e.name = 'XPathException';\n    e.code = code;\n    return e;\n  }\n  XPathException.INVALID_EXPRESSION_ERR = 51;\n  XPathException.TYPE_ERR = 52;\n\n\n  var XPathEvaluator = xpath.XPathEvaluator = function XPathEvaluator() {}\n  XPathEvaluator.prototype = {\n    createExpression: function(expression, resolver) {\n      return new XPathExpression(expression, resolver);\n    },\n    createNSResolver: function(nodeResolver) {\n      // TODO\n    },\n    evaluate: function evaluate(expression, contextNode, resolver, type, result) {\n      var expr = new XPathExpression(expression, resolver);\n      return expr.evaluate(contextNode, type, result);\n    }\n  };\n\n\n  var XPathExpression = xpath.XPathExpression = function XPathExpression(expression, resolver, optDoc) {\n    var stream = new Stream(expression);\n    this._ast = parse(stream, astFactory);\n    this._doc = optDoc;\n  }\n  XPathExpression.prototype = {\n    evaluate: function evaluate(contextNode, type, result) {\n      if (null == contextNode.nodeType)\n        throw new Error('bad argument (expected context node): ' + contextNode);\n      var doc = contextNode.ownerDocument || contextNode;\n      if (null != this._doc && this._doc !== doc) {\n        throw new core.DOMException(\n            core.DOMException.WRONG_DOCUMENT_ERR,\n            'The document must be the same as the context node\\'s document.');\n      }\n      var evaluator = new Evaluator(doc);\n      var value = evaluator.val(this._ast, {nodes: [contextNode]});\n      if (XPathResult.NUMBER_TYPE === type)\n        value = fn.number(value);\n      else if (XPathResult.STRING_TYPE === type)\n        value = fn.string(value);\n      else if (XPathResult.BOOLEAN_TYPE === type)\n        value = fn['boolean'](value);\n      else if (XPathResult.ANY_TYPE !== type &&\n               XPathResult.UNORDERED_NODE_ITERATOR_TYPE !== type &&\n               XPathResult.ORDERED_NODE_ITERATOR_TYPE !== type &&\n               XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE !== type &&\n               XPathResult.ORDERED_NODE_SNAPSHOT_TYPE !== type &&\n               XPathResult.ANY_UNORDERED_NODE_TYPE !== type &&\n               XPathResult.FIRST_ORDERED_NODE_TYPE !== type)\n        throw new core.DOMException(\n            core.DOMException.NOT_SUPPORTED_ERR,\n            'You must provide an XPath result type (0=any).');\n      else if (XPathResult.ANY_TYPE !== type &&\n               'object' !== typeof value)\n        throw new XPathException(\n            XPathException.TYPE_ERR,\n            'Value should be a node-set: ' + value);\n      return new XPathResult(doc, value, type);\n    }\n  }\n\n  var XPathResult = xpath.XPathResult = function XPathResult(doc, value, resultType) {\n    this._value = value;\n    this._resultType = resultType;\n    this._i = 0;\n    this._invalidated = false;\n    if (this.resultType === XPathResult.UNORDERED_NODE_ITERATOR_TYPE ||\n        this.resultType === XPathResult.ORDERED_NODE_ITERATOR_TYPE) {\n      doc.addEventListener('DOMSubtreeModified', invalidate, true);\n      var self = this;\n      function invalidate() {\n        self._invalidated = true;\n        doc.removeEventListener('DOMSubtreeModified', invalidate, true);\n      }\n    }\n  }\n  XPathResult.ANY_TYPE = 0;\n  XPathResult.NUMBER_TYPE = 1;\n  XPathResult.STRING_TYPE = 2;\n  XPathResult.BOOLEAN_TYPE = 3;\n  XPathResult.UNORDERED_NODE_ITERATOR_TYPE = 4;\n  XPathResult.ORDERED_NODE_ITERATOR_TYPE = 5;\n  XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE = 6;\n  XPathResult.ORDERED_NODE_SNAPSHOT_TYPE = 7;\n  XPathResult.ANY_UNORDERED_NODE_TYPE = 8;\n  XPathResult.FIRST_ORDERED_NODE_TYPE = 9;\n  var proto = {\n    // XPathResultType\n    get resultType() {\n      if (this._resultType) return this._resultType;\n      switch (typeof this._value) {\n        case 'number': return XPathResult.NUMBER_TYPE;\n        case 'string': return XPathResult.STRING_TYPE;\n        case 'boolean': return XPathResult.BOOLEAN_TYPE;\n        default: return XPathResult.UNORDERED_NODE_ITERATOR_TYPE;\n      }\n    },\n    get numberValue() {\n      if (XPathResult.NUMBER_TYPE !== this.resultType)\n        throw new XPathException(XPathException.TYPE_ERR,\n                                 'You should have asked for a NUMBER_TYPE.');\n      return this._value;\n    },\n    get stringValue() {\n      if (XPathResult.STRING_TYPE !== this.resultType)\n        throw new XPathException(XPathException.TYPE_ERR,\n                                 'You should have asked for a STRING_TYPE.');\n      return this._value;\n    },\n    get booleanValue() {\n      if (XPathResult.BOOLEAN_TYPE !== this.resultType)\n        throw new XPathException(XPathException.TYPE_ERR,\n                                 'You should have asked for a BOOLEAN_TYPE.');\n      return this._value;\n    },\n    get singleNodeValue() {\n      if (XPathResult.ANY_UNORDERED_NODE_TYPE !== this.resultType &&\n          XPathResult.FIRST_ORDERED_NODE_TYPE !== this.resultType)\n        throw new XPathException(\n            XPathException.TYPE_ERR,\n            'You should have asked for a FIRST_ORDERED_NODE_TYPE.');\n      return this._value.nodes[0] || null;\n    },\n    get invalidIteratorState() {\n      if (XPathResult.UNORDERED_NODE_ITERATOR_TYPE !== this.resultType &&\n          XPathResult.ORDERED_NODE_ITERATOR_TYPE !== this.resultType)\n        return false;\n      return !!this._invalidated;\n    },\n    get snapshotLength() {\n      if (XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE !== this.resultType &&\n          XPathResult.ORDERED_NODE_SNAPSHOT_TYPE !== this.resultType)\n        throw new XPathException(\n            XPathException.TYPE_ERR,\n            'You should have asked for a ORDERED_NODE_SNAPSHOT_TYPE.');\n      return this._value.nodes.length;\n    },\n    iterateNext: function iterateNext() {\n      if (XPathResult.UNORDERED_NODE_ITERATOR_TYPE !== this.resultType &&\n          XPathResult.ORDERED_NODE_ITERATOR_TYPE !== this.resultType)\n        throw new XPathException(\n            XPathException.TYPE_ERR,\n            'You should have asked for a ORDERED_NODE_ITERATOR_TYPE.');\n      if (this.invalidIteratorState)\n        throw new core.DOMException(\n            core.DOMException.INVALID_STATE_ERR,\n            'The document has been mutated since the result was returned');\n      return this._value.nodes[this._i++] || null;\n    },\n    snapshotItem: function snapshotItem(index) {\n      if (XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE !== this.resultType &&\n          XPathResult.ORDERED_NODE_SNAPSHOT_TYPE !== this.resultType)\n        throw new XPathException(\n            XPathException.TYPE_ERR,\n            'You should have asked for a ORDERED_NODE_SNAPSHOT_TYPE.');\n      return this._value.nodes[index] || null;\n    }\n  };\n  // so you can access ANY_TYPE etc. from the instances:\n  XPathResult.prototype = Object.create(XPathResult,\n      Object.keys(proto).reduce(function (descriptors, name) {\n        descriptors[name] = Object.getOwnPropertyDescriptor(proto, name);\n        return descriptors;\n      }, {\n        constructor: {\n          value: XPathResult,\n          writable: true,\n          configurable: true\n        }\n      }));\n\n  core.XPathException = XPathException;\n  core.XPathExpression = XPathExpression;\n  core.XPathResult = XPathResult;\n  core.XPathEvaluator = XPathEvaluator;\n\n  core.Document.prototype.createExpression =\n    XPathEvaluator.prototype.createExpression;\n\n  core.Document.prototype.createNSResolver =\n      XPathEvaluator.prototype.createNSResolver;\n\n  core.Document.prototype.evaluate = XPathEvaluator.prototype.evaluate;\n\n})();\n"]}