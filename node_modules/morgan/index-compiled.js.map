{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["/*!\n * morgan\n * Copyright(c) 2010 Sencha Inc.\n * Copyright(c) 2011 TJ Holowaychuk\n * Copyright(c) 2014 Jonathan Ong\n * Copyright(c) 2014-2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict'\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = morgan\nmodule.exports.compile = compile\nmodule.exports.format = format\nmodule.exports.token = token\n\n/**\n * Module dependencies.\n * @private\n */\n\nvar auth = require('basic-auth')\nvar debug = require('debug')('morgan')\nvar deprecate = require('depd')('morgan')\nvar onFinished = require('on-finished')\nvar onHeaders = require('on-headers')\n\n/**\n * Array of CLF month names.\n * @private\n */\n\nvar clfmonth = [\n  'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',\n  'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'\n]\n\n/**\n * Default log buffer duration.\n * @private\n */\n\nvar defaultBufferDuration = 1000;\n\n/**\n * Create a logger middleware.\n *\n * @public\n * @param {String|Function} format\n * @param {Object} [options]\n * @return {Function} middleware\n */\n\nfunction morgan(format, options) {\n  var fmt = format\n  var opts = options || {}\n\n  if (format && typeof format === 'object') {\n    opts = format\n    fmt = opts.format || 'default'\n\n    // smart deprecation message\n    deprecate('morgan(options): use morgan(' + (typeof fmt === 'string' ? JSON.stringify(fmt) : 'format') + ', options) instead')\n  }\n\n  if (fmt === undefined) {\n    deprecate('undefined format: specify a format')\n  }\n\n  // output on request instead of response\n  var immediate = opts.immediate\n\n  // check if log entry should be skipped\n  var skip = opts.skip || false\n\n  // format function\n  var formatLine = typeof fmt !== 'function'\n    ? getFormatFunction(fmt)\n    : fmt\n\n  // stream\n  var buffer = opts.buffer\n  var stream = opts.stream || process.stdout\n\n  // buffering support\n  if (buffer) {\n    deprecate('buffer option')\n\n    // flush interval\n    var interval = typeof buffer !== 'number'\n      ? defaultBufferDuration\n      : buffer\n\n    // swap the stream\n    stream = createBufferStream(stream, interval)\n  }\n\n  return function logger(req, res, next) {\n    // request data\n    req._startAt = undefined\n    req._startTime = undefined\n    req._remoteAddress = getip(req)\n\n    // response data\n    res._startAt = undefined\n    res._startTime = undefined\n\n    // record request start\n    recordStartTime.call(req)\n\n    function logRequest() {\n      if (skip !== false && skip(req, res)) {\n        debug('skip request')\n        return\n      }\n\n      var line = formatLine(morgan, req, res)\n\n      if (null == line) {\n        debug('skip line')\n        return\n      }\n\n      debug('log request')\n      stream.write(line + '\\n')\n    };\n\n    if (immediate) {\n      // immediate log\n      logRequest()\n    } else {\n      // record response start\n      onHeaders(res, recordStartTime)\n\n      // log when response finished\n      onFinished(res, logRequest)\n    }\n\n    next();\n  };\n}\n\n/**\n * Apache combined log format.\n */\n\nmorgan.format('combined', ':remote-addr - :remote-user [:date[clf]] \":method :url HTTP/:http-version\" :status :res[content-length] \":referrer\" \":user-agent\"')\n\n/**\n * Apache common log format.\n */\n\nmorgan.format('common', ':remote-addr - :remote-user [:date[clf]] \":method :url HTTP/:http-version\" :status :res[content-length]')\n\n/**\n * Default format.\n */\n\nmorgan.format('default', ':remote-addr - :remote-user [:date] \":method :url HTTP/:http-version\" :status :res[content-length] \":referrer\" \":user-agent\"')\ndeprecate.property(morgan, 'default', 'default format: use combined format')\n\n/**\n * Short format.\n */\n\nmorgan.format('short', ':remote-addr :remote-user :method :url HTTP/:http-version :status :res[content-length] - :response-time ms')\n\n/**\n * Tiny format.\n */\n\nmorgan.format('tiny', ':method :url :status :res[content-length] - :response-time ms')\n\n/**\n * dev (colored)\n */\n\nmorgan.format('dev', function developmentFormatLine(tokens, req, res) {\n  // get the status code if response written\n  var status = res._header\n    ? res.statusCode\n    : undefined\n\n  // get status color\n  var color = status >= 500 ? 31 // red\n    : status >= 400 ? 33 // yellow\n    : status >= 300 ? 36 // cyan\n    : status >= 200 ? 32 // green\n    : 0 // no color\n\n  // get colored function\n  var fn = developmentFormatLine[color]\n\n  if (!fn) {\n    // compile\n    fn = developmentFormatLine[color] = compile('\\x1b[0m:method :url \\x1b['\n      + color + 'm:status \\x1b[0m:response-time ms - :res[content-length]\\x1b[0m')\n  }\n\n  return fn(tokens, req, res)\n})\n\n/**\n * request url\n */\n\nmorgan.token('url', function getUrlToken(req) {\n  return req.originalUrl || req.url\n})\n\n/**\n * request method\n */\n\nmorgan.token('method', function getMethodToken(req) {\n  return req.method;\n});\n\n/**\n * response time in milliseconds\n */\n\nmorgan.token('response-time', function getResponseTimeToken(req, res, digits) {\n  if (!req._startAt || !res._startAt) {\n    // missing request and/or response start time\n    return\n  }\n\n  // calculate diff\n  var ms = (res._startAt[0] - req._startAt[0]) * 1e3\n    + (res._startAt[1] - req._startAt[1]) * 1e-6\n\n  // return truncated value\n  return ms.toFixed(digits === undefined ? 3 : digits)\n})\n\n/**\n * current date\n */\n\nmorgan.token('date', function getDateToken(req, res, format) {\n  var date = new Date()\n\n  switch (format || 'web') {\n    case 'clf':\n      return clfdate(date)\n    case 'iso':\n      return date.toISOString()\n    case 'web':\n      return date.toUTCString()\n  }\n});\n\n/**\n * response status code\n */\n\nmorgan.token('status', function getStatusToken(req, res) {\n  return res._header\n    ? String(res.statusCode)\n    : undefined\n})\n\n/**\n * normalized referrer\n */\n\nmorgan.token('referrer', function getReferrerToken(req) {\n  return req.headers['referer'] || req.headers['referrer'];\n});\n\n/**\n * remote address\n */\n\nmorgan.token('remote-addr', getip)\n\n/**\n * remote user\n */\n\nmorgan.token('remote-user', function getRemoteUserToken(req) {\n  // parse basic credentials\n  var credentials = auth(req)\n\n  // return username\n  return credentials\n    ? credentials.name\n    : undefined\n})\n\n/**\n * HTTP version\n */\n\nmorgan.token('http-version', function getHttpVersionToken(req) {\n  return req.httpVersionMajor + '.' + req.httpVersionMinor\n})\n\n/**\n * UA string\n */\n\nmorgan.token('user-agent', function getUserAgentToken(req) {\n  return req.headers['user-agent'];\n});\n\n/**\n * request header\n */\n\nmorgan.token('req', function getRequestToken(req, res, field) {\n  // get header\n  var header = req.headers[field.toLowerCase()]\n\n  return Array.isArray(header)\n    ? header.join(', ')\n    : header\n})\n\n/**\n * response header\n */\n\nmorgan.token('res', function getResponseTime(req, res, field) {\n  if (!res._header) {\n    return undefined\n  }\n\n  // get header\n  var header = res.getHeader(field)\n\n  return Array.isArray(header)\n    ? header.join(', ')\n    : header\n})\n\n/**\n * Format a Date in the common log format.\n *\n * @private\n * @param {Date} dateTime\n * @return {string}\n */\n\nfunction clfdate(dateTime) {\n  var date = dateTime.getUTCDate()\n  var hour = dateTime.getUTCHours()\n  var mins = dateTime.getUTCMinutes()\n  var secs = dateTime.getUTCSeconds()\n  var year = dateTime.getUTCFullYear()\n\n  var month = clfmonth[dateTime.getUTCMonth()]\n\n  return pad2(date) + '/' + month + '/' + year\n    + ':' + pad2(hour) + ':' + pad2(mins) + ':' + pad2(secs)\n    + ' +0000'\n}\n\n/**\n * Compile a format string into a function.\n *\n * @param {string} format\n * @return {function}\n * @public\n */\n\nfunction compile(format) {\n  if (typeof format !== 'string') {\n    throw new TypeError('argument format must be a string')\n  }\n\n  var fmt = format.replace(/\"/g, '\\\\\"')\n  var js = '  return \"' + fmt.replace(/:([-\\w]{2,})(?:\\[([^\\]]+)\\])?/g, function(_, name, arg) {\n    return '\"\\n    + (tokens[\"' + name + '\"](req, res, ' + String(JSON.stringify(arg)) + ') || \"-\") + \"'\n  }) + '\";'\n\n  return new Function('tokens, req, res', js)\n}\n\n/**\n * Create a basic buffering stream.\n *\n * @param {object} stream\n * @param {number} interval\n * @public\n */\n\nfunction createBufferStream(stream, interval) {\n  var buf = []\n  var timer = null\n\n  // flush function\n  function flush() {\n    timer = null\n    stream.write(buf.join(''))\n    buf.length = 0\n  }\n\n  // write function\n  function write(str) {\n    if (timer === null) {\n      timer = setTimeout(flush, interval)\n    }\n\n    buf.push(str)\n  }\n\n  // return a minimal \"stream\"\n  return { write: write }\n}\n\n/**\n * Define a format with the given name.\n *\n * @param {string} name\n * @param {string|function} fmt\n * @public\n */\n\nfunction format(name, fmt) {\n  morgan[name] = fmt\n  return this\n}\n\n/**\n * Lookup and compile a named format function.\n *\n * @param {string} name\n * @return {function}\n * @public\n */\n\nfunction getFormatFunction(name) {\n  // lookup format\n  var fmt = morgan[name] || name || morgan.default\n\n  // return compiled format\n  return typeof fmt !== 'function'\n    ? compile(fmt)\n    : fmt\n}\n\n/**\n * Get request IP address.\n *\n * @private\n * @param {IncomingMessage} req\n * @return {string}\n */\n\nfunction getip(req) {\n  return req.ip\n    || req._remoteAddress\n    || (req.connection && req.connection.remoteAddress)\n    || undefined;\n}\n\n/**\n * Pad number to two digits.\n *\n * @private\n * @param {number} num\n * @return {string}\n */\n\nfunction pad2(num) {\n  var str = String(num)\n\n  return (str.length === 1 ? '0' : '')\n    + str\n}\n\n/**\n * Record the start time.\n * @private\n */\n\nfunction recordStartTime() {\n  this._startAt = process.hrtime()\n  this._startTime = new Date()\n}\n\n/**\n * Define a token function with the given name,\n * and callback fn(req, res).\n *\n * @param {string} name\n * @param {function} fn\n * @public\n */\n\nfunction token(name, fn) {\n  morgan[name] = fn\n  return this\n}\n"]}