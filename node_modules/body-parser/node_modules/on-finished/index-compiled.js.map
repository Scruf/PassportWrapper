{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["/*!\n * on-finished\n * Copyright(c) 2013 Jonathan Ong\n * Copyright(c) 2014 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict'\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = onFinished\nmodule.exports.isFinished = isFinished\n\n/**\n * Module dependencies.\n * @private\n */\n\nvar first = require('ee-first')\n\n/**\n * Variables.\n * @private\n */\n\n/* istanbul ignore next */\nvar defer = typeof setImmediate === 'function'\n  ? setImmediate\n  : function(fn){ process.nextTick(fn.bind.apply(fn, arguments)) }\n\n/**\n * Invoke callback when the response has finished, useful for\n * cleaning up resources afterwards.\n *\n * @param {object} msg\n * @param {function} listener\n * @return {object}\n * @public\n */\n\nfunction onFinished(msg, listener) {\n  if (isFinished(msg) !== false) {\n    defer(listener, null, msg)\n    return msg\n  }\n\n  // attach the listener to the message\n  attachListener(msg, listener)\n\n  return msg\n}\n\n/**\n * Determine if message is already finished.\n *\n * @param {object} msg\n * @return {boolean}\n * @public\n */\n\nfunction isFinished(msg) {\n  var socket = msg.socket\n\n  if (typeof msg.finished === 'boolean') {\n    // OutgoingMessage\n    return Boolean(msg.finished || (socket && !socket.writable))\n  }\n\n  if (typeof msg.complete === 'boolean') {\n    // IncomingMessage\n    return Boolean(msg.upgrade || !socket || !socket.readable || (msg.complete && !msg.readable))\n  }\n\n  // don't know\n  return undefined\n}\n\n/**\n * Attach a finished listener to the message.\n *\n * @param {object} msg\n * @param {function} callback\n * @private\n */\n\nfunction attachFinishedListener(msg, callback) {\n  var eeMsg\n  var eeSocket\n  var finished = false\n\n  function onFinish(error) {\n    eeMsg.cancel()\n    eeSocket.cancel()\n\n    finished = true\n    callback(error)\n  }\n\n  // finished on first message event\n  eeMsg = eeSocket = first([[msg, 'end', 'finish']], onFinish)\n\n  function onSocket(socket) {\n    // remove listener\n    msg.removeListener('socket', onSocket)\n\n    if (finished) return\n    if (eeMsg !== eeSocket) return\n\n    // finished on first socket event\n    eeSocket = first([[socket, 'error', 'close']], onFinish)\n  }\n\n  if (msg.socket) {\n    // socket already assigned\n    onSocket(msg.socket)\n    return\n  }\n\n  // wait for socket to be assigned\n  msg.on('socket', onSocket)\n\n  if (msg.socket === undefined) {\n    // node.js 0.8 patch\n    patchAssignSocket(msg, onSocket)\n  }\n}\n\n/**\n * Attach the listener to the message.\n *\n * @param {object} msg\n * @return {function}\n * @private\n */\n\nfunction attachListener(msg, listener) {\n  var attached = msg.__onFinished\n\n  // create a private single listener with queue\n  if (!attached || !attached.queue) {\n    attached = msg.__onFinished = createListener(msg)\n    attachFinishedListener(msg, attached)\n  }\n\n  attached.queue.push(listener)\n}\n\n/**\n * Create listener on message.\n *\n * @param {object} msg\n * @return {function}\n * @private\n */\n\nfunction createListener(msg) {\n  function listener(err) {\n    if (msg.__onFinished === listener) msg.__onFinished = null\n    if (!listener.queue) return\n\n    var queue = listener.queue\n    listener.queue = null\n\n    for (var i = 0; i < queue.length; i++) {\n      queue[i](err, msg)\n    }\n  }\n\n  listener.queue = []\n\n  return listener\n}\n\n/**\n * Patch ServerResponse.prototype.assignSocket for node.js 0.8.\n *\n * @param {ServerResponse} res\n * @param {function} callback\n * @private\n */\n\nfunction patchAssignSocket(res, callback) {\n  var assignSocket = res.assignSocket\n\n  if (typeof assignSocket !== 'function') return\n\n  // res.on('socket', callback) is broken in 0.8\n  res.assignSocket = function _assignSocket(socket) {\n    assignSocket.call(this, socket)\n    callback(socket)\n  }\n}\n"]}