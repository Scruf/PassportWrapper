{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["/*!\n * raw-body\n * Copyright(c) 2013-2014 Jonathan Ong\n * Copyright(c) 2014-2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict'\n\n/**\n * Module dependencies.\n * @private\n */\n\nvar bytes = require('bytes')\nvar iconv = require('iconv-lite')\nvar unpipe = require('unpipe')\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = getRawBody\n\n/**\n * Module variables.\n * @private\n */\n\nvar iconvEncodingMessageRegExp = /^Encoding not recognized: /\n\n/**\n * Get the decoder for a given encoding.\n *\n * @param {string} encoding\n * @private\n */\n\nfunction getDecoder(encoding) {\n  if (!encoding) return null\n\n  try {\n    return iconv.getDecoder(encoding)\n  } catch (e) {\n    // error getting decoder\n    if (!iconvEncodingMessageRegExp.test(e.message)) throw e\n\n    // the encoding was not found\n    throw createError(415, 'specified encoding unsupported', 'encoding.unsupported', {\n      encoding: encoding\n    })\n  }\n}\n\n/**\n * Get the raw body of a stream (typically HTTP).\n *\n * @param {object} stream\n * @param {object|string|function} [options]\n * @param {function} [callback]\n * @public\n */\n\nfunction getRawBody(stream, options, callback) {\n  var done = callback\n  var opts = options || {}\n\n  if (options === true || typeof options === 'string') {\n    // short cut for encoding\n    opts = {\n      encoding: options\n    }\n  }\n\n  if (typeof options === 'function') {\n    done = options\n    opts = {}\n  }\n\n  // validate callback is a function, if provided\n  if (done !== undefined && typeof done !== 'function') {\n    throw new TypeError('argument callback must be a function')\n  }\n\n  // require the callback without promises\n  if (!done && !global.Promise) {\n    throw new TypeError('argument callback is required')\n  }\n\n  // get encoding\n  var encoding = opts.encoding !== true\n    ? opts.encoding\n    : 'utf-8'\n\n  // convert the limit to an integer\n  var limit = bytes.parse(opts.limit)\n\n  // convert the expected length to an integer\n  var length = opts.length != null && !isNaN(opts.length)\n    ? parseInt(opts.length, 10)\n    : null\n\n  if (done) {\n    // classic callback style\n    return readStream(stream, encoding, length, limit, done)\n  }\n\n  return new Promise(function executor(resolve, reject) {\n    readStream(stream, encoding, length, limit, function onRead(err, buf) {\n      if (err) return reject(err)\n      resolve(buf)\n    })\n  })\n}\n\n/**\n * Halt a stream.\n *\n * @param {Object} stream\n * @private\n */\n\nfunction halt(stream) {\n  // unpipe everything from the stream\n  unpipe(stream)\n\n  // pause stream\n  if (typeof stream.pause === 'function') {\n    stream.pause()\n  }\n}\n\n/**\n * Make a serializable error object.\n *\n * To create serializable errors you must re-set message so\n * that it is enumerable and you must re configure the type\n * property so that is writable and enumerable.\n *\n * @param {number} status\n * @param {string} message\n * @param {string} type\n * @param {object} props\n * @private\n */\n\nfunction createError(status, message, type, props) {\n  var error = new Error()\n\n  // capture stack trace\n  Error.captureStackTrace(error, createError)\n\n  // set free-form properties\n  for (var prop in props) {\n    error[prop] = props[prop]\n  }\n\n  // set message\n  error.message = message\n\n  // set status\n  error.status = status\n  error.statusCode = status\n\n  // set type\n  Object.defineProperty(error, 'type', {\n    value: type,\n    enumerable: true,\n    writable: true,\n    configurable: true\n  })\n\n  return error\n}\n\n/**\n * Read the data from the stream.\n *\n * @param {object} stream\n * @param {string} encoding\n * @param {number} length\n * @param {number} limit\n * @param {function} callback\n * @public\n */\n\nfunction readStream(stream, encoding, length, limit, callback) {\n  var complete = false\n  var sync = true\n\n  // check the length and limit options.\n  // note: we intentionally leave the stream paused,\n  // so users should handle the stream themselves.\n  if (limit !== null && length !== null && length > limit) {\n    return done(createError(413, 'request entity too large', 'entity.too.large', {\n      expected: length,\n      length: length,\n      limit: limit\n    }))\n  }\n\n  // streams1: assert request encoding is buffer.\n  // streams2+: assert the stream encoding is buffer.\n  //   stream._decoder: streams1\n  //   state.encoding: streams2\n  //   state.decoder: streams2, specifically < 0.10.6\n  var state = stream._readableState\n  if (stream._decoder || (state && (state.encoding || state.decoder))) {\n    // developer error\n    return done(createError(500, 'stream encoding should not be set', 'stream.encoding.set'))\n  }\n\n  var received = 0\n  var decoder\n\n  try {\n    decoder = getDecoder(encoding)\n  } catch (err) {\n    return done(err)\n  }\n\n  var buffer = decoder\n    ? ''\n    : []\n\n  // attach listeners\n  stream.on('aborted', onAborted)\n  stream.on('close', cleanup)\n  stream.on('data', onData)\n  stream.on('end', onEnd)\n  stream.on('error', onEnd)\n\n  // mark sync section complete\n  sync = false\n\n  function done() {\n    var args = new Array(arguments.length)\n\n    // copy arguments\n    for (var i = 0; i < args.length; i++) {\n      args[i] = arguments[i]\n    }\n\n    // mark complete\n    complete = true\n\n    if (sync) {\n      process.nextTick(invokeCallback)\n    } else {\n      invokeCallback()\n    }\n\n    function invokeCallback() {\n      cleanup()\n\n      if (args[0]) {\n        // halt the stream on error\n        halt(stream)\n      }\n\n      callback.apply(null, args)\n    }\n  }\n\n  function onAborted() {\n    if (complete) return\n\n    done(createError(400, 'request aborted', 'request.aborted', {\n      code: 'ECONNABORTED',\n      expected: length,\n      length: length,\n      received: received\n    }))\n  }\n\n  function onData(chunk) {\n    if (complete) return\n\n    received += chunk.length\n    decoder\n      ? buffer += decoder.write(chunk)\n      : buffer.push(chunk)\n\n    if (limit !== null && received > limit) {\n      done(createError(413, 'request entity too large', 'entity.too.large', {\n        limit: limit,\n        received: received\n      }))\n    }\n  }\n\n  function onEnd(err) {\n    if (complete) return\n    if (err) return done(err)\n\n    if (length !== null && received !== length) {\n      done(createError(400, 'request size did not match content length', 'request.size.invalid', {\n        expected: length,\n        length: length,\n        received: received\n      }))\n    } else {\n      var string = decoder\n        ? buffer + (decoder.end() || '')\n        : Buffer.concat(buffer)\n      cleanup()\n      done(null, string)\n    }\n  }\n\n  function cleanup() {\n    buffer = null\n\n    stream.removeListener('aborted', onAborted)\n    stream.removeListener('data', onData)\n    stream.removeListener('end', onEnd)\n    stream.removeListener('error', onEnd)\n    stream.removeListener('close', cleanup)\n  }\n}\n"]}