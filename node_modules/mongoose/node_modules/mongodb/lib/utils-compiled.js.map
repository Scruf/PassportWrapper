{"version":3,"sources":["utils.js"],"names":[],"mappings":"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","file":"utils-compiled.js","sourcesContent":["\"use strict\";\n\nvar MongoError = require('mongodb-core').MongoError,\n  f = require('util').format;\n\nvar shallowClone = function(obj) {\n  var copy = {};\n  for(var name in obj) copy[name] = obj[name];\n  return copy;\n}\n\n// Set simple property\nvar getSingleProperty = function(obj, name, value) {\n  Object.defineProperty(obj, name, {\n    enumerable:true,\n    get: function() {\n      return value\n    }\n  });\n}\n\nvar formatSortValue = exports.formatSortValue = function(sortDirection) {\n  var value = (\"\" + sortDirection).toLowerCase();\n\n  switch (value) {\n    case 'ascending':\n    case 'asc':\n    case '1':\n      return 1;\n    case 'descending':\n    case 'desc':\n    case '-1':\n      return -1;\n    default:\n      throw new Error(\"Illegal sort clause, must be of the form \"\n                    + \"[['field1', '(ascending|descending)'], \"\n                    + \"['field2', '(ascending|descending)']]\");\n  }\n};\n\nvar formattedOrderClause = exports.formattedOrderClause = function(sortValue) {\n  var orderBy = {};\n  if(sortValue == null) return null;\n  if (Array.isArray(sortValue)) {\n    if(sortValue.length === 0) {\n      return null;\n    }\n\n    for(var i = 0; i < sortValue.length; i++) {\n      if(sortValue[i].constructor == String) {\n        orderBy[sortValue[i]] = 1;\n      } else {\n        orderBy[sortValue[i][0]] = formatSortValue(sortValue[i][1]);\n      }\n    }\n  } else if(sortValue != null && typeof sortValue == 'object') {\n    orderBy = sortValue;\n  } else if (typeof sortValue == 'string') {\n    orderBy[sortValue] = 1;\n  } else {\n    throw new Error(\"Illegal sort clause, must be of the form \" +\n      \"[['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]\");\n  }\n\n  return orderBy;\n};\n\nvar checkCollectionName = function checkCollectionName (collectionName) {\n  if('string' !== typeof collectionName) {\n    throw Error(\"collection name must be a String\");\n  }\n\n  if(!collectionName || collectionName.indexOf('..') != -1) {\n    throw Error(\"collection names cannot be empty\");\n  }\n\n  if(collectionName.indexOf('$') != -1 &&\n      collectionName.match(/((^\\$cmd)|(oplog\\.\\$main))/) == null) {\n    throw Error(\"collection names must not contain '$'\");\n  }\n\n  if(collectionName.match(/^\\.|\\.$/) != null) {\n    throw Error(\"collection names must not start or end with '.'\");\n  }\n\n  // Validate that we are not passing 0x00 in the colletion name\n  if(!!~collectionName.indexOf(\"\\x00\")) {\n    throw new Error(\"collection names cannot contain a null character\");\n  }\n};\n\nvar handleCallback = function(callback, err, value1, value2) {\n  try {\n    if(callback == null) return;\n    if(value2) return callback(err, value1, value2);\n    return callback(err, value1);\n  } catch(err) {\n    process.nextTick(function() { throw err; });\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Wrap a Mongo error document in an Error instance\n * @ignore\n * @api private\n */\nvar toError = function(error) {\n  if (error instanceof Error) return error;\n\n  var msg = error.err || error.errmsg || error.errMessage || error;\n  var e = MongoError.create({message: msg, driver:true});\n\n  // Get all object keys\n  var keys = typeof error == 'object'\n    ? Object.keys(error)\n    : [];\n\n  for(var i = 0; i < keys.length; i++) {\n    try {\n      e[keys[i]] = error[keys[i]];\n    } catch(err) {\n      // continue\n    }\n  }\n\n  return e;\n}\n\n/**\n * @ignore\n */\nvar normalizeHintField = function normalizeHintField(hint) {\n  var finalHint = null;\n\n  if(typeof hint == 'string') {\n    finalHint = hint;\n  } else if(Array.isArray(hint)) {\n    finalHint = {};\n\n    hint.forEach(function(param) {\n      finalHint[param] = 1;\n    });\n  } else if(hint != null && typeof hint == 'object') {\n    finalHint = {};\n    for (var name in hint) {\n      finalHint[name] = hint[name];\n    }\n  }\n\n  return finalHint;\n};\n\n/**\n * Create index name based on field spec\n *\n * @ignore\n * @api private\n */\nvar parseIndexOptions = function(fieldOrSpec) {\n  var fieldHash = {};\n  var indexes = [];\n  var keys;\n\n  // Get all the fields accordingly\n  if('string' == typeof fieldOrSpec) {\n    // 'type'\n    indexes.push(fieldOrSpec + '_' + 1);\n    fieldHash[fieldOrSpec] = 1;\n  } else if(Array.isArray(fieldOrSpec)) {\n    fieldOrSpec.forEach(function(f) {\n      if('string' == typeof f) {\n        // [{location:'2d'}, 'type']\n        indexes.push(f + '_' + 1);\n        fieldHash[f] = 1;\n      } else if(Array.isArray(f)) {\n        // [['location', '2d'],['type', 1]]\n        indexes.push(f[0] + '_' + (f[1] || 1));\n        fieldHash[f[0]] = f[1] || 1;\n      } else if(isObject(f)) {\n        // [{location:'2d'}, {type:1}]\n        keys = Object.keys(f);\n        keys.forEach(function(k) {\n          indexes.push(k + '_' + f[k]);\n          fieldHash[k] = f[k];\n        });\n      } else {\n        // undefined (ignore)\n      }\n    });\n  } else if(isObject(fieldOrSpec)) {\n    // {location:'2d', type:1}\n    keys = Object.keys(fieldOrSpec);\n    keys.forEach(function(key) {\n      indexes.push(key + '_' + fieldOrSpec[key]);\n      fieldHash[key] = fieldOrSpec[key];\n    });\n  }\n\n  return {\n    name: indexes.join(\"_\"), keys: keys, fieldHash: fieldHash\n  }\n}\n\nvar isObject = exports.isObject = function (arg) {\n  return '[object Object]' == toString.call(arg)\n}\n\nvar debugOptions = function(debugFields, options) {\n  var finaloptions = {};\n  debugFields.forEach(function(n) {\n    finaloptions[n] = options[n];\n  });\n\n  return finaloptions;\n}\n\nvar decorateCommand = function(command, options, exclude) {\n  for(var name in options) {\n    if(exclude[name] == null) command[name] = options[name];\n  }\n\n  return command;\n}\n\nexports.shallowClone = shallowClone;\nexports.getSingleProperty = getSingleProperty;\nexports.checkCollectionName = checkCollectionName;\nexports.toError = toError;\nexports.formattedOrderClause = formattedOrderClause;\nexports.parseIndexOptions = parseIndexOptions;\nexports.normalizeHintField = normalizeHintField;\nexports.handleCallback = handleCallback;\nexports.decorateCommand = decorateCommand;\nexports.isObject = isObject;\nexports.debugOptions = debugOptions;\nexports.MAX_JS_INT = 0x20000000000000;\n"]}