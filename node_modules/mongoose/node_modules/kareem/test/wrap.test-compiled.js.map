{"version":3,"sources":["wrap.test.js"],"names":[],"mappings":"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","file":"wrap.test-compiled.js","sourcesContent":["var assert = require('assert');\nvar Kareem = require('../');\n\ndescribe('wrap()', function() {\n  var hooks;\n\n  beforeEach(function() {\n    hooks = new Kareem();\n  });\n\n  it('handles pre errors', function(done) {\n    hooks.pre('cook', function(done) {\n      done('error!');\n    });\n\n    hooks.post('cook', function(obj) {\n      obj.tofu = 'no';\n    });\n\n    var obj = { bacon: 0, eggs: 0 };\n\n    var args = [obj];\n    args.push(function(error, result) {\n      assert.equal('error!', error);\n      assert.ok(!result);\n      assert.equal(undefined, obj.tofu);\n      done();\n    });\n\n    hooks.wrap(\n      'cook',\n      function(o, callback) {\n        // Should never get called\n        assert.ok(false);\n        callback(null, o);\n      },\n      obj,\n      args);\n  });\n\n  it('handles pre errors when no callback defined', function(done) {\n    hooks.pre('cook', function(done) {\n      done('error!');\n    });\n\n    hooks.post('cook', function(obj) {\n      obj.tofu = 'no';\n    });\n\n    var obj = { bacon: 0, eggs: 0 };\n\n    var args = [obj];\n\n    hooks.wrap(\n      'cook',\n      function(o, callback) {\n        // Should never get called\n        assert.ok(false);\n        callback(null, o);\n      },\n      obj,\n      args);\n\n    setTimeout(\n      function() {\n        done();\n      },\n      25);\n  });\n\n  it('handles errors in wrapped function', function(done) {\n    hooks.pre('cook', function(done) {\n      done();\n    });\n\n    hooks.post('cook', function(obj) {\n      obj.tofu = 'no';\n    });\n\n    var obj = { bacon: 0, eggs: 0 };\n\n    var args = [obj];\n    args.push(function(error, result) {\n      assert.equal('error!', error);\n      assert.ok(!result);\n      assert.equal(undefined, obj.tofu);\n      done();\n    });\n\n    hooks.wrap(\n      'cook',\n      function(o, callback) {\n        callback('error!');\n      },\n      obj,\n      args);\n  });\n\n  it('handles errors in post', function(done) {\n    hooks.pre('cook', function(done) {\n      done();\n    });\n\n    hooks.post('cook', function(obj, callback) {\n      obj.tofu = 'no';\n      callback('error!');\n    });\n\n    var obj = { bacon: 0, eggs: 0 };\n\n    var args = [obj];\n    args.push(function(error, result) {\n      assert.equal('error!', error);\n      assert.ok(!result);\n      assert.equal('no', obj.tofu);\n      done();\n    });\n\n    hooks.wrap(\n      'cook',\n      function(o, callback) {\n        callback(null, o);\n      },\n      obj,\n      args);\n  });\n\n  it('works with no args', function(done) {\n    hooks.pre('cook', function(done) {\n      done();\n    });\n\n    hooks.post('cook', function(callback) {\n      obj.tofu = 'no';\n      callback();\n    });\n\n    var obj = { bacon: 0, eggs: 0 };\n\n    var args = [];\n\n    hooks.wrap(\n      'cook',\n      function(callback) {\n        callback(null);\n      },\n      obj,\n      args);\n\n    setTimeout(\n      function() {\n        assert.equal('no', obj.tofu);\n        done();\n      },\n      25);\n  });\n\n  it('handles pre errors with no args', function(done) {\n    hooks.pre('cook', function(done) {\n      done('error!');\n    });\n\n    hooks.post('cook', function(callback) {\n      obj.tofu = 'no';\n      callback();\n    });\n\n    var obj = { bacon: 0, eggs: 0 };\n\n    var args = [];\n\n    hooks.wrap(\n      'cook',\n      function(callback) {\n        callback(null);\n      },\n      obj,\n      args);\n\n    setTimeout(\n      function() {\n        assert.equal(undefined, obj.tofu);\n        done();\n      },\n      25);\n  });\n\n  it('handles wrapped function errors with no args', function(done) {\n    hooks.pre('cook', function(done) {\n      obj.waffles = false;\n      done();\n    });\n\n    hooks.post('cook', function(callback) {\n      obj.tofu = 'no';\n      callback();\n    });\n\n    var obj = { bacon: 0, eggs: 0 };\n\n    var args = [];\n\n    hooks.wrap(\n      'cook',\n      function(callback) {\n        callback('error!');\n      },\n      obj,\n      args);\n\n    setTimeout(\n      function() {\n        assert.equal(false, obj.waffles);\n        assert.equal(undefined, obj.tofu);\n        done();\n      },\n      25);\n  });\n\n  it('handles post errors with no args', function(done) {\n    hooks.pre('cook', function(done) {\n      obj.waffles = false;\n      done();\n    });\n\n    hooks.post('cook', function(callback) {\n      obj.tofu = 'no';\n      callback('error!');\n    });\n\n    var obj = { bacon: 0, eggs: 0 };\n\n    var args = [];\n\n    hooks.wrap(\n      'cook',\n      function(callback) {\n        callback();\n      },\n      obj,\n      args);\n\n    setTimeout(\n      function() {\n        assert.equal(false, obj.waffles);\n        assert.equal('no', obj.tofu);\n        done();\n      },\n      25);\n  });\n\n  it('can use legacy post behavior', function(done) {\n    var called = 0;\n    hooks.post('cook', function(callback) {\n      ++called;\n      callback();\n    });\n\n    var args = [function(error) {\n      assert.equal(called, 0);\n\n      setTimeout(function() {\n        assert.equal(called, 1);\n        done();\n      }, 0);\n    }];\n\n    hooks.wrap(\n      'cook',\n      function(callback) {\n        callback();\n      },\n      null,\n      args,\n      true);\n  });\n});"]}