{"version":3,"sources":["index.js"],"names":[],"mappings":"AAAA;;AAEA,SAAS,MAAT,GAAkB;AAChB,OAAK,KAAL,GAAa,EAAb,CADgB;AAEhB,OAAK,MAAL,GAAc,EAAd,CAFgB;CAAlB;;AAKA,OAAO,SAAP,CAAiB,OAAjB,GAA2B,UAAS,IAAT,EAAe,OAAf,EAAwB,QAAxB,EAAkC;AAC3D,MAAI,OAAO,KAAK,KAAL,CAAW,IAAX,KAAoB,EAApB,CADgD;AAE3D,MAAI,UAAU,KAAK,MAAL,CAF6C;AAG3D,MAAI,eAAe,KAAK,QAAL,IAAiB,CAAjB,CAHwC;AAI3D,MAAI,aAAa,CAAb,CAJuD;AAK3D,MAAI,gBAAgB,YAAhB,CALuD;AAM3D,MAAI,OAAO,KAAP,CANuD;;AAQ3D,MAAI,CAAC,OAAD,EAAU;AACZ,WAAO,QAAQ,QAAR,CAAiB,YAAW;AACjC,eAAS,IAAT,EADiC;KAAX,CAAxB,CADY;GAAd;;AAMA,MAAI,OAAO,YAAW;AACpB,QAAI,cAAc,OAAd,EAAuB;AACzB,aADyB;KAA3B;AAGA,QAAI,MAAM,KAAK,UAAL,CAAN,CAJgB;;AAMpB,QAAI,IAAI,OAAJ,EAAa;AACf,UAAI,EAAJ,CAAO,IAAP,CACE,OADF,EAEE,UAAS,KAAT,EAAgB;AACd,YAAI,KAAJ,EAAW;AACT,cAAI,IAAJ,EAAU;AACR,mBADQ;WAAV;AAGA,iBAAO,IAAP,CAJS;AAKT,iBAAO,SAAS,KAAT,CAAP,CALS;SAAX;;AAQA,UAAE,UAAF,CATc;AAUd,aAAK,KAAL,CAAW,OAAX,EAAoB,SAApB,EAVc;OAAhB,EAYA,UAAS,KAAT,EAAgB;AACd,YAAI,KAAJ,EAAW;AACT,cAAI,IAAJ,EAAU;AACR,mBADQ;WAAV;AAGA,iBAAO,IAAP,CAJS;AAKT,iBAAO,SAAS,KAAT,CAAP,CALS;SAAX;;AAQA,YAAI,EAAE,YAAF,KAAmB,CAAnB,EAAsB;AACxB,iBAAO,SAAS,IAAT,CAAP,CADwB;SAA1B;OATF,CAdF,CADe;KAAjB,MA4BO,IAAI,IAAI,EAAJ,CAAO,MAAP,GAAgB,CAAhB,EAAmB;AAC5B,UAAI,OAAO,CAAC,UAAS,KAAT,EAAgB;AAC1B,YAAI,KAAJ,EAAW;AACT,cAAI,IAAJ,EAAU;AACR,mBADQ;WAAV;AAGA,iBAAO,IAAP,CAJS;AAKT,iBAAO,SAAS,KAAT,CAAP,CALS;SAAX;;AAQA,YAAI,EAAE,UAAF,IAAgB,OAAhB,EAAyB;AAC3B,cAAI,gBAAgB,CAAhB,EAAmB;;AAErB,mBAFqB;WAAvB,MAGO;AACL,mBAAO,SAAS,IAAT,CAAP,CADK;WAHP;SADF;;AASA,aAAK,KAAL,CAAW,OAAX,EAAoB,SAApB,EAlB0B;OAAhB,CAAR,CADwB;AAqB5B,UAAI,UAAU,MAAV,IAAoB,CAApB,EAAuB;AACzB,aAAK,IAAI,IAAI,CAAJ,EAAO,IAAI,UAAU,MAAV,EAAkB,EAAE,CAAF,EAAK;AACzC,eAAK,IAAL,CAAU,UAAU,CAAV,CAAV,EADyC;SAA3C;OADF;AAKA,UAAI,EAAJ,CAAO,KAAP,CAAa,OAAb,EAAsB,IAAtB,EA1B4B;KAAvB,MA2BA;AACL,UAAI,EAAJ,CAAO,IAAP,CAAY,OAAZ,EADK;AAEL,UAAI,EAAE,UAAF,IAAgB,OAAhB,EAAyB;AAC3B,YAAI,gBAAgB,CAAhB,EAAmB;;AAErB,iBAFqB;SAAvB,MAGO;AACL,iBAAO,QAAQ,QAAR,CAAiB,YAAW;AACjC,qBAAS,IAAT,EADiC;WAAX,CAAxB,CADK;SAHP;OADF;AAUA,aAZK;KA3BA;GAlCE,CAdgD;;AA2F3D,SA3F2D;CAAlC;;AA8F3B,OAAO,SAAP,CAAiB,QAAjB,GAA4B,UAAS,IAAT,EAAe,OAAf,EAAwB,IAAxB,EAA8B,QAA9B,EAAwC;AAClE,MAAI,QAAQ,KAAK,MAAL,CAAY,IAAZ,KAAqB,EAArB,CADsD;AAElE,MAAI,WAAW,MAAM,MAAN,CAFmD;AAGlE,MAAI,cAAc,CAAd,CAH8D;;AAKlE,MAAI,CAAC,QAAD,EAAW;AACb,WAAO,QAAQ,QAAR,CAAiB,YAAW;AACjC,eAAS,KAAT,CAAe,IAAf,EAAqB,CAAC,IAAD,EAAO,MAAP,CAAc,IAAd,CAArB,EADiC;KAAX,CAAxB,CADa;GAAf;;AAMA,MAAI,OAAO,YAAW;AACpB,QAAI,OAAO,MAAM,WAAN,CAAP,CADgB;;AAGpB,QAAI,KAAK,MAAL,GAAc,KAAK,MAAL,EAAa;AAC7B,WAAK,KAAL,CAAW,OAAX,EAAoB,KAAK,MAAL,CAAY,UAAS,KAAT,EAAgB;AAC9C,YAAI,KAAJ,EAAW;AACT,iBAAO,SAAS,KAAT,CAAP,CADS;SAAX;;AAIA,YAAI,EAAE,WAAF,IAAiB,QAAjB,EAA2B;AAC7B,iBAAO,SAAS,KAAT,CAAe,IAAf,EAAqB,CAAC,IAAD,EAAO,MAAP,CAAc,IAAd,CAArB,CAAP,CAD6B;SAA/B;;AAIA,eAT8C;OAAhB,CAAhC,EAD6B;KAA/B,MAYO;AACL,WAAK,KAAL,CAAW,OAAX,EAAoB,IAApB,EADK;;AAGL,UAAI,EAAE,WAAF,IAAiB,QAAjB,EAA2B;AAC7B,eAAO,SAAS,KAAT,CAAe,IAAf,EAAqB,CAAC,IAAD,EAAO,MAAP,CAAc,IAAd,CAArB,CAAP,CAD6B;OAA/B;;AAIA,aAPK;KAZP;GAHS,CAXuD;;AAqClE,SArCkE;CAAxC;;AAwC5B,OAAO,SAAP,CAAiB,IAAjB,GAAwB,UAAS,IAAT,EAAe,EAAf,EAAmB,OAAnB,EAA4B,IAA5B,EAAkC,aAAlC,EAAiD;AACvE,MAAI,UAAW,KAAK,MAAL,GAAc,CAAd,GAAkB,KAAK,KAAK,MAAL,GAAc,CAAd,CAAvB,GAA0C,IAA1C,CADwD;AAEvE,MAAI,QAAQ,IAAR,CAFmE;;AAIvE,OAAK,OAAL,CAAa,IAAb,EAAmB,OAAnB,EAA4B,UAAS,KAAT,EAAgB;AAC1C,QAAI,KAAJ,EAAW;AACT,UAAI,OAAO,OAAP,KAAmB,UAAnB,EAA+B;AACjC,eAAO,QAAQ,KAAR,CAAP,CADiC;OAAnC;AAGA,aAJS;KAAX;;AAOA,QAAI,MAAO,OAAO,OAAP,KAAmB,UAAnB,GAAgC,KAAK,MAAL,GAAc,CAAd,GAAkB,KAAK,MAAL,CARnB;;AAU1C,OAAG,KAAH,CAAS,OAAT,EAAkB,KAAK,KAAL,CAAW,CAAX,EAAc,GAAd,EAAmB,MAAnB,CAA0B,YAAW;AACrD,UAAI,UAAU,CAAV,CAAJ,EAAkB;;AAEhB,eAAO,OAAO,OAAP,KAAmB,UAAnB,GACL,QAAQ,UAAU,CAAV,CAAR,CADK,GAEL,SAFK,CAFS;OAAlB;;AAOA,UAAI,iBAAiB,OAAO,OAAP,KAAmB,UAAnB,EAA+B;AAClD,gBAAQ,KAAR,CAAc,OAAd,EAAuB,SAAvB,EADkD;OAApD;;AAIA,UAAI,mBAAmB,MAAM,SAAN,CAAgB,KAAhB,CAAsB,IAAtB,CAA2B,SAA3B,EAAsC,CAAtC,CAAnB,CAZiD;AAarD,YAAM,QAAN,CAAe,IAAf,EAAqB,OAArB,EAA8B,gBAA9B,EAAgD,YAAW;AACzD,YAAI,UAAU,CAAV,CAAJ,EAAkB;AAChB,iBAAO,OAAO,OAAP,KAAmB,UAAnB,GACL,QAAQ,UAAU,CAAV,CAAR,CADK,GAEL,SAFK,CADS;SAAlB;;AAMA,eAAO,OAAO,OAAP,KAAmB,UAAnB,IAAiC,CAAC,aAAD,GACtC,QAAQ,KAAR,CAAc,OAAd,EAAuB,SAAvB,CADK,GAEL,SAFK,CAPkD;OAAX,CAAhD,CAbqD;KAAX,CAA5C,EAV0C;GAAhB,CAA5B,CAJuE;CAAjD;;AA0CxB,OAAO,SAAP,CAAiB,aAAjB,GAAiC,UAAS,IAAT,EAAe,EAAf,EAAmB,OAAnB,EAA4B;AAC3D,MAAI,QAAQ,IAAR,CADuD;AAE3D,SAAO,YAAW;AAChB,QAAI,OAAO,MAAM,SAAN,CAAgB,KAAhB,CAAsB,IAAtB,CAA2B,SAA3B,CAAP,CADY;AAEhB,UAAM,IAAN,CAAW,IAAX,EAAiB,EAAjB,EAAqB,OAArB,EAA8B,IAA9B,EAFgB;GAAX,CAFoD;CAA5B;;AAQjC,OAAO,SAAP,CAAiB,GAAjB,GAAuB,UAAS,IAAT,EAAe,OAAf,EAAwB,EAAxB,EAA4B,KAA5B,EAAmC;AACxD,MAAI,OAAO,UAAU,CAAV,CAAP,KAAwB,SAAxB,EAAmC;AACrC,YAAQ,EAAR,CADqC;AAErC,SAAK,OAAL,CAFqC;AAGrC,cAAU,KAAV,CAHqC;GAAvC;;AAMA,OAAK,KAAL,CAAW,IAAX,IAAmB,KAAK,KAAL,CAAW,IAAX,KAAoB,EAApB,CAPqC;AAQxD,MAAI,OAAO,KAAK,KAAL,CAAW,IAAX,CAAP,CARoD;;AAUxD,MAAI,OAAJ,EAAa;AACX,SAAK,QAAL,GAAgB,KAAK,QAAL,IAAiB,CAAjB,CADL;AAEX,MAAE,KAAK,QAAL,CAFS;GAAb;;AAKA,OAAK,IAAL,CAAU,EAAE,IAAI,EAAJ,EAAQ,SAAS,OAAT,EAApB,EAfwD;;AAiBxD,SAAO,IAAP,CAjBwD;CAAnC;;AAoBvB,OAAO,SAAP,CAAiB,IAAjB,GAAwB,UAAS,IAAT,EAAe,EAAf,EAAmB;AACzC,GAAC,KAAK,MAAL,CAAY,IAAZ,IAAoB,KAAK,MAAL,CAAY,IAAZ,KAAqB,EAArB,CAArB,CAA8C,IAA9C,CAAmD,EAAnD,EADyC;AAEzC,SAAO,IAAP,CAFyC;CAAnB;;AAKxB,OAAO,SAAP,CAAiB,KAAjB,GAAyB,YAAW;AAClC,MAAI,IAAI,IAAI,MAAJ,EAAJ,CAD8B;AAElC,OAAK,IAAI,GAAJ,IAAW,KAAK,KAAL,EAAY;AAC1B,MAAE,KAAF,CAAQ,GAAR,IAAe,KAAK,KAAL,CAAW,GAAX,EAAgB,KAAhB,EAAf,CAD0B;GAA5B;AAGA,OAAK,IAAI,GAAJ,IAAW,KAAK,MAAL,EAAa;AAC3B,MAAE,MAAF,CAAS,GAAT,IAAgB,KAAK,MAAL,CAAY,GAAZ,EAAiB,KAAjB,EAAhB,CAD2B;GAA7B;;AAIA,SAAO,CAAP,CATkC;CAAX;;AAYzB,OAAO,OAAP,GAAiB,MAAjB","file":"index-compiled.js","sourcesContent":["'use strict';\n\nfunction Kareem() {\n  this._pres = {};\n  this._posts = {};\n}\n\nKareem.prototype.execPre = function(name, context, callback) {\n  var pres = this._pres[name] || [];\n  var numPres = pres.length;\n  var numAsyncPres = pres.numAsync || 0;\n  var currentPre = 0;\n  var asyncPresLeft = numAsyncPres;\n  var done = false;\n\n  if (!numPres) {\n    return process.nextTick(function() {\n      callback(null);\n    });\n  }\n\n  var next = function() {\n    if (currentPre >= numPres) {\n      return;\n    }\n    var pre = pres[currentPre];\n\n    if (pre.isAsync) {\n      pre.fn.call(\n        context,\n        function(error) {\n          if (error) {\n            if (done) {\n              return;\n            }\n            done = true;\n            return callback(error);\n          }\n\n          ++currentPre;\n          next.apply(context, arguments);\n        },\n        function(error) {\n          if (error) {\n            if (done) {\n              return;\n            }\n            done = true;\n            return callback(error);\n          }\n\n          if (--numAsyncPres === 0) {\n            return callback(null);\n          }\n        });\n    } else if (pre.fn.length > 0) {\n      var args = [function(error) {\n        if (error) {\n          if (done) {\n            return;\n          }\n          done = true;\n          return callback(error);\n        }\n\n        if (++currentPre >= numPres) {\n          if (asyncPresLeft > 0) {\n            // Leave parallel hooks to run\n            return;\n          } else {\n            return callback(null);\n          }\n        }\n\n        next.apply(context, arguments);\n      }];\n      if (arguments.length >= 2) {\n        for (var i = 1; i < arguments.length; ++i) {\n          args.push(arguments[i]);\n        }\n      }\n      pre.fn.apply(context, args);\n    } else {\n      pre.fn.call(context);\n      if (++currentPre >= numPres) {\n        if (asyncPresLeft > 0) {\n          // Leave parallel hooks to run\n          return;\n        } else {\n          return process.nextTick(function() {\n            callback(null);\n          });\n        }\n      }\n      next();\n    }\n  };\n\n  next();\n};\n\nKareem.prototype.execPost = function(name, context, args, callback) {\n  var posts = this._posts[name] || [];\n  var numPosts = posts.length;\n  var currentPost = 0;\n\n  if (!numPosts) {\n    return process.nextTick(function() {\n      callback.apply(null, [null].concat(args));\n    });\n  }\n\n  var next = function() {\n    var post = posts[currentPost];\n\n    if (post.length > args.length) {\n      post.apply(context, args.concat(function(error) {\n        if (error) {\n          return callback(error);\n        }\n\n        if (++currentPost >= numPosts) {\n          return callback.apply(null, [null].concat(args));\n        }\n\n        next();\n      }));\n    } else {\n      post.apply(context, args);\n\n      if (++currentPost >= numPosts) {\n        return callback.apply(null, [null].concat(args));\n      }\n\n      next();\n    }\n  };\n\n  next();\n};\n\nKareem.prototype.wrap = function(name, fn, context, args, useLegacyPost) {\n  var lastArg = (args.length > 0 ? args[args.length - 1] : null);\n  var _this = this;\n\n  this.execPre(name, context, function(error) {\n    if (error) {\n      if (typeof lastArg === 'function') {\n        return lastArg(error);\n      }\n      return;\n    }\n\n    var end = (typeof lastArg === 'function' ? args.length - 1 : args.length);\n\n    fn.apply(context, args.slice(0, end).concat(function() {\n      if (arguments[0]) {\n        // Assume error\n        return typeof lastArg === 'function' ?\n          lastArg(arguments[0]) :\n          undefined;\n      }\n\n      if (useLegacyPost && typeof lastArg === 'function') {\n        lastArg.apply(context, arguments);\n      }\n\n      var argsWithoutError = Array.prototype.slice.call(arguments, 1);\n      _this.execPost(name, context, argsWithoutError, function() {\n        if (arguments[0]) {\n          return typeof lastArg === 'function' ?\n            lastArg(arguments[0]) :\n            undefined;\n        }\n\n        return typeof lastArg === 'function' && !useLegacyPost ?\n          lastArg.apply(context, arguments) :\n          undefined;\n      });\n    }));\n  });\n};\n\nKareem.prototype.createWrapper = function(name, fn, context) {\n  var _this = this;\n  return function() {\n    var args = Array.prototype.slice.call(arguments);\n    _this.wrap(name, fn, context, args);\n  };\n};\n\nKareem.prototype.pre = function(name, isAsync, fn, error) {\n  if (typeof arguments[1] !== 'boolean') {\n    error = fn;\n    fn = isAsync;\n    isAsync = false;\n  }\n\n  this._pres[name] = this._pres[name] || [];\n  var pres = this._pres[name];\n\n  if (isAsync) {\n    pres.numAsync = pres.numAsync || 0;\n    ++pres.numAsync;\n  }\n\n  pres.push({ fn: fn, isAsync: isAsync });\n\n  return this;\n};\n\nKareem.prototype.post = function(name, fn) {\n  (this._posts[name] = this._posts[name] || []).push(fn);\n  return this;\n};\n\nKareem.prototype.clone = function() {\n  var n = new Kareem();\n  for (var key in this._pres) {\n    n._pres[key] = this._pres[key].slice();\n  }\n  for (var key in this._posts) {\n    n._posts[key] = this._posts[key].slice();\n  }\n\n  return n;\n};\n\nmodule.exports = Kareem;\n"]}