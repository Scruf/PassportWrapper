{"version":3,"sources":["deserializer_bak.js"],"names":[],"mappings":"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","file":"deserializer_bak-compiled.js","sourcesContent":["\"use strict\"\n\nvar writeIEEE754 = require('../float_parser').writeIEEE754,\n\treadIEEE754 = require('../float_parser').readIEEE754,\n\tf = require('util').format,\n\tLong = require('../long').Long,\n  Double = require('../double').Double,\n  Timestamp = require('../timestamp').Timestamp,\n  ObjectID = require('../objectid').ObjectID,\n  Symbol = require('../symbol').Symbol,\n  Code = require('../code').Code,\n  MinKey = require('../min_key').MinKey,\n  MaxKey = require('../max_key').MaxKey,\n  DBRef = require('../db_ref').DBRef,\n  BSONRegExp = require('../regexp').BSONRegExp,\n  Binary = require('../binary').Binary;\n\nvar BSON = {};\n\n/**\n * Contains the function cache if we have that enable to allow for avoiding the eval step on each deserialization, comparison is by md5\n *\n * @ignore\n * @api private\n */\nvar functionCache = BSON.functionCache = {};\n\n/**\n * Number BSON Type\n *\n * @classconstant BSON_DATA_NUMBER\n **/\nBSON.BSON_DATA_NUMBER = 1;\n/**\n * String BSON Type\n *\n * @classconstant BSON_DATA_STRING\n **/\nBSON.BSON_DATA_STRING = 2;\n/**\n * Object BSON Type\n *\n * @classconstant BSON_DATA_OBJECT\n **/\nBSON.BSON_DATA_OBJECT = 3;\n/**\n * Array BSON Type\n *\n * @classconstant BSON_DATA_ARRAY\n **/\nBSON.BSON_DATA_ARRAY = 4;\n/**\n * Binary BSON Type\n *\n * @classconstant BSON_DATA_BINARY\n **/\nBSON.BSON_DATA_BINARY = 5;\n/**\n * ObjectID BSON Type\n *\n * @classconstant BSON_DATA_OID\n **/\nBSON.BSON_DATA_OID = 7;\n/**\n * Boolean BSON Type\n *\n * @classconstant BSON_DATA_BOOLEAN\n **/\nBSON.BSON_DATA_BOOLEAN = 8;\n/**\n * Date BSON Type\n *\n * @classconstant BSON_DATA_DATE\n **/\nBSON.BSON_DATA_DATE = 9;\n/**\n * null BSON Type\n *\n * @classconstant BSON_DATA_NULL\n **/\nBSON.BSON_DATA_NULL = 10;\n/**\n * RegExp BSON Type\n *\n * @classconstant BSON_DATA_REGEXP\n **/\nBSON.BSON_DATA_REGEXP = 11;\n/**\n * Code BSON Type\n *\n * @classconstant BSON_DATA_CODE\n **/\nBSON.BSON_DATA_CODE = 13;\n/**\n * Symbol BSON Type\n *\n * @classconstant BSON_DATA_SYMBOL\n **/\nBSON.BSON_DATA_SYMBOL = 14;\n/**\n * Code with Scope BSON Type\n *\n * @classconstant BSON_DATA_CODE_W_SCOPE\n **/\nBSON.BSON_DATA_CODE_W_SCOPE = 15;\n/**\n * 32 bit Integer BSON Type\n *\n * @classconstant BSON_DATA_INT\n **/\nBSON.BSON_DATA_INT = 16;\n/**\n * Timestamp BSON Type\n *\n * @classconstant BSON_DATA_TIMESTAMP\n **/\nBSON.BSON_DATA_TIMESTAMP = 17;\n/**\n * Long BSON Type\n *\n * @classconstant BSON_DATA_LONG\n **/\nBSON.BSON_DATA_LONG = 18;\n/**\n * MinKey BSON Type\n *\n * @classconstant BSON_DATA_MIN_KEY\n **/\nBSON.BSON_DATA_MIN_KEY = 0xff;\n/**\n * MaxKey BSON Type\n *\n * @classconstant BSON_DATA_MAX_KEY\n **/\nBSON.BSON_DATA_MAX_KEY = 0x7f;\n\n/**\n * Binary Default Type\n *\n * @classconstant BSON_BINARY_SUBTYPE_DEFAULT\n **/\nBSON.BSON_BINARY_SUBTYPE_DEFAULT = 0;\n/**\n * Binary Function Type\n *\n * @classconstant BSON_BINARY_SUBTYPE_FUNCTION\n **/\nBSON.BSON_BINARY_SUBTYPE_FUNCTION = 1;\n/**\n * Binary Byte Array Type\n *\n * @classconstant BSON_BINARY_SUBTYPE_BYTE_ARRAY\n **/\nBSON.BSON_BINARY_SUBTYPE_BYTE_ARRAY = 2;\n/**\n * Binary UUID Type\n *\n * @classconstant BSON_BINARY_SUBTYPE_UUID\n **/\nBSON.BSON_BINARY_SUBTYPE_UUID = 3;\n/**\n * Binary MD5 Type\n *\n * @classconstant BSON_BINARY_SUBTYPE_MD5\n **/\nBSON.BSON_BINARY_SUBTYPE_MD5 = 4;\n/**\n * Binary User Defined Type\n *\n * @classconstant BSON_BINARY_SUBTYPE_USER_DEFINED\n **/\nBSON.BSON_BINARY_SUBTYPE_USER_DEFINED = 128;\n\n// BSON MAX VALUES\nBSON.BSON_INT32_MAX = 0x7FFFFFFF;\nBSON.BSON_INT32_MIN = -0x80000000;\n\nBSON.BSON_INT64_MAX = Math.pow(2, 63) - 1;\nBSON.BSON_INT64_MIN = -Math.pow(2, 63);\n\n// JS MAX PRECISE VALUES\nBSON.JS_INT_MAX = 0x20000000000000;  // Any integer up to 2^53 can be precisely represented by a double.\nBSON.JS_INT_MIN = -0x20000000000000;  // Any integer down to -2^53 can be precisely represented by a double.\n\n// Internal long versions\nvar JS_INT_MAX_LONG = Long.fromNumber(0x20000000000000);  // Any integer up to 2^53 can be precisely represented by a double.\nvar JS_INT_MIN_LONG = Long.fromNumber(-0x20000000000000);  // Any integer down to -2^53 can be precisely represented by a double.\n\nvar deserialize = function(buffer, options, isArray) {\n\tvar index = 0;\n\t// Read the document size\n  var size = buffer[index++] | buffer[index++] << 8 | buffer[index++] << 16 | buffer[index++] << 24;\n\n\t// Ensure buffer is valid size\n  if(size < 5 || buffer.length < size) {\n\t\tthrow new Error(\"corrupt bson message\");\n\t}\n\n\t// Illegal end value\n\tif(buffer[size - 1] != 0) {\n\t\tthrow new Error(\"One object, sized correctly, with a spot for an EOO, but the EOO isn't 0x00\");\n\t}\n\n\t// Start deserializtion\n\treturn deserializeObject(buffer, options, isArray);\n}\n\n// // Reads in a C style string\n// var readCStyleStringSpecial = function(buffer, index) {\n// \t// Get the start search index\n// \tvar i = index;\n// \t// Locate the end of the c string\n// \twhile(buffer[i] !== 0x00 && i < buffer.length) {\n// \t\ti++\n// \t}\n// \t// If are at the end of the buffer there is a problem with the document\n// \tif(i >= buffer.length) throw new Error(\"Bad BSON Document: illegal CString\")\n// \t// Grab utf8 encoded string\n// \tvar string = buffer.toString('utf8', index, i);\n// \t// Update index position\n// \tindex = i + 1;\n// \t// Return string\n// \treturn {s: string, i: index};\n// }\n\n// Reads in a C style string\nvar readCStyleStringSpecial = function(buffer, index) {\n\t// Get the start search index\n\tvar i = index;\n\t// Locate the end of the c string\n\twhile(buffer[i] !== 0x00 && i < buffer.length) {\n\t\ti++\n\t}\n\t// If are at the end of the buffer there is a problem with the document\n\tif(i >= buffer.length) throw new Error(\"Bad BSON Document: illegal CString\")\n\t// Grab utf8 encoded string\n\treturn buffer.toString('utf8', index, i);\n}\n\nvar DeserializationMethods = {}\nDeserializationMethods[BSON.BSON_DATA_OID] = function(name, object, buffer, index) {\n\tvar string = buffer.toString('binary', index, index + 12);\n\tobject[name] = new ObjectID(string);\n\treturn index + 12;\n}\n\nDeserializationMethods[BSON.BSON_DATA_NUMBER] = function(name, object, buffer, index) {\n\tobject[name] = buffer.readDoubleLE(index);\n  return index + 8;\n}\n\nDeserializationMethods[BSON.BSON_DATA_INT] = function(name, object, buffer, index) {\n\tobject[name] = buffer.readInt32LE(index);\n\treturn index + 4;\n}\n\nDeserializationMethods[BSON.BSON_DATA_TIMESTAMP] = function(name, object, buffer, index) {\n  var lowBits = buffer[index++] | buffer[index++] << 8 | buffer[index++] << 16 | buffer[index++] << 24;\n  var highBits = buffer[index++] | buffer[index++] << 8 | buffer[index++] << 16 | buffer[index++] << 24;\n  object[name] = new Timestamp(lowBits, highBits);\n\treturn index;\n}\n\nDeserializationMethods[BSON.BSON_DATA_STRING] = function(name, object, buffer, index) {\n  var stringSize = buffer[index++] | buffer[index++] << 8 | buffer[index++] << 16 | buffer[index++] << 24;\n\tif(stringSize <= 0 || stringSize > (buffer.length - index) || buffer[index + stringSize - 1] != 0) throw new Error(\"bad string length in bson\");\n  object[name] = buffer.toString('utf8', index, index + stringSize - 1);\n  return index + stringSize;\n}\n\nDeserializationMethods[BSON.BSON_DATA_BOOLEAN] = function(name, object, buffer, index) {\n  object[name] = buffer[index++] == 1;\n\treturn index;\n}\n\nvar deserializeObject = function(buffer, options, isArray) {\n  // Options\n  options = options == null ? {} : options;\n  var evalFunctions = options['evalFunctions'] == null ? false : options['evalFunctions'];\n  var cacheFunctions = options['cacheFunctions'] == null ? false : options['cacheFunctions'];\n  var cacheFunctionsCrc32 = options['cacheFunctionsCrc32'] == null ? false : options['cacheFunctionsCrc32'];\n  var promoteLongs = options['promoteLongs'] == null ? true : options['promoteLongs'];\n\tvar fieldsAsRaw = options['fieldsAsRaw'] == null ? {} : options['fieldsAsRaw'];\n  // Return BSONRegExp objects instead of native regular expressions\n  var bsonRegExp = typeof options['bsonRegExp'] == 'boolean' ? options['bsonRegExp'] : false;\n  var promoteBuffers = options['promoteBuffers'] == null ? false : options['promoteBuffers'];\n\n  // Validate that we have at least 4 bytes of buffer\n  if(buffer.length < 5) throw new Error(\"corrupt bson message < 5 bytes long\");\n\n  // Set up index\n  var index = typeof options['index'] == 'number' ? options['index'] : 0;\n\n\t// Read the document size\n  var size = buffer[index++] | buffer[index++] << 8 | buffer[index++] << 16 | buffer[index++] << 24;\n\n\t// Ensure buffer is valid size\n  if(size < 5 || size > buffer.length) throw new Error(\"corrupt bson message\");\n\n  // Create holding object\n  var object = isArray ? [] : {};\n\n  // While we have more left data left keep parsing\n  while(true) {\n    // Read the type\n    var elementType = buffer[index++];\n    // If we get a zero it's the last byte, exit\n    if(elementType == 0) break;\n    var name = readCStyleStringSpecial(buffer, index);\n\t\tindex = index + name.length + 1;\n\n\t\t// console.log(\"----------- 0 \" + elementType + \" :: \" + name)\n\t\tindex = DeserializationMethods[elementType](name, object, buffer, index);\n\t\t// console.log('--------------- 1')\n  }\n\n  // Check if we have a db ref object\n  if(object['$id'] != null) object = new DBRef(object['$ref'], object['$id'], object['$db']);\n\n  // Return the final objects\n  return object;\n}\n\n/**\n * Ensure eval is isolated.\n *\n * @ignore\n * @api private\n */\nvar isolateEvalWithHash = function(functionCache, hash, functionString, object) {\n  // Contains the value we are going to set\n  var value = null;\n\n  // Check for cache hit, eval if missing and return cached function\n  if(functionCache[hash] == null) {\n    eval(\"value = \" + functionString);\n    functionCache[hash] = value;\n  }\n  // Set the object\n  return functionCache[hash].bind(object);\n}\n\n/**\n * Ensure eval is isolated.\n *\n * @ignore\n * @api private\n */\nvar isolateEval = function(functionString) {\n  // Contains the value we are going to set\n  var value = null;\n  // Eval the function\n  eval(\"value = \" + functionString);\n  return value;\n}\n\nmodule.exports = deserialize\n"]}