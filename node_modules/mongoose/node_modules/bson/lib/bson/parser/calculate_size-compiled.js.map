{"version":3,"sources":["calculate_size.js"],"names":[],"mappings":"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","file":"calculate_size-compiled.js","sourcesContent":["\"use strict\"\n\nvar writeIEEE754 = require('../float_parser').writeIEEE754\n\t, readIEEE754 = require('../float_parser').readIEEE754\n\t, Long = require('../long').Long\n  , Double = require('../double').Double\n  , Timestamp = require('../timestamp').Timestamp\n  , ObjectID = require('../objectid').ObjectID\n  , Symbol = require('../symbol').Symbol\n  , BSONRegExp = require('../regexp').BSONRegExp\n  , Code = require('../code').Code\n  , MinKey = require('../min_key').MinKey\n  , MaxKey = require('../max_key').MaxKey\n  , DBRef = require('../db_ref').DBRef\n  , Binary = require('../binary').Binary;\n\n// To ensure that 0.4 of node works correctly\nvar isDate = function isDate(d) {\n  return typeof d === 'object' && Object.prototype.toString.call(d) === '[object Date]';\n}\n\nvar calculateObjectSize = function calculateObjectSize(object, serializeFunctions, ignoreUndefined) {\n  var totalLength = (4 + 1);\n\n  if(Array.isArray(object)) {\n    for(var i = 0; i < object.length; i++) {\n      totalLength += calculateElement(i.toString(), object[i], serializeFunctions, true, ignoreUndefined)\n    }\n  } else {\n\t\t// If we have toBSON defined, override the current object\n\t\tif(object.toBSON) {\n\t\t\tobject = object.toBSON();\n\t\t}\n\n\t\t// Calculate size\n    for(var key in object) {\n      totalLength += calculateElement(key, object[key], serializeFunctions, false, ignoreUndefined)\n    }\n  }\n\n  return totalLength;\n}\n\n/**\n * @ignore\n * @api private\n */\nfunction calculateElement(name, value, serializeFunctions, isArray, ignoreUndefined) {\n\t// If we have toBSON defined, override the current object\n  if(value && value.toBSON){\n    value = value.toBSON();\n  }\n\n  switch(typeof value) {\n    case 'string':\n      return 1 + Buffer.byteLength(name, 'utf8') + 1 + 4 + Buffer.byteLength(value, 'utf8') + 1;\n    case 'number':\n      if(Math.floor(value) === value && value >= BSON.JS_INT_MIN && value <= BSON.JS_INT_MAX) {\n        if(value >= BSON.BSON_INT32_MIN && value <= BSON.BSON_INT32_MAX) { // 32 bit\n          return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + (4 + 1);\n        } else {\n          return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + (8 + 1);\n        }\n      } else {  // 64 bit\n        return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + (8 + 1);\n      }\n    case 'undefined':\n      if(isArray || !ignoreUndefined) return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + (1);\n      return 0;\n    case 'boolean':\n      return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + (1 + 1);\n    case 'object':\n      if(value == null || value instanceof MinKey || value instanceof MaxKey || value['_bsontype'] == 'MinKey' || value['_bsontype'] == 'MaxKey') {\n        return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + (1);\n      } else if(value instanceof ObjectID || value['_bsontype'] == 'ObjectID') {\n        return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + (12 + 1);\n      } else if(value instanceof Date || isDate(value)) {\n        return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + (8 + 1);\n      } else if(typeof Buffer !== 'undefined' && Buffer.isBuffer(value)) {\n        return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + (1 + 4 + 1) + value.length;\n      } else if(value instanceof Long || value instanceof Double || value instanceof Timestamp\n          || value['_bsontype'] == 'Long' || value['_bsontype'] == 'Double' || value['_bsontype'] == 'Timestamp') {\n        return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + (8 + 1);\n      } else if(value instanceof Code || value['_bsontype'] == 'Code') {\n        // Calculate size depending on the availability of a scope\n        if(value.scope != null && Object.keys(value.scope).length > 0) {\n          return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + 1 + 4 + 4 + Buffer.byteLength(value.code.toString(), 'utf8') + 1 + calculateObjectSize(value.scope, serializeFunctions, ignoreUndefined);\n        } else {\n          return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + 1 + 4 + Buffer.byteLength(value.code.toString(), 'utf8') + 1;\n        }\n      } else if(value instanceof Binary || value['_bsontype'] == 'Binary') {\n        // Check what kind of subtype we have\n        if(value.sub_type == Binary.SUBTYPE_BYTE_ARRAY) {\n          return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + (value.position + 1 + 4 + 1 + 4);\n        } else {\n          return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + (value.position + 1 + 4 + 1);\n        }\n      } else if(value instanceof Symbol || value['_bsontype'] == 'Symbol') {\n        return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + Buffer.byteLength(value.value, 'utf8') + 4 + 1 + 1;\n      } else if(value instanceof DBRef || value['_bsontype'] == 'DBRef') {\n        // Set up correct object for serialization\n        var ordered_values = {\n            '$ref': value.namespace\n          , '$id' : value.oid\n        };\n\n        // Add db reference if it exists\n        if(null != value.db) {\n          ordered_values['$db'] = value.db;\n        }\n\n        return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + 1 + calculateObjectSize(ordered_values, serializeFunctions, ignoreUndefined);\n      } else if(value instanceof RegExp || Object.prototype.toString.call(value) === '[object RegExp]') {\n          return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + 1 + Buffer.byteLength(value.source, 'utf8') + 1\n            + (value.global ? 1 : 0) + (value.ignoreCase ? 1 : 0) + (value.multiline ? 1 : 0) + 1\n      } else if(value instanceof BSONRegExp || value['_bsontype'] == 'BSONRegExp') {\n          return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + 1 + Buffer.byteLength(value.pattern, 'utf8') + 1\n            + Buffer.byteLength(value.options, 'utf8') + 1\n      } else {\n        return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + calculateObjectSize(value, serializeFunctions, ignoreUndefined) + 1;\n      }\n    case 'function':\n      // WTF for 0.4.X where typeof /someregexp/ === 'function'\n      if(value instanceof RegExp || Object.prototype.toString.call(value) === '[object RegExp]' || String.call(value) == '[object RegExp]') {\n        return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + 1 + Buffer.byteLength(value.source, 'utf8') + 1\n          + (value.global ? 1 : 0) + (value.ignoreCase ? 1 : 0) + (value.multiline ? 1 : 0) + 1\n      } else {\n        if(serializeFunctions && value.scope != null && Object.keys(value.scope).length > 0) {\n          return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + 1 + 4 + 4 + Buffer.byteLength(value.toString(), 'utf8') + 1 + calculateObjectSize(value.scope, serializeFunctions, ignoreUndefined);\n        } else if(serializeFunctions) {\n          return (name != null ? (Buffer.byteLength(name, 'utf8') + 1) : 0) + 1 + 4 + Buffer.byteLength(value.toString(), 'utf8') + 1;\n        }\n      }\n  }\n\n  return 0;\n}\n\nvar BSON = {};\n\n/**\n * Contains the function cache if we have that enable to allow for avoiding the eval step on each deserialization, comparison is by md5\n *\n * @ignore\n * @api private\n */\nvar functionCache = BSON.functionCache = {};\n\n/**\n * Number BSON Type\n *\n * @classconstant BSON_DATA_NUMBER\n **/\nBSON.BSON_DATA_NUMBER = 1;\n/**\n * String BSON Type\n *\n * @classconstant BSON_DATA_STRING\n **/\nBSON.BSON_DATA_STRING = 2;\n/**\n * Object BSON Type\n *\n * @classconstant BSON_DATA_OBJECT\n **/\nBSON.BSON_DATA_OBJECT = 3;\n/**\n * Array BSON Type\n *\n * @classconstant BSON_DATA_ARRAY\n **/\nBSON.BSON_DATA_ARRAY = 4;\n/**\n * Binary BSON Type\n *\n * @classconstant BSON_DATA_BINARY\n **/\nBSON.BSON_DATA_BINARY = 5;\n/**\n * ObjectID BSON Type\n *\n * @classconstant BSON_DATA_OID\n **/\nBSON.BSON_DATA_OID = 7;\n/**\n * Boolean BSON Type\n *\n * @classconstant BSON_DATA_BOOLEAN\n **/\nBSON.BSON_DATA_BOOLEAN = 8;\n/**\n * Date BSON Type\n *\n * @classconstant BSON_DATA_DATE\n **/\nBSON.BSON_DATA_DATE = 9;\n/**\n * null BSON Type\n *\n * @classconstant BSON_DATA_NULL\n **/\nBSON.BSON_DATA_NULL = 10;\n/**\n * RegExp BSON Type\n *\n * @classconstant BSON_DATA_REGEXP\n **/\nBSON.BSON_DATA_REGEXP = 11;\n/**\n * Code BSON Type\n *\n * @classconstant BSON_DATA_CODE\n **/\nBSON.BSON_DATA_CODE = 13;\n/**\n * Symbol BSON Type\n *\n * @classconstant BSON_DATA_SYMBOL\n **/\nBSON.BSON_DATA_SYMBOL = 14;\n/**\n * Code with Scope BSON Type\n *\n * @classconstant BSON_DATA_CODE_W_SCOPE\n **/\nBSON.BSON_DATA_CODE_W_SCOPE = 15;\n/**\n * 32 bit Integer BSON Type\n *\n * @classconstant BSON_DATA_INT\n **/\nBSON.BSON_DATA_INT = 16;\n/**\n * Timestamp BSON Type\n *\n * @classconstant BSON_DATA_TIMESTAMP\n **/\nBSON.BSON_DATA_TIMESTAMP = 17;\n/**\n * Long BSON Type\n *\n * @classconstant BSON_DATA_LONG\n **/\nBSON.BSON_DATA_LONG = 18;\n/**\n * MinKey BSON Type\n *\n * @classconstant BSON_DATA_MIN_KEY\n **/\nBSON.BSON_DATA_MIN_KEY = 0xff;\n/**\n * MaxKey BSON Type\n *\n * @classconstant BSON_DATA_MAX_KEY\n **/\nBSON.BSON_DATA_MAX_KEY = 0x7f;\n\n/**\n * Binary Default Type\n *\n * @classconstant BSON_BINARY_SUBTYPE_DEFAULT\n **/\nBSON.BSON_BINARY_SUBTYPE_DEFAULT = 0;\n/**\n * Binary Function Type\n *\n * @classconstant BSON_BINARY_SUBTYPE_FUNCTION\n **/\nBSON.BSON_BINARY_SUBTYPE_FUNCTION = 1;\n/**\n * Binary Byte Array Type\n *\n * @classconstant BSON_BINARY_SUBTYPE_BYTE_ARRAY\n **/\nBSON.BSON_BINARY_SUBTYPE_BYTE_ARRAY = 2;\n/**\n * Binary UUID Type\n *\n * @classconstant BSON_BINARY_SUBTYPE_UUID\n **/\nBSON.BSON_BINARY_SUBTYPE_UUID = 3;\n/**\n * Binary MD5 Type\n *\n * @classconstant BSON_BINARY_SUBTYPE_MD5\n **/\nBSON.BSON_BINARY_SUBTYPE_MD5 = 4;\n/**\n * Binary User Defined Type\n *\n * @classconstant BSON_BINARY_SUBTYPE_USER_DEFINED\n **/\nBSON.BSON_BINARY_SUBTYPE_USER_DEFINED = 128;\n\n// BSON MAX VALUES\nBSON.BSON_INT32_MAX = 0x7FFFFFFF;\nBSON.BSON_INT32_MIN = -0x80000000;\n\nBSON.BSON_INT64_MAX = Math.pow(2, 63) - 1;\nBSON.BSON_INT64_MIN = -Math.pow(2, 63);\n\n// JS MAX PRECISE VALUES\nBSON.JS_INT_MAX = 0x20000000000000;  // Any integer up to 2^53 can be precisely represented by a double.\nBSON.JS_INT_MIN = -0x20000000000000;  // Any integer down to -2^53 can be precisely represented by a double.\n\n// Internal long versions\nvar JS_INT_MAX_LONG = Long.fromNumber(0x20000000000000);  // Any integer up to 2^53 can be precisely represented by a double.\nvar JS_INT_MIN_LONG = Long.fromNumber(-0x20000000000000);  // Any integer down to -2^53 can be precisely represented by a double.\n\nmodule.exports = calculateObjectSize;\n"]}