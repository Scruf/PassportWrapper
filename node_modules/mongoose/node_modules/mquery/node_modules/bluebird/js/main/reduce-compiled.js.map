{"version":3,"sources":["reduce.js"],"names":[],"mappings":"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","file":"reduce-compiled.js","sourcesContent":["\"use strict\";\nmodule.exports = function(Promise,\n                          PromiseArray,\n                          apiRejection,\n                          tryConvertToPromise,\n                          INTERNAL) {\nvar getDomain = Promise._getDomain;\nvar async = require(\"./async.js\");\nvar util = require(\"./util.js\");\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nfunction ReductionPromiseArray(promises, fn, accum, _each) {\n    this.constructor$(promises);\n    this._promise._captureStackTrace();\n    this._preservedValues = _each === INTERNAL ? [] : null;\n    this._zerothIsAccum = (accum === undefined);\n    this._gotAccum = false;\n    this._reducingIndex = (this._zerothIsAccum ? 1 : 0);\n    this._valuesPhase = undefined;\n    var maybePromise = tryConvertToPromise(accum, this._promise);\n    var rejected = false;\n    var isPromise = maybePromise instanceof Promise;\n    if (isPromise) {\n        maybePromise = maybePromise._target();\n        if (maybePromise._isPending()) {\n            maybePromise._proxyPromiseArray(this, -1);\n        } else if (maybePromise._isFulfilled()) {\n            accum = maybePromise._value();\n            this._gotAccum = true;\n        } else {\n            this._reject(maybePromise._reason());\n            rejected = true;\n        }\n    }\n    if (!(isPromise || this._zerothIsAccum)) this._gotAccum = true;\n    var domain = getDomain();\n    this._callback = domain === null ? fn : domain.bind(fn);\n    this._accum = accum;\n    if (!rejected) async.invoke(init, this, undefined);\n}\nfunction init() {\n    this._init$(undefined, -5);\n}\nutil.inherits(ReductionPromiseArray, PromiseArray);\n\nReductionPromiseArray.prototype._init = function () {};\n\nReductionPromiseArray.prototype._resolveEmptyArray = function () {\n    if (this._gotAccum || this._zerothIsAccum) {\n        this._resolve(this._preservedValues !== null\n                        ? [] : this._accum);\n    }\n};\n\nReductionPromiseArray.prototype._promiseFulfilled = function (value, index) {\n    var values = this._values;\n    values[index] = value;\n    var length = this.length();\n    var preservedValues = this._preservedValues;\n    var isEach = preservedValues !== null;\n    var gotAccum = this._gotAccum;\n    var valuesPhase = this._valuesPhase;\n    var valuesPhaseIndex;\n    if (!valuesPhase) {\n        valuesPhase = this._valuesPhase = new Array(length);\n        for (valuesPhaseIndex=0; valuesPhaseIndex<length; ++valuesPhaseIndex) {\n            valuesPhase[valuesPhaseIndex] = 0;\n        }\n    }\n    valuesPhaseIndex = valuesPhase[index];\n\n    if (index === 0 && this._zerothIsAccum) {\n        this._accum = value;\n        this._gotAccum = gotAccum = true;\n        valuesPhase[index] = ((valuesPhaseIndex === 0)\n            ? 1 : 2);\n    } else if (index === -1) {\n        this._accum = value;\n        this._gotAccum = gotAccum = true;\n    } else {\n        if (valuesPhaseIndex === 0) {\n            valuesPhase[index] = 1;\n        } else {\n            valuesPhase[index] = 2;\n            this._accum = value;\n        }\n    }\n    if (!gotAccum) return;\n\n    var callback = this._callback;\n    var receiver = this._promise._boundValue();\n    var ret;\n\n    for (var i = this._reducingIndex; i < length; ++i) {\n        valuesPhaseIndex = valuesPhase[i];\n        if (valuesPhaseIndex === 2) {\n            this._reducingIndex = i + 1;\n            continue;\n        }\n        if (valuesPhaseIndex !== 1) return;\n        value = values[i];\n        this._promise._pushContext();\n        if (isEach) {\n            preservedValues.push(value);\n            ret = tryCatch(callback).call(receiver, value, i, length);\n        }\n        else {\n            ret = tryCatch(callback)\n                .call(receiver, this._accum, value, i, length);\n        }\n        this._promise._popContext();\n\n        if (ret === errorObj) return this._reject(ret.e);\n\n        var maybePromise = tryConvertToPromise(ret, this._promise);\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            if (maybePromise._isPending()) {\n                valuesPhase[i] = 4;\n                return maybePromise._proxyPromiseArray(this, i);\n            } else if (maybePromise._isFulfilled()) {\n                ret = maybePromise._value();\n            } else {\n                return this._reject(maybePromise._reason());\n            }\n        }\n\n        this._reducingIndex = i + 1;\n        this._accum = ret;\n    }\n\n    this._resolve(isEach ? preservedValues : this._accum);\n};\n\nfunction reduce(promises, fn, initialValue, _each) {\n    if (typeof fn !== \"function\") return apiRejection(\"fn must be a function\\u000a\\u000a    See http://goo.gl/916lJJ\\u000a\");\n    var array = new ReductionPromiseArray(promises, fn, initialValue, _each);\n    return array.promise();\n}\n\nPromise.prototype.reduce = function (fn, initialValue) {\n    return reduce(this, fn, initialValue, null);\n};\n\nPromise.reduce = function (promises, fn, initialValue, _each) {\n    return reduce(promises, fn, initialValue, _each);\n};\n};\n"]}