{"version":3,"sources":["map.js"],"names":[],"mappings":"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","file":"map-compiled.js","sourcesContent":["\"use strict\";\nmodule.exports = function(Promise,\n                          PromiseArray,\n                          apiRejection,\n                          tryConvertToPromise,\n                          INTERNAL) {\nvar getDomain = Promise._getDomain;\nvar async = require(\"./async.js\");\nvar util = require(\"./util.js\");\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nvar PENDING = {};\nvar EMPTY_ARRAY = [];\n\nfunction MappingPromiseArray(promises, fn, limit, _filter) {\n    this.constructor$(promises);\n    this._promise._captureStackTrace();\n    var domain = getDomain();\n    this._callback = domain === null ? fn : domain.bind(fn);\n    this._preservedValues = _filter === INTERNAL\n        ? new Array(this.length())\n        : null;\n    this._limit = limit;\n    this._inFlight = 0;\n    this._queue = limit >= 1 ? [] : EMPTY_ARRAY;\n    async.invoke(init, this, undefined);\n}\nutil.inherits(MappingPromiseArray, PromiseArray);\nfunction init() {this._init$(undefined, -2);}\n\nMappingPromiseArray.prototype._init = function () {};\n\nMappingPromiseArray.prototype._promiseFulfilled = function (value, index) {\n    var values = this._values;\n    var length = this.length();\n    var preservedValues = this._preservedValues;\n    var limit = this._limit;\n    if (values[index] === PENDING) {\n        values[index] = value;\n        if (limit >= 1) {\n            this._inFlight--;\n            this._drainQueue();\n            if (this._isResolved()) return;\n        }\n    } else {\n        if (limit >= 1 && this._inFlight >= limit) {\n            values[index] = value;\n            this._queue.push(index);\n            return;\n        }\n        if (preservedValues !== null) preservedValues[index] = value;\n\n        var callback = this._callback;\n        var receiver = this._promise._boundValue();\n        this._promise._pushContext();\n        var ret = tryCatch(callback).call(receiver, value, index, length);\n        this._promise._popContext();\n        if (ret === errorObj) return this._reject(ret.e);\n\n        var maybePromise = tryConvertToPromise(ret, this._promise);\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            if (maybePromise._isPending()) {\n                if (limit >= 1) this._inFlight++;\n                values[index] = PENDING;\n                return maybePromise._proxyPromiseArray(this, index);\n            } else if (maybePromise._isFulfilled()) {\n                ret = maybePromise._value();\n            } else {\n                return this._reject(maybePromise._reason());\n            }\n        }\n        values[index] = ret;\n    }\n    var totalResolved = ++this._totalResolved;\n    if (totalResolved >= length) {\n        if (preservedValues !== null) {\n            this._filter(values, preservedValues);\n        } else {\n            this._resolve(values);\n        }\n\n    }\n};\n\nMappingPromiseArray.prototype._drainQueue = function () {\n    var queue = this._queue;\n    var limit = this._limit;\n    var values = this._values;\n    while (queue.length > 0 && this._inFlight < limit) {\n        if (this._isResolved()) return;\n        var index = queue.pop();\n        this._promiseFulfilled(values[index], index);\n    }\n};\n\nMappingPromiseArray.prototype._filter = function (booleans, values) {\n    var len = values.length;\n    var ret = new Array(len);\n    var j = 0;\n    for (var i = 0; i < len; ++i) {\n        if (booleans[i]) ret[j++] = values[i];\n    }\n    ret.length = j;\n    this._resolve(ret);\n};\n\nMappingPromiseArray.prototype.preservedValues = function () {\n    return this._preservedValues;\n};\n\nfunction map(promises, fn, options, _filter) {\n    var limit = typeof options === \"object\" && options !== null\n        ? options.concurrency\n        : 0;\n    limit = typeof limit === \"number\" &&\n        isFinite(limit) && limit >= 1 ? limit : 0;\n    return new MappingPromiseArray(promises, fn, limit, _filter);\n}\n\nPromise.prototype.map = function (fn, options) {\n    if (typeof fn !== \"function\") return apiRejection(\"fn must be a function\\u000a\\u000a    See http://goo.gl/916lJJ\\u000a\");\n\n    return map(this, fn, options, null).promise();\n};\n\nPromise.map = function (promises, fn, options, _filter) {\n    if (typeof fn !== \"function\") return apiRejection(\"fn must be a function\\u000a\\u000a    See http://goo.gl/916lJJ\\u000a\");\n    return map(promises, fn, options, _filter).promise();\n};\n\n\n};\n"]}