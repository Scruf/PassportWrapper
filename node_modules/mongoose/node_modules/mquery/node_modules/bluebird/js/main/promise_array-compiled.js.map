{"version":3,"sources":["promise_array.js"],"names":[],"mappings":"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","file":"promise_array-compiled.js","sourcesContent":["\"use strict\";\nmodule.exports = function(Promise, INTERNAL, tryConvertToPromise,\n    apiRejection) {\nvar util = require(\"./util.js\");\nvar isArray = util.isArray;\n\nfunction toResolutionValue(val) {\n    switch(val) {\n    case -2: return [];\n    case -3: return {};\n    }\n}\n\nfunction PromiseArray(values) {\n    var promise = this._promise = new Promise(INTERNAL);\n    var parent;\n    if (values instanceof Promise) {\n        parent = values;\n        promise._propagateFrom(parent, 1 | 4);\n    }\n    this._values = values;\n    this._length = 0;\n    this._totalResolved = 0;\n    this._init(undefined, -2);\n}\nPromiseArray.prototype.length = function () {\n    return this._length;\n};\n\nPromiseArray.prototype.promise = function () {\n    return this._promise;\n};\n\nPromiseArray.prototype._init = function init(_, resolveValueIfEmpty) {\n    var values = tryConvertToPromise(this._values, this._promise);\n    if (values instanceof Promise) {\n        values = values._target();\n        this._values = values;\n        if (values._isFulfilled()) {\n            values = values._value();\n            if (!isArray(values)) {\n                var err = new Promise.TypeError(\"expecting an array, a promise or a thenable\\u000a\\u000a    See http://goo.gl/s8MMhc\\u000a\");\n                this.__hardReject__(err);\n                return;\n            }\n        } else if (values._isPending()) {\n            values._then(\n                init,\n                this._reject,\n                undefined,\n                this,\n                resolveValueIfEmpty\n           );\n            return;\n        } else {\n            this._reject(values._reason());\n            return;\n        }\n    } else if (!isArray(values)) {\n        this._promise._reject(apiRejection(\"expecting an array, a promise or a thenable\\u000a\\u000a    See http://goo.gl/s8MMhc\\u000a\")._reason());\n        return;\n    }\n\n    if (values.length === 0) {\n        if (resolveValueIfEmpty === -5) {\n            this._resolveEmptyArray();\n        }\n        else {\n            this._resolve(toResolutionValue(resolveValueIfEmpty));\n        }\n        return;\n    }\n    var len = this.getActualLength(values.length);\n    this._length = len;\n    this._values = this.shouldCopyValues() ? new Array(len) : this._values;\n    var promise = this._promise;\n    for (var i = 0; i < len; ++i) {\n        var isResolved = this._isResolved();\n        var maybePromise = tryConvertToPromise(values[i], promise);\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            if (isResolved) {\n                maybePromise._ignoreRejections();\n            } else if (maybePromise._isPending()) {\n                maybePromise._proxyPromiseArray(this, i);\n            } else if (maybePromise._isFulfilled()) {\n                this._promiseFulfilled(maybePromise._value(), i);\n            } else {\n                this._promiseRejected(maybePromise._reason(), i);\n            }\n        } else if (!isResolved) {\n            this._promiseFulfilled(maybePromise, i);\n        }\n    }\n};\n\nPromiseArray.prototype._isResolved = function () {\n    return this._values === null;\n};\n\nPromiseArray.prototype._resolve = function (value) {\n    this._values = null;\n    this._promise._fulfill(value);\n};\n\nPromiseArray.prototype.__hardReject__ =\nPromiseArray.prototype._reject = function (reason) {\n    this._values = null;\n    this._promise._rejectCallback(reason, false, true);\n};\n\nPromiseArray.prototype._promiseProgressed = function (progressValue, index) {\n    this._promise._progress({\n        index: index,\n        value: progressValue\n    });\n};\n\n\nPromiseArray.prototype._promiseFulfilled = function (value, index) {\n    this._values[index] = value;\n    var totalResolved = ++this._totalResolved;\n    if (totalResolved >= this._length) {\n        this._resolve(this._values);\n    }\n};\n\nPromiseArray.prototype._promiseRejected = function (reason, index) {\n    this._totalResolved++;\n    this._reject(reason);\n};\n\nPromiseArray.prototype.shouldCopyValues = function () {\n    return true;\n};\n\nPromiseArray.prototype.getActualLength = function (len) {\n    return len;\n};\n\nreturn PromiseArray;\n};\n"]}