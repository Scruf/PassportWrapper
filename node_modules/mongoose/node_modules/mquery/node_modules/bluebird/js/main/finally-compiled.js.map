{"version":3,"sources":["finally.js"],"names":[],"mappings":"AAAA;;AACA,OAAO,OAAP,GAAiB,UAAS,OAAT,EAAkB,WAAlB,EAA+B,mBAA/B,EAAoD;AACrE,QAAI,OAAO,QAAQ,WAAR,CAAP,CADiE;AAErE,QAAI,cAAc,KAAK,WAAL,CAFmD;AAGrE,QAAI,UAAU,KAAK,OAAL,CAHuD;;AAKrE,aAAS,UAAT,GAAsB;AAClB,eAAO,IAAP,CADkB;KAAtB;AAGA,aAAS,SAAT,GAAqB;AACjB,cAAM,IAAN,CADiB;KAArB;AAGA,aAAS,OAAT,CAAiB,CAAjB,EAAoB;AAChB,eAAO,YAAW;AACd,mBAAO,CAAP,CADc;SAAX,CADS;KAApB;AAKA,aAAS,MAAT,CAAgB,CAAhB,EAAmB;AACf,eAAO,YAAW;AACd,kBAAM,CAAN,CADc;SAAX,CADQ;KAAnB;AAKA,aAAS,eAAT,CAAyB,GAAzB,EAA8B,aAA9B,EAA6C,WAA7C,EAA0D;AACtD,YAAI,IAAJ,CADsD;AAEtD,YAAI,YAAY,aAAZ,CAAJ,EAAgC;AAC5B,mBAAO,cAAc,QAAQ,aAAR,CAAd,GAAuC,OAAO,aAAP,CAAvC,CADqB;SAAhC,MAEO;AACH,mBAAO,cAAc,UAAd,GAA2B,SAA3B,CADJ;SAFP;AAKA,eAAO,IAAI,KAAJ,CAAU,IAAV,EAAgB,OAAhB,EAAyB,SAAzB,EAAoC,aAApC,EAAmD,SAAnD,CAAP,CAPsD;KAA1D;;AAUA,aAAS,cAAT,CAAwB,aAAxB,EAAuC;AACnC,YAAI,UAAU,KAAK,OAAL,CADqB;AAEnC,YAAI,UAAU,KAAK,OAAL,CAFqB;;AAInC,YAAI,MAAM,QAAQ,QAAR,KACQ,QAAQ,IAAR,CAAa,QAAQ,WAAR,EAAb,CADR,GAEQ,SAFR,CAJyB;;AAQnC,YAAI,QAAQ,SAAR,EAAmB;AACnB,gBAAI,eAAe,oBAAoB,GAApB,EAAyB,OAAzB,CAAf,CADe;AAEnB,gBAAI,wBAAwB,OAAxB,EAAiC;AACjC,+BAAe,aAAa,OAAb,EAAf,CADiC;AAEjC,uBAAO,gBAAgB,YAAhB,EAA8B,aAA9B,EACiB,QAAQ,WAAR,EADjB,CAAP,CAFiC;aAArC;SAFJ;;AASA,YAAI,QAAQ,UAAR,EAAJ,EAA0B;AACtB,wBAAY,CAAZ,GAAgB,aAAhB,CADsB;AAEtB,mBAAO,WAAP,CAFsB;SAA1B,MAGO;AACH,mBAAO,aAAP,CADG;SAHP;KAjBJ;;AAyBA,aAAS,UAAT,CAAoB,KAApB,EAA2B;AACvB,YAAI,UAAU,KAAK,OAAL,CADS;AAEvB,YAAI,UAAU,KAAK,OAAL,CAFS;;AAIvB,YAAI,MAAM,QAAQ,QAAR,KACQ,QAAQ,IAAR,CAAa,QAAQ,WAAR,EAAb,EAAoC,KAApC,CADR,GAEQ,QAAQ,KAAR,CAFR,CAJa;;AAQvB,YAAI,QAAQ,SAAR,EAAmB;AACnB,gBAAI,eAAe,oBAAoB,GAApB,EAAyB,OAAzB,CAAf,CADe;AAEnB,gBAAI,wBAAwB,OAAxB,EAAiC;AACjC,+BAAe,aAAa,OAAb,EAAf,CADiC;AAEjC,uBAAO,gBAAgB,YAAhB,EAA8B,KAA9B,EAAqC,IAArC,CAAP,CAFiC;aAArC;SAFJ;AAOA,eAAO,KAAP,CAfuB;KAA3B;;AAkBA,YAAQ,SAAR,CAAkB,mBAAlB,GAAwC,UAAU,OAAV,EAAmB,SAAnB,EAA8B;AAClE,YAAI,OAAO,OAAP,KAAmB,UAAnB,EAA+B,OAAO,KAAK,IAAL,EAAP,CAAnC;;AAEA,YAAI,oBAAoB;AACpB,qBAAS,IAAT;AACA,qBAAS,OAAT;SAFA,CAH8D;;AAQlE,eAAO,KAAK,KAAL,CACC,YAAY,cAAZ,GAA6B,UAA7B,EACA,YAAY,cAAZ,GAA6B,SAA7B,EAAwC,SAFzC,EAGC,iBAHD,EAGoB,SAHpB,CAAP,CARkE;KAA9B,CA1E6B;;AAwFrE,YAAQ,SAAR,CAAkB,MAAlB,GACA,QAAQ,SAAR,CAAkB,SAAlB,IAA+B,UAAU,OAAV,EAAmB;AAC9C,eAAO,KAAK,mBAAL,CAAyB,OAAzB,EAAkC,IAAlC,CAAP,CAD8C;KAAnB,CAzFsC;;AA6FrE,YAAQ,SAAR,CAAkB,GAAlB,GAAwB,UAAU,OAAV,EAAmB;AACvC,eAAO,KAAK,mBAAL,CAAyB,OAAzB,EAAkC,KAAlC,CAAP,CADuC;KAAnB,CA7F6C;CAApD","file":"finally-compiled.js","sourcesContent":["\"use strict\";\nmodule.exports = function(Promise, NEXT_FILTER, tryConvertToPromise) {\nvar util = require(\"./util.js\");\nvar isPrimitive = util.isPrimitive;\nvar thrower = util.thrower;\n\nfunction returnThis() {\n    return this;\n}\nfunction throwThis() {\n    throw this;\n}\nfunction return$(r) {\n    return function() {\n        return r;\n    };\n}\nfunction throw$(r) {\n    return function() {\n        throw r;\n    };\n}\nfunction promisedFinally(ret, reasonOrValue, isFulfilled) {\n    var then;\n    if (isPrimitive(reasonOrValue)) {\n        then = isFulfilled ? return$(reasonOrValue) : throw$(reasonOrValue);\n    } else {\n        then = isFulfilled ? returnThis : throwThis;\n    }\n    return ret._then(then, thrower, undefined, reasonOrValue, undefined);\n}\n\nfunction finallyHandler(reasonOrValue) {\n    var promise = this.promise;\n    var handler = this.handler;\n\n    var ret = promise._isBound()\n                    ? handler.call(promise._boundValue())\n                    : handler();\n\n    if (ret !== undefined) {\n        var maybePromise = tryConvertToPromise(ret, promise);\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            return promisedFinally(maybePromise, reasonOrValue,\n                                    promise.isFulfilled());\n        }\n    }\n\n    if (promise.isRejected()) {\n        NEXT_FILTER.e = reasonOrValue;\n        return NEXT_FILTER;\n    } else {\n        return reasonOrValue;\n    }\n}\n\nfunction tapHandler(value) {\n    var promise = this.promise;\n    var handler = this.handler;\n\n    var ret = promise._isBound()\n                    ? handler.call(promise._boundValue(), value)\n                    : handler(value);\n\n    if (ret !== undefined) {\n        var maybePromise = tryConvertToPromise(ret, promise);\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            return promisedFinally(maybePromise, value, true);\n        }\n    }\n    return value;\n}\n\nPromise.prototype._passThroughHandler = function (handler, isFinally) {\n    if (typeof handler !== \"function\") return this.then();\n\n    var promiseAndHandler = {\n        promise: this,\n        handler: handler\n    };\n\n    return this._then(\n            isFinally ? finallyHandler : tapHandler,\n            isFinally ? finallyHandler : undefined, undefined,\n            promiseAndHandler, undefined);\n};\n\nPromise.prototype.lastly =\nPromise.prototype[\"finally\"] = function (handler) {\n    return this._passThroughHandler(handler, true);\n};\n\nPromise.prototype.tap = function (handler) {\n    return this._passThroughHandler(handler, false);\n};\n};\n"]}