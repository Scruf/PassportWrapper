{"version":3,"sources":["thenables.js"],"names":[],"mappings":"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","file":"thenables-compiled.js","sourcesContent":["\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar util = require(\"./util.js\");\nvar errorObj = util.errorObj;\nvar isObject = util.isObject;\n\nfunction tryConvertToPromise(obj, context) {\n    if (isObject(obj)) {\n        if (obj instanceof Promise) {\n            return obj;\n        }\n        else if (isAnyBluebirdPromise(obj)) {\n            var ret = new Promise(INTERNAL);\n            obj._then(\n                ret._fulfillUnchecked,\n                ret._rejectUncheckedCheckError,\n                ret._progressUnchecked,\n                ret,\n                null\n            );\n            return ret;\n        }\n        var then = util.tryCatch(getThen)(obj);\n        if (then === errorObj) {\n            if (context) context._pushContext();\n            var ret = Promise.reject(then.e);\n            if (context) context._popContext();\n            return ret;\n        } else if (typeof then === \"function\") {\n            return doThenable(obj, then, context);\n        }\n    }\n    return obj;\n}\n\nfunction getThen(obj) {\n    return obj.then;\n}\n\nvar hasProp = {}.hasOwnProperty;\nfunction isAnyBluebirdPromise(obj) {\n    return hasProp.call(obj, \"_promise0\");\n}\n\nfunction doThenable(x, then, context) {\n    var promise = new Promise(INTERNAL);\n    var ret = promise;\n    if (context) context._pushContext();\n    promise._captureStackTrace();\n    if (context) context._popContext();\n    var synchronous = true;\n    var result = util.tryCatch(then).call(x,\n                                        resolveFromThenable,\n                                        rejectFromThenable,\n                                        progressFromThenable);\n    synchronous = false;\n    if (promise && result === errorObj) {\n        promise._rejectCallback(result.e, true, true);\n        promise = null;\n    }\n\n    function resolveFromThenable(value) {\n        if (!promise) return;\n        promise._resolveCallback(value);\n        promise = null;\n    }\n\n    function rejectFromThenable(reason) {\n        if (!promise) return;\n        promise._rejectCallback(reason, synchronous, true);\n        promise = null;\n    }\n\n    function progressFromThenable(value) {\n        if (!promise) return;\n        if (typeof promise._progress === \"function\") {\n            promise._progress(value);\n        }\n    }\n    return ret;\n}\n\nreturn tryConvertToPromise;\n};\n"]}