{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["// muri\n\n/**\n * MongoDB URI parser as described here:\n * http://www.mongodb.org/display/DOCS/Connections\n */\n\n/**\n * Module dependencies\n */\n\nvar qs = require('querystring');\n\n/**\n * Defaults\n */\n\nvar DEFAULT_PORT = 27017;\nvar DEFAULT_DB = 'test';\nvar ADMIN_DB = 'admin';\n\n/**\n * Muri\n */\n\nmodule.exports = exports = function muri (str) {\n  if (!/^mongodb:\\/\\//.test(str)) {\n    throw new Error('Invalid mongodb uri. Must begin with \"mongodb://\"'\n                  + '\\n  Received: ' + str);\n  }\n\n  var ret = {\n      hosts: []\n    , db: DEFAULT_DB\n    , options: {}\n  }\n\n  var match = /^mongodb:\\/\\/([^?]+)(\\??.*)$/.exec(str);\n  if (!match || '/' == match[1]) {\n    throw new Error('Invalid mongodb uri. Missing hostname');\n  }\n\n  var uris = match[1];\n  var path = match[2];\n  var db;\n\n  uris.split(',').forEach(function (uri) {\n    var o = parse(uri);\n\n    if (o.host) {\n      ret.hosts.push({\n          host: o.host\n        , port: parseInt(o.port, 10)\n      })\n\n      if (!db && o.db) {\n        db = o.db;\n      }\n    } else if (o.ipc) {\n      ret.hosts.push({ ipc: o.ipc });\n    }\n\n    if (o.auth) {\n      ret.auth = {\n          user: o.auth.user\n        , pass: o.auth.pass\n      }\n    }\n  })\n\n  if (!ret.hosts.length) {\n    throw new Error('Invalid mongodb uri. Missing hostname');\n  }\n\n  var parts = path.split('?');\n\n  if (!db) {\n    if (parts[0]) {\n      db = parts[0].replace(/^\\//, '');\n    } else {\n      // deal with ipc formats\n      db = /\\/([^\\.]+)$/.exec(match[1]);\n      if (db && db[1]) {\n        db = db[1];\n      }\n    }\n  }\n\n  if (db) {\n    ret.db = db;\n  } else if (ret.auth) {\n    ret.db = ADMIN_DB;\n  }\n\n  if (parts[1]) {\n    ret.options = options(parts[1]);\n  }\n\n  return ret;\n}\n\n/**\n * Parse str into key/val pairs casting values appropriately.\n */\n\nfunction options (str) {\n  var sep = /;/.test(str)\n    ? ';'\n    : '&';\n\n  var ret = qs.parse(str, sep);\n\n  Object.keys(ret).forEach(function (key) {\n    var val = ret[key];\n    if ('readPreferenceTags' == key) {\n      val = readPref(val);\n      if (val) {\n        ret[key] = Array.isArray(val)\n          ? val\n          : [val];\n      }\n    } else {\n      ret[key] = format(val);\n    }\n  });\n\n  return ret;\n}\n\nfunction format (val) {\n  var num;\n\n  if ('true' == val) {\n    return true;\n  } else if ('false' == val) {\n    return false;\n  } else {\n    num = parseInt(val, 10);\n    if (!isNaN(num)) {\n      return num;\n    }\n  }\n\n  return val;\n}\n\nfunction readPref (val) {\n  var ret;\n\n  if (Array.isArray(val)) {\n    ret = val.map(readPref).filter(Boolean);\n    return ret.length\n      ? ret\n      : undefined\n  }\n\n  var pair = val.split(',');\n  var hasKeys;\n  ret = {};\n\n  pair.forEach(function (kv) {\n    kv = (kv || '').trim();\n    if (!kv) return;\n    hasKeys = true;\n    var split = kv.split(':');\n    ret[split[0]] = format(split[1]);\n  });\n\n  return hasKeys && ret;\n}\n\nvar ipcRgx = /\\.sock/;\n\nfunction parse (uriString) {\n  // do not use require('url').parse b/c it can't handle # in username or pwd\n  // mongo uris are strange\n\n  var uri = uriString;\n  var ret = {};\n  var parts;\n  var auth;\n  var ipcs;\n\n  // skip protocol\n  uri = uri.replace(/^mongodb:\\/\\//, '');\n\n  // auth\n  if (/@/.test(uri)) {\n    parts = uri.split(/@/);\n    auth = parts[0];\n    uri = parts[1];\n\n    parts = auth.split(':');\n    ret.auth = {};\n    ret.auth.user = parts[0];\n    ret.auth.pass = parts[1];\n  }\n\n  // unix domain sockets\n  if (ipcRgx.test(uri)) {\n    ipcs = uri.split(ipcRgx);\n    ret.ipc = ipcs[0] + '.sock';\n\n    // included a database?\n    if (ipcs[1]) {\n      // strip leading / from database name\n      ipcs[1] = ipcs[1].replace(/^\\//, '');\n\n      if (ipcs[1]) {\n        ret.db = ipcs[1];\n      }\n    }\n\n    return ret;\n  }\n\n  // database name\n  parts = uri.split('/');\n  if (parts[1]) ret.db = parts[1];\n\n  // ipv6, [ip]:host\n  if (/^\\[[^\\]]+\\]:\\d+/.test(parts[0])) {\n    ret.host = parts[0].substring(1, parts[0].indexOf(']:'));\n    ret.port = parts[0].substring(parts[0].indexOf(']:') + ']:'.length);\n  } else {\n    // host:port\n    parts = parts[0].split(':');\n    ret.host = parts[0];\n    ret.port = parts[1] || DEFAULT_PORT;\n  }\n\n  return ret;\n}\n\n/**\n * Version\n */\n\nmodule.exports.version = JSON.parse(\n  require('fs').readFileSync(__dirname + '/../package.json', 'utf8')\n).version;\n"]}