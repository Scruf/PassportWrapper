{"version":3,"sources":["promise.test.js"],"names":[],"mappings":"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","file":"promise.test-compiled.js","sourcesContent":["/*global describe,it */\n/**\n * Module dependencies.\n */\n\nvar assert = require('assert');\nvar MPromise = require('../');\n\n/**\n * Test.\n */\n\ndescribe('promise', function () {\n  it('events fire right after fulfill()', function (done) {\n    var promise = new MPromise()\n      , called = 0;\n\n    promise.on('fulfill', function (a, b) {\n      assert.equal(a, '1');\n      assert.equal(b, '2');\n      called++;\n    });\n\n    promise.fulfill('1', '2');\n\n    promise.on('fulfill', function (a, b) {\n      assert.equal(a, '1');\n      assert.equal(b, '2');\n      called++;\n    });\n\n    assert.equal(2, called);\n    done();\n  });\n\n  it('events fire right after reject()', function (done) {\n    var promise = new MPromise()\n      , called = 0;\n\n    promise.on('reject', function (err) {\n      assert.ok(err instanceof Error);\n      called++;\n    });\n\n    promise.reject(new Error('booyah'));\n\n    promise.on('reject', function (err) {\n      assert.ok(err instanceof Error);\n      called++;\n    });\n\n    assert.equal(2, called);\n    done()\n  });\n\n  describe('onResolve()', function () {\n    it('from constructor works', function (done) {\n      var called = 0;\n\n      var promise = new MPromise(function (err) {\n        assert.ok(err instanceof Error);\n        called++;\n      });\n\n      promise.reject(new Error('dawg'));\n\n      assert.equal(1, called);\n      done();\n    });\n\n    it('after fulfill()', function (done) {\n      var promise = new MPromise()\n        , called = 0;\n\n      promise.fulfill('woot');\n\n      promise.onResolve(function (err, data) {\n        assert.equal(data, 'woot');\n        called++;\n      });\n\n      promise.onResolve(function (err) {\n        assert.strictEqual(err, null);\n        called++;\n      });\n\n      assert.equal(2, called);\n      done();\n    })\n  });\n\n  describe('onFulfill shortcut', function () {\n    it('works', function (done) {\n      var promise = new MPromise()\n        , called = 0;\n\n      promise.onFulfill(function (woot) {\n        assert.strictEqual(woot, undefined);\n        called++;\n      });\n\n      promise.fulfill();\n\n      assert.equal(1, called);\n      done();\n    });\n  });\n\n  describe('onReject shortcut', function () {\n    it('works', function (done) {\n      var promise = new MPromise()\n        , called = 0;\n\n      promise.onReject(function (err) {\n        assert.ok(err instanceof Error);\n        called++;\n      });\n\n      promise.reject(new Error);\n      assert.equal(1, called);\n      done();\n    })\n  });\n\n  describe('return values', function () {\n    it('on()', function (done) {\n      var promise = new MPromise();\n      assert.ok(promise.on('jump', function () {}) instanceof MPromise);\n      done()\n    });\n\n    it('onFulfill()', function (done) {\n      var promise = new MPromise();\n      assert.ok(promise.onFulfill(function () {}) instanceof MPromise);\n      done();\n    });\n    it('onReject()', function (done) {\n      var promise = new MPromise();\n      assert.ok(promise.onReject(function () {}) instanceof MPromise);\n      done();\n    });\n    it('onResolve()', function (done) {\n      var promise = new MPromise();\n      assert.ok(promise.onResolve(function () {}) instanceof MPromise);\n      done();\n    })\n  });\n\n  describe('casting errors', function () {\n    describe('reject()', function () {\n      it('does not cast arguments to Error', function (done) {\n        var p = new MPromise(function (err) {\n          assert.equal(3, err);\n          done();\n        });\n\n        p.reject(3);\n      })\n    })\n  });\n\n  describe('then', function () {\n    describe('catching', function () {\n      it('should not catch returned promise fulfillments', function (done) {\n        var errorSentinal\n          , p = new MPromise;\n        p.then(function () { throw errorSentinal = new Error(\"boo!\") });\n\n        p.fulfill();\n        done();\n      });\n\n\n      it('should not catch returned promise fulfillments even async', function (done) {\n        var errorSentinal\n          , p = new MPromise;\n        p.then(function () { throw errorSentinal = new Error(\"boo!\") });\n\n        setTimeout(function () {\n          p.fulfill();\n          done();\n        }, 10);\n      });\n\n\n      it('can be disabled using .end()', function (done) {\n        if (process.version.indexOf('v0.8') == 0) return done();\n        var errorSentinal\n          , overTimeout\n          , domain = require('domain').create();\n\n        domain.once('error', function (err) {\n          assert(err, errorSentinal);\n          clearTimeout(overTimeout);\n          done()\n        });\n\n        domain.run(function () {\n          var p = new MPromise;\n          var p2 = p.then(function () {\n            throw errorSentinal = new Error('shucks')\n          });\n          p2.end();\n\n          p.fulfill();\n        });\n        overTimeout = setTimeout(function () { done(new Error('error was swallowed')); }, 10);\n      });\n\n\n      it('can be disabled using .end() even when async', function (done) {\n        if (process.version.indexOf('v0.10') != 0) return done();\n        var errorSentinal\n          , overTimeout\n          , domain = require('domain').create();\n\n        domain.on('error', function (err) {\n          assert(err, errorSentinal);\n          clearTimeout(overTimeout);\n          done()\n        });\n\n        domain.run(function () {\n          var p = new MPromise;\n          var p2 = p.then(function () {\n            throw errorSentinal = new Error(\"boo!\")\n          });\n          p2.end();\n\n          setTimeout(function () {p.fulfill();}, 10);\n        });\n        overTimeout = setTimeout(function () { done(new Error('error was swallowed')); }, 20);\n      });\n\n\n      it('can be handled using .end() so no throwing', function (done) {\n        var errorSentinal\n          , overTimeout\n          , domain = require('domain').create();\n\n        domain.run(function () {\n          var p = new MPromise;\n          var p2 = p.then(function () {\n            throw errorSentinal = new Error(\"boo!\")\n          });\n          p2.end(function (err) {\n            assert.equal(err, errorSentinal);\n            clearTimeout(overTimeout);\n            done()\n          });\n\n          setTimeout(function () {p.fulfill();}, 10);\n        });\n        overTimeout = setTimeout(function () { done(new Error('error was swallowed')); }, 20);\n      });\n\n    });\n\n    it('persistent', function (done) {\n      var p = new MPromise;\n      v = null;\n\n      function ensure(val) {\n        v = v || val;\n        assert.equal(v, val);\n      }\n\n      function guard() {\n        throw new Error('onReject should not be called');\n      }\n\n      p.then(ensure, guard).end();\n\n      p.fulfill('foo');\n      p.fulfill('bar');\n      p.reject(new Error('baz'));\n\n      p.then(ensure, guard).end();\n\n      setTimeout(done, 0);\n    });\n\n\n    it('accepts multiple completion values', function (done) {\n      var p = new MPromise;\n\n      p.then(function (a, b) {\n        assert.equal(2, arguments.length);\n        assert.equal('hi', a);\n        assert.equal(4, b);\n        done();\n      }, done).end();\n\n      p.fulfill('hi', 4);\n    })\n  });\n\n  describe('fulfill values and splats', function () {\n    it('should handle multiple values', function (done) {\n      var p = new MPromise;\n      p.onFulfill(function (a, b, c) {\n        assert.equal('a', a);\n        assert.equal('b', b);\n        assert.equal('c', c);\n        done();\n      });\n      p.fulfill('a', 'b', 'c');\n    });\n\n    it('should handle multiple values from a then', function (done) {\n      MPromise.fulfilled().then(\n        function () {\n          return MPromise.fulfilled().then(\n            function () {\n              var p = new MPromise;\n              p.fulfill('a', 'b', 'c');\n              return p;\n            }\n          );\n        }\n      ).onFulfill(\n        function (a, b, c) {\n          assert.equal('a', a);\n          assert.equal('b', b);\n          assert.equal('c', c);\n          done();\n        }\n      ).end()\n    });\n\n    it('should work with `fulfilled` convenience method', function (done) {\n      MPromise.fulfilled('a', 'b', 'c').then(function (a, b, c) {\n        assert.equal('a', a);\n        assert.equal('b', b);\n        assert.equal('c', c);\n        done();\n      })\n    });\n  });\n\n\n  describe('end', function () {\n    it(\"should return the promise\", function (done) {\n      var p = new MPromise;\n      var p1 = p.end();\n      assert.equal(p, p1);\n      done();\n    });\n\n\n    it(\"should throw for chain\", function (done) {\n      var p = new MPromise;\n      p.then().then().then().then().end();\n      try {\n        p.reject('bad');\n      } catch (e) {\n        done();\n      }\n    });\n\n\n    it(\"should not throw for chain with reject handler\", function (done) {\n      var p = new MPromise;\n      p.then().then().then().then().end(function () {\n        done();\n      });\n      try {\n        p.reject('bad');\n      } catch (e) {\n        done(e);\n      }\n    });\n  });\n\n\n  describe('chain', function () {\n    it('should propagate fulfillment', function (done) {\n      var varSentinel = {a: 'a'};\n      var p1 = new MPromise;\n      p1.chain(new MPromise(function (err, doc) {\n        assert.equal(doc, varSentinel);\n        done();\n      }));\n      p1.fulfill(varSentinel);\n    });\n\n\n    it('should propagate rejection', function (done) {\n      var e = new Error(\"gaga\");\n      var p1 = new MPromise;\n      p1.chain(new MPromise(function (err) {\n        assert.equal(err, e);\n        done();\n      }));\n      p1.reject(e);\n    });\n\n\n    it('should propagate resolution err', function (done) {\n      var e = new Error(\"gaga\");\n      var p1 = new MPromise;\n      p1.chain(new MPromise(function (err) {\n        assert.equal(err, e);\n        done();\n      }));\n      p1.resolve(e);\n    });\n\n\n    it('should propagate resolution val', function (done) {\n      var varSentinel = {a: 'a'};\n      var p1 = new MPromise;\n      p1.chain(new MPromise(function (err, val) {\n        assert.equal(val, varSentinel);\n        done();\n      }));\n      p1.resolve(null, varSentinel);\n    })\n  });\n\n\n  describe(\"all\", function () {\n    it(\"works\", function (done) {\n      var count = 0;\n      var p = new MPromise;\n      var p2 = p.all(function () {\n        return [\n          (function () {\n            var p = new MPromise();\n            count++;\n            p.resolve();\n            return p;\n          })()\n          , (function () {\n            var p = new MPromise();\n            count++;\n            p.resolve();\n            return p;\n          })()\n        ];\n      });\n      p2.then(function () {\n        assert.equal(count, 2);\n        done();\n      });\n      p.resolve();\n    });\n\n\n    it(\"handles rejects\", function (done) {\n      var count = 0;\n      var p = new MPromise;\n      var p2 = p.all(function () {\n        return [\n          (function () {\n            var p = new MPromise();\n            count++;\n            p.resolve();\n            return p;\n          })()\n          , (function () {\n            count++;\n            throw new Error(\"gaga\");\n          })()\n        ];\n      });\n      p2.onReject(function (err) {\n        assert(err.message, \"gaga\");\n        assert.equal(count, 2);\n        done();\n      });\n      p.resolve();\n    });\n  });\n\n\n  describe(\"deferred\", function () {\n    it(\"works\", function (done) {\n      var d = MPromise.deferred();\n      assert.ok(d.promise instanceof MPromise);\n      assert.ok(d.reject instanceof Function);\n      assert.ok(d.resolve instanceof Function);\n      assert.ok(d.callback instanceof Function);\n      done();\n    });\n  });\n\n\n  describe(\"hook\", function () {\n    it(\"works\", function (done) {\n      var run = 0;\n      var l1 = function (ser, par) {\n        run++;\n        ser();\n        par();\n      };\n      MPromise.hook([l1, l1, l1]).then(function () {\n        assert(run, 3);\n        done();\n      })\n\n    });\n\n\n    it(\"works with async serial hooks\", function (done) {\n      this.timeout(800);\n      var run = 0;\n      var l1 = function (ser, par) {\n        run++;\n        setTimeout(function () {ser();}, 200);\n        par();\n      };\n      MPromise.hook([l1, l1, l1]).then(function () {\n        assert(run, 3);\n        done();\n      })\n    });\n\n\n    it(\"works with async parallel hooks\", function (done) {\n      this.timeout(400);\n      var run = 0;\n      var l1 = function (ser, par) {\n        run++;\n        ser();\n        setTimeout(function () {par();}, 200);\n      };\n      MPromise.hook([l1, l1, l1]).then(function () {\n        assert(run, 3);\n        done();\n      })\n    });\n\n\n    it(\"catches errors in hook logic\", function (done) {\n      var run = 0;\n      var l1 = function (ser, par) {\n        run++;\n        ser();\n        par();\n      };\n      var l2 = function (ser, par) {\n        run++;\n        ser();\n        par();\n        throw new Error(\"err\")\n      };\n      MPromise.hook([l1, l2, l1]).end(function (err) {\n        assert(run, 2);\n        done();\n      });\n    });\n  });\n});\n"]}