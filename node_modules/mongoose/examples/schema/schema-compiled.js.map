{"version":3,"sources":["schema.js"],"names":[],"mappings":";;;;AAIA,IAAI,WAAW,QAAQ,WAAR,CAAX;IACA,SAAS,SAAS,MAAT;;;;;;;;AAQb,IAAI,UAAU,IAAI,MAAJ,EAAV;;AAEJ,QAAQ,GAAR,CAAY;AACV,SAAO;AACL,UAAM,MAAN;AACA,WAAO,IAAP;GAFF;AAIA,QAAM,IAAN;AACA,QAAM,MAAN;AACA,YAAU,CAAC,OAAD,CAAV;CAPF;;AAUA,IAAI,WAAW,IAAI,MAAJ,CAAW;AACxB,SAAO;AACL,UAAM,MAAN;AACA,WAAO,IAAP;GAFF;AAIA,QAAM;AACJ,UAAM,MAAN;AACA,eAAW,IAAX;AACA,UAAM,IAAN;GAHF;AAKA,QAAM,IAAN;AACA,OAAK,MAAL;AACA,YAAU,CAAC,OAAD,CAAV;AACA,WAAS,OAAO,QAAP;CAbI,CAAX;;AAgBJ,IAAI,SAAS,IAAI,MAAJ,CAAW;AACtB,QAAM;AACJ,WAAO,MAAP;AACA,UAAM,MAAN;GAFF;AAIA,SAAO;AACL,UAAM,MAAN;AACA,cAAU,IAAV;AACA,WAAO;AACL,cAAQ,IAAR;AACA,cAAQ,IAAR;KAFF;GAHF;AAQA,SAAO,OAAP;CAbW,CAAT;;;;;;AAoBJ,SAAS,IAAT,CAAc,MAAd,EACC,OADD,CACS,YAAW;AAClB,SAAO,IAAI,IAAJ,EAAP,CADkB;CAAX,CADT,CAIC,GAJD,CAIK,UAAS,CAAT,EAAY;AACf,SAAO,MAAM,KAAN,GAAc,IAAI,IAAJ,EAAd,GAA2B,CAA3B,CADQ;CAAZ,CAJL;;;;;;AAYA,SAAS,GAAT,CAAa,MAAb,EAAqB,UAAS,IAAT,EAAe,IAAf,EAAqB;;AAExC,cAAY,IAAZ;AAFwC,MAGxC,GAHwC;CAArB,CAArB;;;;;;AAUA,SAAS,OAAT,CAAiB,WAAjB,GAA+B,UAAS,QAAT,EAAmB;AAChD,SAAO,KAAK,EAAL,CAAQ,KAAR,CAAc,QAAd,EAAwB,QAAxB,CAAiC,KAAK,OAAL,EAAc,QAA/C,CAAP,CADgD;CAAnB;;AAI/B,SAAS,OAAT,CAAiB,WAAjB,GAA+B,UAAS,KAAT,EAAgB,QAAhB,EAA0B;AACvD,SAAO,KAAK,IAAL,CAAU,EAAC,OAAO,KAAP,EAAX,EAA0B,QAA1B,CAAP,CADuD;CAA1B;;AAI/B,SAAS,OAAT,CAAiB,eAAjB,GAAmC,UAAS,OAAT,EAAkB,IAAlB,EAAwB,QAAxB,EAAkC;AACnE,SAAO,KAAK,IAAL,CAAU,SAAV,EAAqB,OAArB,EAA8B,KAA9B,CAAoC,MAApC,EAA4C,GAA5C,CAAgD,IAAhD,EAAsD,GAAtD,CAA0D,QAA1D,CAAP,CADmE;CAAlC;;;;;;AAQnC,SAAS,aAAT,CAAuB,OAAvB,EAAgC;AAC9B,YAAU,WAAW,EAAX,CADoB;AAE9B,MAAI,MAAM,QAAQ,GAAR,IAAe,OAAf,CAFoB;;AAI9B,SAAO,SAAS,aAAT,CAAuB,MAAvB,EAA+B;AACpC,WAAO,IAAP,CAAY,GAAZ,EAAiB,GAAjB,CAAqB,UAAS,CAAT,EAAY;AAC/B,WAAK,IAAL,GAAY,EAAE,WAAF,GAAgB,OAAhB,CAAwB,YAAxB,EAAsC,EAAtC,EAA0C,OAA1C,CAAkD,KAAlD,EAAyD,EAAzD,CAAZ,CAD+B;AAE/B,aAAO,CAAP,CAF+B;KAAZ,CAArB,CADoC;GAA/B,CAJuB;CAAhC;;AAYA,SAAS,MAAT,CAAgB,eAAhB;;;;;;AAMA,SAAS,KAAT,CAAe,UAAf,EAA2B,QAA3B;AACA,SAAS,KAAT,CAAe,QAAf,EAAyB,MAAzB","file":"schema-compiled.js","sourcesContent":["/**\n * Module dependencies.\n */\n\nvar mongoose = require('../../lib'),\n    Schema = mongoose.Schema;\n\n/**\n * Schema definition\n */\n\n// recursive embedded-document schema\n\nvar Comment = new Schema();\n\nComment.add({\n  title: {\n    type: String,\n    index: true\n  },\n  date: Date,\n  body: String,\n  comments: [Comment]\n});\n\nvar BlogPost = new Schema({\n  title: {\n    type: String,\n    index: true\n  },\n  slug: {\n    type: String,\n    lowercase: true,\n    trim: true\n  },\n  date: Date,\n  buf: Buffer,\n  comments: [Comment],\n  creator: Schema.ObjectId\n});\n\nvar Person = new Schema({\n  name: {\n    first: String,\n    last: String\n  },\n  email: {\n    type: String,\n    required: true,\n    index: {\n      unique: true,\n      sparse: true\n    }\n  },\n  alive: Boolean\n});\n\n/**\n * Accessing a specific schema type by key\n */\n\nBlogPost.path('date')\n.default(function() {\n  return new Date();\n})\n.set(function(v) {\n  return v === 'now' ? new Date() : v;\n});\n\n/**\n * Pre hook.\n */\n\nBlogPost.pre('save', function(next, done) {\n  /* global emailAuthor */\n  emailAuthor(done); // some async function\n  next();\n});\n\n/**\n * Methods\n */\n\nBlogPost.methods.findCreator = function(callback) {\n  return this.db.model('Person').findById(this.creator, callback);\n};\n\nBlogPost.statics.findByTitle = function(title, callback) {\n  return this.find({title: title}, callback);\n};\n\nBlogPost.methods.expressiveQuery = function(creator, date, callback) {\n  return this.find('creator', creator).where('date').gte(date).run(callback);\n};\n\n/**\n * Plugins\n */\n\nfunction slugGenerator(options) {\n  options = options || {};\n  var key = options.key || 'title';\n\n  return function slugGenerator(schema) {\n    schema.path(key).set(function(v) {\n      this.slug = v.toLowerCase().replace(/[^a-z0-9]/g, '').replace(/-+/g, '');\n      return v;\n    });\n  };\n}\n\nBlogPost.plugin(slugGenerator());\n\n/**\n * Define model.\n */\n\nmongoose.model('BlogPost', BlogPost);\nmongoose.model('Person', Person);\n"]}