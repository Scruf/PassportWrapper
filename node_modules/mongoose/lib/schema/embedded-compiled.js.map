{"version":3,"sources":["embedded.js"],"names":[],"mappings":"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","file":"embedded-compiled.js","sourcesContent":["var SchemaType = require('../schematype');\nvar Subdocument = require('../types/subdocument');\n\nmodule.exports = Embedded;\n\n/**\n * Sub-schema schematype constructor\n *\n * @param {Schema} schema\n * @param {String} key\n * @param {Object} options\n * @inherits SchemaType\n * @api public\n */\n\nfunction Embedded(schema, path, options) {\n  var _embedded = function(value, path, parent) {\n    var _this = this;\n    Subdocument.apply(this, arguments);\n    this.$parent = parent;\n    if (parent) {\n      parent.on('save', function() {\n        _this.emit('save', _this);\n      });\n    }\n  };\n  _embedded.prototype = Object.create(Subdocument.prototype);\n  _embedded.prototype.$__setSchema(schema);\n  _embedded.schema = schema;\n  _embedded.$isSingleNested = true;\n  _embedded.prototype.$basePath = path;\n\n  // apply methods\n  for (var i in schema.methods) {\n    _embedded.prototype[i] = schema.methods[i];\n  }\n\n  // apply statics\n  for (i in schema.statics) {\n    _embedded[i] = schema.statics[i];\n  }\n\n  this.caster = _embedded;\n  this.schema = schema;\n  this.$isSingleNested = true;\n  SchemaType.call(this, path, options, 'Embedded');\n}\n\nEmbedded.prototype = Object.create(SchemaType.prototype);\n\n/**\n * Casts contents\n *\n * @param {Object} value\n * @api private\n */\n\nEmbedded.prototype.cast = function(val, doc, init) {\n  if (val && val.$isSingleNested) {\n    return val;\n  }\n  var subdoc = new this.caster(void 0, doc ? doc.$__.selected : void 0, doc);\n  if (init) {\n    subdoc.init(val);\n  } else {\n    subdoc.set(val, undefined, true);\n  }\n  return subdoc;\n};\n\n/**\n * Casts contents for query\n *\n * @param {string} [$conditional] optional query operator (like `$eq` or `$in`)\n * @param {any} value\n * @api private\n */\n\nEmbedded.prototype.castForQuery = function($conditional, val) {\n  var handler;\n  if (arguments.length === 2) {\n    handler = this.$conditionalHandlers[$conditional];\n    if (!handler) {\n      throw new Error('Can\\'t use ' + $conditional);\n    }\n    return handler.call(this, val);\n  }\n  val = $conditional;\n  return new this.caster(val).toObject({virtuals: false});\n};\n\n/**\n * Async validation on this single nested doc.\n *\n * @api private\n */\n\nEmbedded.prototype.doValidate = function(value, fn) {\n  SchemaType.prototype.doValidate.call(this, value, function(error) {\n    if (error) {\n      return fn(error);\n    }\n    if (!value) {\n      return fn(null);\n    }\n    value.validate(fn, {__noPromise: true});\n  });\n};\n\n/**\n * Synchronously validate this single nested doc\n *\n * @api private\n */\n\nEmbedded.prototype.doValidateSync = function(value) {\n  var schemaTypeError = SchemaType.prototype.doValidateSync.call(this, value);\n  if (schemaTypeError) {\n    return schemaTypeError;\n  }\n  if (!value) {\n    return;\n  }\n  return value.validateSync();\n};\n"]}