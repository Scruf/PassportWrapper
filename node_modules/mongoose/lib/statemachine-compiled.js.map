{"version":3,"sources":["statemachine.js"],"names":[],"mappings":"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","file":"statemachine-compiled.js","sourcesContent":["\n/*!\n * Module dependencies.\n */\n\nvar utils = require('./utils');\n\n/*!\n * StateMachine represents a minimal `interface` for the\n * constructors it builds via StateMachine.ctor(...).\n *\n * @api private\n */\n\nvar StateMachine = module.exports = exports = function StateMachine() {\n};\n\n/*!\n * StateMachine.ctor('state1', 'state2', ...)\n * A factory method for subclassing StateMachine.\n * The arguments are a list of states. For each state,\n * the constructor's prototype gets state transition\n * methods named after each state. These transition methods\n * place their path argument into the given state.\n *\n * @param {String} state\n * @param {String} [state]\n * @return {Function} subclass constructor\n * @private\n */\n\nStateMachine.ctor = function() {\n  var states = utils.args(arguments);\n\n  var ctor = function() {\n    StateMachine.apply(this, arguments);\n    this.paths = {};\n    this.states = {};\n    this.stateNames = states;\n\n    var i = states.length,\n        state;\n\n    while (i--) {\n      state = states[i];\n      this.states[state] = {};\n    }\n  };\n\n  ctor.prototype = new StateMachine();\n\n  states.forEach(function(state) {\n    // Changes the `path`'s state to `state`.\n    ctor.prototype[state] = function(path) {\n      this._changeState(path, state);\n    };\n  });\n\n  return ctor;\n};\n\n/*!\n * This function is wrapped by the state change functions:\n *\n * - `require(path)`\n * - `modify(path)`\n * - `init(path)`\n *\n * @api private\n */\n\nStateMachine.prototype._changeState = function _changeState(path, nextState) {\n  var prevBucket = this.states[this.paths[path]];\n  if (prevBucket) delete prevBucket[path];\n\n  this.paths[path] = nextState;\n  this.states[nextState][path] = true;\n};\n\n/*!\n * ignore\n */\n\nStateMachine.prototype.clear = function clear(state) {\n  var keys = Object.keys(this.states[state]),\n      i = keys.length,\n      path;\n\n  while (i--) {\n    path = keys[i];\n    delete this.states[state][path];\n    delete this.paths[path];\n  }\n};\n\n/*!\n * Checks to see if at least one path is in the states passed in via `arguments`\n * e.g., this.some('required', 'inited')\n *\n * @param {String} state that we want to check for.\n * @private\n */\n\nStateMachine.prototype.some = function some() {\n  var _this = this;\n  var what = arguments.length ? arguments : this.stateNames;\n  return Array.prototype.some.call(what, function(state) {\n    return Object.keys(_this.states[state]).length;\n  });\n};\n\n/*!\n * This function builds the functions that get assigned to `forEach` and `map`,\n * since both of those methods share a lot of the same logic.\n *\n * @param {String} iterMethod is either 'forEach' or 'map'\n * @return {Function}\n * @api private\n */\n\nStateMachine.prototype._iter = function _iter(iterMethod) {\n  return function() {\n    var numArgs = arguments.length,\n        states = utils.args(arguments, 0, numArgs - 1),\n        callback = arguments[numArgs - 1];\n\n    if (!states.length) states = this.stateNames;\n\n    var _this = this;\n\n    var paths = states.reduce(function(paths, state) {\n      return paths.concat(Object.keys(_this.states[state]));\n    }, []);\n\n    return paths[iterMethod](function(path, i, paths) {\n      return callback(path, i, paths);\n    });\n  };\n};\n\n/*!\n * Iterates over the paths that belong to one of the parameter states.\n *\n * The function profile can look like:\n * this.forEach(state1, fn);         // iterates over all paths in state1\n * this.forEach(state1, state2, fn); // iterates over all paths in state1 or state2\n * this.forEach(fn);                 // iterates over all paths in all states\n *\n * @param {String} [state]\n * @param {String} [state]\n * @param {Function} callback\n * @private\n */\n\nStateMachine.prototype.forEach = function forEach() {\n  this.forEach = this._iter('forEach');\n  return this.forEach.apply(this, arguments);\n};\n\n/*!\n * Maps over the paths that belong to one of the parameter states.\n *\n * The function profile can look like:\n * this.forEach(state1, fn);         // iterates over all paths in state1\n * this.forEach(state1, state2, fn); // iterates over all paths in state1 or state2\n * this.forEach(fn);                 // iterates over all paths in all states\n *\n * @param {String} [state]\n * @param {String} [state]\n * @param {Function} callback\n * @return {Array}\n * @private\n */\n\nStateMachine.prototype.map = function map() {\n  this.map = this._iter('map');\n  return this.map.apply(this, arguments);\n};\n"]}