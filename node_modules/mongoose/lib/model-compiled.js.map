{"version":3,"sources":["model.js"],"names":[],"mappings":";;;;AAIA,IAAI,WAAW,QAAQ,YAAR,CAAX;AACJ,IAAI,gBAAgB,QAAQ,SAAR,CAAhB;AACJ,IAAI,eAAe,cAAc,YAAd;AACnB,IAAI,sBAAsB,cAAc,mBAAd;AAC1B,IAAI,QAAQ,QAAQ,SAAR,CAAR;AACJ,IAAI,YAAY,QAAQ,aAAR,CAAZ;AACJ,IAAI,SAAS,QAAQ,UAAR,CAAT;AACJ,IAAI,QAAQ,QAAQ,SAAR,CAAR;AACJ,IAAI,iBAAiB,MAAM,MAAN,CAAa,cAAb;AACrB,IAAI,mBAAmB,MAAM,gBAAN;AACvB,IAAI,eAAe,QAAQ,QAAR,EAAkB,YAAlB;AACnB,IAAI,UAAU,QAAQ,WAAR,CAAV;AACJ,IAAI,OAAO,QAAQ,MAAR,CAAP;AACJ,IAAI,OAAO,MAAM,IAAN;;AAEX,IAAI,QAAQ,QAAQ,OAAR,CAAR;AACJ,IAAI,kBAAkB,QAAQ,oBAAR,CAAlB;;AAEJ,IAAI,gBAAgB,CAAhB;IACA,cAAc,CAAd;IACA,cAAc,gBAAgB,WAAhB;;;;;;;;;;;;;;;;AAgBlB,SAAS,KAAT,CAAe,GAAf,EAAoB,MAApB,EAA4B,MAA5B,EAAoC;AAClC,WAAS,IAAT,CAAc,IAAd,EAAoB,GAApB,EAAyB,MAAzB,EAAiC,MAAjC,EADkC;CAApC;;;;;;;;;AAWA,MAAM,SAAN,CAAgB,SAAhB,GAA4B,SAAS,SAAT;;;;;;;;;AAS5B,MAAM,SAAN,CAAgB,EAAhB;;;;;;;;;AASA,MAAM,SAAN,CAAgB,UAAhB;;;;;;;;;AASA,MAAM,SAAN,CAAgB,SAAhB;;;;;;;;;;AAUA,MAAM,SAAN,CAAgB,aAAhB;;AAEA,MAAM,SAAN,CAAgB,aAAhB,GAAgC,UAAS,OAAT,EAAkB,QAAlB,EAA4B;AAC1D,MAAI,QAAQ,IAAR,CADsD;AAE1D,MAAI,CAAC,QAAQ,IAAR,IAAgB,KAAK,MAAL,CAAY,OAAZ,CAAoB,IAApB,EAA0B;AAC7C,YAAQ,IAAR,GAAe,KAAK,MAAL,CAAY,OAAZ,CAAoB,IAApB,CAD8B;GAA/C;AAGA,MAAI,OAAO,QAAQ,IAAR,KAAiB,SAAxB,EAAmC;AACrC,YAAQ,IAAR,GAAe,IAAf,CADqC;GAAvC;;AAIA,MAAI,KAAK,KAAL,EAAY;;AAEd,QAAI,kBAAkB,EAAlB,CAFU;AAGd,QAAI,KAAK,MAAL,CAAY,OAAZ,CAAoB,QAApB,IACA,KAAK,MAAL,CAAY,OAAZ,CAAoB,QAApB,CAA6B,cAA7B,EAA6C;AAC/C,sBAAgB,cAAhB,GAAiC,IAAjC,CAD+C;KADjD;;AAKA,oBAAgB,UAAhB,GAA6B,CAA7B,CARc;AASd,oBAAgB,uBAAhB,GAA0C,IAA1C,CATc;AAUd,oBAAgB,SAAhB,GAA4B,KAA5B,CAVc;;AAYd,QAAI,MAAM,KAAK,QAAL,CAAc,eAAd,CAAN,CAZU;;AAcd,QAAI,CAAC,MAAM,MAAN,CAAa,cAAb,CAA4B,OAAO,EAAP,EAAW,KAAvC,CAAD,EAAgD;;;;;;AAMlD,iBAAW,YAAW;AACpB,iBAAS,IAAI,KAAJ,CAAU,yCAAV,CAAT,EADoB;OAAX,EAER,CAFH,EANkD;AASlD,aATkD;KAApD;;AAYA,SAAK,UAAL,CAAgB,IAAhB,EAAsB,GAAtB,EA1Bc;AA2Bd,SAAK,UAAL,CAAgB,MAAhB,CAAuB,GAAvB,EAA4B,QAAQ,IAAR,EAAc,UAAS,GAAT,EAAc,GAAd,EAAmB;AAC3D,UAAI,GAAJ,EAAS;AACP,cAAM,KAAN,GAAc,IAAd,CADO;AAEP,cAAM,IAAN,CAAW,OAAX,EAAoB,IAApB,EAFO;;AAIP,iBAAS,GAAT,EAJO;AAKP,eALO;OAAT;;AAQA,eAAS,IAAT,EAAe,GAAf,EAT2D;KAAnB,CAA1C,CA3Bc;AAsCd,SAAK,QAAL,GAtCc;AAuCd,SAAK,KAAL,GAAa,KAAb,CAvCc;AAwCd,SAAK,IAAL,CAAU,OAAV,EAAmB,KAAnB;;AAxCc,QA0Cd,CAAK,GAAL,CAAS,SAAT,GAAqB,IAArB,CA1Cc;GAAhB,MA2CO;;;AAGL,SAAK,GAAL,CAAS,SAAT,GAAqB,KAArB,CAHK;;AAKL,QAAI,QAAQ,KAAK,QAAL,EAAR,CALC;;AAOL,QAAI,KAAJ,EAAW;AACT,UAAI,iBAAiB,KAAjB,EAAwB;AAC1B,iBAAS,KAAT,EAD0B;AAE1B,eAF0B;OAA5B;AAIA,UAAI,QAAQ,KAAK,QAAL,CAAc,MAAM,CAAN,CAAd,CAAR,CALK;;AAOT,UAAI,iBAAiB,KAAjB,EAAwB;AAC1B,iBAAS,KAAT,EAD0B;AAE1B,eAF0B;OAA5B;;AAKA,WAAK,UAAL,CAAgB,MAAhB,CAAuB,KAAvB,EAA8B,MAAM,CAAN,CAA9B,EAAwC,QAAQ,IAAR,EAAc,UAAS,GAAT,EAAc,GAAd,EAAmB;AACvE,YAAI,GAAJ,EAAS;AACP,mBAAS,GAAT,EADO;AAEP,iBAFO;SAAT;AAIA,iBAAS,IAAT,EAAe,GAAf,EALuE;OAAnB,CAAtD,CAZS;KAAX,MAmBO;AACL,WAAK,QAAL,GADK;AAEL,iBAFK;AAGL,aAHK;KAnBP;;AAyBA,SAAK,IAAL,CAAU,OAAV,EAAmB,KAAnB,EAhCK;GA3CP;CAT8B;;;;;;AA4FhC,MAAM,SAAN,CAAgB,OAAhB,GAA0B,UAAS,OAAT,EAAkB,QAAlB,EAA4B;AACpD,MAAI,QAAQ,IAAR,CADgD;;AAGpD,QAAM,aAAN,CAAoB,OAApB,EAA6B,UAAS,KAAT,EAAgB,MAAhB,EAAwB;AACnD,QAAI,KAAJ,EAAW;AACT,aAAO,SAAS,KAAT,CAAP,CADS;KAAX;;AAIA,UAAM,QAAN,GALmD;AAMnD,UAAM,aAAN,GANmD;;AAQnD,QAAI,cAAc,CAAd,CAR+C;AASnD,QAAI,MAAJ,EAAY;AACV,UAAI,MAAM,OAAN,CAAc,MAAd,CAAJ,EAA2B;AACzB,sBAAc,OAAO,MAAP,CADW;OAA3B,MAEO,IAAI,OAAO,MAAP,IAAiB,OAAO,MAAP,CAAc,CAAd,KAAoB,SAApB,EAA+B;AACzD,sBAAc,OAAO,MAAP,CAAc,CAAd,CAD2C;OAApD,MAEA,IAAI,OAAO,MAAP,IAAiB,OAAO,MAAP,CAAc,SAAd,KAA4B,SAA5B,EAAuC;AACjE,sBAAc,OAAO,MAAP,CAAc,SAAd,CADmD;OAA5D,MAEA;AACL,sBAAc,MAAd,CADK;OAFA;KALT;;;AATmD,QAsB/C,MAAM,GAAN,CAAU,OAAV,IAAqB,CAAC,MAAM,GAAN,CAAU,SAAV,EAAqB;AAC7C,UAAI,cAAc,iBAAiB,cAAc,MAAM,GAAN,CAAU,OAAV,CAA/B,CAD2B;AAE7C,YAAM,GAAN,CAAU,OAAV,GAAoB,SAApB,CAF6C;;AAI7C,UAAI,eAAe,CAAf,EAAkB;;AAEpB,YAAI,MAAM,IAAI,YAAJ,EAAN,CAFgB;AAGpB,eAAO,SAAS,GAAT,CAAP,CAHoB;OAAtB;;;AAJ6C,UAWzC,WAAJ,EAAiB;AACf,YAAI,MAAM,MAAM,MAAN,CAAa,OAAb,CAAqB,UAArB,CADK;AAEf,YAAI,UAAU,MAAM,QAAN,CAAe,GAAf,IAAsB,CAAtB,CAFC;AAGf,cAAM,QAAN,CAAe,GAAf,EAAoB,UAAU,CAAV,CAApB,CAHe;OAAjB;KAXF;;AAkBA,UAAM,IAAN,CAAW,MAAX,EAAmB,KAAnB,EAA0B,WAA1B,EAxCmD;AAyCnD,aAAS,IAAT,EAAe,KAAf,EAAsB,WAAtB,EAzCmD;GAAxB,CAA7B,CAHoD;CAA5B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqF1B,MAAM,SAAN,CAAgB,IAAhB,GAAuB,UAAS,OAAT,EAAkB,EAAlB,EAAsB;AAC3C,MAAI,OAAO,OAAP,KAAmB,UAAnB,EAA+B;AACjC,SAAK,OAAL,CADiC;AAEjC,cAAU,SAAV,CAFiC;GAAnC;;AAKA,MAAI,CAAC,OAAD,EAAU;AACZ,cAAU,EAAV,CADY;GAAd;;AAIA,MAAI,QAAQ,WAAR,EAAqB;AACvB,WAAO,KAAK,OAAL,CAAa,OAAb,EAAsB,EAAtB,CAAP,CADuB;GAAzB;;AAIA,MAAI,QAAQ,IAAR,CAduC;AAe3C,MAAI,UAAU,gBAAgB,GAAhB,EAAV,CAfuC;AAgB3C,SAAO,IAAI,QAAQ,GAAR,CAAY,UAAS,OAAT,EAAkB,MAAlB,EAA0B;AAC/C,UAAM,OAAN,CAAc,OAAd,EAAuB,UAAS,KAAT,EAAgB,GAAhB,EAAqB,WAArB,EAAkC;AACvD,UAAI,KAAJ,EAAW;AACT,cAAM,GAAG,KAAH,CAAN,CADS;AAET,eAAO,KAAP,EAFS;AAGT,eAHS;OAAX;;AAMA,YAAM,GAAG,IAAH,EAAS,GAAT,EAAc,WAAd,CAAN,CAPuD;AAQvD,cAAQ,GAAR,EAAa,WAAb,EARuD;KAAlC,CAAvB,CAD+C;GAA1B,CAAvB,CAhB2C;CAAtB;;;;;;;;;AAqCvB,SAAS,oBAAT,CAA8B,IAA9B,EAAoC,IAApC,EAA0C;AACxC,MAAI,iBAAiB,KAAK,MAAL,CAAY,OAAZ,CAAoB,cAApB,CADmB;AAExC,MAAI,CAAC,cAAD,EAAiB,OAAO,KAAP,CAArB;;;AAFwC,MAKxC,GAAO,KAAK,OAAL,CAAa,SAAb,EAAwB,GAAxB,CAAP,CALwC;;AAOxC,SAAO,eAAe,IAAf,CAAP,CAPwC;CAA1C;;;;;;;;;;;;;;AAsBA,SAAS,OAAT,CAAiB,IAAjB,EAAuB,KAAvB,EAA8B,KAA9B,EAAqC,IAArC,EAA2C,GAA3C,EAAgD,EAAhD,EAAoD;;AAElD,SAAO,KAAK,MAAL,CAAP,CAFkD;AAGlD,MAAI,CAAC,MAAM,EAAN,CAAD,EAAY,MAAM,EAAN,IAAY,EAAZ,CAAhB;AACA,QAAM,EAAN,EAAU,KAAK,IAAL,CAAV,GAAuB,GAAvB;;;AAJkD,MAO9C,KAAK,MAAL,CAAY,OAAZ,CAAoB,UAApB,KAAmC,KAAnC,EAA0C,OAA9C;;;AAPkD,MAU9C,qBAAqB,IAArB,EAA2B,KAAK,IAAL,CAA/B,EAA2C,OAA3C;;;AAVkD,MAa9C,iBAAiB,cAAc,KAAK,GAAL,CAAS,OAAT,CAA/B,EAAkD,OAAtD;;AAEA,UAAQ,EAAR;AACE,SAAK,MAAL,CADF;AAEE,SAAK,QAAL,CAFF;AAGE,SAAK,MAAL,CAHF;AAIE,SAAK,OAAL,CAJF;AAKE,SAAK,UAAL,CALF;AAME,SAAK,OAAL,CANF;AAOE,SAAK,UAAL,CAPF;AAQE,SAAK,WAAL;AACE,YADF;AARF;;AAYI,aAFF;AAVF;;;;;;;AAfkD,MAmC9C,OAAO,OAAP,IAAkB,OAAO,UAAP,IAAqB,OAAO,WAAP,EAAoB;AAC7D,SAAK,GAAL,CAAS,OAAT,GAAmB,WAAnB,CAD6D;GAA/D,MAEO,IAAI,OAAO,IAAP,CAAY,EAAZ,CAAJ,EAAqB;;AAE1B,SAAK,SAAL,GAF0B;GAArB,MAGA,IAAI,MAAM,OAAN,CAAc,GAAd,CAAJ,EAAwB;;AAE7B,SAAK,SAAL,GAF6B;GAAxB,MAGA,IAAI,iBAAiB,IAAjB,CAAsB,KAAK,IAAL,CAA1B,EAAsC;;;AAG3C,SAAK,GAAL,CAAS,OAAT,GAAmB,aAAnB,CAH2C;GAAtC;CA3CT;;;;;;;;;;;;AA4DA,SAAS,aAAT,CAAuB,IAAvB,EAA6B,KAA7B,EAAoC,KAApC,EAA2C,IAA3C,EAAiD,KAAjD,EAAwD;AACtD,MAAI,MAAM,IAAN,IAAc,MAAM,IAAN,CAAW,KAAK,IAAL,CAAzB,EAAqC;;AAEvC,WAFuC;GAAzC;;AAKA,MAAI,OAAO,MAAM,aAAN,KAAwB,UAA/B,EAA2C;AAC7C,UAAM,aAAN,GAAsB,OAAtB,CAA8B,UAAS,MAAT,EAAiB;AAC7C,UAAI,KAAK,OAAO,CAAP,CAAL,CADyC;AAE7C,UAAI,MAAM,OAAO,CAAP,CAAN,CAFyC;AAG7C,cAAQ,IAAR,EAAc,KAAd,EAAqB,KAArB,EAA4B,IAA5B,EAAkC,GAAlC,EAAuC,EAAvC,EAH6C;KAAjB,CAA9B,CAD6C;AAM7C,WAN6C;GAA/C;;;;AANsD,MAiBlD,UAAU,MAAM,QAAN;MACV,MAAM,OAAO,IAAP,CAAY,OAAZ,CAAN;MACA,IAAI,IAAI,MAAJ;MACJ,GAHJ;MAII,EAJJ,CAjBsD;;AAuBtD,MAAI,MAAM,CAAN,EAAS;;;AAGX,QAAI,iBAAiB,KAAjB,CAAJ,EAA6B;AAC3B,cAAQ,MAAM,QAAN,CAAe,EAAC,YAAY,CAAZ,EAAhB,CAAR,CAD2B;KAA7B,MAEO,IAAI,MAAM,OAAN,EAAe;AACxB,cAAQ,MAAM,OAAN,EAAR,CADwB;KAAnB;;AAIP,WAAO,QAAQ,IAAR,EAAc,KAAd,EAAqB,KAArB,EAA4B,IAA5B,EAAkC,KAAlC,CAAP,CATW;GAAb;;AAYA,WAAS,IAAT,CAAc,GAAd,EAAmB;AACjB,WAAO,iBAAiB,GAAjB,IACD,IAAI,QAAJ,CAAa,EAAC,YAAY,CAAZ,EAAd,CADC,GAED,GAFC,CADU;GAAnB;;AAMA,SAAO,GAAP,EAAY;AACV,SAAK,IAAI,CAAJ,CAAL,CADU;AAEV,UAAM,QAAQ,EAAR,CAAN,CAFU;;AAIV,QAAI,iBAAiB,GAAjB,CAAJ,EAA2B;AACzB,YAAM,IAAI,QAAJ,CAAa,EAAC,YAAY,CAAZ,EAAd,CAAN,CADyB;KAA3B,MAEO,IAAI,MAAM,OAAN,CAAc,GAAd,CAAJ,EAAwB;AAC7B,YAAM,IAAI,GAAJ,CAAQ,IAAR,CAAN,CAD6B;KAAxB,MAEA,IAAI,IAAI,OAAJ,EAAa;AACtB,YAAM,IAAI,OAAJ,EAAN,CADsB;KAAjB;;AAIP,QAAI,OAAO,WAAP,EAAoB;AACtB,YAAM,EAAC,OAAO,GAAP,EAAP,CADsB;KAAxB;;AAIA,YAAQ,IAAR,EAAc,KAAd,EAAqB,KAArB,EAA4B,IAA5B,EAAkC,GAAlC,EAAuC,EAAvC,EAhBU;GAAZ;CAzCF;;;;;;;;;;AAqEA,MAAM,SAAN,CAAgB,QAAhB,GAA2B,YAAW;AACpC,MAAI,QAAQ,KAAK,QAAL,EAAR,CADgC;AAEpC,MAAI,CAAC,MAAM,MAAN,IAAgB,gBAAgB,KAAK,GAAL,CAAS,OAAT,EAAkB,OAAvD;;AAEA,MAAI,QAAQ,EAAR;MACA,QAAQ,EAAR;MACA,MAAM,MAAM,MAAN;MACN,YAAY,EAAZ;MACA,IAAI,CAAJ,CARgC;;AAUpC,QAAM,GAAN,GAAY,KAAK,IAAL,CAAU,GAAV,CAVwB;;AAYpC,SAAO,IAAI,GAAJ,EAAS,EAAE,CAAF,EAAK;AACnB,QAAI,OAAO,MAAM,CAAN,CAAP,CADe;AAEnB,QAAI,QAAQ,KAAK,KAAL,CAFO;;AAInB,QAAI,QAAQ,oBAAoB,IAApB,EAA0B,KAAK,IAAL,EAAW,KAArC,CAAR,CAJe;AAKnB,QAAI,KAAJ,EAAW;AACT,gBAAU,IAAV,CAAe,KAAf,EADS;AAET,eAFS;KAAX;;AAKA,QAAI,UAAU,MAAV,EAAkB,SAAtB;;AAEA,QAAI,cAAc,KAAd,EAAqB;AACvB,cAAQ,IAAR,EAAc,KAAd,EAAqB,KAArB,EAA4B,IAA5B,EAAkC,CAAlC,EAAqC,QAArC,EADuB;KAAzB,MAEO,IAAI,UAAU,IAAV,EAAgB;AACzB,cAAQ,IAAR,EAAc,KAAd,EAAqB,KAArB,EAA4B,IAA5B,EAAkC,IAAlC,EADyB;KAApB,MAEA,IAAI,MAAM,KAAN,IAAe,MAAM,QAAN,EAAgB;;AAExC,oBAAc,IAAd,EAAoB,KAApB,EAA2B,KAA3B,EAAkC,IAAlC,EAAwC,KAAxC,EAFwC;KAAnC,MAGA,IAAI,MAAM,KAAN,IAAe,OAAO,QAAP,CAAgB,KAAhB,CAAf,EAAuC;;AAEhD,cAAQ,MAAM,QAAN,EAAR,CAFgD;AAGhD,cAAQ,IAAR,EAAc,KAAd,EAAqB,KAArB,EAA4B,IAA5B,EAAkC,KAAlC,EAHgD;KAA3C,MAIA;AACL,cAAQ,MAAM,KAAN,CAAY,KAAZ,EAAmB,EAAC,YAAY,CAAZ,EAApB,CAAR,CADK;AAEL,cAAQ,IAAR,EAAc,KAAd,EAAqB,KAArB,EAA4B,IAA5B,EAAkC,KAAlC,EAFK;KAJA;GAnBT;;AA6BA,MAAI,UAAU,MAAV,EAAkB;AACpB,WAAO,IAAI,mBAAJ,CAAwB,SAAxB,CAAP,CADoB;GAAtB;;AAIA,MAAI,KAAK,GAAL,CAAS,OAAT,EAAkB;AACpB,SAAK,UAAL,CAAgB,KAAhB,EAAuB,KAAvB,EADoB;GAAtB;;AAIA,SAAO,CAAC,KAAD,EAAQ,KAAR,CAAP,CAjDoC;CAAX;;;;;;;;;;;;AA8D3B,SAAS,mBAAT,CAA6B,GAA7B,EAAkC,IAAlC,EAAwC,KAAxC,EAA+C;;AAE7C,MAAI,MAAM,IAAI,SAAJ,CAAc,IAAd,EAAoB,IAApB,CAAN,CAFyC;;AAI7C,MAAI,CAAC,GAAD,IAAQ,IAAI,GAAJ,CAAQ,QAAR,EAAkB;;;AAG5B,QAAI,MAAM,KAAK,KAAL,CAAW,GAAX,EAAgB,CAAhB,CAAN,CAHwB;AAI5B,QAAI,GAAC,CAAI,GAAJ,CAAQ,QAAR,CAAiB,GAAjB,KAAyB,IAAI,GAAJ,CAAQ,QAAR,CAAiB,GAAjB,EAAsB,UAAtB,IAC1B,IAAI,GAAJ,CAAQ,QAAR,CAAiB,MAAM,IAAN,CADjB,EAC8B;AAChC,aAAO,GAAP,CADgC;KADlC;GAJF;;AAUA,MAAI,EAAE,OAAO,KAAP,IAAgB,MAAM,eAAN,CAAlB,EAA0C,OAA9C;;;;;;;;;;;AAd6C,MAyBzC,QAAQ,IAAI,OAAJ,CAAY,KAAZ,IACR,IAAI,OAAJ,CAAY,OAAZ,IAAuB,eAAe,IAAI,OAAJ,CAAY,OAAZ,EAAqB,OAApC,CAAvB;AACA,MAAI,OAAJ,CAAY,OAAZ,IAAuB,IAAI,OAAJ,CAAY,OAAZ,CAAoB,IAApB;AACvB,MAAI,OAAJ,CAAY,MAAZ;AACC,MAAI,OAAJ,CAAY,MAAZ,CAAmB,GAAnB,KAA2B,CAA3B,IACD,aAAa,IAAb,CAAkB,IAAI,OAAJ,CAAY,MAAZ,CADjB,CADD,CA5ByC;;AAgC7C,MAAI,KAAJ,EAAW;AACT,QAAI,UAAU,MAAM,QAAN,CADL;AAET,QAAI,OAAO,IAAP,CAAY,OAAZ,EAAqB,MAArB,KAAgC,CAAhC,IAAqC,QAAQ,IAAR,IAAgB,QAAQ,IAAR,EAAc;AACrE,aAAO,IAAP,CADqE;KAAvE;GAFF;CAhCF;;;;;;;;;;AAgDA,MAAM,SAAN,CAAgB,UAAhB,GAA6B,UAAS,KAAT,EAAgB,KAAhB,EAAuB;AAClD,MAAI,MAAM,KAAK,MAAL,CAAY,OAAZ,CAAoB,UAApB,CADwC;;AAGlD,MAAI,UAAU,IAAV,EAAgB;;AAElB,QAAI,GAAJ,EAAS,KAAK,QAAL,CAAc,GAAd,EAAmB,MAAM,GAAN,IAAa,CAAb,CAAnB,CAAT;AACA,WAHkB;GAApB;;;;;;;;AAHkD,MAe9C,CAAC,KAAK,UAAL,CAAgB,GAAhB,CAAD,EAAuB;AACzB,WADyB;GAA3B;;;AAfkD,MAoB9C,mBAAmB,gBAAgB,KAAK,GAAL,CAAS,OAAT,CAAnC,EAAsD;AACxD,UAAM,GAAN,IAAa,KAAK,QAAL,CAAc,GAAd,CAAb,CADwD;GAA1D;;AAIA,MAAI,iBAAiB,cAAc,KAAK,GAAL,CAAS,OAAT,CAA/B,EAAkD;AACpD,QAAI,CAAC,MAAM,IAAN,IAAc,OAAO,MAAM,IAAN,CAAW,GAAX,CAAP,KAA2B,WAA3B,EAAwC;AACzD,YAAM,IAAN,KAAe,MAAM,IAAN,GAAa,EAAb,CAAf,CADyD;AAEzD,YAAM,IAAN,CAAW,GAAX,IAAkB,CAAlB,CAFyD;KAA3D;GADF;CAxB2B;;;;;;;;;;;;;;;;AA8C7B,MAAM,SAAN,CAAgB,SAAhB,GAA4B,SAAS,SAAT,GAAqB;AAC/C,OAAK,GAAL,CAAS,OAAT,GAAmB,WAAnB,CAD+C;AAE/C,SAAO,IAAP,CAF+C;CAArB;;;;;;;;;;AAa5B,MAAM,SAAN,CAAgB,QAAhB,GAA2B,SAAS,MAAT,CAAgB,KAAhB,EAAuB;AAChD,YAAU,QAAQ,EAAR,CAAV,CADgD;;AAGhD,MAAI,KAAJ,EACI,GADJ,CAHgD;;AAMhD,MAAI,CAAC,MAAM,GAAN,EAAW;AACd,UAAM,GAAN,GAAY,KAAK,IAAL,CAAU,GAAV,CADE;GAAhB;;AAIA,MAAI,KAAK,GAAL,CAAS,QAAT,EAAmB;AACrB,YAAQ,OAAO,IAAP,CAAY,KAAK,GAAL,CAAS,QAAT,CAApB,CADqB;AAErB,UAAM,MAAM,MAAN,CAFe;;AAIrB,SAAK,IAAI,IAAI,CAAJ,EAAO,IAAI,GAAJ,EAAS,EAAE,CAAF,EAAK;AAC5B,YAAM,MAAM,CAAN,CAAN,IAAkB,KAAK,GAAL,CAAS,QAAT,CAAkB,MAAM,CAAN,CAAlB,CAAlB,CAD4B;KAA9B;GAJF;;AASA,MAAI,KAAK,IAAL,CAAU,GAAV,IAAiB,IAAjB,EAAuB;AACzB,WAAO,IAAI,KAAJ,CAAU,2BAAV,CAAP,CADyB;GAA3B;;AAIA,SAAO,KAAP,CAvBgD;CAAvB;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoD3B,MAAM,SAAN,CAAgB,MAAhB,GAAyB,SAAS,MAAT,CAAgB,OAAhB,EAAyB,EAAzB,EAA6B;AACpD,MAAI,OAAO,OAAP,KAAmB,UAAnB,EAA+B;AACjC,SAAK,OAAL,CADiC;AAEjC,cAAU,SAAV,CAFiC;GAAnC;;AAKA,MAAI,CAAC,OAAD,EAAU;AACZ,cAAU,EAAV,CADY;GAAd;;AAIA,MAAI,KAAK,GAAL,CAAS,QAAT,EAAmB;AACrB,QAAI,EAAJ,EAAQ;AACN,WAAK,GAAL,CAAS,QAAT,CAAkB,IAAlB,CACI,UAAS,GAAT,EAAc;AAAE,WAAG,IAAH,EAAS,GAAT,EAAF;OAAd,EACA,UAAS,GAAT,EAAc;AAAE,WAAG,GAAH,EAAF;OAAd,CAFJ,CADM;KAAR;AAKA,WAAO,IAAP,CANqB;GAAvB;;AASA,MAAI,QAAQ,IAAR,CAnBgD;AAoBpD,MAAI,UAAU,gBAAgB,GAAhB,EAAV,CApBgD;AAqBpD,OAAK,GAAL,CAAS,QAAT,GAAoB,IAAI,QAAQ,GAAR,CAAY,UAAS,OAAT,EAAkB,MAAlB,EAA0B;AAC5D,QAAI,QAAQ,MAAM,QAAN,EAAR,CADwD;AAE5D,QAAI,iBAAiB,KAAjB,EAAwB;AAC1B,aAAO,KAAP,EAD0B;AAE1B,YAAM,GAAG,KAAH,CAAN,CAF0B;AAG1B,aAH0B;KAA5B;;AAMA,QAAI,CAAC,QAAQ,IAAR,IAAgB,MAAM,MAAN,CAAa,OAAb,CAAqB,IAArB,EAA2B;AAC9C,cAAQ,IAAR,GAAe,MAAM,MAAN,CAAa,OAAb,CAAqB,IAArB,CAD+B;KAAhD;;AAIA,UAAM,UAAN,CAAiB,MAAjB,CAAwB,KAAxB,EAA+B,OAA/B,EAAwC,UAAS,GAAT,EAAc;AACpD,UAAI,CAAC,GAAD,EAAM;AACR,cAAM,IAAN,CAAW,QAAX,EAAqB,KAArB,EADQ;AAER,gBAAQ,KAAR,EAFQ;AAGR,cAAM,GAAG,IAAH,EAAS,KAAT,CAAN,CAHQ;AAIR,eAJQ;OAAV;;AAOA,aAAO,GAAP,EARoD;AASpD,YAAM,GAAG,GAAH,CAAN,CAToD;KAAd,CAAxC,CAZ4D;GAA1B,CAApC,CArBoD;AA6CpD,SAAO,KAAK,GAAL,CAAS,QAAT,CA7C6C;CAA7B;;;;;;;;;;;;;;AA4DzB,MAAM,SAAN,CAAgB,KAAhB,GAAwB,SAAS,KAAT,CAAe,IAAf,EAAqB;AAC3C,SAAO,KAAK,EAAL,CAAQ,KAAR,CAAc,IAAd,CAAP,CAD2C;CAArB;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8BxB,MAAM,aAAN,GAAsB,SAAS,aAAT,CAAuB,IAAvB,EAA6B,MAA7B,EAAqC;AACzD,MAAI,EAAE,UAAU,OAAO,gBAAP,CAAZ,EAAsC;AACxC,UAAM,IAAI,KAAJ,CAAU,4CAAV,CAAN,CADwC;GAA1C;;AAIA,MAAI,KAAK,MAAL,CAAY,oBAAZ,IAAoC,CAAC,KAAK,MAAL,CAAY,oBAAZ,CAAiC,MAAjC,EAAyC;AAChF,UAAM,IAAI,KAAJ,CAAU,oBAAoB,IAApB,GACZ,iDADY,CAAhB,CADgF;GAAlF;;AAKA,MAAI,MAAM,KAAK,MAAL,CAAY,OAAZ,CAAoB,gBAApB,CAV+C;AAWzD,MAAI,OAAO,IAAP,CAAY,GAAZ,CAAJ,EAAsB;AACpB,UAAM,IAAI,KAAJ,CAAU,oBAAoB,IAApB,GACZ,iCADY,GACwB,GADxB,GAC8B,GAD9B,CAAhB,CADoB;GAAtB;;AAKA,WAAS,KAAT,CAAe,CAAf,EAAkB,CAAlB,EAAqB;AACnB,QAAI,MAAM,KAAN,CAAY,CAAZ,CAAJ,CADmB;AAEnB,QAAI,MAAM,KAAN,CAAY,CAAZ,CAAJ,CAFmB;AAGnB,WAAO,EAAE,MAAF,CAHY;AAInB,WAAO,EAAE,QAAF,CAJY;AAKnB,WAAO,EAAE,MAAF,CALY;AAMnB,WAAO,EAAE,QAAF,CANY;AAOnB,WAAO,EAAE,GAAF,CAPY;AAQnB,WAAO,EAAE,GAAF,CARY;;AAUnB,QAAI,CAAC,MAAM,SAAN,CAAgB,CAAhB,EAAmB,CAAnB,CAAD,EAAwB;AAC1B,YAAM,IAAI,KAAJ,CAAU,gDACZ,gCADY,CAAhB,CAD0B;KAA5B;GAVF;;AAgBA,WAAS,KAAT,CAAe,MAAf,EAAuB,UAAvB,EAAmC;AACjC,UAAM,KAAN,CAAY,MAAZ,EAAoB,UAApB,EADiC;;AAGjC,QAAI,MAAM,EAAN,CAH6B;AAIjC,QAAI,GAAJ,IAAW,EAAC,MAAM,MAAN,EAAc,SAAS,IAAT,EAA1B,CAJiC;AAKjC,WAAO,GAAP,CAAW,GAAX,EALiC;AAMjC,WAAO,oBAAP,GAA8B,EAAC,KAAK,GAAL,EAAU,OAAO,IAAP,EAAa,QAAQ,KAAR,EAAtD,CANiC;;AAQjC,QAAI,WAAW,OAAX,CAAmB,UAAnB,EAA+B;AACjC,aAAO,OAAP,CAAe,UAAf,GAA4B,WAAW,OAAX,CAAmB,UAAnB,CADK;KAAnC;;;AARiC,SAajC,CAAM,OAAO,OAAP,EAAgB,WAAW,OAAX,CAAtB,CAbiC;;AAejC,QAAI,SAAS,OAAO,OAAP,CAAe,MAAf,CAfoB;AAgBjC,QAAI,WAAW,OAAO,OAAP,CAAe,QAAf,CAhBkB;AAiBjC,QAAI,MAAM,OAAO,OAAP,CAAe,GAAf,CAjBuB;;AAmBjC,WAAO,OAAP,GAAiB,MAAM,KAAN,CAAY,WAAW,OAAX,CAA7B,CAnBiC;AAoBjC,QAAI,MAAJ,EAAY,OAAO,OAAP,CAAe,MAAf,GAAwB,MAAxB,CAAZ;AACA,QAAI,QAAJ,EAAc,OAAO,OAAP,CAAe,QAAf,GAA0B,QAA1B,CAAd;AACA,QAAI,OAAO,GAAP,KAAe,WAAf,EAA4B;AAC9B,aAAO,OAAP,CAAe,GAAf,GAAqB,GAArB,CAD8B;KAAhC;;AAIA,WAAO,SAAP,GAAmB,WAAW,SAAX,CAAqB,MAArB,CAA4B,OAAO,SAAP,CAAiB,KAAjB,CAAuB,OAAO,kBAAP,CAA0B,MAA1B,CAAnD,CAAnB,CA1BiC;AA2BjC,WAAO,cAAP,GAAwB,SAAxB;AA3BiC,GAAnC;;;AAhCyD,OA+DzD,CAAM,MAAN,EAAc,KAAK,MAAL,CAAd,CA/DyD;;AAiEzD,MAAI,CAAC,KAAK,cAAL,EAAqB;AACxB,SAAK,cAAL,GAAsB,EAAtB,CADwB;GAA1B;;AAIA,MAAI,CAAC,KAAK,MAAL,CAAY,oBAAZ,EAAkC;AACrC,SAAK,MAAL,CAAY,oBAAZ,GAAmC,EAAC,KAAK,GAAL,EAAU,OAAO,IAAP,EAAa,QAAQ,IAAR,EAA3D,CADqC;GAAvC;;AAIA,MAAI,KAAK,cAAL,CAAoB,IAApB,CAAJ,EAA+B;AAC7B,UAAM,IAAI,KAAJ,CAAU,8BAA8B,IAA9B,GAAqC,kBAArC,CAAhB,CAD6B;GAA/B;;AAIA,OAAK,cAAL,CAAoB,IAApB,IAA4B,KAAK,EAAL,CAAQ,KAAR,CAAc,IAAd,EAAoB,MAApB,EAA4B,KAAK,UAAL,CAAgB,IAAhB,CAAxD,CA7EyD;AA8EzD,OAAK,cAAL,CAAoB,IAApB,EAA0B,SAA1B,CAAoC,SAApC,GAAgD,KAAK,SAAL,CA9ES;AA+EzD,SAAO,cAAP,CAAsB,KAAK,cAAL,CAAoB,IAApB,CAAtB,EAAiD,eAAjD,EAAkE;AAChE,WAAO,KAAK,SAAL;AACP,kBAAc,IAAd;AACA,cAAU,KAAV;GAHF;;;AA/EyD,cAsFzD,CAAa,KAAK,cAAL,CAAoB,IAApB,CAAb,EAAwC,MAAxC,EAtFyD;AAuFzD,eAAa,KAAK,cAAL,CAAoB,IAApB,CAAb,EAAwC,MAAxC,EAvFyD;;AAyFzD,SAAO,KAAK,cAAL,CAAoB,IAApB,CAAP,CAzFyD;CAArC;;;;;;;;AAkGtB,KAAK,IAAI,CAAJ,IAAS,aAAa,SAAb,EAAwB;AACpC,QAAM,CAAN,IAAW,aAAa,SAAb,CAAuB,CAAvB,CAAX,CADoC;CAAtC;;;;;;;;AAUA,MAAM,IAAN,GAAa,SAAS,IAAT,GAAgB;AAC3B,MAAI,IAAC,CAAK,MAAL,CAAY,OAAZ,CAAoB,SAApB,IACA,KAAK,MAAL,CAAY,OAAZ,CAAoB,SAApB,KAAkC,IAAlC,IAA0C,KAAK,EAAL,CAAQ,MAAR,CAAe,SAAf,EAA2B;AACxE,SAAK,aAAL,CAAmB,EAAE,aAAa,IAAb,EAArB,EADwE;GAD1E;;AAKA,OAAK,MAAL,CAAY,IAAZ,CAAiB,MAAjB,EAAyB,IAAzB,EAN2B;CAAhB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuCb,MAAM,aAAN,GAAsB,SAAS,aAAT,CAAuB,OAAvB,EAAgC,EAAhC,EAAoC;AACxD,MAAI,OAAO,OAAP,KAAmB,UAAnB,EAA+B;AACjC,SAAK,OAAL,CADiC;AAEjC,cAAU,IAAV,CAFiC;GAAnC;;AAKA,MAAI,WAAW,QAAQ,WAAR,EAAqB;AAClC,mBAAe,IAAf,EAAqB,EAArB,EADkC;AAElC,WAFkC;GAApC;;AAKA,MAAI,QAAQ,IAAR,CAXoD;AAYxD,MAAI,UAAU,gBAAgB,GAAhB,EAAV,CAZoD;AAaxD,SAAO,IAAI,QAAQ,GAAR,CAAY,UAAS,OAAT,EAAkB,MAAlB,EAA0B;AAC/C,mBAAe,KAAf,EAAsB,UAAS,KAAT,EAAgB;AACpC,UAAI,KAAJ,EAAW;AACT,cAAM,GAAG,KAAH,CAAN,CADS;AAET,eAAO,KAAP,EAFS;OAAX;AAIA,YAAM,IAAN,CALoC;AAMpC,gBANoC;KAAhB,CAAtB,CAD+C;GAA1B,CAAvB,CAbwD;CAApC;;AAyBtB,SAAS,cAAT,CAAwB,KAAxB,EAA+B,QAA/B,EAAyC;AACvC,MAAI,UAAU,MAAM,MAAN,CAAa,OAAb,EAAV,CADmC;AAEvC,MAAI,CAAC,QAAQ,MAAR,EAAgB;AACnB,YAAQ,QAAR,CAAiB,YAAW;AAC1B,kBAAY,UAAZ,CAD0B;KAAX,CAAjB,CADmB;AAInB,WAJmB;GAArB;;;;AAFuC,MAWnC,OAAO,UAAS,GAAT,EAAc;AACvB,QAAI,OAAO,MAAM,MAAN,CAAa,OAAb,CAAqB,eAArB,EAAsC;AAC/C,YAAM,IAAN,CAAW,OAAX,EAAoB,GAApB,EAD+C;KAAjD;AAGA,UAAM,IAAN,CAAW,OAAX,EAAoB,GAApB,EAJuB;AAKvB,gBAAY,SAAS,GAAT,CAAZ,CALuB;GAAd,CAX4B;;AAmBvC,MAAI,kBAAkB,UAAS,GAAT,EAAc,MAAd,EAAsB,OAAtB,EAA+B,IAA/B,EAAqC;AACzD,UAAM,IAAN,CAAW,mBAAX,EAAgC,GAAhC,EAAqC,MAArC,EAA6C,OAA7C,EAAsD,IAAtD,EADyD;GAArC,CAnBiB;AAsBvC,MAAI,mBAAmB,UAAS,MAAT,EAAiB,OAAjB,EAA0B;AAC/C,UAAM,IAAN,CAAW,oBAAX,EAAiC,MAAjC,EAAyC,OAAzC,EAD+C;GAA1B,CAtBgB;;AA0BvC,MAAI,SAAS,YAAW;AACtB,QAAI,QAAQ,QAAQ,KAAR,EAAR,CADkB;AAEtB,QAAI,CAAC,KAAD,EAAQ,OAAO,MAAP,CAAZ;;AAEA,QAAI,cAAc,MAAM,CAAN,CAAd,CAJkB;AAKtB,QAAI,UAAU,MAAM,CAAN,CAAV,CALkB;AAMtB,gBAAY,OAAZ,EANsB;;AAQtB,qBAAiB,WAAjB,EAA8B,OAA9B,EARsB;;AAUtB,UAAM,UAAN,CAAiB,WAAjB,CAA6B,WAA7B,EAA0C,OAA1C,EAAmD,KAAK,UAAS,GAAT,EAAc,IAAd,EAAoB;AAC1E,sBAAgB,GAAhB,EAAqB,WAArB,EAAkC,OAAlC,EAA2C,IAA3C,EAD0E;AAE1E,UAAI,GAAJ,EAAS;AACP,eAAO,KAAK,GAAL,CAAP,CADO;OAAT;AAGA,eAL0E;KAApB,CAAxD,EAVsB;GAAX,CA1B0B;;AA6CvC,WA7CuC;CAAzC;;AAgDA,SAAS,WAAT,CAAqB,OAArB,EAA8B;AAC5B,MAAI,QAAQ,IAAR,EAAc;AAChB,QAAI,OAAO,QAAQ,IAAR,KAAiB,SAAxB,EAAmC;AACrC,cAAQ,CAAR,GAAY,QAAQ,IAAR,CADyB;AAErC,aAAO,QAAQ,IAAR,CAF8B;KAAvC;AAIA,QAAI,OAAO,QAAQ,IAAR,KAAiB,QAAxB,EAAkC;AACpC,cAAQ,CAAR,GAAY,QAAQ,IAAR,CAAa,CAAb,CADwB;AAEpC,cAAQ,CAAR,GAAY,QAAQ,IAAR,CAAa,CAAb,CAFwB;AAGpC,cAAQ,QAAR,GAAmB,QAAQ,IAAR,CAAa,QAAb,CAHiB;AAIpC,aAAO,QAAQ,IAAR,CAJ6B;KAAtC;GALF;CADF;;;;;;;;;;AAuBA,MAAM,MAAN;;;;;;;;;;AAUA,MAAM,EAAN;;;;;;;;;;AAUA,MAAM,UAAN;;;;;;;;;;AAUA,MAAM,IAAN;;;;;;;;;;AAUA,MAAM,cAAN;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4BA,MAAM,MAAN,GAAe,SAAS,MAAT,CAAgB,UAAhB,EAA4B,QAA5B,EAAsC;AACnD,MAAI,OAAO,UAAP,KAAsB,UAAtB,EAAkC;AACpC,eAAW,UAAX,CADoC;AAEpC,iBAAa,EAAb,CAFoC;GAAtC;;;AADmD,MAO/C,KAAK,IAAI,KAAJ,CAAU,UAAV,EAAsB,EAAtB,EAA0B,IAA1B,EAAgC,KAAK,UAAL,CAArC,CAP+C;;AASnD,SAAO,GAAG,MAAH,CAAU,QAAV,CAAP,CATmD;CAAtC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqDf,MAAM,IAAN,GAAa,SAAS,IAAT,CAAc,UAAd,EAA0B,UAA1B,EAAsC,OAAtC,EAA+C,QAA/C,EAAyD;AACpE,MAAI,OAAO,UAAP,KAAsB,UAAtB,EAAkC;AACpC,eAAW,UAAX,CADoC;AAEpC,iBAAa,EAAb,CAFoC;AAGpC,iBAAa,IAAb,CAHoC;AAIpC,cAAU,IAAV,CAJoC;GAAtC,MAKO,IAAI,OAAO,UAAP,KAAsB,UAAtB,EAAkC;AAC3C,eAAW,UAAX,CAD2C;AAE3C,iBAAa,IAAb,CAF2C;AAG3C,cAAU,IAAV,CAH2C;GAAtC,MAIA,IAAI,OAAO,OAAP,KAAmB,UAAnB,EAA+B;AACxC,eAAW,OAAX,CADwC;AAExC,cAAU,IAAV,CAFwC;GAAnC;;;AAV6D,MAgBhE,KAAK,IAAI,KAAJ,CAAU,EAAV,EAAc,EAAd,EAAkB,IAAlB,EAAwB,KAAK,UAAL,CAA7B,CAhBgE;AAiBpE,KAAG,MAAH,CAAU,UAAV,EAjBoE;AAkBpE,KAAG,UAAH,CAAc,OAAd,EAlBoE;AAmBpE,MAAI,KAAK,MAAL,CAAY,oBAAZ,IAAoC,GAAG,mBAAH,EAApC,EAA8D;AAChE,OAAG,MAAH,CAAU,KAAK,MAAL,CAAY,OAAZ,CAAoB,gBAApB,CAAV,CADgE;GAAlE;;AAIA,SAAO,GAAG,IAAH,CAAQ,UAAR,EAAoB,QAApB,CAAP,CAvBoE;CAAzD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuEb,MAAM,QAAN,GAAiB,SAAS,QAAT,CAAkB,EAAlB,EAAsB,UAAtB,EAAkC,OAAlC,EAA2C,QAA3C,EAAqD;AACpE,MAAI,OAAO,EAAP,KAAc,WAAd,EAA2B;AAC7B,SAAK,IAAL,CAD6B;GAA/B;AAGA,SAAO,KAAK,OAAL,CAAa,EAAC,KAAK,EAAL,EAAd,EAAwB,UAAxB,EAAoC,OAApC,EAA6C,QAA7C,CAAP,CAJoE;CAArD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6CjB,MAAM,OAAN,GAAgB,SAAS,OAAT,CAAiB,UAAjB,EAA6B,UAA7B,EAAyC,OAAzC,EAAkD,QAAlD,EAA4D;AAC1E,MAAI,OAAO,OAAP,KAAmB,UAAnB,EAA+B;AACjC,eAAW,OAAX,CADiC;AAEjC,cAAU,IAAV,CAFiC;GAAnC,MAGO,IAAI,OAAO,UAAP,KAAsB,UAAtB,EAAkC;AAC3C,eAAW,UAAX,CAD2C;AAE3C,iBAAa,IAAb,CAF2C;AAG3C,cAAU,IAAV,CAH2C;GAAtC,MAIA,IAAI,OAAO,UAAP,KAAsB,UAAtB,EAAkC;AAC3C,eAAW,UAAX,CAD2C;AAE3C,iBAAa,EAAb,CAF2C;AAG3C,iBAAa,IAAb,CAH2C;AAI3C,cAAU,IAAV,CAJ2C;GAAtC;;;AARmE,MAgBtE,KAAK,IAAI,KAAJ,CAAU,EAAV,EAAc,EAAd,EAAkB,IAAlB,EAAwB,KAAK,UAAL,CAA7B,CAhBsE;AAiB1E,KAAG,MAAH,CAAU,UAAV,EAjB0E;AAkB1E,KAAG,UAAH,CAAc,OAAd,EAlB0E;AAmB1E,MAAI,KAAK,MAAL,CAAY,oBAAZ,IAAoC,GAAG,mBAAH,EAApC,EAA8D;AAChE,OAAG,MAAH,CAAU,KAAK,MAAL,CAAY,OAAZ,CAAoB,gBAApB,CAAV,CADgE;GAAlE;;AAIA,SAAO,GAAG,OAAH,CAAW,UAAX,EAAuB,QAAvB,CAAP,CAvB0E;CAA5D;;;;;;;;;;;;;;;;;;AA0ChB,MAAM,KAAN,GAAc,SAAS,KAAT,CAAe,UAAf,EAA2B,QAA3B,EAAqC;AACjD,MAAI,OAAO,UAAP,KAAsB,UAAtB,EAAkC;AACpC,eAAW,UAAX,CADoC;AAEpC,iBAAa,EAAb,CAFoC;GAAtC;;;AADiD,MAO7C,KAAK,IAAI,KAAJ,CAAU,EAAV,EAAc,EAAd,EAAkB,IAAlB,EAAwB,KAAK,UAAL,CAA7B,CAP6C;;AASjD,SAAO,GAAG,KAAH,CAAS,UAAT,EAAqB,QAArB,CAAP,CATiD;CAArC;;;;;;;;;;;;;;;;;;;;;;;;;;AAoCd,MAAM,QAAN,GAAiB,SAAS,QAAT,CAAkB,KAAlB,EAAyB,UAAzB,EAAqC,QAArC,EAA+C;;AAE9D,MAAI,KAAK,IAAI,KAAJ,CAAU,EAAV,EAAc,EAAd,EAAkB,IAAlB,EAAwB,KAAK,UAAL,CAA7B,CAF0D;;AAI9D,MAAI,OAAO,UAAP,KAAsB,UAAtB,EAAkC;AACpC,eAAW,UAAX,CADoC;AAEpC,iBAAa,EAAb,CAFoC;GAAtC;;AAKA,SAAO,GAAG,QAAH,CAAY,KAAZ,EAAmB,UAAnB,EAA+B,QAA/B,CAAP,CAT8D;CAA/C;;;;;;;;;;;;;;;;;;;;;;;;;;AAoCjB,MAAM,KAAN,GAAc,SAAS,KAAT,CAAe,IAAf,EAAqB,GAArB,EAA0B;AACtC,OAAK,GAAL;;AADsC,MAGlC,KAAK,IAAI,KAAJ,CAAU,EAAV,EAAc,EAAd,EAAkB,IAAlB,EAAwB,KAAK,UAAL,CAAxB,CAAyC,IAAzC,CAA8C,EAA9C,CAAL,CAHkC;AAItC,SAAO,GAAG,KAAH,CAAS,KAAT,CAAe,EAAf,EAAmB,SAAnB,CAAP,CAJsC;CAA1B;;;;;;;;;;;;;;;;;AAsBd,MAAM,MAAN,GAAe,SAAS,MAAT,GAAkB;AAC/B,MAAI,KAAK,IAAI,KAAJ,CAAU,EAAV,EAAc,EAAd,EAAkB,IAAlB,EAAwB,KAAK,UAAL,CAAxB,CAAyC,IAAzC,CAA8C,EAA9C,CAAL,CAD2B;AAE/B,SAAO,GAAG,MAAH,CAAU,KAAV,CAAgB,EAAhB,EAAoB,SAApB,CAAP,CAF+B;CAAlB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyEf,MAAM,gBAAN,GAAyB,UAAS,UAAT,EAAqB,MAArB,EAA6B,OAA7B,EAAsC,QAAtC,EAAgD;AACvE,MAAI,OAAO,OAAP,KAAmB,UAAnB,EAA+B;AACjC,eAAW,OAAX,CADiC;AAEjC,cAAU,IAAV,CAFiC;GAAnC,MAGO,IAAI,UAAU,MAAV,KAAqB,CAArB,EAAwB;AACjC,QAAI,OAAO,UAAP,KAAsB,UAAtB,EAAkC;AACpC,UAAI,MAAM,yEACJ,IADI,GACG,KAAK,SAAL,GAAiB,4DADpB,GAEJ,IAFI,GAEG,KAAK,SAAL,GAAiB,kDAFpB,GAGJ,IAHI,GAGG,KAAK,SAAL,GAAiB,yCAHpB,GAIJ,IAJI,GAIG,KAAK,SAAL,GAAiB,6BAJpB,GAKJ,IALI,GAKG,KAAK,SAAL,GAAiB,uBALpB,CAD0B;AAOpC,YAAM,IAAI,SAAJ,CAAc,GAAd,CAAN,CAPoC;KAAtC;AASA,aAAS,UAAT,CAViC;AAWjC,iBAAa,SAAb,CAXiC;GAA5B;;AAcP,MAAI,MAAJ,CAlBuE;AAmBvE,MAAI,WAAW,QAAQ,MAAR,EAAgB;AAC7B,aAAS,QAAQ,MAAR,CADoB;AAE7B,YAAQ,MAAR,GAAiB,SAAjB,CAF6B;GAA/B;;AAKA,WAAS,MAAM,KAAN,CAAY,MAAZ,EAAoB,EAAC,YAAY,CAAZ,EAArB,CAAT,CAxBuE;AAyBvE,MAAI,KAAK,MAAL,CAAY,OAAZ,CAAoB,UAApB,IAAkC,OAAlC,IAA6C,QAAQ,MAAR,EAAgB;AAC/D,QAAI,CAAC,OAAO,YAAP,EAAqB;AACxB,aAAO,YAAP,GAAsB,EAAtB,CADwB;KAA1B;AAGA,WAAO,YAAP,CAAoB,KAAK,MAAL,CAAY,OAAZ,CAAoB,UAApB,CAApB,GAAsD,CAAtD,CAJ+D;GAAjE;;AAOA,MAAI,KAAK,IAAI,KAAJ,CAAU,EAAV,EAAc,EAAd,EAAkB,IAAlB,EAAwB,KAAK,UAAL,CAA7B,CAhCmE;AAiCvE,KAAG,MAAH,CAAU,MAAV,EAjCuE;;AAmCvE,SAAO,GAAG,gBAAH,CAAoB,UAApB,EAAgC,MAAhC,EAAwC,OAAxC,EAAiD,QAAjD,CAAP,CAnCuE;CAAhD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8GzB,MAAM,iBAAN,GAA0B,UAAS,EAAT,EAAa,MAAb,EAAqB,OAArB,EAA8B,QAA9B,EAAwC;AAChE,MAAI,UAAU,MAAV,KAAqB,CAArB,EAAwB;AAC1B,QAAI,OAAO,EAAP,KAAc,UAAd,EAA0B;AAC5B,UAAI,MAAM,0EACJ,IADI,GACG,KAAK,SAAL,GAAiB,oCADpB,GAEJ,IAFI,GAEG,KAAK,SAAL,GAAiB,0BAFpB,GAGJ,IAHI,GAGG,KAAK,SAAL,GAAiB,wBAHpB,CADkB;AAK5B,YAAM,IAAI,SAAJ,CAAc,GAAd,CAAN,CAL4B;KAA9B;AAOA,WAAO,KAAK,gBAAL,CAAsB,EAAC,KAAK,EAAL,EAAvB,EAAiC,SAAjC,CAAP,CAR0B;GAA5B;;;AADgE,MAa5D,cAAc,QAAd,EAAwB;AAC1B,SAAK,GAAG,GAAH,CADqB;GAA5B;;AAIA,SAAO,KAAK,gBAAL,CAAsB,IAAtB,CAA2B,IAA3B,EAAiC,EAAC,KAAK,EAAL,EAAlC,EAA4C,MAA5C,EAAoD,OAApD,EAA6D,QAA7D,CAAP,CAjBgE;CAAxC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmE1B,MAAM,gBAAN,GAAyB,UAAS,UAAT,EAAqB,OAArB,EAA8B,QAA9B,EAAwC;AAC/D,MAAI,UAAU,MAAV,KAAqB,CAArB,IAA0B,OAAO,UAAP,KAAsB,UAAtB,EAAkC;AAC9D,QAAI,MAAM,yEACJ,IADI,GACG,KAAK,SAAL,GAAiB,2CADpB,GAEJ,IAFI,GAEG,KAAK,SAAL,GAAiB,iCAFpB,GAGJ,IAHI,GAGG,KAAK,SAAL,GAAiB,uBAHpB,CADoD;AAK9D,UAAM,IAAI,SAAJ,CAAc,GAAd,CAAN,CAL8D;GAAhE;;AAQA,MAAI,OAAO,OAAP,KAAmB,UAAnB,EAA+B;AACjC,eAAW,OAAX,CADiC;AAEjC,cAAU,SAAV,CAFiC;GAAnC;;AAKA,MAAI,MAAJ,CAd+D;AAe/D,MAAI,OAAJ,EAAa;AACX,aAAS,QAAQ,MAAR,CADE;AAEX,YAAQ,MAAR,GAAiB,SAAjB,CAFW;GAAb;;AAKA,MAAI,KAAK,IAAI,KAAJ,CAAU,EAAV,EAAc,EAAd,EAAkB,IAAlB,EAAwB,KAAK,UAAL,CAA7B,CApB2D;AAqB/D,KAAG,MAAH,CAAU,MAAV,EArB+D;;AAuB/D,SAAO,GAAG,gBAAH,CAAoB,UAApB,EAAgC,OAAhC,EAAyC,QAAzC,CAAP,CAvB+D;CAAxC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsDzB,MAAM,iBAAN,GAA0B,UAAS,EAAT,EAAa,OAAb,EAAsB,QAAtB,EAAgC;AACxD,MAAI,UAAU,MAAV,KAAqB,CAArB,IAA0B,OAAO,EAAP,KAAc,UAAd,EAA0B;AACtD,QAAI,MAAM,0EACJ,IADI,GACG,KAAK,SAAL,GAAiB,oCADpB,GAEJ,IAFI,GAEG,KAAK,SAAL,GAAiB,0BAFpB,GAGJ,IAHI,GAGG,KAAK,SAAL,GAAiB,wBAHpB,CAD4C;AAKtD,UAAM,IAAI,SAAJ,CAAc,GAAd,CAAN,CALsD;GAAxD;;AAQA,SAAO,KAAK,gBAAL,CAAsB,EAAC,KAAK,EAAL,EAAvB,EAAiC,OAAjC,EAA0C,QAA1C,CAAP,CATwD;CAAhC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6C1B,MAAM,MAAN,GAAe,SAAS,MAAT,CAAgB,GAAhB,EAAqB,QAArB,EAA+B;AAC5C,MAAI,IAAJ,EACI,EADJ,CAD4C;;AAI5C,MAAI,MAAM,OAAN,CAAc,GAAd,CAAJ,EAAwB;AACtB,WAAO,GAAP,CADsB;AAEtB,SAAK,QAAL,CAFsB;GAAxB,MAGO;AACL,QAAI,OAAO,UAAU,UAAU,MAAV,GAAmB,CAAnB,CAAjB,CADC;AAEL,QAAI,OAAO,IAAP,KAAgB,UAAhB,EAA4B;AAC9B,WAAK,IAAL,CAD8B;AAE9B,aAAO,MAAM,IAAN,CAAW,SAAX,EAAsB,CAAtB,EAAyB,UAAU,MAAV,GAAmB,CAAnB,CAAhC,CAF8B;KAAhC,MAGO;AACL,aAAO,MAAM,IAAN,CAAW,SAAX,CAAP,CADK;KAHP;GALF;;AAaA,MAAI,UAAU,gBAAgB,GAAhB,EAAV,CAjBwC;AAkB5C,MAAI,QAAQ,IAAR,CAlBwC;;AAoB5C,MAAI,UAAU,IAAI,QAAQ,GAAR,CAAY,UAAS,OAAT,EAAkB,MAAlB,EAA0B;AACtD,QAAI,KAAK,MAAL,KAAgB,CAAhB,EAAmB;AACrB,cAAQ,QAAR,CAAiB,YAAW;AAC1B,cAAM,GAAG,IAAH,CAAN,CAD0B;AAE1B,gBAAQ,IAAR,EAF0B;OAAX,CAAjB,CADqB;AAKrB,aALqB;KAAvB;;AAQA,QAAI,YAAY,EAAZ,CATkD;AAUtD,SAAK,OAAL,CAAa,UAAS,GAAT,EAAc;AACzB,gBAAU,IAAV,CAAe,UAAS,QAAT,EAAmB;AAChC,YAAI,SAAS,IAAI,KAAJ,CAAU,GAAV,CAAT,CAD4B;AAEhC,YAAI,kBAAkB,UAAS,KAAT,EAAgB,GAAhB,EAAqB;AACzC,cAAI,KAAJ,EAAW;AACT,mBAAO,SAAS,KAAT,CAAP,CADS;WAAX;AAGA,mBAAS,IAAT,EAAe,GAAf,EAJyC;SAArB;;;;AAFU,YAW5B,OAAO,gBAAP,EAAyB;AAC3B,iBAAO,gBAAP,CAAwB,EAAC,aAAa,IAAb,EAAzB,EAA6C,eAA7C,EAD2B;SAA7B,MAEO;AACL,iBAAO,IAAP,CAAY,EAAC,aAAa,IAAb,EAAb,EAAiC,eAAjC,EADK;SAFP;OAXa,CAAf,CADyB;KAAd,CAAb,CAVsD;;AA8BtD,UAAM,QAAN,CAAe,SAAf,EAA0B,UAAS,KAAT,EAAgB,SAAhB,EAA2B;AACnD,UAAI,KAAJ,EAAW;AACT,cAAM,GAAG,KAAH,CAAN,CADS;AAET,eAAO,KAAP,EAFS;AAGT,eAHS;OAAX;;AAMA,UAAI,eAAe,KAAf,EAAsB;AACxB,gBAAQ,SAAR,EADwB;AAExB,cAAM,GAAG,IAAH,CAAQ,KAAR,EAAe,IAAf,EAAqB,SAArB,CAAN,CAFwB;OAA1B,MAGO;AACL,gBAAQ,KAAR,CAAc,OAAd,EAAuB,SAAvB,EADK;AAEL,YAAI,EAAJ,EAAQ;AACN,oBAAU,OAAV,CAAkB,IAAlB,EADM;AAEN,aAAG,KAAH,CAAS,KAAT,EAAgB,SAAhB,EAFM;SAAR;OALF;KAPwB,CAA1B,CA9BsD;GAA1B,CAA1B,CApBwC;;AAsE5C,SAAO,OAAP,CAtE4C;CAA/B;;;;;;;;;;;;;;;;;;;;;AA4Ff,MAAM,UAAN,GAAmB,UAAS,GAAT,EAAc,QAAd,EAAwB;AACzC,MAAI,QAAQ,IAAR,CADqC;AAEzC,MAAI,UAAU,gBAAgB,GAAhB,EAAV,CAFqC;;AAIzC,SAAO,IAAI,QAAQ,GAAR,CAAY,UAAS,OAAT,EAAkB,MAAlB,EAA0B;AAC/C,QAAI,YAAY,EAAZ,CAD2C;AAE/C,QAAI,OAAJ,CAAY,UAAS,GAAT,EAAc;AACxB,gBAAU,IAAV,CAAe,UAAS,QAAT,EAAmB;AAChC,cAAM,IAAI,KAAJ,CAAU,GAAV,CAAN,CADgC;AAEhC,YAAI,QAAJ,CAAa,EAAC,aAAa,IAAb,EAAd,EAAkC,UAAS,KAAT,EAAgB;AAChD,cAAI,KAAJ,EAAW;AACT,mBAAO,SAAS,KAAT,CAAP,CADS;WAAX;AAGA,mBAAS,IAAT,EAAe,GAAf,EAJgD;SAAhB,CAAlC,CAFgC;OAAnB,CAAf,CADwB;KAAd,CAAZ,CAF+C;;AAc/C,UAAM,QAAN,CAAe,SAAf,EAA0B,UAAS,KAAT,EAAgB,IAAhB,EAAsB;AAC9C,UAAI,KAAJ,EAAW;AACT,eAAO,KAAP,EADS;AAET,oBAAY,SAAS,KAAT,CAAZ,CAFS;AAGT,eAHS;OAAX;AAKA,UAAI,aAAa,KAAK,GAAL,CAAS,UAAS,GAAT,EAAc;AACtC,eAAO,IAAI,QAAJ,CAAa,EAAC,UAAU,KAAV,EAAd,CAAP,CADsC;OAAd,CAAtB,CAN0C;AAS9C,YAAM,UAAN,CAAiB,UAAjB,CAA4B,UAA5B,EAAwC,UAAS,KAAT,EAAgB;AACtD,YAAI,KAAJ,EAAW;AACT,iBAAO,KAAP,EADS;AAET,sBAAY,SAAS,KAAT,CAAZ,CAFS;AAGT,iBAHS;SAAX;AAKA,gBAAQ,IAAR,EANsD;AAOtD,oBAAY,SAAS,IAAT,EAAe,IAAf,CAAZ,CAPsD;OAAhB,CAAxC,CAT8C;KAAtB,CAA1B,CAd+C;GAA1B,CAAvB,CAJyC;CAAxB;;;;;;;;;;;;;;;;AAsDnB,MAAM,OAAN,GAAgB,UAAS,GAAT,EAAc;AAC5B,MAAI,QAAQ,QAAQ,gBAAR,EAA0B,WAA1B,CAAsC,IAAtC,EAA4C,GAA5C,CAAR,CADwB;AAE5B,QAAM,IAAN,CAAW,GAAX,EAF4B;AAG5B,SAAO,KAAP,CAH4B;CAAd;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsFhB,MAAM,MAAN,GAAe,SAAS,MAAT,CAAgB,UAAhB,EAA4B,GAA5B,EAAiC,OAAjC,EAA0C,QAA1C,EAAoD;AACjE,MAAI,KAAK,IAAI,KAAJ,CAAU,EAAV,EAAc,EAAd,EAAkB,IAAlB,EAAwB,KAAK,UAAL,CAA7B;;;AAD6D,MAI7D,sBAAsB,QAAtB,EAAgC;AAClC,iBAAa,WAAW,QAAX,EAAb,CADkC;GAApC,MAEO;AACL,iBAAa,MAAM,KAAN,CAAY,UAAZ,EAAwB,EAAC,gBAAgB,IAAhB,EAAzB,CAAb,CADK;GAFP;AAKA,YAAU,OAAO,OAAP,KAAmB,UAAnB,GAAgC,OAAhC,GAA0C,MAAM,KAAN,CAAY,OAAZ,CAA1C,CATuD;;AAWjE,SAAO,GAAG,MAAH,CAAU,UAAV,EAAsB,GAAtB,EAA2B,OAA3B,EAAoC,QAApC,CAAP,CAXiE;CAApD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiFf,MAAM,SAAN,GAAkB,SAAS,SAAT,CAAmB,CAAnB,EAAsB,QAAtB,EAAgC;AAChD,MAAI,QAAQ,IAAR,CAD4C;AAEhD,MAAI,UAAU,gBAAgB,GAAhB,EAAV,CAF4C;AAGhD,SAAO,IAAI,QAAQ,GAAR,CAAY,UAAS,OAAT,EAAkB,MAAlB,EAA0B;AAC/C,QAAI,CAAC,MAAM,SAAN,CAAgB,MAAhB,EAAwB;AAC3B,UAAI,OAAO,EAAC,MAAM,IAAN,EAAY,aAAa,IAAb,EAAmB,QAAQ,KAAR,EAAvC,CADuB;AAE3B,YAAM,SAAN,CAAgB,MAAhB,GAAyB,IAAI,MAAJ,CAAW,EAAX,EAAe,IAAf,CAAzB,CAF2B;KAA7B;;AAKA,QAAI,CAAC,EAAE,GAAF,EAAO,EAAE,GAAF,GAAQ,EAAC,QAAQ,CAAR,EAAT,CAAZ;AACA,QAAI,EAAE,OAAF,KAAc,KAAd,EAAqB,EAAE,OAAF,GAAY,IAAZ,CAAzB;;AAEA,MAAE,GAAF,GAAQ,OAAO,EAAE,GAAF,CAAf,CAT+C;AAU/C,MAAE,MAAF,GAAW,OAAO,EAAE,MAAF,CAAlB,CAV+C;;AAY/C,QAAI,EAAE,KAAF,EAAS;AACX,UAAI,IAAI,IAAI,KAAJ,CAAU,EAAE,KAAF,CAAd,CADO;AAEX,QAAE,IAAF,CAAO,KAAP,EAFW;AAGX,QAAE,KAAF,GAAU,EAAE,WAAF,CAHC;AAIX,UAAI,SAAJ,CAJW;KAAb;;AAOA,UAAM,UAAN,CAAiB,SAAjB,CAA2B,IAA3B,EAAiC,IAAjC,EAAuC,CAAvC,EAA0C,UAAS,GAAT,EAAc,GAAd,EAAmB,KAAnB,EAA0B;AAClE,UAAI,GAAJ,EAAS;AACP,oBAAY,SAAS,GAAT,CAAZ,CADO;AAEP,eAAO,GAAP,EAFO;AAGP,eAHO;OAAT;;AAMA,UAAI,IAAI,OAAJ,IAAe,IAAI,SAAJ,EAAe;;AAEhC,YAAI,QAAQ,MAAM,OAAN,CACR,gBAAgB,IAAI,cAAJ,EACd,MAAM,SAAN,CAAgB,MAAhB,EACA,IAAI,cAAJ,EACA,MAAM,EAAN,EACA,MAAM,IAAN,CALF,CAF4B;;AAShC,cAAM,UAAN,GAAmB,IAAnB,CATgC;;AAWhC,oBAAY,SAAS,IAAT,EAAe,KAAf,EAAsB,KAAtB,CAAZ,CAXgC;AAYhC,eAAO,QAAQ,KAAR,EAAe,KAAf,CAAP,CAZgC;OAAlC;;AAeA,kBAAY,SAAS,IAAT,EAAe,GAAf,EAAoB,KAApB,CAAZ,CAtBkE;AAuBlE,cAAQ,GAAR,EAAa,KAAb,EAvBkE;KAA1B,CAA1C,CAnB+C;GAA1B,CAAvB,CAHgD;CAAhC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+ElB,MAAM,OAAN,GAAgB,UAAS,IAAT,EAAe,OAAf,EAAwB,QAAxB,EAAkC;AAChD,MAAI,OAAO,OAAP,KAAmB,UAAnB,EAA+B;AACjC,eAAW,OAAX,CADiC;AAEjC,cAAU,EAAV,CAFiC;GAAnC;;AAKA,MAAI,QAAQ,IAAR,CAN4C;AAOhD,MAAI,UAAU,gBAAgB,GAAhB,EAAV,CAP4C;AAQhD,MAAI,CAAC,IAAD,EAAO;AACT,WAAO,IAAI,QAAQ,GAAR,CAAY,UAAS,OAAT,EAAkB,MAAlB,EAA0B;AAC/C,UAAI,QAAQ,IAAI,KAAJ,CAAU,oCAAV,CAAR,CAD2C;AAE/C,aAAO,KAAP,EAF+C;AAG/C,kBAAY,SAAS,KAAT,CAAZ,CAH+C;KAA1B,CAAvB,CADS;GAAX;;AAQA,MAAI,CAAJ,EAAO,CAAP,CAhBgD;;AAkBhD,SAAO,IAAI,QAAQ,GAAR,CAAY,UAAS,OAAT,EAAkB,MAAlB,EAA0B;AAC/C,QAAI,UAAU,UAAS,GAAT,EAAc,GAAd,EAAmB;AAC/B,UAAI,GAAJ,EAAS;AACP,eAAO,GAAP,EADO;AAEP,oBAAY,SAAS,GAAT,CAAZ,CAFO;AAGP,eAHO;OAAT;AAKA,UAAI,QAAQ,IAAR,EAAc;AAChB,gBAAQ,IAAI,OAAJ,EAAa,IAAI,KAAJ,CAArB,CADgB;AAEhB,oBAAY,SAAS,IAAT,EAAe,IAAI,OAAJ,EAAa,IAAI,KAAJ,CAAxC,CAFgB;AAGhB,eAHgB;OAAlB;;AAMA,UAAI,QAAQ,IAAI,OAAJ,CAAY,MAAZ;;AAZmB,UAc3B,UAAU,CAAV,EAAa;AACf,gBAAQ,IAAI,OAAJ,EAAa,IAAI,KAAJ,CAArB,CADe;AAEf,oBAAY,SAAS,IAAT,EAAe,IAAI,OAAJ,EAAa,IAAI,KAAJ,CAAxC,CAFe;AAGf,eAHe;OAAjB;;AAMA,UAAI,UAAU,KAAV,CApB2B;;AAsB/B,eAAS,IAAT,CAAc,GAAd,EAAmB;AACjB,YAAI,OAAO,CAAC,OAAD,EAAU;AACnB,oBAAU,IAAV,CADmB;AAEnB,iBAAO,GAAP,EAFmB;AAGnB,sBAAY,SAAS,GAAT,CAAZ,CAHmB;AAInB,iBAJmB;SAArB;AAMA,YAAI,EAAE,KAAF,IAAW,CAAX,EAAc;AAChB,kBAAQ,IAAI,OAAJ,EAAa,IAAI,KAAJ,CAArB,CADgB;AAEhB,sBAAY,SAAS,IAAT,EAAe,IAAI,OAAJ,EAAa,IAAI,KAAJ,CAAxC,CAFgB;SAAlB;OAPF;;AAaA,WAAK,IAAI,IAAI,CAAJ,EAAO,IAAI,IAAI,OAAJ,CAAY,MAAZ,EAAoB,GAAxC,EAA6C;AAC3C,YAAI,OAAO,IAAI,OAAJ,CAAY,CAAZ,EAAe,GAAf,CADgC;AAE3C,YAAI,OAAJ,CAAY,CAAZ,EAAe,GAAf,GAAqB,IAAI,KAAJ,EAArB,CAF2C;AAG3C,YAAI,OAAJ,CAAY,CAAZ,EAAe,GAAf,CAAmB,IAAnB,CAAwB,IAAxB,EAA8B,IAA9B,EAH2C;OAA7C;KAnCY,CADiC;;AA2C/C,QAAI,MAAM,OAAN,CAAc,IAAd,CAAJ,EAAyB;AACvB,UAAI,KAAK,MAAL,KAAgB,CAAhB,EAAmB;AACrB,YAAI,QAAQ,IAAI,KAAJ,CAAU,mDAClB,uBADkB,CAAlB,CADiB;AAGrB,eAAO,KAAP,EAHqB;AAIrB,oBAAY,SAAS,KAAT,CAAZ,CAJqB;AAKrB,eALqB;OAAvB;AAOA,UAAI,KAAK,CAAL,CAAJ,CARuB;AASvB,UAAI,KAAK,CAAL,CAAJ,CATuB;AAUvB,YAAM,UAAN,CAAiB,OAAjB,CAAyB,CAAzB,EAA4B,CAA5B,EAA+B,OAA/B,EAAwC,OAAxC,EAVuB;KAAzB,MAWO;AACL,UAAI,KAAK,IAAL,KAAc,OAAd,IAAyB,CAAC,MAAM,OAAN,CAAc,KAAK,WAAL,CAAf,EAAkC;AAC7D,gBAAQ,IAAI,KAAJ,CAAU,mDACd,0BADc,CAAlB,CAD6D;AAG7D,eAAO,KAAP,EAH6D;AAI7D,oBAAY,SAAS,KAAT,CAAZ,CAJ6D;AAK7D,eAL6D;OAA/D;;AAQA,YAAM,UAAN,CAAiB,OAAjB,CAAyB,IAAzB,EAA+B,OAA/B,EAAwC,OAAxC,EATK;KAXP;GA3CqB,CAAvB,CAlBgD;CAAlC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6HhB,MAAM,SAAN,GAAkB,SAAS,SAAT,GAAqB;AACrC,MAAI,OAAO,GAAG,KAAH,CAAS,IAAT,CAAc,SAAd,CAAP;MACA,SADJ;MAEI,QAFJ,CADqC;;AAKrC,MAAI,OAAO,KAAK,KAAK,MAAL,GAAc,CAAd,CAAZ,KAAiC,UAAjC,EAA6C;AAC/C,eAAW,KAAK,GAAL,EAAX,CAD+C;GAAjD;;AAIA,MAAI,KAAK,MAAL,KAAgB,CAAhB,IAAqB,KAAK,OAAL,CAAa,KAAK,CAAL,CAAb,CAArB,EAA4C;AAC9C,gBAAY,IAAI,SAAJ,CAAc,KAAK,CAAL,CAAd,CAAZ,CAD8C;GAAhD,MAEO;AACL,gBAAY,IAAI,SAAJ,CAAc,IAAd,CAAZ,CADK;GAFP;;AAMA,YAAU,KAAV,CAAgB,IAAhB,EAfqC;;AAiBrC,MAAI,OAAO,QAAP,KAAoB,WAApB,EAAiC;AACnC,WAAO,SAAP,CADmC;GAArC;;AAIA,SAAO,UAAU,IAAV,CAAe,QAAf,CAAP,CArBqC;CAArB;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiDlB,MAAM,SAAN,GAAkB,UAAS,UAAT,EAAqB,OAArB,EAA8B,QAA9B,EAAwC;AACxD,MAAI,OAAO,OAAP,KAAmB,UAAnB,EAA+B;AACjC,eAAW,OAAX,CADiC;AAEjC,cAAU,EAAV,CAFiC;GAAnC;;AAKA,MAAI,QAAQ,IAAR,CANoD;AAOxD,MAAI,UAAU,gBAAgB,GAAhB,EAAV,CAPoD;AAQxD,SAAO,IAAI,QAAQ,GAAR,CAAY,UAAS,OAAT,EAAkB,MAAlB,EAA0B;AAC/C,QAAI,KAAJ,CAD+C;AAE/C,QAAI,eAAe,SAAf,IAA4B,CAAC,MAAM,QAAN,CAAe,UAAf,CAAD,EAA6B;AAC3D,cAAQ,IAAI,KAAJ,CAAU,mCAAV,CAAR,CAD2D;KAA7D,MAEO,IAAI,CAAC,QAAQ,IAAR,EAAc;AACxB,cAAQ,IAAI,KAAJ,CAAU,2CAAV,CAAR,CADwB;KAAnB,MAEA,IAAI,CAAC,MAAM,OAAN,CAAc,QAAQ,IAAR,CAAf,EAA8B;AACvC,cAAQ,IAAI,KAAJ,CAAU,qCAAV,CAAR,CADuC;KAAlC;;AAIP,QAAI,KAAJ,EAAW;AACT,kBAAY,SAAS,KAAT,CAAZ,CADS;AAET,aAAO,KAAP,EAFS;AAGT,aAHS;KAAX;;;AAV+C,WAiB/C,CAAQ,MAAR,GAAiB,UAAjB,CAjB+C;;AAmB/C,UAAM,UAAN,CAAiB,iBAAjB,CAAmC,QAAQ,IAAR,CAAa,CAAb,CAAnC,EAAoD,QAAQ,IAAR,CAAa,CAAb,CAApD,EAAqE,OAArE,EAA8E,UAAS,GAAT,EAAc,GAAd,EAAmB;;;AAG/F,UAAI,GAAJ,EAAS;AACP,oBAAY,SAAS,GAAT,CAAZ,CADO;AAEP,eAAO,GAAP,EAFO;AAGP,eAHO;OAAT;;AAMA,UAAI,QAAQ,IAAI,OAAJ,CAAY,MAAZ,CATmF;AAU/F,UAAI,QAAQ,IAAR,IAAgB,UAAU,CAAV,EAAa;AAC/B,oBAAY,SAAS,IAAT,EAAe,IAAI,OAAJ,EAAa,IAAI,KAAJ,CAAxC,CAD+B;AAE/B,gBAAQ,IAAI,OAAJ,EAAa,IAAI,KAAJ,CAArB,CAF+B;AAG/B,eAH+B;OAAjC;;AAMA,UAAI,UAAU,KAAV,CAhB2F;;AAkB/F,eAAS,IAAT,CAAc,GAAd,EAAmB;AACjB,YAAI,OAAO,CAAC,OAAD,EAAU;AACnB,sBAAY,SAAS,GAAT,CAAZ,CADmB;AAEnB,iBAAO,GAAP,EAFmB;AAGnB,iBAHmB;SAArB;;AAMA,YAAI,EAAC,EAAE,KAAF,IAAW,CAAC,OAAD,EAAU;AACxB,sBAAY,SAAS,IAAT,EAAe,IAAI,OAAJ,EAAa,IAAI,KAAJ,CAAxC,CADwB;AAExB,kBAAQ,IAAI,OAAJ,EAAa,IAAI,KAAJ,CAArB,CAFwB;SAA1B;OAPF;;AAaA,WAAK,IAAI,IAAI,CAAJ,EAAO,IAAI,IAAI,OAAJ,CAAY,MAAZ,EAAoB,GAAxC,EAA6C;AAC3C,YAAI,OAAO,IAAI,OAAJ,CAAY,CAAZ,CAAP,CADuC;AAE3C,YAAI,OAAJ,CAAY,CAAZ,IAAiB,IAAI,KAAJ,EAAjB,CAF2C;AAG3C,YAAI,OAAJ,CAAY,CAAZ,EAAe,IAAf,CAAoB,IAApB,EAA0B,EAA1B,EAA8B,IAA9B,EAH2C;OAA7C;KA/B4E,CAA9E,CAnB+C;GAA1B,CAAvB,CARwD;CAAxC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiIlB,MAAM,QAAN,GAAiB,UAAS,IAAT,EAAe,KAAf,EAAsB,EAAtB,EAA0B;AACzC,MAAI,QAAQ,IAAR;;;AADqC,MAIrC,YAAY,SAAS,CAAC,CAAC,MAAM,WAAN,CAJc;AAKzC,UAAQ,MAAM,QAAN,CAAe,KAAf,CAAR;;;AALyC,MAQrC,QAAQ,EAAR,CARqC;;AAUzC,MAAI,SAAJ,EAAe;AACb,cAAU,IAAV,EAAgB,IAAhB,EAAsB,KAAtB,EAA6B,KAA7B,EAAoC,EAApC,EADa;GAAf,MAEO;AACL,QAAI,UAAU,gBAAgB,GAAhB,EAAV,CADC;AAEL,WAAO,IAAI,QAAQ,GAAR,CAAY,UAAS,OAAT,EAAkB,MAAlB,EAA0B;AAC/C,gBAAU,KAAV,EAAiB,IAAjB,EAAuB,KAAvB,EAA8B,KAA9B,EAAqC,UAAS,KAAT,EAAgB,IAAhB,EAAsB;AACzD,YAAI,KAAJ,EAAW;AACT,gBAAM,GAAG,KAAH,CAAN,CADS;AAET,iBAAO,KAAP,EAFS;SAAX,MAGO;AACL,gBAAM,GAAG,IAAH,EAAS,IAAT,CAAN,CADK;AAEL,kBAAQ,IAAR,EAFK;SAHP;OADmC,CAArC,CAD+C;KAA1B,CAAvB,CAFK;GAFP;CAVe;;;;;;;;;;;;;AAuCjB,SAAS,SAAT,CAAmB,KAAnB,EAA0B,IAA1B,EAAgC,KAAhC,EAAuC,KAAvC,EAA8C,EAA9C,EAAkD;AAChD,MAAI,UAAU,MAAM,MAAN,CADkC;;AAGhD,MAAI,YAAY,CAAZ,EAAe;AACjB,WAAO,GAAG,IAAH,EAAS,IAAT,CAAP,CADiB;GAAnB;;;AAHgD,MAQ5C,IAAI,OAAJ,CAR4C;AAShD,MAAI,IAAJ,CATgD;AAUhD,SAAO,GAAP,EAAY;AACV,WAAO,MAAM,CAAN,CAAP,CADU;AAEV,QAAI,OAAO,KAAK,KAAL,KAAe,UAAtB,EAAkC;AACpC,cAAQ,KAAK,KAAL,CAD4B;KAAtC;AAGA,aAAS,KAAT,EAAgB,IAAhB,EAAsB,IAAtB,EAA4B,YAAY,IAAZ,CAAiB,KAAjB,EAAwB,IAAxB,EAA8B,IAA9B,EAAoC,KAApC,EAA2C,IAA3C,CAA5B,EALU;GAAZ;;AAQA,WAAS,IAAT,CAAc,GAAd,EAAmB;AACjB,QAAI,GAAJ,EAAS;AACP,aAAO,GAAG,GAAH,CAAP,CADO;KAAT;AAGA,QAAI,EAAE,OAAF,EAAW;AACb,aADa;KAAf;AAGA,OAAG,IAAH,EAAS,IAAT,EAPiB;GAAnB;CAlBF;;;;;;;;;;;AAsCA,SAAS,WAAT,CAAqB,IAArB,EAA2B,OAA3B,EAAoC,KAApC,EAA2C,EAA3C,EAA+C;AAC7C,MAAI,QAAQ,IAAR,CADyC;AAE7C,MAAI,SAAS,QAAQ,IAAR,GAAe,GAAf,CAFgC;AAG7C,MAAI,MAAM,QAAQ,QAAR,CAHmC;;AAK7C,MAAI,CAAC,GAAD,EAAM;AACR,WAAO,EAAP,CADQ;GAAV;;;AAL6C,MAUzC,CAAC,MAAM,OAAN,CAAc,GAAd,CAAD,EAAqB;AACvB,UAAM,CAAC,GAAD,CAAN,CADuB;GAAzB;;AAIA,SAAO,UAAS,GAAT,EAAc;AACnB,QAAI,UAAU,IAAI,MAAJ,CADK;;AAGnB,aAAS,IAAT,CAAc,GAAd,EAAmB;AACjB,UAAI,GAAJ,EAAS,OAAO,GAAG,GAAH,CAAP,CAAT;AACA,UAAI,EAAE,OAAF,EAAW,OAAf;AACA,WAHiB;KAAnB;;AAMA,QAAI,OAAO,CAAC,OAAD,EAAU,OAAO,GAAG,GAAH,CAAP,CAArB;;AAEA,QAAI,OAAJ,CAAY,UAAS,UAAT,EAAqB;AAC/B,mBAAa,MAAM,KAAN,CAAY,UAAZ,CAAb;;AAD+B,UAG3B,CAAC,WAAW,aAAX,EAA0B;AAC7B,mBAAW,aAAX,GAA2B,WAAW,IAAX,CADE;AAE7B,mBAAW,IAAX,GAAkB,SAAS,WAAW,IAAX,CAFE;OAA/B;;AAKA,UAAI,SAAS,MAAM,OAAO,MAAP,CAAc,CAAd,EAAiB,OAAO,MAAP,GAAgB,CAAhB,CAAvB,KACX,MAAM,MAAN,CAAa,UAAb,CAAwB,MAAxB,CADW,CARkB;AAU/B,UAAI,SAAJ,CAV+B;AAW/B,UAAI,OAAO,WAAW,KAAX,KAAqB,QAA5B,EAAsC;AACxC,mBAAW,KAAX,GAAmB,MAAM,KAAN,CAAY,WAAW,KAAX,CAA/B,CADwC;OAA1C,MAEO,IAAI,UAAU,OAAO,MAAP,IAAiB,OAAO,MAAP,CAAc,OAAd,IAClC,OAAO,MAAP,CAAc,OAAd,CAAsB,GAAtB,EAA2B;AAC7B,oBAAY,MAAM,KAAN,CAAY,OAAO,MAAP,CAAc,OAAd,CAAsB,GAAtB,CAAZ,CAAuC,MAAvC,CACV,UADU,CACC,WAAW,aAAX,CADb,CAD6B;AAG7B,cAAM,WAAW,IAAX,CAAN,GAAyB,SAAzB,CAH6B;AAI7B,YAAI,aAAa,UAAU,OAAV,IAAqB,UAAU,OAAV,CAAkB,GAAlB,EAAuB;AAC3D,qBAAW,KAAX,GAAmB,MAAM,KAAN,CAAY,UAAU,OAAV,CAAkB,GAAlB,CAA/B,CAD2D;SAA7D,MAEO,IAAI,aAAa,UAAU,MAAV,IAAoB,UAAU,MAAV,CAAiB,OAAjB,IAC1C,UAAU,MAAV,CAAiB,OAAjB,CAAyB,GAAzB,EAA8B;AAC9B,qBAAW,KAAX,GAAmB,MAAM,KAAN,CAAY,UAAU,MAAV,CAAiB,OAAjB,CAAyB,GAAzB,CAA/B,CAD8B;SADzB;OAPF,MAWA,IAAI,UAAU,OAAO,OAAP,IAAkB,OAAO,OAAP,CAAe,GAAf,EAAoB;AACzD,oBAAY,MAAM,KAAN,CAAY,OAAO,OAAP,CAAe,GAAf,CAAZ,CAAgC,MAAhC,CACV,UADU,CACC,WAAW,aAAX,CADb,CADyD;AAGzD,YAAI,aAAa,UAAU,OAAV,IAAqB,UAAU,OAAV,CAAkB,GAAlB,EAAuB;AAC3D,qBAAW,KAAX,GAAmB,MAAM,KAAN,CAAY,UAAU,OAAV,CAAkB,GAAlB,CAA/B,CAD2D;SAA7D,MAEO,IAAI,aAAa,UAAU,MAAV,IAAoB,UAAU,MAAV,CAAiB,OAAjB,IAC1C,UAAU,MAAV,CAAiB,OAAjB,CAAyB,GAAzB,EAA8B;AAC9B,qBAAW,KAAX,GAAmB,MAAM,KAAN,CAAY,UAAU,MAAV,CAAiB,OAAjB,CAAyB,GAAzB,CAA/B,CAD8B;SADzB;OALF;AAUP,gBAAU,WAAW,KAAX,IAAoB,KAApB,EAA2B,IAArC,EAA2C,MAAM,QAAN,CAAe,UAAf,CAA3C,EACE,KADF,EACS,IADT,EAlC+B;KAArB,CAAZ,CAXmB;GAAd,CAdsC;CAA/C;;;;;AAoEA,IAAI,eAAe,YAAf;IACA,qBAAqB,aAArB;;AAEJ,SAAS,QAAT,CAAkB,KAAlB,EAAyB,IAAzB,EAA+B,OAA/B,EAAwC,EAAxC,EAA4C;AAC1C,MAAI,SAAJ,EAAe,MAAf;;;AAD0C,MAItC,CAAC,MAAM,OAAN,CAAc,IAAd,CAAD,EAAsB;AACxB,WAAO,CAAC,IAAD,CAAP,CADwB;GAA1B;;AAIA,MAAI,KAAK,MAAL,KAAgB,CAAhB,IAAqB,KAAK,KAAL,CAAW,MAAM,iBAAN,CAAhC,EAA0D;AAC5D,WAAO,IAAP,CAD4D;GAA9D;;AAIA,cAAY,wBAAwB,KAAxB,EAA+B,IAA/B,EAAqC,OAArC,CAAZ,CAZ0C;AAa1C,WAAS,gCAAgC,SAAhC,CAAT,CAb0C;;AAe1C,MAAI,CAAJ;MAAO,MAAM,UAAU,MAAV;MACT,GADJ;MACS,KADT;MACgB,MADhB;MACwB,OADxB;MACiC,OAAO,EAAP,CAhBS;;AAkB1C,YAAU,IAAI,OAAJ,CAAY,UAAS,GAAT,EAAc,IAAd,EAAoB,OAApB,EAA6B,cAA7B,EAA6C;AACjE,QAAI,GAAJ,EAAS,OAAO,GAAG,GAAH,CAAP,CAAT;;AAEA,QAAI,OAAO,QAAQ,OAAR,IAAmB,QAAQ,OAAR,CAAgB,IAAhB;QAC1B,MAAM,KAAK,MAAL;QACN,WAAW,EAAX;QAAe,UAAU,EAAV;QAAc,GAFjC;QAEsC,GAFtC;;;;;AAHiE,SAU5D,IAAI,IAAI,CAAJ,EAAO,IAAI,GAAJ,EAAS,GAAzB,EAA8B;AAC5B,YAAM,KAAK,CAAL,CAAN,CAD4B;AAE5B,YAAM,OAAO,MAAM,QAAN,CAAe,KAAf,EAAsB,GAAtB,CAAP,CAAN,CAF4B;AAG5B,cAAQ,GAAR,IAAe,GAAf,CAH4B;AAI5B,eAAS,GAAT,IAAgB,CAAhB;;;AAJ4B,UAOxB,CAAC,IAAD,EAAO,IAAI,GAAJ,CAAQ,YAAR,GAAuB,IAAvB,CAAX;KAPF;;AAUA,eAAW;AACT,cAAQ,MAAR;AACA,eAAS,OAAT;AACA,gBAAU,QAAV;AACA,YAAM,IAAN;AACA,YAAM,QAAQ,IAAR;AACN,eAAS,cAAT;KANF,EApBiE;AA4BjE,SA5BiE;GAA7C,CAAtB,CAlB0C;;AAiD1C,WAAS,OAAT,CAAiB,IAAjB,EAAuB;;AAErB,WAAO,cAAc,IAAd,CAFc;GAAvB;;AAKA,MAAI,aAAa,GAAb,CAtDsC;AAuD1C,MAAI,SAAS,KAAT,CAvDsC;AAwD1C,OAAK,IAAI,CAAJ,EAAO,IAAI,GAAJ,EAAS,GAArB,EAA0B;AACxB,UAAM,UAAU,CAAV,CAAN,CADwB;AAExB,aAAS,IAAI,OAAJ,CAAY,MAAZ,CAFe;;AAIxB,QAAI,IAAI,OAAJ,CAAY,KAAZ,EAAmB;AACrB,cAAQ,MAAM,MAAN,CAAa,WAAb,CAAyB,IAAI,OAAJ,CAAY,KAAZ,CAAjC,CADqB;KAAvB,MAEO;AACL,cAAQ,EAAR,CADK;KAFP;;AAMA,QAAI,MAAM,MAAM,KAAN,CAAY,OAAZ,CAAoB,IAAI,GAAJ,EAAS,OAA7B,CAAN,CAVoB;AAWxB,UAAM,MAAM,KAAN,CAAY,MAAZ,CAAmB,GAAnB,CAAN,CAXwB;;AAaxB,QAAI,IAAI,MAAJ,KAAe,CAAf,IAAoB,IAAI,KAAJ,CAAU,MAAM,iBAAN,CAA9B,EAAwD;AAC1D,QAAE,UAAF,CAD0D;AAE1D,eAF0D;KAA5D;;AAKA,aAAS,IAAT,CAlBwB;AAmBxB,UAAM,GAAN,KAAc,MAAM,GAAN,GAAY;AACxB,WAAK,GAAL;KADY,CAAd,CAnBwB;;AAuBxB,QAAI,iBAAiB,EAAjB,CAvBoB;AAwBxB,mBAAe,IAAf,GAAsB,IAAI,OAAJ,CAAY,OAAZ,IAAuB,IAAI,OAAJ,CAAY,OAAZ,CAAoB,IAApB,IAA4B,SAAnD,CAxBE;AAyBxB,mBAAe,SAAf,GAA2B,aAAa,IAAb,CAAkB,MAAlB,KAA8B,UAAU,OAAO,GAAP,KAAe,CAAf,CAzB3C;;AA2BxB,QAAI,eAAe,SAAf,EAA0B;;;;AAI5B,UAAI,OAAO,MAAP,KAAkB,QAAlB,EAA4B;AAC9B,iBAAS,OAAO,OAAP,CAAe,kBAAf,EAAmC,GAAnC,CAAT,CAD8B;OAAhC,MAEO;;AAEL,iBAAS,MAAM,MAAN,CAAa,WAAb,CAAyB,MAAzB,CAAT,CAFK;AAGL,eAAO,OAAO,GAAP,CAHF;OAFP;KAJF;;AAaA,QAAI,IAAI,OAAJ,CAAY,OAAZ,IAAuB,IAAI,OAAJ,CAAY,OAAZ,CAAoB,KAApB,EAA2B;AACpD,qBAAe,aAAf,GAA+B,IAAI,OAAJ,CAAY,OAAZ,CAAoB,KAApB,CADqB;AAEpD,UAAI,OAAJ,CAAY,OAAZ,CAAoB,KAApB,GAA4B,IAAI,OAAJ,CAAY,OAAZ,CAAoB,KAApB,GAA4B,IAAI,MAAJ,CAFJ;KAAtD;;AAKA,QAAI,KAAJ,CAAU,IAAV,CAAe,KAAf,EAAsB,MAAtB,EAA8B,IAAI,OAAJ,CAAY,OAAZ,EAAqB,KAAK,IAAL,CAAU,IAAV,EAAgB,IAAI,OAAJ,EAAa,cAA7B,CAAnD,EA7CwB;GAA1B;;AAgDA,MAAI,CAAC,MAAD,EAAS;AACX,WAAO,IAAP,CADW;GAAb;;AAIA,WAAS,IAAT,CAAc,OAAd,EAAuB,cAAvB,EAAuC,GAAvC,EAA4C,UAA5C,EAAwD;AACtD,QAAI,GAAJ,EAAS,OAAO,QAAQ,OAAR,CAAgB,GAAhB,CAAP,CAAT;AACA,WAAO,KAAK,MAAL,CAAY,UAAZ,CAAP,CAFsD;AAGtD,QAAI,EAAE,UAAF,KAAiB,CAAjB,EAAoB;AACtB,cAAQ,OAAR,CAAgB,GAAhB,EAAqB,IAArB,EAA2B,OAA3B,EAAoC,cAApC,EADsB;KAAxB;GAHF;CA5GF;;AAqHA,SAAS,uBAAT,CAAiC,KAAjC,EAAwC,IAAxC,EAA8C,OAA9C,EAAuD;AACrD,MAAI,CAAJ;MAAO,GAAP;MAAY,MAAM,KAAK,MAAL;MACd,YAAY,EAAZ;MACA,MAAM,EAAN;MACA,qBAAqB,QAAQ,KAAR,IAAiB,QAAQ,KAAR,CAAc,SAAd,IAA2B,QAAQ,KAAR;MACjE,MAJJ;MAIY,OAJZ;MAIqB,KAJrB;MAI4B,cAJ5B;MAI4C,UAJ5C;MAIwD,SAJxD;MAImE,gBAJnE;MAIqF,kBAJrF,CADqD;;AAOrD,WAAS,MAAM,UAAN,CAAiB,QAAQ,IAAR,CAA1B,CAPqD;;AASrD,MAAI,UAAU,OAAO,MAAP,EAAe;AAC3B,aAAS,OAAO,MAAP,CADkB;GAA7B;;AAIA,MAAI,CAAC,MAAD,IAAW,MAAM,cAAN,EAAsB;AACnC,uBAAmB,MAAM,MAAN,CAAa,oBAAb,CAAkC,GAAlC,CADgB;GAArC;;AAIA,YAAU,UAAU,OAAO,OAAP,IAAkB,OAAO,OAAP,CAAe,OAAf,CAjBe;;AAmBrD,OAAK,IAAI,CAAJ,EAAO,IAAI,GAAJ,EAAS,GAArB,EAA0B;AACxB,UAAM,KAAK,CAAL,CAAN,CADwB;;AAGxB,QAAI,OAAJ,EAAa;AACX,mBAAa,MAAM,QAAN,CAAe,OAAf,EAAwB,GAAxB,CAAb,CADW;KAAb,MAEO;AACL,UAAI,CAAC,kBAAD,EAAqB;AACvB,YAAI,mBAAJ,CADuB;;AAGvB,YAAI,CAAC,MAAD,IAAW,gBAAX,EAA6B;AAC/B,+BAAqB,MAAM,QAAN,CAAe,gBAAf,EAAiC,GAAjC,CAArB,CAD+B;;AAG/B,cAAI,kBAAJ,EAAwB;AACtB,kCAAsB,MAAM,EAAN,CAAS,KAAT,CAAe,kBAAf,EAAmC,UAAnC,CAA8C,QAAQ,IAAR,CAApE,CADsB;;AAGtB,gBAAI,uBAAuB,oBAAoB,MAApB,EAA4B;AACrD,oCAAsB,oBAAoB,MAApB,CAD+B;aAAvD;WAHF;SAHF,MAUO;AACL,gCAAsB,MAAtB,CADK;SAVP;;AAcA,qBAAa,CACX,uBAAuB,oBAAoB,OAApB,IAA+B,oBAAoB,OAApB,CAA4B,GAA5B;AAAtD,YACG,MAAM,SAAN;AAFQ,SAAb,CAjBuB;OAAzB,MAqBO;AACL,uBAAa,CAAC,kBAAD,CAAb;AADK,SArBP;KAHF;;AA6BA,QAAI,CAAC,UAAD,EAAa;AACf,eADe;KAAjB;;AAIA,QAAI,CAAC,MAAM,OAAN,CAAc,UAAd,CAAD,EAA4B;AAC9B,mBAAa,CAAC,UAAD,CAAb,CAD8B;KAAhC;;AAIA,QAAI,IAAI,WAAW,MAAX,CAxCgB;AAyCxB,WAAO,GAAP,EAAY;AACV,kBAAY,WAAW,CAAX,CAAZ,CADU;AAEV,UAAI,CAAC,UAAU,SAAV,CAAD,EAAuB;AACzB,gBAAQ,MAAM,EAAN,CAAS,KAAT,CAAe,SAAf,CAAR,CADyB;AAEzB,yBAAiB;AACf,iBAAO,KAAP;SADF,CAFyB;;AAMzB,YAAI,UAAU,CAAC,gBAAD,EAAmB;AAC/B,kBAAQ,KAAR,GAAgB,KAAhB,CAD+B;SAAjC;;AAIA,cAAM,KAAN,CAAY,cAAZ,EAA4B,OAA5B,EAVyB;;AAYzB,kBAAU,SAAV,IAAuB;AACrB,iBAAO,KAAP;AACA,mBAAS,cAAT;AACA,gBAAM,CAAC,GAAD,CAAN;AACA,eAAK,EAAL;SAJF,CAZyB;AAkBzB,YAAI,IAAJ,CAAS,UAAU,SAAV,CAAT,EAlByB;OAA3B,MAmBO;AACL,kBAAU,SAAV,EAAqB,IAArB,CAA0B,IAA1B,CAA+B,GAA/B,EADK;OAnBP;KAFF;GAzCF;;AAoEA,SAAO,GAAP,CAvFqD;CAAvD;;AA0FA,SAAS,+BAAT,CAAyC,SAAzC,EAAoD;AAClD,MAAI,SAAS,EAAT;;AACA,GADJ;MACO,CADP;MACU,GADV;MACe,IADf;MACqB,EADrB;MACyB,GADzB;MAC8B,IAD9B;MACoC,GADpC;MACyC,UADzC;MACqD,OADrD;MAC8D,IAD9D,CADkD;;AAIlD,SAAO,UAAU,MAAV,CAJ2C;AAKlD,OAAK,IAAI,CAAJ,EAAO,IAAI,IAAJ,EAAU,GAAtB,EAA2B;AACzB,WAAO,UAAU,CAAV,EAAa,IAAb,CADkB;AAEzB,UAAM,KAAK,MAAL,CAFmB;AAGzB,cAAU,UAAU,CAAV,EAAa,OAAb,CAHe;AAIzB,WAAO,QAAQ,IAAR,CAJkB;;AAMzB,SAAK,IAAI,CAAJ,EAAO,IAAI,GAAJ,EAAS,GAArB,EAA0B;AACxB,YAAM,SAAN,CADwB;AAExB,YAAM,KAAK,CAAL,CAAN,CAFwB;AAGxB,WAAK,OAAO,MAAM,QAAN,CAAe,KAAf,EAAsB,GAAtB,CAAP,CAAL,CAHwB;AAIxB,mBAAa,CAAC,CAAC,IAAI,GAAJ,CAJS;;AAMxB,UAAI,CAAC,GAAD,IAAQ,MAAM,OAAN,CAAc,GAAd,KAAsB,IAAI,MAAJ,KAAe,CAAf,EAAkB;AAClD,cAAM,MAAM,QAAN,CAAe,IAAf,EAAqB,GAArB,CAAN,CADkD;OAApD;;AAIA,UAAI,GAAJ,EAAS;AACP,cAAM,aAAa,GAAb,CAAN,CADO;;AAGP,gBAAQ,KAAR,CAAc,EAAd,IAAoB,MAAM,OAAN,CAAc,GAAd,IAAqB,IAAI,KAAJ,EAArB,GAAmC,GAAnC,CAHb;OAAT;;AAMA,aAAO,IAAP,CAAY,GAAZ,EAhBwB;AAiBxB,gBAAU,CAAV,EAAa,GAAb,CAAiB,IAAjB,CAAsB,GAAtB,EAjBwB;;AAmBxB,UAAI,UAAJ,EAAgB;;AAEd,YAAI,SAAJ,CAAc,IAAd,EAAoB,QAAQ,KAAR,CAAc,EAAd,CAApB,EAAuC,OAAvC,EAFc;OAAhB;KAnBF;GANF;;AAgCA,SAAO,MAAP,CArCkD;CAApD;;;;;;;;;AA+CA,SAAS,YAAT,CAAsB,GAAtB,EAA2B;AACzB,MAAI,eAAe,KAAf,EAAsB,OAAO,IAAI,GAAJ,CAAjC;;AAEA,MAAI,MAAM,OAAN,CAAc,GAAd,CAAJ,EAAwB;AACtB,SAAK,IAAI,IAAI,CAAJ,EAAO,IAAI,IAAI,MAAJ,EAAY,EAAE,CAAF,EAAK;AACnC,UAAI,IAAI,CAAJ,aAAkB,KAAlB,EAAyB;AAC3B,YAAI,CAAJ,IAAS,IAAI,CAAJ,EAAO,GAAP,CADkB;OAA7B;KADF;AAKA,WAAO,GAAP,CANsB;GAAxB;;AASA,SAAO,GAAP,CAZyB;CAA3B;;;;;;;AAoBA,SAAS,UAAT,CAAoB,CAApB,EAAuB;;;;AAIrB,6BAA2B,EAAE,MAAF,EAAU,EAAE,OAAF,EAAW,EAAE,QAAF,EAAY,EAAE,OAAF,CAA5D;;;;;AAJqB,MASjB,OAAO,EAAE,IAAF,CATU;AAUrB,MAAI,OAAO,EAAE,IAAF,CAVU;AAWrB,MAAI,SAAS,EAAE,MAAF,CAXQ;AAYrB,MAAI,UAAU,EAAE,OAAF,CAZO;;AAcrB,WAAS,QAAT,CAAkB,GAAlB,EAAuB;AACrB,WAAO,YAAY,GAAZ,EAAiB,OAAjB,CAAP,CADqB;GAAvB;;AAIA,OAAK,IAAI,IAAI,CAAJ,EAAO,IAAI,KAAK,MAAL,EAAa,EAAE,CAAF,EAAK;AACpC,QAAI,MAAM,QAAN,CAAe,IAAf,EAAqB,KAAK,CAAL,CAArB,KAAiC,IAAjC,EAAuC;AACzC,eADyC;KAA3C;AAGA,UAAM,QAAN,CAAe,IAAf,EAAqB,OAAO,CAAP,CAArB,EAAgC,KAAK,CAAL,CAAhC,EAAyC,QAAzC,EAJoC;GAAtC;CAlBF;;;;;;;;;;;;;;;;;;;;AA4CA,SAAS,WAAT,CAAqB,GAArB,EAA0B,cAA1B,EAA0C;AACxC,MAAI,MAAM,OAAN,CAAc,GAAd,CAAJ,EAAwB;;AAEtB,QAAI,MAAM,EAAN,CAFkB;AAGtB,QAAI,YAAY,IAAI,MAAJ,CAHM;AAItB,SAAK,IAAI,IAAI,CAAJ,EAAO,IAAI,SAAJ,EAAe,EAAE,CAAF,EAAK;AAClC,UAAI,SAAS,IAAI,CAAJ,CAAT,CAD8B;AAElC,UAAI,CAAC,MAAM,MAAN,CAAD,EAAgB,SAApB;AACA,oBAAc,MAAd,EAAsB,cAAtB,EAHkC;AAIlC,UAAI,IAAJ,CAAS,MAAT,EAJkC;AAKlC,UAAI,eAAe,aAAf,IACA,IAAI,MAAJ,IAAc,eAAe,aAAf,EAA8B;AAC9C,cAD8C;OADhD;KALF;;;;AAJsB,WAiBf,IAAI,MAAJ,GAAa,IAAI,MAAJ,EAAY;AAC9B,YAAM,SAAN,CAAgB,GAAhB,CAAoB,KAApB,CAA0B,GAA1B,EAA+B,EAA/B,EAD8B;KAAhC;AAGA,SAAK,IAAI,CAAJ,EAAO,IAAI,IAAI,MAAJ,EAAY,EAAE,CAAF,EAAK;AAC/B,UAAI,CAAJ,IAAS,IAAI,CAAJ,CAAT,CAD+B;KAAjC;AAGA,WAAO,GAAP,CAvBsB;GAAxB;;;AADwC,MA4BpC,MAAM,GAAN,CAAJ,EAAgB;AACd,kBAAc,GAAd,EAAmB,cAAnB,EADc;AAEd,WAAO,GAAP,CAFc;GAAhB;;AAKA,SAAO,IAAP,CAjCwC;CAA1C;;;;;;AAwCA,SAAS,aAAT,CAAuB,MAAvB,EAA+B,cAA/B,EAA+C;AAC7C,MAAI,eAAe,SAAf,EAA0B;AAC5B,QAAI,OAAO,OAAO,QAAP,KAAoB,UAA3B,EAAuC;AACzC,aAAO,OAAO,IAAP,CAAY,GAAZ,CADkC;KAA3C,MAEO;AACL,aAAO,OAAO,GAAP,CADF;KAFP;GADF;CADF;;;;;;;AAeA,SAAS,KAAT,CAAe,GAAf,EAAoB;AAClB,MAAI,OAAO,IAAP,EAAa;AACf,WAAO,KAAP,CADe;GAAjB;;AAIA,MAAI,OAAO,OAAO,GAAP,CALO;AAMlB,MAAI,SAAS,QAAT,EAAmB;AACrB,WAAO,KAAP,CADqB;GAAvB;;AAIA,MAAI,SAAS,QAAT,EAAmB;AACrB,WAAO,KAAP,CADqB;GAAvB;;AAIA,MAAI,OAAO,QAAP,CAAgB,GAAhB,CAAJ,EAA0B;AACxB,WAAO,KAAP,CADwB;GAA1B;;AAIA,MAAI,IAAI,WAAJ,CAAgB,IAAhB,KAAyB,UAAzB,EAAqC;AACvC,WAAO,KAAP,CADuC;GAAzC;;;AAlBkB,SAuBX,IAAP,CAvBkB;CAApB;;;;;;;;;;;;;;;;;;;;;;AA8CA,SAAS,0BAAT,CAAoC,MAApC,EAA4C,UAA5C,EAAwD,WAAxD,EAAqE,OAArE,EAA8E,QAA9E,EAAwF;;AAEtF,MAAI,WAAW,EAAX,CAFkF;AAGtF,MAAI,UAAU,QAAQ,IAAR,IAAgB,OAAO,MAAP,GAAgB,CAAhB,CAHwD;AAItF,MAAI,GAAJ,CAJsF;AAKtF,MAAI,GAAJ,CALsF;AAMtF,MAAI,EAAJ,CANsF;;AAQtF,OAAK,IAAI,IAAI,CAAJ,EAAO,IAAI,OAAO,MAAP,EAAe,EAAE,CAAF,EAAK;AACtC,SAAK,OAAO,CAAP,CAAL,CADsC;;AAGtC,QAAI,MAAM,OAAN,CAAc,EAAd,CAAJ,EAAuB;;AAErB,iCAA2B,EAA3B,EAA+B,UAA/B,EAA2C,WAA3C,EAAwD,OAAxD,EAAiE,IAAjE,EAFqB;AAGrB,eAAS,IAAT,CAAc,EAAd,EAHqB;AAIrB,eAJqB;KAAvB;;AAOA,QAAI,OAAO,IAAP,IAAe,CAAC,OAAD,EAAU;;;AAG3B,eAAS,IAAT,CAAc,EAAd,EAH2B;AAI3B,eAJ2B;KAA7B;;AAOA,UAAM,OAAO,EAAP,CAAN,CAjBsC;;AAmBtC,QAAI,QAAJ,EAAc;;;;AAIZ,YAAM,WAAW,GAAX,CAAN,CAJY;AAKZ,UAAI,GAAJ,EAAS;AACP,YAAI,OAAJ,EAAa;AACX,mBAAS,YAAY,GAAZ,CAAT,IAA6B,GAA7B,CADW;SAAb,MAEO;AACL,mBAAS,IAAT,CAAc,GAAd,EADK;SAFP;OADF,MAMO;AACL,iBAAS,IAAT,CAAc,EAAd,EADK;OANP;KALF,MAcO;;AAEL,eAAS,CAAT,IAAc,MAAM,WAAW,GAAX,KAAmB,IAAnB,CAFf;KAdP;GAnBF;;AAuCA,SAAO,MAAP,GAAgB,CAAhB,CA/CsF;AAgDtF,MAAI,SAAS,MAAT,EAAiB;;;;;;AAMnB,aAAS,OAAT,CAAiB,UAAS,GAAT,EAAc,CAAd,EAAiB;AAChC,UAAI,CAAC,GAAD,EAAM;AACR,eADQ;OAAV;AAGA,aAAO,CAAP,IAAY,GAAZ,CAJgC;KAAjB,CAAjB,CANmB;GAArB;CAhDF;;;;;;;;;;;;AAyEA,MAAM,UAAN,GAAmB,SAAS,UAAT,CAAoB,IAApB,EAA0B;AAC3C,SAAO,KAAK,MAAL,CAAY,UAAZ,CAAuB,IAAvB,CAAP,CAD2C;CAA1B;;;;;;;;;;;;AAcnB,MAAM,OAAN,GAAgB,SAAS,OAAT,CAAiB,IAAjB,EAAuB,MAAvB,EAA+B,cAA/B,EAA+C,UAA/C,EAA2D,IAA3D,EAAiE;AAC/E,MAAI,oBAAoB,OAAO,OAAP,CAAe,UAAf,KAA8B,KAA9B,CADuD;;AAG/E,MAAI,qBAAqB,CAAC,OAAO,KAAP,CAAa,OAAO,OAAP,CAAe,UAAf,CAAd,EAA0C;;AAEjE,QAAI,IAAI,EAAJ,CAF6D;AAGjE,MAAE,OAAO,OAAP,CAAe,UAAf,CAAF,GAA+B,MAA/B,CAHiE;AAIjE,WAAO,GAAP,CAAW,CAAX,EAJiE;GAAnE;;;AAH+E,WAWtE,KAAT,CAAe,GAAf,EAAoB,MAApB,EAA4B,MAA5B,EAAoC;AAClC,QAAI,EAAE,gBAAgB,KAAhB,CAAF,EAA0B;AAC5B,aAAO,IAAI,KAAJ,CAAU,GAAV,EAAe,MAAf,EAAuB,MAAvB,CAAP,CAD4B;KAA9B;AAGA,UAAM,IAAN,CAAW,IAAX,EAAiB,GAAjB,EAAsB,MAAtB,EAA8B,MAA9B,EAJkC;GAApC;;AAOA,QAAM,KAAN,GAAc,OAAO,CAAP,CAAS,KAAT,CAAe,KAAf,EAAd,CAlB+E;AAmB/E,QAAM,IAAN,GAAa,IAAb,CAnB+E;AAoB/E,QAAM,SAAN,GAAkB,IAAlB,CApB+E;AAqB/E,QAAM,SAAN,GAAkB,KAAlB,CArB+E;AAsB/E,QAAM,SAAN,CAAgB,SAAhB,GAA4B,MAAM,SAAN,CAtBmD;AAuB/E,QAAM,KAAN,GAAc,MAAM,SAAN,CAAgB,KAAhB,CAvBiE;AAwB/E,QAAM,EAAN,GAAW,MAAM,SAAN,CAAgB,EAAhB,GAAqB,UAArB,CAxBoE;AAyB/E,QAAM,cAAN,GAAuB,MAAM,SAAN,CAAgB,cAAhB,GAAiC,SAAjC,CAzBwD;;AA2B/E,QAAM,SAAN,CAAgB,YAAhB,CAA6B,MAA7B,EA3B+E;;AA6B/E,MAAI,oBAAoB;AACtB,oBAAgB,OAAO,OAAP,CAAe,cAAf;AAChB,YAAQ,OAAO,OAAP,CAAe,MAAf;GAFN,CA7B2E;;AAkC/E,QAAM,SAAN,CAAgB,UAAhB,GAA6B,WAAW,UAAX,CACzB,cADyB,EAEvB,iBAFuB,CAA7B;;;AAlC+E,cAwC/E,CAAa,KAAb,EAAoB,MAApB,EAxC+E;AAyC/E,eAAa,KAAb,EAAoB,MAApB,EAzC+E;;AA2C/E,QAAM,MAAN,GAAe,MAAM,SAAN,CAAgB,MAAhB,CA3CgE;AA4C/E,QAAM,UAAN,GAAmB,MAAM,SAAN,CAAgB,UAAhB,CA5C4D;;AA8C/E,SAAO,KAAP,CA9C+E;CAAjE;;;;;;;;AAuDhB,IAAI,eAAe,UAAS,KAAT,EAAgB,MAAhB,EAAwB;AACzC,WAAS,KAAT,CAAe,MAAf,EAAuB,MAAvB,EAA+B;AAC7B,WAAO,cAAP,CAAsB,MAAM,SAAN,EAAiB,MAAvC,EAA+C;AAC7C,WAAK,YAAW;AACd,YAAI,IAAI,EAAJ,CADU;AAEd,aAAK,IAAI,CAAJ,IAAS,OAAO,OAAP,CAAe,MAAf,CAAd,EAAsC;AACpC,YAAE,CAAF,IAAO,OAAO,OAAP,CAAe,MAAf,EAAuB,CAAvB,EAA0B,IAA1B,CAA+B,IAA/B,CAAP,CADoC;SAAtC;AAGA,eAAO,CAAP,CALc;OAAX;AAOL,oBAAc,IAAd;KARF,EAD6B;GAA/B;AAYA,OAAK,IAAI,MAAJ,IAAc,OAAO,OAAP,EAAgB;AACjC,QAAI,OAAO,OAAO,OAAP,CAAe,MAAf,CAAP,KAAkC,UAAlC,EAA8C;AAChD,YAAM,SAAN,CAAgB,MAAhB,IAA0B,OAAO,OAAP,CAAe,MAAf,CAA1B,CADgD;KAAlD,MAEO;AACL,YAAM,MAAN,EAAc,MAAd,EADK;KAFP;GADF;CAbiB;;;;;;;AA2BnB,IAAI,eAAe,UAAS,KAAT,EAAgB,MAAhB,EAAwB;AACzC,OAAK,IAAI,CAAJ,IAAS,OAAO,OAAP,EAAgB;AAC5B,UAAM,CAAN,IAAW,OAAO,OAAP,CAAe,CAAf,CAAX,CAD4B;GAA9B;CADiB;;;;;;;;;;;AAenB,MAAM,UAAN,GAAmB,SAAS,QAAT,CAAkB,IAAlB,EAAwB,MAAxB,EAAgC,UAAhC,EAA4C;;AAE7D,MAAI,QAAQ,IAAR,CAFyD;;AAI7D,MAAI,QAAQ,SAAS,KAAT,CAAe,GAAf,EAAoB,MAApB,EAA4B,MAA5B,EAAoC;AAC9C,QAAI,EAAE,gBAAgB,KAAhB,CAAF,EAA0B;AAC5B,aAAO,IAAI,KAAJ,CAAU,GAAV,EAAe,MAAf,EAAuB,MAAvB,CAAP,CAD4B;KAA9B;AAGA,UAAM,IAAN,CAAW,IAAX,EAAiB,GAAjB,EAAsB,MAAtB,EAA8B,MAA9B,EAJ8C;GAApC,CAJiD;;AAW7D,QAAM,SAAN,GAAkB,KAAlB,CAX6D;AAY7D,QAAM,SAAN,CAAgB,SAAhB,GAA4B,MAAM,SAAN,CAZiC;AAa7D,QAAM,EAAN,GAAW,MAAM,SAAN,CAAgB,EAAhB,GAAqB,IAArB,CAbkD;;AAe7D,MAAI,IAAI,UAAU,OAAO,MAAP,KAAkB,QAAlB,GACZ,MADE,GAEF,MAAM,SAAN,CAAgB,MAAhB,CAjBuD;;AAmB7D,MAAI,UAAU,EAAE,OAAF,IAAa,EAAb,CAnB+C;;AAqB7D,MAAI,CAAC,UAAD,EAAa;AACf,iBAAa,MAAM,SAAN,CAAgB,MAAhB,CAAuB,GAAvB,CAA2B,YAA3B,KACN,MAAM,gBAAN,CAAuB,MAAM,SAAN,EAAiB,OAAxC,CADM,CADE;GAAjB;;AAKA,MAAI,oBAAoB;AACtB,oBAAgB,IAAI,QAAQ,cAAR,GAAyB,IAA7B;AAChB,YAAQ,KAAK,QAAQ,MAAR;GAFX,CA1ByD;;AA+B7D,QAAM,SAAN,CAAgB,UAAhB,GAA6B,KAAK,UAAL,CAAgB,UAAhB,EAA4B,iBAA5B,CAA7B,CA/B6D;AAgC7D,QAAM,UAAN,GAAmB,MAAM,SAAN,CAAgB,UAAhB,CAhC0C;AAiC7D,QAAM,IAAN,GAjC6D;AAkC7D,SAAO,KAAP,CAlC6D;CAA5C;;;;;;AAyCnB,OAAO,OAAP,GAAiB,UAAU,KAAV","file":"model-compiled.js","sourcesContent":["/*!\n * Module dependencies.\n */\n\nvar Document = require('./document');\nvar MongooseError = require('./error');\nvar VersionError = MongooseError.VersionError;\nvar DivergentArrayError = MongooseError.DivergentArrayError;\nvar Query = require('./query');\nvar Aggregate = require('./aggregate');\nvar Schema = require('./schema');\nvar utils = require('./utils');\nvar hasOwnProperty = utils.object.hasOwnProperty;\nvar isMongooseObject = utils.isMongooseObject;\nvar EventEmitter = require('events').EventEmitter;\nvar Promise = require('./promise');\nvar util = require('util');\nvar tick = utils.tick;\n\nvar async = require('async');\nvar PromiseProvider = require('./promise_provider');\n\nvar VERSION_WHERE = 1,\n    VERSION_INC = 2,\n    VERSION_ALL = VERSION_WHERE | VERSION_INC;\n\n/**\n * Model constructor\n *\n * Provides the interface to MongoDB collections as well as creates document instances.\n *\n * @param {Object} doc values with which to create the document\n * @inherits Document\n * @event `error`: If listening to this event, it is emitted when a document was saved without passing a callback and an `error` occurred. If not listening, the event bubbles to the connection used to create this Model.\n * @event `index`: Emitted after `Model#ensureIndexes` completes. If an error occurred it is passed with the event.\n * @event `index-single-start`: Emitted when an individual index starts within `Model#ensureIndexes`. The fields and options being used to build the index are also passed with the event.\n * @event `index-single-done`: Emitted when an individual index finishes within `Model#ensureIndexes`. If an error occurred it is passed with the event. The fields, options, and index name are also passed.\n * @api public\n */\n\nfunction Model(doc, fields, skipId) {\n  Document.call(this, doc, fields, skipId);\n}\n\n/*!\n * Inherits from Document.\n *\n * All Model.prototype features are available on\n * top level (non-sub) documents.\n */\n\nModel.prototype.__proto__ = Document.prototype;\n\n/**\n * Connection the model uses.\n *\n * @api public\n * @property db\n */\n\nModel.prototype.db;\n\n/**\n * Collection the model uses.\n *\n * @api public\n * @property collection\n */\n\nModel.prototype.collection;\n\n/**\n * The name of the model\n *\n * @api public\n * @property modelName\n */\n\nModel.prototype.modelName;\n\n/**\n * If this is a discriminator model, `baseModelName` is the name of\n * the base model.\n *\n * @api public\n * @property baseModelName\n */\n\nModel.prototype.baseModelName;\n\nModel.prototype.$__handleSave = function(options, callback) {\n  var _this = this;\n  if (!options.safe && this.schema.options.safe) {\n    options.safe = this.schema.options.safe;\n  }\n  if (typeof options.safe === 'boolean') {\n    options.safe = null;\n  }\n\n  if (this.isNew) {\n    // send entire doc\n    var toObjectOptions = {};\n    if (this.schema.options.toObject &&\n        this.schema.options.toObject.retainKeyOrder) {\n      toObjectOptions.retainKeyOrder = true;\n    }\n\n    toObjectOptions.depopulate = 1;\n    toObjectOptions._skipDepopulateTopLevel = true;\n    toObjectOptions.transform = false;\n\n    var obj = this.toObject(toObjectOptions);\n\n    if (!utils.object.hasOwnProperty(obj || {}, '_id')) {\n      // documents must have an _id else mongoose won't know\n      // what to update later if more changes are made. the user\n      // wouldn't know what _id was generated by mongodb either\n      // nor would the ObjectId generated my mongodb necessarily\n      // match the schema definition.\n      setTimeout(function() {\n        callback(new Error('document must have an _id before saving'));\n      }, 0);\n      return;\n    }\n\n    this.$__version(true, obj);\n    this.collection.insert(obj, options.safe, function(err, ret) {\n      if (err) {\n        _this.isNew = true;\n        _this.emit('isNew', true);\n\n        callback(err);\n        return;\n      }\n\n      callback(null, ret);\n    });\n    this.$__reset();\n    this.isNew = false;\n    this.emit('isNew', false);\n    // Make it possible to retry the insert\n    this.$__.inserting = true;\n  } else {\n    // Make sure we don't treat it as a new object on error,\n    // since it already exists\n    this.$__.inserting = false;\n\n    var delta = this.$__delta();\n\n    if (delta) {\n      if (delta instanceof Error) {\n        callback(delta);\n        return;\n      }\n      var where = this.$__where(delta[0]);\n\n      if (where instanceof Error) {\n        callback(where);\n        return;\n      }\n\n      this.collection.update(where, delta[1], options.safe, function(err, ret) {\n        if (err) {\n          callback(err);\n          return;\n        }\n        callback(null, ret);\n      });\n    } else {\n      this.$__reset();\n      callback();\n      return;\n    }\n\n    this.emit('isNew', false);\n  }\n};\n\n/*!\n * ignore\n */\n\nModel.prototype.$__save = function(options, callback) {\n  var _this = this;\n\n  _this.$__handleSave(options, function(error, result) {\n    if (error) {\n      return callback(error);\n    }\n\n    _this.$__reset();\n    _this.$__storeShard();\n\n    var numAffected = 0;\n    if (result) {\n      if (Array.isArray(result)) {\n        numAffected = result.length;\n      } else if (result.result && result.result.n !== undefined) {\n        numAffected = result.result.n;\n      } else if (result.result && result.result.nModified !== undefined) {\n        numAffected = result.result.nModified;\n      } else {\n        numAffected = result;\n      }\n    }\n\n    // was this an update that required a version bump?\n    if (_this.$__.version && !_this.$__.inserting) {\n      var doIncrement = VERSION_INC === (VERSION_INC & _this.$__.version);\n      _this.$__.version = undefined;\n\n      if (numAffected <= 0) {\n        // the update failed. pass an error back\n        var err = new VersionError();\n        return callback(err);\n      }\n\n      // increment version if was successful\n      if (doIncrement) {\n        var key = _this.schema.options.versionKey;\n        var version = _this.getValue(key) | 0;\n        _this.setValue(key, version + 1);\n      }\n    }\n\n    _this.emit('save', _this, numAffected);\n    callback(null, _this, numAffected);\n  });\n};\n\n/**\n * Saves this document.\n *\n * ####Example:\n *\n *     product.sold = Date.now();\n *     product.save(function (err, product, numAffected) {\n *       if (err) ..\n *     })\n *\n * The callback will receive three parameters\n *\n * 1. `err` if an error occurred\n * 2. `product` which is the saved `product`\n * 3. `numAffected` will be 1 when the document was successfully persisted to MongoDB, otherwise 0. Unless you tweak mongoose's internals, you don't need to worry about checking this parameter for errors - checking `err` is sufficient to make sure your document was properly saved.\n *\n * As an extra measure of flow control, save will return a Promise.\n * ####Example:\n *     product.save().then(function(product) {\n *        ...\n *     });\n *\n * For legacy reasons, mongoose stores object keys in reverse order on initial\n * save. That is, `{ a: 1, b: 2 }` will be saved as `{ b: 2, a: 1 }` in\n * MongoDB. To override this behavior, set\n * [the `toObject.retainKeyOrder` option](http://mongoosejs.com/docs/api.html#document_Document-toObject)\n * to true on your schema.\n *\n * @param {Object} [options] options optional options\n * @param {Object} [options.safe] overrides [schema's safe option](http://mongoosejs.com//docs/guide.html#safe)\n * @param {Boolean} [options.validateBeforeSave] set to false to save without validating.\n * @param {Function} [fn] optional callback\n * @return {Promise} Promise\n * @api public\n * @see middleware http://mongoosejs.com/docs/middleware.html\n */\n\nModel.prototype.save = function(options, fn) {\n  if (typeof options === 'function') {\n    fn = options;\n    options = undefined;\n  }\n\n  if (!options) {\n    options = {};\n  }\n\n  if (options.__noPromise) {\n    return this.$__save(options, fn);\n  }\n\n  var _this = this;\n  var Promise = PromiseProvider.get();\n  return new Promise.ES6(function(resolve, reject) {\n    _this.$__save(options, function(error, doc, numAffected) {\n      if (error) {\n        fn && fn(error);\n        reject(error);\n        return;\n      }\n\n      fn && fn(null, doc, numAffected);\n      resolve(doc, numAffected);\n    });\n  });\n};\n\n/**\n * Determines whether versioning should be skipped for the given path\n *\n * @param {Document} self\n * @param {String} path\n * @return {Boolean} true if versioning should be skipped for the given path\n */\nfunction shouldSkipVersioning(self, path) {\n  var skipVersioning = self.schema.options.skipVersioning;\n  if (!skipVersioning) return false;\n\n  // Remove any array indexes from the path\n  path = path.replace(/\\.\\d+\\./, '.');\n\n  return skipVersioning[path];\n}\n\n/*!\n * Apply the operation to the delta (update) clause as\n * well as track versioning for our where clause.\n *\n * @param {Document} self\n * @param {Object} where\n * @param {Object} delta\n * @param {Object} data\n * @param {Mixed} val\n * @param {String} [operation]\n */\n\nfunction operand(self, where, delta, data, val, op) {\n  // delta\n  op || (op = '$set');\n  if (!delta[op]) delta[op] = {};\n  delta[op][data.path] = val;\n\n  // disabled versioning?\n  if (self.schema.options.versionKey === false) return;\n\n  // path excluded from versioning?\n  if (shouldSkipVersioning(self, data.path)) return;\n\n  // already marked for versioning?\n  if (VERSION_ALL === (VERSION_ALL & self.$__.version)) return;\n\n  switch (op) {\n    case '$set':\n    case '$unset':\n    case '$pop':\n    case '$pull':\n    case '$pullAll':\n    case '$push':\n    case '$pushAll':\n    case '$addToSet':\n      break;\n    default:\n      // nothing to do\n      return;\n  }\n\n  // ensure updates sent with positional notation are\n  // editing the correct array element.\n  // only increment the version if an array position changes.\n  // modifying elements of an array is ok if position does not change.\n\n  if (op === '$push' || op === '$pushAll' || op === '$addToSet') {\n    self.$__.version = VERSION_INC;\n  } else if (/^\\$p/.test(op)) {\n    // potentially changing array positions\n    self.increment();\n  } else if (Array.isArray(val)) {\n    // $set an array\n    self.increment();\n  } else if (/\\.\\d+\\.|\\.\\d+$/.test(data.path)) {\n    // now handling $set, $unset\n    // subpath of array\n    self.$__.version = VERSION_WHERE;\n  }\n}\n\n/*!\n * Compiles an update and where clause for a `val` with _atomics.\n *\n * @param {Document} self\n * @param {Object} where\n * @param {Object} delta\n * @param {Object} data\n * @param {Array} value\n */\n\nfunction handleAtomics(self, where, delta, data, value) {\n  if (delta.$set && delta.$set[data.path]) {\n    // $set has precedence over other atomics\n    return;\n  }\n\n  if (typeof value.$__getAtomics === 'function') {\n    value.$__getAtomics().forEach(function(atomic) {\n      var op = atomic[0];\n      var val = atomic[1];\n      operand(self, where, delta, data, val, op);\n    });\n    return;\n  }\n\n  // legacy support for plugins\n\n  var atomics = value._atomics,\n      ops = Object.keys(atomics),\n      i = ops.length,\n      val,\n      op;\n\n  if (i === 0) {\n    // $set\n\n    if (isMongooseObject(value)) {\n      value = value.toObject({depopulate: 1});\n    } else if (value.valueOf) {\n      value = value.valueOf();\n    }\n\n    return operand(self, where, delta, data, value);\n  }\n\n  function iter(mem) {\n    return isMongooseObject(mem)\n        ? mem.toObject({depopulate: 1})\n        : mem;\n  }\n\n  while (i--) {\n    op = ops[i];\n    val = atomics[op];\n\n    if (isMongooseObject(val)) {\n      val = val.toObject({depopulate: 1});\n    } else if (Array.isArray(val)) {\n      val = val.map(iter);\n    } else if (val.valueOf) {\n      val = val.valueOf();\n    }\n\n    if (op === '$addToSet') {\n      val = {$each: val};\n    }\n\n    operand(self, where, delta, data, val, op);\n  }\n}\n\n/**\n * Produces a special query document of the modified properties used in updates.\n *\n * @api private\n * @method $__delta\n * @memberOf Model\n */\n\nModel.prototype.$__delta = function() {\n  var dirty = this.$__dirty();\n  if (!dirty.length && VERSION_ALL !== this.$__.version) return;\n\n  var where = {},\n      delta = {},\n      len = dirty.length,\n      divergent = [],\n      d = 0;\n\n  where._id = this._doc._id;\n\n  for (; d < len; ++d) {\n    var data = dirty[d];\n    var value = data.value;\n\n    var match = checkDivergentArray(this, data.path, value);\n    if (match) {\n      divergent.push(match);\n      continue;\n    }\n\n    if (divergent.length) continue;\n\n    if (undefined === value) {\n      operand(this, where, delta, data, 1, '$unset');\n    } else if (value === null) {\n      operand(this, where, delta, data, null);\n    } else if (value._path && value._atomics) {\n      // arrays and other custom types (support plugins etc)\n      handleAtomics(this, where, delta, data, value);\n    } else if (value._path && Buffer.isBuffer(value)) {\n      // MongooseBuffer\n      value = value.toObject();\n      operand(this, where, delta, data, value);\n    } else {\n      value = utils.clone(value, {depopulate: 1});\n      operand(this, where, delta, data, value);\n    }\n  }\n\n  if (divergent.length) {\n    return new DivergentArrayError(divergent);\n  }\n\n  if (this.$__.version) {\n    this.$__version(where, delta);\n  }\n\n  return [where, delta];\n};\n\n/*!\n * Determine if array was populated with some form of filter and is now\n * being updated in a manner which could overwrite data unintentionally.\n *\n * @see https://github.com/Automattic/mongoose/issues/1334\n * @param {Document} doc\n * @param {String} path\n * @return {String|undefined}\n */\n\nfunction checkDivergentArray(doc, path, array) {\n  // see if we populated this path\n  var pop = doc.populated(path, true);\n\n  if (!pop && doc.$__.selected) {\n    // If any array was selected using an $elemMatch projection, we deny the update.\n    // NOTE: MongoDB only supports projected $elemMatch on top level array.\n    var top = path.split('.')[0];\n    if ((doc.$__.selected[top] && doc.$__.selected[top].$elemMatch) ||\n        doc.$__.selected[top + '.$']) {\n      return top;\n    }\n  }\n\n  if (!(pop && array && array.isMongooseArray)) return;\n\n  // If the array was populated using options that prevented all\n  // documents from being returned (match, skip, limit) or they\n  // deselected the _id field, $pop and $set of the array are\n  // not safe operations. If _id was deselected, we do not know\n  // how to remove elements. $pop will pop off the _id from the end\n  // of the array in the db which is not guaranteed to be the\n  // same as the last element we have here. $set of the entire array\n  // would be similarily destructive as we never received all\n  // elements of the array and potentially would overwrite data.\n  var check = pop.options.match ||\n      pop.options.options && hasOwnProperty(pop.options.options, 'limit') || // 0 is not permitted\n      pop.options.options && pop.options.options.skip || // 0 is permitted\n      pop.options.select && // deselected _id?\n      (pop.options.select._id === 0 ||\n      /\\s?-_id\\s?/.test(pop.options.select));\n\n  if (check) {\n    var atomics = array._atomics;\n    if (Object.keys(atomics).length === 0 || atomics.$set || atomics.$pop) {\n      return path;\n    }\n  }\n}\n\n/**\n * Appends versioning to the where and update clauses.\n *\n * @api private\n * @method $__version\n * @memberOf Model\n */\n\nModel.prototype.$__version = function(where, delta) {\n  var key = this.schema.options.versionKey;\n\n  if (where === true) {\n    // this is an insert\n    if (key) this.setValue(key, delta[key] = 0);\n    return;\n  }\n\n  // updates\n\n  // only apply versioning if our versionKey was selected. else\n  // there is no way to select the correct version. we could fail\n  // fast here and force them to include the versionKey but\n  // thats a bit intrusive. can we do this automatically?\n  if (!this.isSelected(key)) {\n    return;\n  }\n\n  // $push $addToSet don't need the where clause set\n  if (VERSION_WHERE === (VERSION_WHERE & this.$__.version)) {\n    where[key] = this.getValue(key);\n  }\n\n  if (VERSION_INC === (VERSION_INC & this.$__.version)) {\n    if (!delta.$set || typeof delta.$set[key] === 'undefined') {\n      delta.$inc || (delta.$inc = {});\n      delta.$inc[key] = 1;\n    }\n  }\n};\n\n/**\n * Signal that we desire an increment of this documents version.\n *\n * ####Example:\n *\n *     Model.findById(id, function (err, doc) {\n *       doc.increment();\n *       doc.save(function (err) { .. })\n *     })\n *\n * @see versionKeys http://mongoosejs.com/docs/guide.html#versionKey\n * @api public\n */\n\nModel.prototype.increment = function increment() {\n  this.$__.version = VERSION_ALL;\n  return this;\n};\n\n/**\n * Returns a query object which applies shardkeys if they exist.\n *\n * @api private\n * @method $__where\n * @memberOf Model\n */\n\nModel.prototype.$__where = function _where(where) {\n  where || (where = {});\n\n  var paths,\n      len;\n\n  if (!where._id) {\n    where._id = this._doc._id;\n  }\n\n  if (this.$__.shardval) {\n    paths = Object.keys(this.$__.shardval);\n    len = paths.length;\n\n    for (var i = 0; i < len; ++i) {\n      where[paths[i]] = this.$__.shardval[paths[i]];\n    }\n  }\n\n  if (this._doc._id == null) {\n    return new Error('No _id found on document!');\n  }\n\n  return where;\n};\n\n/**\n * Removes this document from the db.\n *\n * ####Example:\n *     product.remove(function (err, product) {\n *       if (err) return handleError(err);\n *       Product.findById(product._id, function (err, product) {\n *         console.log(product) // null\n *       })\n *     })\n *\n *\n * As an extra measure of flow control, remove will return a Promise (bound to `fn` if passed) so it could be chained, or hooked to recive errors\n *\n * ####Example:\n *     product.remove().then(function (product) {\n *        ...\n *     }).onRejected(function (err) {\n *        assert.ok(err)\n *     })\n *\n * @param {function(err,product)} [fn] optional callback\n * @return {Promise} Promise\n * @api public\n */\n\nModel.prototype.remove = function remove(options, fn) {\n  if (typeof options === 'function') {\n    fn = options;\n    options = undefined;\n  }\n\n  if (!options) {\n    options = {};\n  }\n\n  if (this.$__.removing) {\n    if (fn) {\n      this.$__.removing.then(\n          function(res) { fn(null, res); },\n          function(err) { fn(err); });\n    }\n    return this;\n  }\n\n  var _this = this;\n  var Promise = PromiseProvider.get();\n  this.$__.removing = new Promise.ES6(function(resolve, reject) {\n    var where = _this.$__where();\n    if (where instanceof Error) {\n      reject(where);\n      fn && fn(where);\n      return;\n    }\n\n    if (!options.safe && _this.schema.options.safe) {\n      options.safe = _this.schema.options.safe;\n    }\n\n    _this.collection.remove(where, options, function(err) {\n      if (!err) {\n        _this.emit('remove', _this);\n        resolve(_this);\n        fn && fn(null, _this);\n        return;\n      }\n\n      reject(err);\n      fn && fn(err);\n    });\n  });\n  return this.$__.removing;\n};\n\n/**\n * Returns another Model instance.\n *\n * ####Example:\n *\n *     var doc = new Tank;\n *     doc.model('User').findById(id, callback);\n *\n * @param {String} name model name\n * @api public\n */\n\nModel.prototype.model = function model(name) {\n  return this.db.model(name);\n};\n\n/**\n * Adds a discriminator type.\n *\n * ####Example:\n *\n *     function BaseSchema() {\n *       Schema.apply(this, arguments);\n *\n *       this.add({\n *         name: String,\n *         createdAt: Date\n *       });\n *     }\n *     util.inherits(BaseSchema, Schema);\n *\n *     var PersonSchema = new BaseSchema();\n *     var BossSchema = new BaseSchema({ department: String });\n *\n *     var Person = mongoose.model('Person', PersonSchema);\n *     var Boss = Person.discriminator('Boss', BossSchema);\n *\n * @param {String} name   discriminator model name\n * @param {Schema} schema discriminator model schema\n * @api public\n */\n\nModel.discriminator = function discriminator(name, schema) {\n  if (!(schema && schema.instanceOfSchema)) {\n    throw new Error('You must pass a valid discriminator Schema');\n  }\n\n  if (this.schema.discriminatorMapping && !this.schema.discriminatorMapping.isRoot) {\n    throw new Error('Discriminator \"' + name +\n        '\" can only be a discriminator of the root model');\n  }\n\n  var key = this.schema.options.discriminatorKey;\n  if (schema.path(key)) {\n    throw new Error('Discriminator \"' + name +\n        '\" cannot have field with name \"' + key + '\"');\n  }\n\n  function clean(a, b) {\n    a = utils.clone(a);\n    b = utils.clone(b);\n    delete a.toJSON;\n    delete a.toObject;\n    delete b.toJSON;\n    delete b.toObject;\n    delete a._id;\n    delete b._id;\n\n    if (!utils.deepEqual(a, b)) {\n      throw new Error('Discriminator options are not customizable ' +\n          '(except toJSON, toObject, _id)');\n    }\n  }\n\n  function merge(schema, baseSchema) {\n    utils.merge(schema, baseSchema);\n\n    var obj = {};\n    obj[key] = {type: String, default: name};\n    schema.add(obj);\n    schema.discriminatorMapping = {key: key, value: name, isRoot: false};\n\n    if (baseSchema.options.collection) {\n      schema.options.collection = baseSchema.options.collection;\n    }\n\n    // throws error if options are invalid\n    clean(schema.options, baseSchema.options);\n\n    var toJSON = schema.options.toJSON;\n    var toObject = schema.options.toObject;\n    var _id = schema.options._id;\n\n    schema.options = utils.clone(baseSchema.options);\n    if (toJSON) schema.options.toJSON = toJSON;\n    if (toObject) schema.options.toObject = toObject;\n    if (typeof _id !== 'undefined') {\n      schema.options._id = _id;\n    }\n\n    schema.callQueue = baseSchema.callQueue.concat(schema.callQueue.slice(schema._defaultMiddleware.length));\n    schema._requiredpaths = undefined; // reset just in case Schema#requiredPaths() was called on either schema\n  }\n\n  // merges base schema into new discriminator schema and sets new type field.\n  merge(schema, this.schema);\n\n  if (!this.discriminators) {\n    this.discriminators = {};\n  }\n\n  if (!this.schema.discriminatorMapping) {\n    this.schema.discriminatorMapping = {key: key, value: null, isRoot: true};\n  }\n\n  if (this.discriminators[name]) {\n    throw new Error('Discriminator with name \"' + name + '\" already exists');\n  }\n\n  this.discriminators[name] = this.db.model(name, schema, this.collection.name);\n  this.discriminators[name].prototype.__proto__ = this.prototype;\n  Object.defineProperty(this.discriminators[name], 'baseModelName', {\n    value: this.modelName,\n    configurable: true,\n    writable: false\n  });\n\n  // apply methods and statics\n  applyMethods(this.discriminators[name], schema);\n  applyStatics(this.discriminators[name], schema);\n\n  return this.discriminators[name];\n};\n\n// Model (class) features\n\n/*!\n * Give the constructor the ability to emit events.\n */\n\nfor (var i in EventEmitter.prototype) {\n  Model[i] = EventEmitter.prototype[i];\n}\n\n/**\n * Called when the model compiles.\n *\n * @api private\n */\n\nModel.init = function init() {\n  if ((this.schema.options.autoIndex) ||\n      (this.schema.options.autoIndex === null && this.db.config.autoIndex)) {\n    this.ensureIndexes({ __noPromise: true });\n  }\n\n  this.schema.emit('init', this);\n};\n\n/**\n * Sends `ensureIndex` commands to mongo for each index declared in the schema.\n *\n * ####Example:\n *\n *     Event.ensureIndexes(function (err) {\n *       if (err) return handleError(err);\n *     });\n *\n * After completion, an `index` event is emitted on this `Model` passing an error if one occurred.\n *\n * ####Example:\n *\n *     var eventSchema = new Schema({ thing: { type: 'string', unique: true }})\n *     var Event = mongoose.model('Event', eventSchema);\n *\n *     Event.on('index', function (err) {\n *       if (err) console.error(err); // error occurred during index creation\n *     })\n *\n * _NOTE: It is not recommended that you run this in production. Index creation may impact database performance depending on your load. Use with caution._\n *\n * The `ensureIndex` commands are not sent in parallel. This is to avoid the `MongoError: cannot add index with a background operation in progress` error. See [this ticket](https://github.com/Automattic/mongoose/issues/1365) for more information.\n *\n * @param {Object} [options] internal options\n * @param {Function} [cb] optional callback\n * @return {Promise}\n * @api public\n */\n\nModel.ensureIndexes = function ensureIndexes(options, cb) {\n  if (typeof options === 'function') {\n    cb = options;\n    options = null;\n  }\n\n  if (options && options.__noPromise) {\n    _ensureIndexes(this, cb);\n    return;\n  }\n\n  var _this = this;\n  var Promise = PromiseProvider.get();\n  return new Promise.ES6(function(resolve, reject) {\n    _ensureIndexes(_this, function(error) {\n      if (error) {\n        cb && cb(error);\n        reject(error);\n      }\n      cb && cb();\n      resolve();\n    });\n  });\n};\n\nfunction _ensureIndexes(model, callback) {\n  var indexes = model.schema.indexes();\n  if (!indexes.length) {\n    process.nextTick(function() {\n      callback && callback();\n    });\n    return;\n  }\n  // Indexes are created one-by-one to support how MongoDB < 2.4 deals\n  // with background indexes.\n\n  var done = function(err) {\n    if (err && model.schema.options.emitIndexErrors) {\n      model.emit('error', err);\n    }\n    model.emit('index', err);\n    callback && callback(err);\n  };\n\n  var indexSingleDone = function(err, fields, options, name) {\n    model.emit('index-single-done', err, fields, options, name);\n  };\n  var indexSingleStart = function(fields, options) {\n    model.emit('index-single-start', fields, options);\n  };\n\n  var create = function() {\n    var index = indexes.shift();\n    if (!index) return done();\n\n    var indexFields = index[0];\n    var options = index[1];\n    _handleSafe(options);\n\n    indexSingleStart(indexFields, options);\n\n    model.collection.ensureIndex(indexFields, options, tick(function(err, name) {\n      indexSingleDone(err, indexFields, options, name);\n      if (err) {\n        return done(err);\n      }\n      create();\n    }));\n  };\n\n  create();\n}\n\nfunction _handleSafe(options) {\n  if (options.safe) {\n    if (typeof options.safe === 'boolean') {\n      options.w = options.safe;\n      delete options.safe;\n    }\n    if (typeof options.safe === 'object') {\n      options.w = options.safe.w;\n      options.j = options.safe.j;\n      options.wtimeout = options.safe.wtimeout;\n      delete options.safe;\n    }\n  }\n}\n\n/**\n * Schema the model uses.\n *\n * @property schema\n * @receiver Model\n * @api public\n */\n\nModel.schema;\n\n/*!\n * Connection instance the model uses.\n *\n * @property db\n * @receiver Model\n * @api public\n */\n\nModel.db;\n\n/*!\n * Collection the model uses.\n *\n * @property collection\n * @receiver Model\n * @api public\n */\n\nModel.collection;\n\n/**\n * Base Mongoose instance the model uses.\n *\n * @property base\n * @receiver Model\n * @api public\n */\n\nModel.base;\n\n/**\n * Registered discriminators for this model.\n *\n * @property discriminators\n * @receiver Model\n * @api public\n */\n\nModel.discriminators;\n\n/**\n * Removes documents from the collection.\n *\n * ####Example:\n *\n *     Comment.remove({ title: 'baby born from alien father' }, function (err) {\n *\n *     });\n *\n * ####Note:\n *\n * To remove documents without waiting for a response from MongoDB, do not pass a `callback`, then call `exec` on the returned [Query](#query-js):\n *\n *     var query = Comment.remove({ _id: id });\n *     query.exec();\n *\n * ####Note:\n *\n * This method sends a remove command directly to MongoDB, no Mongoose documents are involved. Because no Mongoose documents are involved, _no middleware (hooks) are executed_.\n *\n * @param {Object} conditions\n * @param {Function} [callback]\n * @return {Promise} Promise\n * @api public\n */\n\nModel.remove = function remove(conditions, callback) {\n  if (typeof conditions === 'function') {\n    callback = conditions;\n    conditions = {};\n  }\n\n  // get the mongodb collection object\n  var mq = new Query(conditions, {}, this, this.collection);\n\n  return mq.remove(callback);\n};\n\n/**\n * Finds documents\n *\n * The `conditions` are cast to their respective SchemaTypes before the command is sent.\n *\n * ####Examples:\n *\n *     // named john and at least 18\n *     MyModel.find({ name: 'john', age: { $gte: 18 }});\n *\n *     // executes immediately, passing results to callback\n *     MyModel.find({ name: 'john', age: { $gte: 18 }}, function (err, docs) {});\n *\n *     // name LIKE john and only selecting the \"name\" and \"friends\" fields, executing immediately\n *     MyModel.find({ name: /john/i }, 'name friends', function (err, docs) { })\n *\n *     // passing options\n *     MyModel.find({ name: /john/i }, null, { skip: 10 })\n *\n *     // passing options and executing immediately\n *     MyModel.find({ name: /john/i }, null, { skip: 10 }, function (err, docs) {});\n *\n *     // executing a query explicitly\n *     var query = MyModel.find({ name: /john/i }, null, { skip: 10 })\n *     query.exec(function (err, docs) {});\n *\n *     // using the promise returned from executing a query\n *     var query = MyModel.find({ name: /john/i }, null, { skip: 10 });\n *     var promise = query.exec();\n *     promise.addBack(function (err, docs) {});\n *\n * @param {Object} conditions\n * @param {Object} [projection] optional fields to return (http://bit.ly/1HotzBo)\n * @param {Object} [options] optional\n * @param {Function} [callback]\n * @return {Query}\n * @see field selection #query_Query-select\n * @see promise #promise-js\n * @api public\n */\n\nModel.find = function find(conditions, projection, options, callback) {\n  if (typeof conditions === 'function') {\n    callback = conditions;\n    conditions = {};\n    projection = null;\n    options = null;\n  } else if (typeof projection === 'function') {\n    callback = projection;\n    projection = null;\n    options = null;\n  } else if (typeof options === 'function') {\n    callback = options;\n    options = null;\n  }\n\n  // get the raw mongodb collection object\n  var mq = new Query({}, {}, this, this.collection);\n  mq.select(projection);\n  mq.setOptions(options);\n  if (this.schema.discriminatorMapping && mq.selectedInclusively()) {\n    mq.select(this.schema.options.discriminatorKey);\n  }\n\n  return mq.find(conditions, callback);\n};\n\n/**\n * Finds a single document by its _id field. `findById(id)` is almost*\n * equivalent to `findOne({ _id: id })`.\n *\n * The `id` is cast based on the Schema before sending the command.\n *\n * Note: `findById()` triggers `findOne` hooks.\n *\n * * Except for how it treats `undefined`. Because the MongoDB driver\n * deletes keys that have value `undefined`, `findById(undefined)` gets\n * translated to `findById({ _id: null })`.\n *\n * ####Example:\n *\n *     // find adventure by id and execute immediately\n *     Adventure.findById(id, function (err, adventure) {});\n *\n *     // same as above\n *     Adventure.findById(id).exec(callback);\n *\n *     // select only the adventures name and length\n *     Adventure.findById(id, 'name length', function (err, adventure) {});\n *\n *     // same as above\n *     Adventure.findById(id, 'name length').exec(callback);\n *\n *     // include all properties except for `length`\n *     Adventure.findById(id, '-length').exec(function (err, adventure) {});\n *\n *     // passing options (in this case return the raw js objects, not mongoose documents by passing `lean`\n *     Adventure.findById(id, 'name', { lean: true }, function (err, doc) {});\n *\n *     // same as above\n *     Adventure.findById(id, 'name').lean().exec(function (err, doc) {});\n *\n * @param {Object|String|Number} id value of `_id` to query by\n * @param {Object} [projection] optional fields to return (http://bit.ly/1HotzBo)\n * @param {Object} [options] optional\n * @param {Function} [callback]\n * @return {Query}\n * @see field selection #query_Query-select\n * @see lean queries #query_Query-lean\n * @api public\n */\n\nModel.findById = function findById(id, projection, options, callback) {\n  if (typeof id === 'undefined') {\n    id = null;\n  }\n  return this.findOne({_id: id}, projection, options, callback);\n};\n\n/**\n * Finds one document.\n *\n * The `conditions` are cast to their respective SchemaTypes before the command is sent.\n *\n * ####Example:\n *\n *     // find one iphone adventures - iphone adventures??\n *     Adventure.findOne({ type: 'iphone' }, function (err, adventure) {});\n *\n *     // same as above\n *     Adventure.findOne({ type: 'iphone' }).exec(function (err, adventure) {});\n *\n *     // select only the adventures name\n *     Adventure.findOne({ type: 'iphone' }, 'name', function (err, adventure) {});\n *\n *     // same as above\n *     Adventure.findOne({ type: 'iphone' }, 'name').exec(function (err, adventure) {});\n *\n *     // specify options, in this case lean\n *     Adventure.findOne({ type: 'iphone' }, 'name', { lean: true }, callback);\n *\n *     // same as above\n *     Adventure.findOne({ type: 'iphone' }, 'name', { lean: true }).exec(callback);\n *\n *     // chaining findOne queries (same as above)\n *     Adventure.findOne({ type: 'iphone' }).select('name').lean().exec(callback);\n *\n * @param {Object} [conditions]\n * @param {Object} [projection] optional fields to return (http://bit.ly/1HotzBo)\n * @param {Object} [options] optional\n * @param {Function} [callback]\n * @return {Query}\n * @see field selection #query_Query-select\n * @see lean queries #query_Query-lean\n * @api public\n */\n\nModel.findOne = function findOne(conditions, projection, options, callback) {\n  if (typeof options === 'function') {\n    callback = options;\n    options = null;\n  } else if (typeof projection === 'function') {\n    callback = projection;\n    projection = null;\n    options = null;\n  } else if (typeof conditions === 'function') {\n    callback = conditions;\n    conditions = {};\n    projection = null;\n    options = null;\n  }\n\n  // get the mongodb collection object\n  var mq = new Query({}, {}, this, this.collection);\n  mq.select(projection);\n  mq.setOptions(options);\n  if (this.schema.discriminatorMapping && mq.selectedInclusively()) {\n    mq.select(this.schema.options.discriminatorKey);\n  }\n\n  return mq.findOne(conditions, callback);\n};\n\n/**\n * Counts number of matching documents in a database collection.\n *\n * ####Example:\n *\n *     Adventure.count({ type: 'jungle' }, function (err, count) {\n *       if (err) ..\n *       console.log('there are %d jungle adventures', count);\n *     });\n *\n * @param {Object} conditions\n * @param {Function} [callback]\n * @return {Query}\n * @api public\n */\n\nModel.count = function count(conditions, callback) {\n  if (typeof conditions === 'function') {\n    callback = conditions;\n    conditions = {};\n  }\n\n  // get the mongodb collection object\n  var mq = new Query({}, {}, this, this.collection);\n\n  return mq.count(conditions, callback);\n};\n\n/**\n * Creates a Query for a `distinct` operation.\n *\n * Passing a `callback` immediately executes the query.\n *\n * ####Example\n *\n *     Link.distinct('url', { clicks: {$gt: 100}}, function (err, result) {\n *       if (err) return handleError(err);\n *\n *       assert(Array.isArray(result));\n *       console.log('unique urls with more than 100 clicks', result);\n *     })\n *\n *     var query = Link.distinct('url');\n *     query.exec(callback);\n *\n * @param {String} field\n * @param {Object} [conditions] optional\n * @param {Function} [callback]\n * @return {Query}\n * @api public\n */\n\nModel.distinct = function distinct(field, conditions, callback) {\n  // get the mongodb collection object\n  var mq = new Query({}, {}, this, this.collection);\n\n  if (typeof conditions === 'function') {\n    callback = conditions;\n    conditions = {};\n  }\n\n  return mq.distinct(field, conditions, callback);\n};\n\n/**\n * Creates a Query, applies the passed conditions, and returns the Query.\n *\n * For example, instead of writing:\n *\n *     User.find({age: {$gte: 21, $lte: 65}}, callback);\n *\n * we can instead write:\n *\n *     User.where('age').gte(21).lte(65).exec(callback);\n *\n * Since the Query class also supports `where` you can continue chaining\n *\n *     User\n *     .where('age').gte(21).lte(65)\n *     .where('name', /^b/i)\n *     ... etc\n *\n * @param {String} path\n * @param {Object} [val] optional value\n * @return {Query}\n * @api public\n */\n\nModel.where = function where(path, val) {\n  void val; // eslint\n  // get the mongodb collection object\n  var mq = new Query({}, {}, this, this.collection).find({});\n  return mq.where.apply(mq, arguments);\n};\n\n/**\n * Creates a `Query` and specifies a `$where` condition.\n *\n * Sometimes you need to query for things in mongodb using a JavaScript expression. You can do so via `find({ $where: javascript })`, or you can use the mongoose shortcut method $where via a Query chain or from your mongoose Model.\n *\n *     Blog.$where('this.username.indexOf(\"val\") !== -1').exec(function (err, docs) {});\n *\n * @param {String|Function} argument is a javascript string or anonymous function\n * @method $where\n * @memberOf Model\n * @return {Query}\n * @see Query.$where #query_Query-%24where\n * @api public\n */\n\nModel.$where = function $where() {\n  var mq = new Query({}, {}, this, this.collection).find({});\n  return mq.$where.apply(mq, arguments);\n};\n\n/**\n * Issues a mongodb findAndModify update command.\n *\n * Finds a matching document, updates it according to the `update` arg, passing any `options`, and returns the found document (if any) to the callback. The query executes immediately if `callback` is passed else a Query object is returned.\n *\n * ####Options:\n *\n * - `new`: bool - if true, return the modified document rather than the original. defaults to false (changed in 4.0)\n * - `upsert`: bool - creates the object if it doesn't exist. defaults to false.\n * - `fields`: {Object|String} - Field selection. Equivalent to `.select(fields).findOneAndUpdate()`\n * - `sort`: if multiple docs are found by the conditions, sets the sort order to choose which doc to update\n * - `runValidators`: if true, runs [update validators](/docs/validation.html#update-validators) on this command. Update validators validate the update operation against the model's schema.\n * - `setDefaultsOnInsert`: if this and `upsert` are true, mongoose will apply the [defaults](http://mongoosejs.com/docs/defaults.html) specified in the model's schema if a new document is created. This option only works on MongoDB >= 2.4 because it relies on [MongoDB's `$setOnInsert` operator](https://docs.mongodb.org/v2.4/reference/operator/update/setOnInsert/).\n * - `passRawResult`: if true, passes the [raw result from the MongoDB driver as the third callback parameter](http://mongodb.github.io/node-mongodb-native/2.0/api/Collection.html#findAndModify)\n *\n *\n * ####Examples:\n *\n *     A.findOneAndUpdate(conditions, update, options, callback) // executes\n *     A.findOneAndUpdate(conditions, update, options)  // returns Query\n *     A.findOneAndUpdate(conditions, update, callback) // executes\n *     A.findOneAndUpdate(conditions, update)           // returns Query\n *     A.findOneAndUpdate()                             // returns Query\n *\n * ####Note:\n *\n * All top level update keys which are not `atomic` operation names are treated as set operations:\n *\n * ####Example:\n *\n *     var query = { name: 'borne' };\n *     Model.findOneAndUpdate(query, { name: 'jason borne' }, options, callback)\n *\n *     // is sent as\n *     Model.findOneAndUpdate(query, { $set: { name: 'jason borne' }}, options, callback)\n *\n * This helps prevent accidentally overwriting your document with `{ name: 'jason borne' }`.\n *\n * ####Note:\n *\n * Values are cast to their appropriate types when using the findAndModify helpers.\n * However, the below are never executed.\n *\n * - defaults\n * - setters\n *\n * `findAndModify` helpers support limited defaults and validation. You can\n * enable these by setting the `setDefaultsOnInsert` and `runValidators` options,\n * respectively.\n *\n * If you need full-fledged validation, use the traditional approach of first\n * retrieving the document.\n *\n *     Model.findById(id, function (err, doc) {\n *       if (err) ..\n *       doc.name = 'jason borne';\n *       doc.save(callback);\n *     });\n *\n * @param {Object} [conditions]\n * @param {Object} [update]\n * @param {Object} [options]\n * @param {Function} [callback]\n * @return {Query}\n * @see mongodb http://www.mongodb.org/display/DOCS/findAndModify+Command\n * @api public\n */\n\nModel.findOneAndUpdate = function(conditions, update, options, callback) {\n  if (typeof options === 'function') {\n    callback = options;\n    options = null;\n  } else if (arguments.length === 1) {\n    if (typeof conditions === 'function') {\n      var msg = 'Model.findOneAndUpdate(): First argument must not be a function.\\n\\n'\n          + '  ' + this.modelName + '.findOneAndUpdate(conditions, update, options, callback)\\n'\n          + '  ' + this.modelName + '.findOneAndUpdate(conditions, update, options)\\n'\n          + '  ' + this.modelName + '.findOneAndUpdate(conditions, update)\\n'\n          + '  ' + this.modelName + '.findOneAndUpdate(update)\\n'\n          + '  ' + this.modelName + '.findOneAndUpdate()\\n';\n      throw new TypeError(msg);\n    }\n    update = conditions;\n    conditions = undefined;\n  }\n\n  var fields;\n  if (options && options.fields) {\n    fields = options.fields;\n    options.fields = undefined;\n  }\n\n  update = utils.clone(update, {depopulate: 1});\n  if (this.schema.options.versionKey && options && options.upsert) {\n    if (!update.$setOnInsert) {\n      update.$setOnInsert = {};\n    }\n    update.$setOnInsert[this.schema.options.versionKey] = 0;\n  }\n\n  var mq = new Query({}, {}, this, this.collection);\n  mq.select(fields);\n\n  return mq.findOneAndUpdate(conditions, update, options, callback);\n};\n\n/**\n * Issues a mongodb findAndModify update command by a document's _id field.\n * `findByIdAndUpdate(id, ...)` is equivalent to `findOneAndUpdate({ _id: id }, ...)`.\n *\n * Finds a matching document, updates it according to the `update` arg,\n * passing any `options`, and returns the found document (if any) to the\n * callback. The query executes immediately if `callback` is passed else a\n * Query object is returned.\n *\n * This function triggers `findOneAndUpdate` middleware.\n *\n * ####Options:\n *\n * - `new`: bool - true to return the modified document rather than the original. defaults to false\n * - `upsert`: bool - creates the object if it doesn't exist. defaults to false.\n * - `runValidators`: if true, runs [update validators](/docs/validation.html#update-validators) on this command. Update validators validate the update operation against the model's schema.\n * - `setDefaultsOnInsert`: if this and `upsert` are true, mongoose will apply the [defaults](http://mongoosejs.com/docs/defaults.html) specified in the model's schema if a new document is created. This option only works on MongoDB >= 2.4 because it relies on [MongoDB's `$setOnInsert` operator](https://docs.mongodb.org/v2.4/reference/operator/update/setOnInsert/).\n * - `sort`: if multiple docs are found by the conditions, sets the sort order to choose which doc to update\n * - `select`: sets the document fields to return\n *\n * ####Examples:\n *\n *     A.findByIdAndUpdate(id, update, options, callback) // executes\n *     A.findByIdAndUpdate(id, update, options)  // returns Query\n *     A.findByIdAndUpdate(id, update, callback) // executes\n *     A.findByIdAndUpdate(id, update)           // returns Query\n *     A.findByIdAndUpdate()                     // returns Query\n *\n * ####Note:\n *\n * All top level update keys which are not `atomic` operation names are treated as set operations:\n *\n * ####Example:\n *\n *     Model.findByIdAndUpdate(id, { name: 'jason borne' }, options, callback)\n *\n *     // is sent as\n *     Model.findByIdAndUpdate(id, { $set: { name: 'jason borne' }}, options, callback)\n *\n * This helps prevent accidentally overwriting your document with `{ name: 'jason borne' }`.\n *\n * ####Note:\n *\n * Values are cast to their appropriate types when using the findAndModify helpers.\n * However, the below are never executed.\n *\n * - defaults\n * - setters\n *\n * `findAndModify` helpers support limited defaults and validation. You can\n * enable these by setting the `setDefaultsOnInsert` and `runValidators` options,\n * respectively.\n *\n * If you need full-fledged validation, use the traditional approach of first\n * retrieving the document.\n *\n *     Model.findById(id, function (err, doc) {\n *       if (err) ..\n *       doc.name = 'jason borne';\n *       doc.save(callback);\n *     });\n *\n * @param {Object|Number|String} id value of `_id` to query by\n * @param {Object} [update]\n * @param {Object} [options]\n * @param {Function} [callback]\n * @return {Query}\n * @see Model.findOneAndUpdate #model_Model.findOneAndUpdate\n * @see mongodb http://www.mongodb.org/display/DOCS/findAndModify+Command\n * @api public\n */\n\nModel.findByIdAndUpdate = function(id, update, options, callback) {\n  if (arguments.length === 1) {\n    if (typeof id === 'function') {\n      var msg = 'Model.findByIdAndUpdate(): First argument must not be a function.\\n\\n'\n          + '  ' + this.modelName + '.findByIdAndUpdate(id, callback)\\n'\n          + '  ' + this.modelName + '.findByIdAndUpdate(id)\\n'\n          + '  ' + this.modelName + '.findByIdAndUpdate()\\n';\n      throw new TypeError(msg);\n    }\n    return this.findOneAndUpdate({_id: id}, undefined);\n  }\n\n  // if a model is passed in instead of an id\n  if (id instanceof Document) {\n    id = id._id;\n  }\n\n  return this.findOneAndUpdate.call(this, {_id: id}, update, options, callback);\n};\n\n/**\n * Issue a mongodb findAndModify remove command.\n *\n * Finds a matching document, removes it, passing the found document (if any) to the callback.\n *\n * Executes immediately if `callback` is passed else a Query object is returned.\n *\n * ####Options:\n *\n * - `sort`: if multiple docs are found by the conditions, sets the sort order to choose which doc to update\n * - `select`: sets the document fields to return\n *\n * ####Examples:\n *\n *     A.findOneAndRemove(conditions, options, callback) // executes\n *     A.findOneAndRemove(conditions, options)  // return Query\n *     A.findOneAndRemove(conditions, callback) // executes\n *     A.findOneAndRemove(conditions) // returns Query\n *     A.findOneAndRemove()           // returns Query\n *\n * Values are cast to their appropriate types when using the findAndModify helpers.\n * However, the below are never executed.\n *\n * - defaults\n * - setters\n *\n * `findAndModify` helpers support limited defaults and validation. You can\n * enable these by setting the `setDefaultsOnInsert` and `runValidators` options,\n * respectively.\n *\n * If you need full-fledged validation, use the traditional approach of first\n * retrieving the document.\n *\n *     Model.findById(id, function (err, doc) {\n *       if (err) ..\n *       doc.name = 'jason borne';\n *       doc.save(callback);\n *     });\n *\n * @param {Object} conditions\n * @param {Object} [options]\n * @param {Function} [callback]\n * @return {Query}\n * @see mongodb http://www.mongodb.org/display/DOCS/findAndModify+Command\n * @api public\n */\n\nModel.findOneAndRemove = function(conditions, options, callback) {\n  if (arguments.length === 1 && typeof conditions === 'function') {\n    var msg = 'Model.findOneAndRemove(): First argument must not be a function.\\n\\n'\n        + '  ' + this.modelName + '.findOneAndRemove(conditions, callback)\\n'\n        + '  ' + this.modelName + '.findOneAndRemove(conditions)\\n'\n        + '  ' + this.modelName + '.findOneAndRemove()\\n';\n    throw new TypeError(msg);\n  }\n\n  if (typeof options === 'function') {\n    callback = options;\n    options = undefined;\n  }\n\n  var fields;\n  if (options) {\n    fields = options.select;\n    options.select = undefined;\n  }\n\n  var mq = new Query({}, {}, this, this.collection);\n  mq.select(fields);\n\n  return mq.findOneAndRemove(conditions, options, callback);\n};\n\n/**\n * Issue a mongodb findAndModify remove command by a document's _id field. `findByIdAndRemove(id, ...)` is equivalent to `findOneAndRemove({ _id: id }, ...)`.\n *\n * Finds a matching document, removes it, passing the found document (if any) to the callback.\n *\n * Executes immediately if `callback` is passed, else a `Query` object is returned.\n *\n * ####Options:\n *\n * - `sort`: if multiple docs are found by the conditions, sets the sort order to choose which doc to update\n * - `select`: sets the document fields to return\n *\n * ####Examples:\n *\n *     A.findByIdAndRemove(id, options, callback) // executes\n *     A.findByIdAndRemove(id, options)  // return Query\n *     A.findByIdAndRemove(id, callback) // executes\n *     A.findByIdAndRemove(id) // returns Query\n *     A.findByIdAndRemove()           // returns Query\n *\n * @param {Object|Number|String} id value of `_id` to query by\n * @param {Object} [options]\n * @param {Function} [callback]\n * @return {Query}\n * @see Model.findOneAndRemove #model_Model.findOneAndRemove\n * @see mongodb http://www.mongodb.org/display/DOCS/findAndModify+Command\n */\n\nModel.findByIdAndRemove = function(id, options, callback) {\n  if (arguments.length === 1 && typeof id === 'function') {\n    var msg = 'Model.findByIdAndRemove(): First argument must not be a function.\\n\\n'\n        + '  ' + this.modelName + '.findByIdAndRemove(id, callback)\\n'\n        + '  ' + this.modelName + '.findByIdAndRemove(id)\\n'\n        + '  ' + this.modelName + '.findByIdAndRemove()\\n';\n    throw new TypeError(msg);\n  }\n\n  return this.findOneAndRemove({_id: id}, options, callback);\n};\n\n/**\n * Shortcut for creating a new Document that is automatically saved to the db\n * if valid.\n *\n * ####Example:\n *\n *     // pass individual docs\n *     Candy.create({ type: 'jelly bean' }, { type: 'snickers' }, function (err, jellybean, snickers) {\n *       if (err) // ...\n *     });\n *\n *     // pass an array\n *     var array = [{ type: 'jelly bean' }, { type: 'snickers' }];\n *     Candy.create(array, function (err, candies) {\n *       if (err) // ...\n *\n *       var jellybean = candies[0];\n *       var snickers = candies[1];\n *       // ...\n *     });\n *\n *     // callback is optional; use the returned promise if you like:\n *     var promise = Candy.create({ type: 'jawbreaker' });\n *     promise.then(function (jawbreaker) {\n *       // ...\n *     })\n *\n * @param {Array|Object|*} doc(s)\n * @param {Function} [callback] callback\n * @return {Promise}\n * @api public\n */\n\nModel.create = function create(doc, callback) {\n  var args,\n      cb;\n\n  if (Array.isArray(doc)) {\n    args = doc;\n    cb = callback;\n  } else {\n    var last = arguments[arguments.length - 1];\n    if (typeof last === 'function') {\n      cb = last;\n      args = utils.args(arguments, 0, arguments.length - 1);\n    } else {\n      args = utils.args(arguments);\n    }\n  }\n\n  var Promise = PromiseProvider.get();\n  var _this = this;\n\n  var promise = new Promise.ES6(function(resolve, reject) {\n    if (args.length === 0) {\n      process.nextTick(function() {\n        cb && cb(null);\n        resolve(null);\n      });\n      return;\n    }\n\n    var toExecute = [];\n    args.forEach(function(doc) {\n      toExecute.push(function(callback) {\n        var toSave = new _this(doc);\n        var callbackWrapper = function(error, doc) {\n          if (error) {\n            return callback(error);\n          }\n          callback(null, doc);\n        };\n\n        // Hack to avoid getting a promise because of\n        // $__registerHooksFromSchema\n        if (toSave.$__original_save) {\n          toSave.$__original_save({__noPromise: true}, callbackWrapper);\n        } else {\n          toSave.save({__noPromise: true}, callbackWrapper);\n        }\n      });\n    });\n\n    async.parallel(toExecute, function(error, savedDocs) {\n      if (error) {\n        cb && cb(error);\n        reject(error);\n        return;\n      }\n\n      if (doc instanceof Array) {\n        resolve(savedDocs);\n        cb && cb.call(_this, null, savedDocs);\n      } else {\n        resolve.apply(promise, savedDocs);\n        if (cb) {\n          savedDocs.unshift(null);\n          cb.apply(_this, savedDocs);\n        }\n      }\n    });\n  });\n\n  return promise;\n};\n\n/**\n * Shortcut for validating an array of documents and inserting them into\n * MongoDB if they're all valid. This function is faster than `.create()`\n * because it only sends one operation to the server, rather than one for each\n * document.\n *\n * This function does **not** trigger save middleware.\n *\n * ####Example:\n *\n *     var arr = [{ name: 'Star Wars' }, { name: 'The Empire Strikes Back' }];\n *     Movies.insertMany(arr, function(error, docs) {});\n *\n * @param {Array|Object|*} doc(s)\n * @param {Function} [callback] callback\n * @return {Promise}\n * @api public\n */\n\nModel.insertMany = function(arr, callback) {\n  var _this = this;\n  var Promise = PromiseProvider.get();\n\n  return new Promise.ES6(function(resolve, reject) {\n    var toExecute = [];\n    arr.forEach(function(doc) {\n      toExecute.push(function(callback) {\n        doc = new _this(doc);\n        doc.validate({__noPromise: true}, function(error) {\n          if (error) {\n            return callback(error);\n          }\n          callback(null, doc);\n        });\n      });\n    });\n\n    async.parallel(toExecute, function(error, docs) {\n      if (error) {\n        reject(error);\n        callback && callback(error);\n        return;\n      }\n      var docObjects = docs.map(function(doc) {\n        return doc.toObject({virtuals: false});\n      });\n      _this.collection.insertMany(docObjects, function(error) {\n        if (error) {\n          reject(error);\n          callback && callback(error);\n          return;\n        }\n        resolve(docs);\n        callback && callback(null, docs);\n      });\n    });\n  });\n};\n\n/**\n * Shortcut for creating a new Document from existing raw data, pre-saved in the DB.\n * The document returned has no paths marked as modified initially.\n *\n * ####Example:\n *\n *     // hydrate previous data into a Mongoose document\n *     var mongooseCandy = Candy.hydrate({ _id: '54108337212ffb6d459f854c', type: 'jelly bean' });\n *\n * @param {Object} obj\n * @return {Document}\n * @api public\n */\n\nModel.hydrate = function(obj) {\n  var model = require('./queryhelpers').createModel(this, obj);\n  model.init(obj);\n  return model;\n};\n\n/**\n * Updates documents in the database without returning them.\n *\n * ####Examples:\n *\n *     MyModel.update({ age: { $gt: 18 } }, { oldEnough: true }, fn);\n *     MyModel.update({ name: 'Tobi' }, { ferret: true }, { multi: true }, function (err, raw) {\n *       if (err) return handleError(err);\n *       console.log('The raw response from Mongo was ', raw);\n *     });\n *\n * ####Valid options:\n *\n *  - `safe` (boolean) safe mode (defaults to value set in schema (true))\n *  - `upsert` (boolean) whether to create the doc if it doesn't match (false)\n *  - `multi` (boolean) whether multiple documents should be updated (false)\n *  - `runValidators`: if true, runs [update validators](/docs/validation.html#update-validators) on this command. Update validators validate the update operation against the model's schema.\n *  - `setDefaultsOnInsert`: if this and `upsert` are true, mongoose will apply the [defaults](http://mongoosejs.com/docs/defaults.html) specified in the model's schema if a new document is created. This option only works on MongoDB >= 2.4 because it relies on [MongoDB's `$setOnInsert` operator](https://docs.mongodb.org/v2.4/reference/operator/update/setOnInsert/).\n *  - `strict` (boolean) overrides the `strict` option for this update\n *  - `overwrite` (boolean) disables update-only mode, allowing you to overwrite the doc (false)\n *\n * All `update` values are cast to their appropriate SchemaTypes before being sent.\n *\n * The `callback` function receives `(err, rawResponse)`.\n *\n * - `err` is the error if any occurred\n * - `rawResponse` is the full response from Mongo\n *\n * ####Note:\n *\n * All top level keys which are not `atomic` operation names are treated as set operations:\n *\n * ####Example:\n *\n *     var query = { name: 'borne' };\n *     Model.update(query, { name: 'jason borne' }, options, callback)\n *\n *     // is sent as\n *     Model.update(query, { $set: { name: 'jason borne' }}, options, callback)\n *     // if overwrite option is false. If overwrite is true, sent without the $set wrapper.\n *\n * This helps prevent accidentally overwriting all documents in your collection with `{ name: 'jason borne' }`.\n *\n * ####Note:\n *\n * Be careful to not use an existing model instance for the update clause (this won't work and can cause weird behavior like infinite loops). Also, ensure that the update clause does not have an _id property, which causes Mongo to return a \"Mod on _id not allowed\" error.\n *\n * ####Note:\n *\n * To update documents without waiting for a response from MongoDB, do not pass a `callback`, then call `exec` on the returned [Query](#query-js):\n *\n *     Comment.update({ _id: id }, { $set: { text: 'changed' }}).exec();\n *\n * ####Note:\n *\n * Although values are casted to their appropriate types when using update, the following are *not* applied:\n *\n * - defaults\n * - setters\n * - validators\n * - middleware\n *\n * If you need those features, use the traditional approach of first retrieving the document.\n *\n *     Model.findOne({ name: 'borne' }, function (err, doc) {\n *       if (err) ..\n *       doc.name = 'jason borne';\n *       doc.save(callback);\n *     })\n *\n * @see strict http://mongoosejs.com/docs/guide.html#strict\n * @see response http://docs.mongodb.org/v2.6/reference/command/update/#output\n * @param {Object} conditions\n * @param {Object} doc\n * @param {Object} [options]\n * @param {Function} [callback]\n * @return {Query}\n * @api public\n */\n\nModel.update = function update(conditions, doc, options, callback) {\n  var mq = new Query({}, {}, this, this.collection);\n  // gh-2406\n  // make local deep copy of conditions\n  if (conditions instanceof Document) {\n    conditions = conditions.toObject();\n  } else {\n    conditions = utils.clone(conditions, {retainKeyOrder: true});\n  }\n  options = typeof options === 'function' ? options : utils.clone(options);\n\n  return mq.update(conditions, doc, options, callback);\n};\n\n/**\n * Executes a mapReduce command.\n *\n * `o` is an object specifying all mapReduce options as well as the map and reduce functions. All options are delegated to the driver implementation. See [node-mongodb-native mapReduce() documentation](http://mongodb.github.io/node-mongodb-native/api-generated/collection.html#mapreduce) for more detail about options.\n *\n * ####Example:\n *\n *     var o = {};\n *     o.map = function () { emit(this.name, 1) }\n *     o.reduce = function (k, vals) { return vals.length }\n *     User.mapReduce(o, function (err, results) {\n *       console.log(results)\n *     })\n *\n * ####Other options:\n *\n * - `query` {Object} query filter object.\n * - `sort` {Object} sort input objects using this key\n * - `limit` {Number} max number of documents\n * - `keeptemp` {Boolean, default:false} keep temporary data\n * - `finalize` {Function} finalize function\n * - `scope` {Object} scope variables exposed to map/reduce/finalize during execution\n * - `jsMode` {Boolean, default:false} it is possible to make the execution stay in JS. Provided in MongoDB > 2.0.X\n * - `verbose` {Boolean, default:false} provide statistics on job execution time.\n * - `readPreference` {String}\n * - `out*` {Object, default: {inline:1}} sets the output target for the map reduce job.\n *\n * ####* out options:\n *\n * - `{inline:1}` the results are returned in an array\n * - `{replace: 'collectionName'}` add the results to collectionName: the results replace the collection\n * - `{reduce: 'collectionName'}` add the results to collectionName: if dups are detected, uses the reducer / finalize functions\n * - `{merge: 'collectionName'}` add the results to collectionName: if dups exist the new docs overwrite the old\n *\n * If `options.out` is set to `replace`, `merge`, or `reduce`, a Model instance is returned that can be used for further querying. Queries run against this model are all executed with the `lean` option; meaning only the js object is returned and no Mongoose magic is applied (getters, setters, etc).\n *\n * ####Example:\n *\n *     var o = {};\n *     o.map = function () { emit(this.name, 1) }\n *     o.reduce = function (k, vals) { return vals.length }\n *     o.out = { replace: 'createdCollectionNameForResults' }\n *     o.verbose = true;\n *\n *     User.mapReduce(o, function (err, model, stats) {\n *       console.log('map reduce took %d ms', stats.processtime)\n *       model.find().where('value').gt(10).exec(function (err, docs) {\n *         console.log(docs);\n *       });\n *     })\n *\n *     // a promise is returned so you may instead write\n *     var promise = User.mapReduce(o);\n *     promise.then(function (model, stats) {\n *       console.log('map reduce took %d ms', stats.processtime)\n *       return model.find().where('value').gt(10).exec();\n *     }).then(function (docs) {\n *        console.log(docs);\n *     }).then(null, handleError).end()\n *\n * @param {Object} o an object specifying map-reduce options\n * @param {Function} [callback] optional callback\n * @see http://www.mongodb.org/display/DOCS/MapReduce\n * @return {Promise}\n * @api public\n */\n\nModel.mapReduce = function mapReduce(o, callback) {\n  var _this = this;\n  var Promise = PromiseProvider.get();\n  return new Promise.ES6(function(resolve, reject) {\n    if (!Model.mapReduce.schema) {\n      var opts = {noId: true, noVirtualId: true, strict: false};\n      Model.mapReduce.schema = new Schema({}, opts);\n    }\n\n    if (!o.out) o.out = {inline: 1};\n    if (o.verbose !== false) o.verbose = true;\n\n    o.map = String(o.map);\n    o.reduce = String(o.reduce);\n\n    if (o.query) {\n      var q = new Query(o.query);\n      q.cast(_this);\n      o.query = q._conditions;\n      q = undefined;\n    }\n\n    _this.collection.mapReduce(null, null, o, function(err, ret, stats) {\n      if (err) {\n        callback && callback(err);\n        reject(err);\n        return;\n      }\n\n      if (ret.findOne && ret.mapReduce) {\n        // returned a collection, convert to Model\n        var model = Model.compile(\n            '_mapreduce_' + ret.collectionName\n            , Model.mapReduce.schema\n            , ret.collectionName\n            , _this.db\n            , _this.base);\n\n        model._mapreduce = true;\n\n        callback && callback(null, model, stats);\n        return resolve(model, stats);\n      }\n\n      callback && callback(null, ret, stats);\n      resolve(ret, stats);\n    });\n  });\n};\n\n/**\n * geoNear support for Mongoose\n *\n * ####Options:\n * - `lean` {Boolean} return the raw object\n * - All options supported by the driver are also supported\n *\n * ####Example:\n *\n *     // Legacy point\n *     Model.geoNear([1,3], { maxDistance : 5, spherical : true }, function(err, results, stats) {\n *        console.log(results);\n *     });\n *\n *     // geoJson\n *     var point = { type : \"Point\", coordinates : [9,9] };\n *     Model.geoNear(point, { maxDistance : 5, spherical : true }, function(err, results, stats) {\n *        console.log(results);\n *     });\n *\n * @param {Object|Array} GeoJSON point or legacy coordinate pair [x,y] to search near\n * @param {Object} options for the qurery\n * @param {Function} [callback] optional callback for the query\n * @return {Promise}\n * @see http://docs.mongodb.org/manual/core/2dsphere/\n * @see http://mongodb.github.io/node-mongodb-native/api-generated/collection.html?highlight=geonear#geoNear\n * @api public\n */\n\nModel.geoNear = function(near, options, callback) {\n  if (typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n\n  var _this = this;\n  var Promise = PromiseProvider.get();\n  if (!near) {\n    return new Promise.ES6(function(resolve, reject) {\n      var error = new Error('Must pass a near option to geoNear');\n      reject(error);\n      callback && callback(error);\n    });\n  }\n\n  var x, y;\n\n  return new Promise.ES6(function(resolve, reject) {\n    var handler = function(err, res) {\n      if (err) {\n        reject(err);\n        callback && callback(err);\n        return;\n      }\n      if (options.lean) {\n        resolve(res.results, res.stats);\n        callback && callback(null, res.results, res.stats);\n        return;\n      }\n\n      var count = res.results.length;\n      // if there are no results, fulfill the promise now\n      if (count === 0) {\n        resolve(res.results, res.stats);\n        callback && callback(null, res.results, res.stats);\n        return;\n      }\n\n      var errSeen = false;\n\n      function init(err) {\n        if (err && !errSeen) {\n          errSeen = true;\n          reject(err);\n          callback && callback(err);\n          return;\n        }\n        if (--count <= 0) {\n          resolve(res.results, res.stats);\n          callback && callback(null, res.results, res.stats);\n        }\n      }\n\n      for (var i = 0; i < res.results.length; i++) {\n        var temp = res.results[i].obj;\n        res.results[i].obj = new _this();\n        res.results[i].obj.init(temp, init);\n      }\n    };\n\n    if (Array.isArray(near)) {\n      if (near.length !== 2) {\n        var error = new Error('If using legacy coordinates, must be an array ' +\n            'of size 2 for geoNear');\n        reject(error);\n        callback && callback(error);\n        return;\n      }\n      x = near[0];\n      y = near[1];\n      _this.collection.geoNear(x, y, options, handler);\n    } else {\n      if (near.type !== 'Point' || !Array.isArray(near.coordinates)) {\n        error = new Error('Must pass either a legacy coordinate array or ' +\n            'GeoJSON Point to geoNear');\n        reject(error);\n        callback && callback(error);\n        return;\n      }\n\n      _this.collection.geoNear(near, options, handler);\n    }\n  });\n};\n\n/**\n * Performs [aggregations](http://docs.mongodb.org/manual/applications/aggregation/) on the models collection.\n *\n * If a `callback` is passed, the `aggregate` is executed. If a callback is not passed, the `aggregate` itself is returned.\n *\n * ####Example:\n *\n *     // Find the max balance of all accounts\n *     Users.aggregate(\n *         { $group: { _id: null, maxBalance: { $max: '$balance' }}}\n *       , { $project: { _id: 0, maxBalance: 1 }}\n *       , function (err, res) {\n *       if (err) return handleError(err);\n *       console.log(res); // [ { maxBalance: 98000 } ]\n *     });\n *\n *     // Or use the aggregation pipeline builder.\n *     Users.aggregate()\n *       .group({ _id: null, maxBalance: { $max: '$balance' } })\n *       .select('-id maxBalance')\n *       .exec(function (err, res) {\n *         if (err) return handleError(err);\n *         console.log(res); // [ { maxBalance: 98 } ]\n *     });\n *\n * ####NOTE:\n *\n * - Arguments are not cast to the model's schema because `$project` operators allow redefining the \"shape\" of the documents at any stage of the pipeline, which may leave documents in an incompatible format.\n * - The documents returned are plain javascript objects, not mongoose documents (since any shape of document can be returned).\n * - Requires MongoDB >= 2.1\n *\n * @see Aggregate #aggregate_Aggregate\n * @see MongoDB http://docs.mongodb.org/manual/applications/aggregation/\n * @param {Object|Array} [...] aggregation pipeline operator(s) or operator array\n * @param {Function} [callback]\n * @return {Aggregate|Promise}\n * @api public\n */\n\nModel.aggregate = function aggregate() {\n  var args = [].slice.call(arguments),\n      aggregate,\n      callback;\n\n  if (typeof args[args.length - 1] === 'function') {\n    callback = args.pop();\n  }\n\n  if (args.length === 1 && util.isArray(args[0])) {\n    aggregate = new Aggregate(args[0]);\n  } else {\n    aggregate = new Aggregate(args);\n  }\n\n  aggregate.model(this);\n\n  if (typeof callback === 'undefined') {\n    return aggregate;\n  }\n\n  return aggregate.exec(callback);\n};\n\n/**\n * Implements `$geoSearch` functionality for Mongoose\n *\n * ####Example:\n *\n *     var options = { near: [10, 10], maxDistance: 5 };\n *     Locations.geoSearch({ type : \"house\" }, options, function(err, res) {\n *       console.log(res);\n *     });\n *\n * ####Options:\n * - `near` {Array} x,y point to search for\n * - `maxDistance` {Number} the maximum distance from the point near that a result can be\n * - `limit` {Number} The maximum number of results to return\n * - `lean` {Boolean} return the raw object instead of the Mongoose Model\n *\n * @param {Object} conditions an object that specifies the match condition (required)\n * @param {Object} options for the geoSearch, some (near, maxDistance) are required\n * @param {Function} [callback] optional callback\n * @return {Promise}\n * @see http://docs.mongodb.org/manual/reference/command/geoSearch/\n * @see http://docs.mongodb.org/manual/core/geohaystack/\n * @api public\n */\n\nModel.geoSearch = function(conditions, options, callback) {\n  if (typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n\n  var _this = this;\n  var Promise = PromiseProvider.get();\n  return new Promise.ES6(function(resolve, reject) {\n    var error;\n    if (conditions === undefined || !utils.isObject(conditions)) {\n      error = new Error('Must pass conditions to geoSearch');\n    } else if (!options.near) {\n      error = new Error('Must specify the near option in geoSearch');\n    } else if (!Array.isArray(options.near)) {\n      error = new Error('near option must be an array [x, y]');\n    }\n\n    if (error) {\n      callback && callback(error);\n      reject(error);\n      return;\n    }\n\n    // send the conditions in the options object\n    options.search = conditions;\n\n    _this.collection.geoHaystackSearch(options.near[0], options.near[1], options, function(err, res) {\n      // have to deal with driver problem. Should be fixed in a soon-ish release\n      // (7/8/2013)\n      if (err) {\n        callback && callback(err);\n        reject(err);\n        return;\n      }\n\n      var count = res.results.length;\n      if (options.lean || count === 0) {\n        callback && callback(null, res.results, res.stats);\n        resolve(res.results, res.stats);\n        return;\n      }\n\n      var errSeen = false;\n\n      function init(err) {\n        if (err && !errSeen) {\n          callback && callback(err);\n          reject(err);\n          return;\n        }\n\n        if (!--count && !errSeen) {\n          callback && callback(null, res.results, res.stats);\n          resolve(res.results, res.stats);\n        }\n      }\n\n      for (var i = 0; i < res.results.length; i++) {\n        var temp = res.results[i];\n        res.results[i] = new _this();\n        res.results[i].init(temp, {}, init);\n      }\n    });\n  });\n};\n\n/**\n * Populates document references.\n *\n * ####Available options:\n *\n * - path: space delimited path(s) to populate\n * - select: optional fields to select\n * - match: optional query conditions to match\n * - model: optional name of the model to use for population\n * - options: optional query options like sort, limit, etc\n *\n * ####Examples:\n *\n *     // populates a single object\n *     User.findById(id, function (err, user) {\n *       var opts = [\n *           { path: 'company', match: { x: 1 }, select: 'name' }\n *         , { path: 'notes', options: { limit: 10 }, model: 'override' }\n *       ]\n *\n *       User.populate(user, opts, function (err, user) {\n *         console.log(user);\n *       })\n *     })\n *\n *     // populates an array of objects\n *     User.find(match, function (err, users) {\n *       var opts = [{ path: 'company', match: { x: 1 }, select: 'name' }]\n *\n *       var promise = User.populate(users, opts);\n *       promise.then(console.log).end();\n *     })\n *\n *     // imagine a Weapon model exists with two saved documents:\n *     //   { _id: 389, name: 'whip' }\n *     //   { _id: 8921, name: 'boomerang' }\n *\n *     var user = { name: 'Indiana Jones', weapon: 389 }\n *     Weapon.populate(user, { path: 'weapon', model: 'Weapon' }, function (err, user) {\n *       console.log(user.weapon.name) // whip\n *     })\n *\n *     // populate many plain objects\n *     var users = [{ name: 'Indiana Jones', weapon: 389 }]\n *     users.push({ name: 'Batman', weapon: 8921 })\n *     Weapon.populate(users, { path: 'weapon' }, function (err, users) {\n *       users.forEach(function (user) {\n *         console.log('%s uses a %s', users.name, user.weapon.name)\n *         // Indiana Jones uses a whip\n *         // Batman uses a boomerang\n *       })\n *     })\n *     // Note that we didn't need to specify the Weapon model because\n *     // we were already using it's populate() method.\n *\n * @param {Document|Array} docs Either a single document or array of documents to populate.\n * @param {Object} options A hash of key/val (path, options) used for population.\n * @param {Function} [cb(err,doc)] Optional callback, executed upon completion. Receives `err` and the `doc(s)`.\n * @return {Promise}\n * @api public\n */\n\nModel.populate = function(docs, paths, cb) {\n  var _this = this;\n\n  // normalized paths\n  var noPromise = paths && !!paths.__noPromise;\n  paths = utils.populate(paths);\n\n  // data that should persist across subPopulate calls\n  var cache = {};\n\n  if (noPromise) {\n    _populate(this, docs, paths, cache, cb);\n  } else {\n    var Promise = PromiseProvider.get();\n    return new Promise.ES6(function(resolve, reject) {\n      _populate(_this, docs, paths, cache, function(error, docs) {\n        if (error) {\n          cb && cb(error);\n          reject(error);\n        } else {\n          cb && cb(null, docs);\n          resolve(docs);\n        }\n      });\n    });\n  }\n};\n\n/*!\n * Populate helper\n *\n * @param {Model} model the model to use\n * @param {Document|Array} docs Either a single document or array of documents to populate.\n * @param {Object} paths\n * @param {Function} [cb(err,doc)] Optional callback, executed upon completion. Receives `err` and the `doc(s)`.\n * @return {Function}\n * @api private\n */\n\nfunction _populate(model, docs, paths, cache, cb) {\n  var pending = paths.length;\n\n  if (pending === 0) {\n    return cb(null, docs);\n  }\n\n  // each path has its own query options and must be executed separately\n  var i = pending;\n  var path;\n  while (i--) {\n    path = paths[i];\n    if (typeof path.model === 'function') {\n      model = path.model;\n    }\n    populate(model, docs, path, subPopulate.call(model, docs, path, cache, next));\n  }\n\n  function next(err) {\n    if (err) {\n      return cb(err);\n    }\n    if (--pending) {\n      return;\n    }\n    cb(null, docs);\n  }\n}\n\n/*!\n * Populates deeply if `populate` option is present.\n *\n * @param {Document|Array} docs\n * @param {Object} options\n * @param {Function} cb\n * @return {Function}\n * @api private\n */\nfunction subPopulate(docs, options, cache, cb) {\n  var _this = this;\n  var prefix = options.path + '.';\n  var pop = options.populate;\n\n  if (!pop) {\n    return cb;\n  }\n\n  // normalize as array\n  if (!Array.isArray(pop)) {\n    pop = [pop];\n  }\n\n  return function(err) {\n    var pending = pop.length;\n\n    function next(err) {\n      if (err) return cb(err);\n      if (--pending) return;\n      cb();\n    }\n\n    if (err || !pending) return cb(err);\n\n    pop.forEach(function(subOptions) {\n      subOptions = utils.clone(subOptions);\n      // path needs parent's path prefixed to it\n      if (!subOptions._originalPath) {\n        subOptions._originalPath = subOptions.path;\n        subOptions.path = prefix + subOptions.path;\n      }\n\n      var schema = cache[prefix.substr(0, prefix.length - 1)] ||\n        _this.schema._getSchema(prefix);\n      var subSchema;\n      if (typeof subOptions.model === 'string') {\n        subOptions.model = _this.model(subOptions.model);\n      } else if (schema && schema.caster && schema.caster.options &&\n          schema.caster.options.ref) {\n        subSchema = _this.model(schema.caster.options.ref).schema.\n          _getSchema(subOptions._originalPath);\n        cache[subOptions.path] = subSchema;\n        if (subSchema && subSchema.options && subSchema.options.ref) {\n          subOptions.model = _this.model(subSchema.options.ref);\n        } else if (subSchema && subSchema.caster && subSchema.caster.options &&\n          subSchema.caster.options.ref) {\n          subOptions.model = _this.model(subSchema.caster.options.ref);\n        }\n      } else if (schema && schema.options && schema.options.ref) {\n        subSchema = _this.model(schema.options.ref).schema.\n          _getSchema(subOptions._originalPath);\n        if (subSchema && subSchema.options && subSchema.options.ref) {\n          subOptions.model = _this.model(subSchema.options.ref);\n        } else if (subSchema && subSchema.caster && subSchema.caster.options &&\n          subSchema.caster.options.ref) {\n          subOptions.model = _this.model(subSchema.caster.options.ref);\n        }\n      }\n      _populate(subOptions.model || _this, docs, utils.populate(subOptions),\n        cache, next);\n    });\n  };\n}\n\n/*!\n * Populates `docs`\n */\nvar excludeIdReg = /\\s?-_id\\s?/,\n    excludeIdRegGlobal = /\\s?-_id\\s?/g;\n\nfunction populate(model, docs, options, cb) {\n  var modelsMap, rawIds;\n\n  // normalize single / multiple docs passed\n  if (!Array.isArray(docs)) {\n    docs = [docs];\n  }\n\n  if (docs.length === 0 || docs.every(utils.isNullOrUndefined)) {\n    return cb();\n  }\n\n  modelsMap = getModelsMapForPopulate(model, docs, options);\n  rawIds = getIdsForAndAddIdsInMapPopulate(modelsMap);\n\n  var i, len = modelsMap.length,\n      mod, match, select, promise, vals = [];\n\n  promise = new Promise(function(err, vals, options, assignmentOpts) {\n    if (err) return cb(err);\n\n    var lean = options.options && options.options.lean,\n        len = vals.length,\n        rawOrder = {}, rawDocs = {}, key, val;\n\n    // optimization:\n    // record the document positions as returned by\n    // the query result.\n    for (var i = 0; i < len; i++) {\n      val = vals[i];\n      key = String(utils.getValue('_id', val));\n      rawDocs[key] = val;\n      rawOrder[key] = i;\n\n      // flag each as result of population\n      if (!lean) val.$__.wasPopulated = true;\n    }\n\n    assignVals({\n      rawIds: rawIds,\n      rawDocs: rawDocs,\n      rawOrder: rawOrder,\n      docs: docs,\n      path: options.path,\n      options: assignmentOpts\n    });\n    cb();\n  });\n\n  function flatten(item) {\n    // no need to include undefined values in our query\n    return undefined !== item;\n  }\n\n  var _remaining = len;\n  var hasOne = false;\n  for (i = 0; i < len; i++) {\n    mod = modelsMap[i];\n    select = mod.options.select;\n\n    if (mod.options.match) {\n      match = utils.object.shallowCopy(mod.options.match);\n    } else {\n      match = {};\n    }\n\n    var ids = utils.array.flatten(mod.ids, flatten);\n    ids = utils.array.unique(ids);\n\n    if (ids.length === 0 || ids.every(utils.isNullOrUndefined)) {\n      --_remaining;\n      continue;\n    }\n\n    hasOne = true;\n    match._id || (match._id = {\n      $in: ids\n    });\n\n    var assignmentOpts = {};\n    assignmentOpts.sort = mod.options.options && mod.options.options.sort || undefined;\n    assignmentOpts.excludeId = excludeIdReg.test(select) || (select && select._id === 0);\n\n    if (assignmentOpts.excludeId) {\n      // override the exclusion from the query so we can use the _id\n      // for document matching during assignment. we'll delete the\n      // _id back off before returning the result.\n      if (typeof select === 'string') {\n        select = select.replace(excludeIdRegGlobal, ' ');\n      } else {\n        // preserve original select conditions by copying\n        select = utils.object.shallowCopy(select);\n        delete select._id;\n      }\n    }\n\n    if (mod.options.options && mod.options.options.limit) {\n      assignmentOpts.originalLimit = mod.options.options.limit;\n      mod.options.options.limit = mod.options.options.limit * ids.length;\n    }\n\n    mod.Model.find(match, select, mod.options.options, next.bind(this, mod.options, assignmentOpts));\n  }\n\n  if (!hasOne) {\n    return cb();\n  }\n\n  function next(options, assignmentOpts, err, valsFromDb) {\n    if (err) return promise.resolve(err);\n    vals = vals.concat(valsFromDb);\n    if (--_remaining === 0) {\n      promise.resolve(err, vals, options, assignmentOpts);\n    }\n  }\n}\n\nfunction getModelsMapForPopulate(model, docs, options) {\n  var i, doc, len = docs.length,\n      available = {},\n      map = [],\n      modelNameFromQuery = options.model && options.model.modelName || options.model,\n      schema, refPath, Model, currentOptions, modelNames, modelName, discriminatorKey, modelForFindSchema;\n\n  schema = model._getSchema(options.path);\n\n  if (schema && schema.caster) {\n    schema = schema.caster;\n  }\n\n  if (!schema && model.discriminators) {\n    discriminatorKey = model.schema.discriminatorMapping.key;\n  }\n\n  refPath = schema && schema.options && schema.options.refPath;\n\n  for (i = 0; i < len; i++) {\n    doc = docs[i];\n\n    if (refPath) {\n      modelNames = utils.getValue(refPath, doc);\n    } else {\n      if (!modelNameFromQuery) {\n        var schemaForCurrentDoc;\n\n        if (!schema && discriminatorKey) {\n          modelForFindSchema = utils.getValue(discriminatorKey, doc);\n\n          if (modelForFindSchema) {\n            schemaForCurrentDoc = model.db.model(modelForFindSchema)._getSchema(options.path);\n\n            if (schemaForCurrentDoc && schemaForCurrentDoc.caster) {\n              schemaForCurrentDoc = schemaForCurrentDoc.caster;\n            }\n          }\n        } else {\n          schemaForCurrentDoc = schema;\n        }\n\n        modelNames = [\n          schemaForCurrentDoc && schemaForCurrentDoc.options && schemaForCurrentDoc.options.ref            // declared in schema\n          || model.modelName                                           // an ad-hoc structure\n        ];\n      } else {\n        modelNames = [modelNameFromQuery];  // query options\n      }\n    }\n\n    if (!modelNames) {\n      continue;\n    }\n\n    if (!Array.isArray(modelNames)) {\n      modelNames = [modelNames];\n    }\n\n    var k = modelNames.length;\n    while (k--) {\n      modelName = modelNames[k];\n      if (!available[modelName]) {\n        Model = model.db.model(modelName);\n        currentOptions = {\n          model: Model\n        };\n\n        if (schema && !discriminatorKey) {\n          options.model = Model;\n        }\n\n        utils.merge(currentOptions, options);\n\n        available[modelName] = {\n          Model: Model,\n          options: currentOptions,\n          docs: [doc],\n          ids: []\n        };\n        map.push(available[modelName]);\n      } else {\n        available[modelName].docs.push(doc);\n      }\n    }\n  }\n\n  return map;\n}\n\nfunction getIdsForAndAddIdsInMapPopulate(modelsMap) {\n  var rawIds = [], // for the correct position\n      i, j, doc, docs, id, len, len2, ret, isDocument, options, path;\n\n  len2 = modelsMap.length;\n  for (j = 0; j < len2; j++) {\n    docs = modelsMap[j].docs;\n    len = docs.length;\n    options = modelsMap[j].options;\n    path = options.path;\n\n    for (i = 0; i < len; i++) {\n      ret = undefined;\n      doc = docs[i];\n      id = String(utils.getValue('_id', doc));\n      isDocument = !!doc.$__;\n\n      if (!ret || Array.isArray(ret) && ret.length === 0) {\n        ret = utils.getValue(path, doc);\n      }\n\n      if (ret) {\n        ret = convertTo_id(ret);\n\n        options._docs[id] = Array.isArray(ret) ? ret.slice() : ret;\n      }\n\n      rawIds.push(ret);\n      modelsMap[j].ids.push(ret);\n\n      if (isDocument) {\n        // cache original populated _ids and model used\n        doc.populated(path, options._docs[id], options);\n      }\n    }\n  }\n\n  return rawIds;\n}\n\n/*!\n * Retrieve the _id of `val` if a Document or Array of Documents.\n *\n * @param {Array|Document|Any} val\n * @return {Array|Document|Any}\n */\n\nfunction convertTo_id(val) {\n  if (val instanceof Model) return val._id;\n\n  if (Array.isArray(val)) {\n    for (var i = 0; i < val.length; ++i) {\n      if (val[i] instanceof Model) {\n        val[i] = val[i]._id;\n      }\n    }\n    return val;\n  }\n\n  return val;\n}\n\n/*!\n * Assigns documents returned from a population query back\n * to the original document path.\n */\n\nfunction assignVals(o) {\n  // replace the original ids in our intermediate _ids structure\n  // with the documents found by query\n\n  assignRawDocsToIdStructure(o.rawIds, o.rawDocs, o.rawOrder, o.options);\n\n  // now update the original documents being populated using the\n  // result structure that contains real documents.\n\n  var docs = o.docs;\n  var path = o.path;\n  var rawIds = o.rawIds;\n  var options = o.options;\n\n  function setValue(val) {\n    return valueFilter(val, options);\n  }\n\n  for (var i = 0; i < docs.length; ++i) {\n    if (utils.getValue(path, docs[i]) == null) {\n      continue;\n    }\n    utils.setValue(path, rawIds[i], docs[i], setValue);\n  }\n}\n\n/*!\n * 1) Apply backwards compatible find/findOne behavior to sub documents\n *\n *    find logic:\n *      a) filter out non-documents\n *      b) remove _id from sub docs when user specified\n *\n *    findOne\n *      a) if no doc found, set to null\n *      b) remove _id from sub docs when user specified\n *\n * 2) Remove _ids when specified by users query.\n *\n * background:\n * _ids are left in the query even when user excludes them so\n * that population mapping can occur.\n */\n\nfunction valueFilter(val, assignmentOpts) {\n  if (Array.isArray(val)) {\n    // find logic\n    var ret = [];\n    var numValues = val.length;\n    for (var i = 0; i < numValues; ++i) {\n      var subdoc = val[i];\n      if (!isDoc(subdoc)) continue;\n      maybeRemoveId(subdoc, assignmentOpts);\n      ret.push(subdoc);\n      if (assignmentOpts.originalLimit &&\n          ret.length >= assignmentOpts.originalLimit) {\n        break;\n      }\n    }\n\n    // Since we don't want to have to create a new mongoosearray, make sure to\n    // modify the array in place\n    while (val.length > ret.length) {\n      Array.prototype.pop.apply(val, []);\n    }\n    for (i = 0; i < ret.length; ++i) {\n      val[i] = ret[i];\n    }\n    return val;\n  }\n\n  // findOne\n  if (isDoc(val)) {\n    maybeRemoveId(val, assignmentOpts);\n    return val;\n  }\n\n  return null;\n}\n\n/*!\n * Remove _id from `subdoc` if user specified \"lean\" query option\n */\n\nfunction maybeRemoveId(subdoc, assignmentOpts) {\n  if (assignmentOpts.excludeId) {\n    if (typeof subdoc.setValue === 'function') {\n      delete subdoc._doc._id;\n    } else {\n      delete subdoc._id;\n    }\n  }\n}\n\n/*!\n * Determine if `doc` is a document returned\n * by a populate query.\n */\n\nfunction isDoc(doc) {\n  if (doc == null) {\n    return false;\n  }\n\n  var type = typeof doc;\n  if (type === 'string') {\n    return false;\n  }\n\n  if (type === 'number') {\n    return false;\n  }\n\n  if (Buffer.isBuffer(doc)) {\n    return false;\n  }\n\n  if (doc.constructor.name === 'ObjectID') {\n    return false;\n  }\n\n  // only docs\n  return true;\n}\n\n/*!\n * Assign `vals` returned by mongo query to the `rawIds`\n * structure returned from utils.getVals() honoring\n * query sort order if specified by user.\n *\n * This can be optimized.\n *\n * Rules:\n *\n *   if the value of the path is not an array, use findOne rules, else find.\n *   for findOne the results are assigned directly to doc path (including null results).\n *   for find, if user specified sort order, results are assigned directly\n *   else documents are put back in original order of array if found in results\n *\n * @param {Array} rawIds\n * @param {Array} vals\n * @param {Boolean} sort\n * @api private\n */\n\nfunction assignRawDocsToIdStructure(rawIds, resultDocs, resultOrder, options, recursed) {\n  // honor user specified sort order\n  var newOrder = [];\n  var sorting = options.sort && rawIds.length > 1;\n  var doc;\n  var sid;\n  var id;\n\n  for (var i = 0; i < rawIds.length; ++i) {\n    id = rawIds[i];\n\n    if (Array.isArray(id)) {\n      // handle [ [id0, id2], [id3] ]\n      assignRawDocsToIdStructure(id, resultDocs, resultOrder, options, true);\n      newOrder.push(id);\n      continue;\n    }\n\n    if (id === null && !sorting) {\n      // keep nulls for findOne unless sorting, which always\n      // removes them (backward compat)\n      newOrder.push(id);\n      continue;\n    }\n\n    sid = String(id);\n\n    if (recursed) {\n      // apply find behavior\n\n      // assign matching documents in original order unless sorting\n      doc = resultDocs[sid];\n      if (doc) {\n        if (sorting) {\n          newOrder[resultOrder[sid]] = doc;\n        } else {\n          newOrder.push(doc);\n        }\n      } else {\n        newOrder.push(id);\n      }\n    } else {\n      // apply findOne behavior - if document in results, assign, else assign null\n      newOrder[i] = doc = resultDocs[sid] || null;\n    }\n  }\n\n  rawIds.length = 0;\n  if (newOrder.length) {\n    // reassign the documents based on corrected order\n\n    // forEach skips over sparse entries in arrays so we\n    // can safely use this to our advantage dealing with sorted\n    // result sets too.\n    newOrder.forEach(function(doc, i) {\n      if (!doc) {\n        return;\n      }\n      rawIds[i] = doc;\n    });\n  }\n}\n\n/**\n * Finds the schema for `path`. This is different than\n * calling `schema.path` as it also resolves paths with\n * positional selectors (something.$.another.$.path).\n *\n * @param {String} path\n * @return {Schema}\n * @api private\n */\n\nModel._getSchema = function _getSchema(path) {\n  return this.schema._getSchema(path);\n};\n\n/*!\n * Compiler utility.\n *\n * @param {String} name model name\n * @param {Schema} schema\n * @param {String} collectionName\n * @param {Connection} connection\n * @param {Mongoose} base mongoose instance\n */\n\nModel.compile = function compile(name, schema, collectionName, connection, base) {\n  var versioningEnabled = schema.options.versionKey !== false;\n\n  if (versioningEnabled && !schema.paths[schema.options.versionKey]) {\n    // add versioning to top level documents only\n    var o = {};\n    o[schema.options.versionKey] = Number;\n    schema.add(o);\n  }\n\n  // generate new class\n  function model(doc, fields, skipId) {\n    if (!(this instanceof model)) {\n      return new model(doc, fields, skipId);\n    }\n    Model.call(this, doc, fields, skipId);\n  }\n\n  model.hooks = schema.s.hooks.clone();\n  model.base = base;\n  model.modelName = name;\n  model.__proto__ = Model;\n  model.prototype.__proto__ = Model.prototype;\n  model.model = Model.prototype.model;\n  model.db = model.prototype.db = connection;\n  model.discriminators = model.prototype.discriminators = undefined;\n\n  model.prototype.$__setSchema(schema);\n\n  var collectionOptions = {\n    bufferCommands: schema.options.bufferCommands,\n    capped: schema.options.capped\n  };\n\n  model.prototype.collection = connection.collection(\n      collectionName\n      , collectionOptions\n  );\n\n  // apply methods and statics\n  applyMethods(model, schema);\n  applyStatics(model, schema);\n\n  model.schema = model.prototype.schema;\n  model.collection = model.prototype.collection;\n\n  return model;\n};\n\n/*!\n * Register methods for this model\n *\n * @param {Model} model\n * @param {Schema} schema\n */\nvar applyMethods = function(model, schema) {\n  function apply(method, schema) {\n    Object.defineProperty(model.prototype, method, {\n      get: function() {\n        var h = {};\n        for (var k in schema.methods[method]) {\n          h[k] = schema.methods[method][k].bind(this);\n        }\n        return h;\n      },\n      configurable: true\n    });\n  }\n  for (var method in schema.methods) {\n    if (typeof schema.methods[method] === 'function') {\n      model.prototype[method] = schema.methods[method];\n    } else {\n      apply(method, schema);\n    }\n  }\n};\n\n/*!\n * Register statics for this model\n * @param {Model} model\n * @param {Schema} schema\n */\nvar applyStatics = function(model, schema) {\n  for (var i in schema.statics) {\n    model[i] = schema.statics[i];\n  }\n};\n\n/*!\n * Subclass this model with `conn`, `schema`, and `collection` settings.\n *\n * @param {Connection} conn\n * @param {Schema} [schema]\n * @param {String} [collection]\n * @return {Model}\n */\n\nModel.__subclass = function subclass(conn, schema, collection) {\n  // subclass model using this connection and collection name\n  var _this = this;\n\n  var Model = function Model(doc, fields, skipId) {\n    if (!(this instanceof Model)) {\n      return new Model(doc, fields, skipId);\n    }\n    _this.call(this, doc, fields, skipId);\n  };\n\n  Model.__proto__ = _this;\n  Model.prototype.__proto__ = _this.prototype;\n  Model.db = Model.prototype.db = conn;\n\n  var s = schema && typeof schema !== 'string'\n      ? schema\n      : _this.prototype.schema;\n\n  var options = s.options || {};\n\n  if (!collection) {\n    collection = _this.prototype.schema.get('collection')\n        || utils.toCollectionName(_this.modelName, options);\n  }\n\n  var collectionOptions = {\n    bufferCommands: s ? options.bufferCommands : true,\n    capped: s && options.capped\n  };\n\n  Model.prototype.collection = conn.collection(collection, collectionOptions);\n  Model.collection = Model.prototype.collection;\n  Model.init();\n  return Model;\n};\n\n/*!\n * Module exports.\n */\n\nmodule.exports = exports = Model;\n"]}