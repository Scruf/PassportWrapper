{"version":3,"sources":["subdocument.js"],"names":[],"mappings":"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","file":"subdocument-compiled.js","sourcesContent":["var Document = require('../document');\nvar PromiseProvider = require('../promise_provider');\n\nmodule.exports = Subdocument;\n\n/**\n * Subdocument constructor.\n *\n * @inherits Document\n * @api private\n */\n\nfunction Subdocument(value, fields) {\n  this.$isSingleNested = true;\n  Document.call(this, value, fields);\n}\n\nSubdocument.prototype = Object.create(Document.prototype);\n\n/**\n * Used as a stub for [hooks.js](https://github.com/bnoguchi/hooks-js/tree/31ec571cef0332e21121ee7157e0cf9728572cc3)\n *\n * ####NOTE:\n *\n * _This is a no-op. Does not actually save the doc to the db._\n *\n * @param {Function} [fn]\n * @return {Promise} resolved Promise\n * @api private\n */\n\nSubdocument.prototype.save = function(fn) {\n  var Promise = PromiseProvider.get();\n  return new Promise.ES6(function(resolve) {\n    fn && fn();\n    resolve();\n  });\n};\n\nSubdocument.prototype.$isValid = function(path) {\n  if (this.$parent) {\n    return this.$parent.$isValid([this.$basePath, path].join('.'));\n  }\n};\n\nSubdocument.prototype.markModified = function(path) {\n  Document.prototype.markModified.call(this, path);\n  if (this.$parent) {\n    this.$parent.markModified([this.$basePath, path].join('.'));\n  }\n};\n\nSubdocument.prototype.$markValid = function(path) {\n  if (this.$parent) {\n    this.$parent.$markValid([this.$basePath, path].join('.'));\n  }\n};\n\nSubdocument.prototype.invalidate = function(path, err, val) {\n  if (this.$parent) {\n    this.$parent.invalidate([this.$basePath, path].join('.'), err, val);\n  } else if (err.kind === 'cast' || err.name === 'CastError') {\n    throw err;\n  }\n};\n\n/**\n * Returns the top level document of this sub-document.\n *\n * @return {Document}\n */\n\nSubdocument.prototype.ownerDocument = function() {\n  if (this.$__.ownerDocument) {\n    return this.$__.ownerDocument;\n  }\n\n  var parent = this.$parent;\n  if (!parent) {\n    return this;\n  }\n\n  while (parent.$parent) {\n    parent = parent.$parent;\n  }\n  this.$__.ownerDocument = parent;\n  return this.$__.ownerDocument;\n};\n\n/**\n * Null-out this subdoc\n *\n * @param {Function} [callback] optional callback for compatibility with Document.prototype.remove\n */\n\nSubdocument.prototype.remove = function(callback) {\n  this.$parent.set(this.$basePath, null);\n  registerRemoveListener(this);\n  if (callback) {\n    callback(null);\n  }\n};\n\n/*!\n * Registers remove event listeners for triggering\n * on subdocuments.\n *\n * @param {EmbeddedDocument} sub\n * @api private\n */\n\nfunction registerRemoveListener(sub) {\n  var owner = sub.ownerDocument();\n\n  function emitRemove() {\n    owner.removeListener('save', emitRemove);\n    owner.removeListener('remove', emitRemove);\n    sub.emit('remove', sub);\n    owner = sub = null;\n  }\n\n  owner.on('save', emitRemove);\n  owner.on('remove', emitRemove);\n}\n"]}