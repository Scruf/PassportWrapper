{"version":3,"sources":["layer.js"],"names":[],"mappings":"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","file":"layer-compiled.js","sourcesContent":["/*!\n * express\n * Copyright(c) 2009-2013 TJ Holowaychuk\n * Copyright(c) 2013 Roman Shtylman\n * Copyright(c) 2014-2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module dependencies.\n * @private\n */\n\nvar pathRegexp = require('path-to-regexp');\nvar debug = require('debug')('express:router:layer');\n\n/**\n * Module variables.\n * @private\n */\n\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = Layer;\n\nfunction Layer(path, options, fn) {\n  if (!(this instanceof Layer)) {\n    return new Layer(path, options, fn);\n  }\n\n  debug('new %s', path);\n  var opts = options || {};\n\n  this.handle = fn;\n  this.name = fn.name || '<anonymous>';\n  this.params = undefined;\n  this.path = undefined;\n  this.regexp = pathRegexp(path, this.keys = [], opts);\n\n  if (path === '/' && opts.end === false) {\n    this.regexp.fast_slash = true;\n  }\n}\n\n/**\n * Handle the error for the layer.\n *\n * @param {Error} error\n * @param {Request} req\n * @param {Response} res\n * @param {function} next\n * @api private\n */\n\nLayer.prototype.handle_error = function handle_error(error, req, res, next) {\n  var fn = this.handle;\n\n  if (fn.length !== 4) {\n    // not a standard error handler\n    return next(error);\n  }\n\n  try {\n    fn(error, req, res, next);\n  } catch (err) {\n    next(err);\n  }\n};\n\n/**\n * Handle the request for the layer.\n *\n * @param {Request} req\n * @param {Response} res\n * @param {function} next\n * @api private\n */\n\nLayer.prototype.handle_request = function handle(req, res, next) {\n  var fn = this.handle;\n\n  if (fn.length > 3) {\n    // not a standard request handler\n    return next();\n  }\n\n  try {\n    fn(req, res, next);\n  } catch (err) {\n    next(err);\n  }\n};\n\n/**\n * Check if this route matches `path`, if so\n * populate `.params`.\n *\n * @param {String} path\n * @return {Boolean}\n * @api private\n */\n\nLayer.prototype.match = function match(path) {\n  if (path == null) {\n    // no path, nothing matches\n    this.params = undefined;\n    this.path = undefined;\n    return false;\n  }\n\n  if (this.regexp.fast_slash) {\n    // fast path non-ending match for / (everything matches)\n    this.params = {};\n    this.path = '';\n    return true;\n  }\n\n  var m = this.regexp.exec(path);\n\n  if (!m) {\n    this.params = undefined;\n    this.path = undefined;\n    return false;\n  }\n\n  // store values\n  this.params = {};\n  this.path = m[0];\n\n  var keys = this.keys;\n  var params = this.params;\n\n  for (var i = 1; i < m.length; i++) {\n    var key = keys[i - 1];\n    var prop = key.name;\n    var val = decode_param(m[i]);\n\n    if (val !== undefined || !(hasOwnProperty.call(params, prop))) {\n      params[prop] = val;\n    }\n  }\n\n  return true;\n};\n\n/**\n * Decode param value.\n *\n * @param {string} val\n * @return {string}\n * @private\n */\n\nfunction decode_param(val) {\n  if (typeof val !== 'string' || val.length === 0) {\n    return val;\n  }\n\n  try {\n    return decodeURIComponent(val);\n  } catch (err) {\n    if (err instanceof URIError) {\n      err.message = 'Failed to decode param \\'' + val + '\\'';\n      err.status = err.statusCode = 400;\n    }\n\n    throw err;\n  }\n}\n"]}