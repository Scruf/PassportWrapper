{"version":3,"sources":["application.js"],"names":[],"mappings":";;;;;;;;AAQA;;;;;;;AAOA,IAAI,eAAe,QAAQ,cAAR,CAAf;AACJ,IAAI,SAAS,QAAQ,UAAR,CAAT;AACJ,IAAI,UAAU,QAAQ,SAAR,CAAV;AACJ,IAAI,aAAa,QAAQ,mBAAR,CAAb;AACJ,IAAI,QAAQ,QAAQ,oBAAR,CAAR;AACJ,IAAI,QAAQ,QAAQ,OAAR,EAAiB,qBAAjB,CAAR;AACJ,IAAI,OAAO,QAAQ,QAAR,CAAP;AACJ,IAAI,OAAO,QAAQ,MAAR,CAAP;AACJ,IAAI,cAAc,QAAQ,SAAR,EAAmB,WAAnB;AAClB,IAAI,qBAAqB,QAAQ,SAAR,EAAmB,kBAAnB;AACzB,IAAI,eAAe,QAAQ,SAAR,EAAmB,YAAnB;AACnB,IAAI,YAAY,QAAQ,MAAR,EAAgB,SAAhB,CAAZ;AACJ,IAAI,UAAU,QAAQ,eAAR,CAAV;AACJ,IAAI,QAAQ,QAAQ,aAAR,CAAR;AACJ,IAAI,UAAU,QAAQ,MAAR,EAAgB,OAAhB;AACd,IAAI,QAAQ,MAAM,SAAN,CAAgB,KAAhB;;;;;;AAMZ,IAAI,MAAM,UAAU,OAAO,OAAP,GAAiB,EAAjB;;;;;;;AAOpB,IAAI,0BAA0B,8BAA1B;;;;;;;;;;;;AAYJ,IAAI,IAAJ,GAAW,SAAS,IAAT,GAAgB;AACzB,OAAK,KAAL,GAAa,EAAb,CADyB;AAEzB,OAAK,OAAL,GAAe,EAAf,CAFyB;AAGzB,OAAK,QAAL,GAAgB,EAAhB,CAHyB;;AAKzB,OAAK,oBAAL,GALyB;CAAhB;;;;;;;AAaX,IAAI,oBAAJ,GAA2B,SAAS,oBAAT,GAAgC;AACzD,MAAI,MAAM,QAAQ,GAAR,CAAY,QAAZ,IAAwB,aAAxB;;;AAD+C,MAIzD,CAAK,MAAL,CAAY,cAAZ,EAJyD;AAKzD,OAAK,GAAL,CAAS,MAAT,EAAiB,MAAjB,EALyD;AAMzD,OAAK,GAAL,CAAS,KAAT,EAAgB,GAAhB,EANyD;AAOzD,OAAK,GAAL,CAAS,cAAT,EAAyB,UAAzB,EAPyD;AAQzD,OAAK,GAAL,CAAS,kBAAT,EAA6B,CAA7B,EARyD;AASzD,OAAK,GAAL,CAAS,aAAT,EAAwB,KAAxB;;;AATyD,QAYzD,CAAO,cAAP,CAAsB,KAAK,QAAL,EAAe,uBAArC,EAA8D;AAC5D,kBAAc,IAAd;AACA,WAAO,IAAP;GAFF,EAZyD;;AAiBzD,QAAM,oBAAN,EAA4B,GAA5B,EAjByD;;AAmBzD,OAAK,EAAL,CAAQ,OAAR,EAAiB,SAAS,OAAT,CAAiB,MAAjB,EAAyB;;AAExC,QAAI,KAAK,QAAL,CAAc,uBAAd,MAA2C,IAA3C,IACC,OAAO,OAAO,QAAP,CAAgB,gBAAhB,CAAP,KAA6C,UAA7C,EAAyD;AAC5D,aAAO,KAAK,QAAL,CAAc,aAAd,CAAP,CAD4D;AAE5D,aAAO,KAAK,QAAL,CAAc,gBAAd,CAAP,CAF4D;KAD9D;;;AAFwC,QASxC,CAAK,OAAL,CAAa,SAAb,GAAyB,OAAO,OAAP,CATe;AAUxC,SAAK,QAAL,CAAc,SAAd,GAA0B,OAAO,QAAP,CAVc;AAWxC,SAAK,OAAL,CAAa,SAAb,GAAyB,OAAO,OAAP,CAXe;AAYxC,SAAK,QAAL,CAAc,SAAd,GAA0B,OAAO,QAAP,CAZc;GAAzB,CAAjB;;;AAnByD,MAmCzD,CAAK,MAAL,GAAc,OAAO,MAAP,CAAc,IAAd,CAAd;;;AAnCyD,MAsCzD,CAAK,SAAL,GAAiB,GAAjB;;;AAtCyD,MAyCzD,CAAK,MAAL,CAAY,QAAZ,GAAuB,KAAK,QAAL;;;AAzCkC,MA4CzD,CAAK,GAAL,CAAS,MAAT,EAAiB,IAAjB,EA5CyD;AA6CzD,OAAK,GAAL,CAAS,OAAT,EAAkB,QAAQ,OAAR,CAAlB,EA7CyD;AA8CzD,OAAK,GAAL,CAAS,qBAAT,EAAgC,UAAhC,EA9CyD;;AAgDzD,MAAI,QAAQ,YAAR,EAAsB;AACxB,SAAK,MAAL,CAAY,YAAZ,EADwB;GAA1B;;AAIA,SAAO,cAAP,CAAsB,IAAtB,EAA4B,QAA5B,EAAsC;AACpC,SAAK,YAAW;AACd,YAAM,IAAI,KAAJ,CAAU,iHAAV,CAAN,CADc;KAAX;GADP,EApDyD;CAAhC;;;;;;;;;;AAmE3B,IAAI,UAAJ,GAAiB,SAAS,UAAT,GAAsB;AACrC,MAAI,CAAC,KAAK,OAAL,EAAc;AACjB,SAAK,OAAL,GAAe,IAAI,MAAJ,CAAW;AACxB,qBAAe,KAAK,OAAL,CAAa,wBAAb,CAAf;AACA,cAAQ,KAAK,OAAL,CAAa,gBAAb,CAAR;KAFa,CAAf,CADiB;;AAMjB,SAAK,OAAL,CAAa,GAAb,CAAiB,MAAM,KAAK,GAAL,CAAS,iBAAT,CAAN,CAAjB,EANiB;AAOjB,SAAK,OAAL,CAAa,GAAb,CAAiB,WAAW,IAAX,CAAgB,IAAhB,CAAjB,EAPiB;GAAnB;CADe;;;;;;;;;;;AAqBjB,IAAI,MAAJ,GAAa,SAAS,MAAT,CAAgB,GAAhB,EAAqB,GAArB,EAA0B,QAA1B,EAAoC;AAC/C,MAAI,SAAS,KAAK,OAAL;;;AADkC,MAI3C,OAAO,YAAY,aAAa,GAAb,EAAkB,GAAlB,EAAuB;AAC5C,SAAK,KAAK,GAAL,CAAS,KAAT,CAAL;AACA,aAAS,SAAS,IAAT,CAAc,IAAd,CAAT;GAFqB,CAAZ;;;AAJoC,MAU3C,CAAC,MAAD,EAAS;AACX,UAAM,0BAAN,EADW;AAEX,WAFW;AAGX,WAHW;GAAb;;AAMA,SAAO,MAAP,CAAc,GAAd,EAAmB,GAAnB,EAAwB,IAAxB,EAhB+C;CAApC;;;;;;;;;;;;AA6Bb,IAAI,GAAJ,GAAU,SAAS,GAAT,CAAa,EAAb,EAAiB;AACzB,MAAI,SAAS,CAAT,CADqB;AAEzB,MAAI,OAAO,GAAP;;;;AAFqB,MAMrB,OAAO,EAAP,KAAc,UAAd,EAA0B;AAC5B,QAAI,MAAM,EAAN,CADwB;;AAG5B,WAAO,MAAM,OAAN,CAAc,GAAd,KAAsB,IAAI,MAAJ,KAAe,CAAf,EAAkB;AAC7C,YAAM,IAAI,CAAJ,CAAN,CAD6C;KAA/C;;;AAH4B,QAQxB,OAAO,GAAP,KAAe,UAAf,EAA2B;AAC7B,eAAS,CAAT,CAD6B;AAE7B,aAAO,EAAP,CAF6B;KAA/B;GARF;;AAcA,MAAI,MAAM,QAAQ,MAAM,IAAN,CAAW,SAAX,EAAsB,MAAtB,CAAR,CAAN,CApBqB;;AAsBzB,MAAI,IAAI,MAAJ,KAAe,CAAf,EAAkB;AACpB,UAAM,IAAI,SAAJ,CAAc,yCAAd,CAAN,CADoB;GAAtB;;;AAtByB,MA2BzB,CAAK,UAAL,GA3ByB;AA4BzB,MAAI,SAAS,KAAK,OAAL,CA5BY;;AA8BzB,MAAI,OAAJ,CAAY,UAAU,EAAV,EAAc;;AAExB,QAAI,CAAC,EAAD,IAAO,CAAC,GAAG,MAAH,IAAa,CAAC,GAAG,GAAH,EAAQ;AAChC,aAAO,OAAO,GAAP,CAAW,IAAX,EAAiB,EAAjB,CAAP,CADgC;KAAlC;;AAIA,UAAM,mBAAN,EAA2B,IAA3B,EANwB;AAOxB,OAAG,SAAH,GAAe,IAAf,CAPwB;AAQxB,OAAG,MAAH,GAAY,IAAZ;;;AARwB,UAWxB,CAAO,GAAP,CAAW,IAAX,EAAiB,SAAS,WAAT,CAAqB,GAArB,EAA0B,GAA1B,EAA+B,IAA/B,EAAqC;AACpD,UAAI,OAAO,IAAI,GAAJ,CADyC;AAEpD,SAAG,MAAH,CAAU,GAAV,EAAe,GAAf,EAAoB,UAAU,GAAV,EAAe;AACjC,YAAI,SAAJ,GAAgB,KAAK,OAAL,CADiB;AAEjC,YAAI,SAAJ,GAAgB,KAAK,QAAL,CAFiB;AAGjC,aAAK,GAAL,EAHiC;OAAf,CAApB,CAFoD;KAArC,CAAjB;;;AAXwB,MAqBxB,CAAG,IAAH,CAAQ,OAAR,EAAiB,IAAjB,EArBwB;GAAd,EAsBT,IAtBH,EA9ByB;;AAsDzB,SAAO,IAAP,CAtDyB;CAAjB;;;;;;;;;;;;AAmEV,IAAI,KAAJ,GAAY,SAAS,KAAT,CAAe,IAAf,EAAqB;AAC/B,OAAK,UAAL,GAD+B;AAE/B,SAAO,KAAK,OAAL,CAAa,KAAb,CAAmB,IAAnB,CAAP,CAF+B;CAArB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuCZ,IAAI,MAAJ,GAAa,SAAS,MAAT,CAAgB,GAAhB,EAAqB,EAArB,EAAyB;AACpC,MAAI,OAAO,EAAP,KAAc,UAAd,EAA0B;AAC5B,UAAM,IAAI,KAAJ,CAAU,4BAAV,CAAN,CAD4B;GAA9B;;;AADoC,MAMhC,YAAY,IAAI,CAAJ,MAAW,GAAX,GACZ,MAAM,GAAN,GACA,GAFY;;;AANoB,MAWpC,CAAK,OAAL,CAAa,SAAb,IAA0B,EAA1B,CAXoC;;AAapC,SAAO,IAAP,CAboC;CAAzB;;;;;;;;;;;;;;AA4Bb,IAAI,KAAJ,GAAY,SAAS,KAAT,CAAe,IAAf,EAAqB,EAArB,EAAyB;AACnC,OAAK,UAAL,GADmC;;AAGnC,MAAI,MAAM,OAAN,CAAc,IAAd,CAAJ,EAAyB;AACvB,SAAK,IAAI,IAAI,CAAJ,EAAO,IAAI,KAAK,MAAL,EAAa,GAAjC,EAAsC;AACpC,WAAK,KAAL,CAAW,KAAK,CAAL,CAAX,EAAoB,EAApB,EADoC;KAAtC;;AAIA,WAAO,IAAP,CALuB;GAAzB;;AAQA,OAAK,OAAL,CAAa,KAAb,CAAmB,IAAnB,EAAyB,EAAzB,EAXmC;;AAanC,SAAO,IAAP,CAbmC;CAAzB;;;;;;;;;;;;;;;;;AA+BZ,IAAI,GAAJ,GAAU,SAAS,GAAT,CAAa,OAAb,EAAsB,GAAtB,EAA2B;AACnC,MAAI,UAAU,MAAV,KAAqB,CAArB,EAAwB;;AAE1B,WAAO,KAAK,QAAL,CAAc,OAAd,CAAP,CAF0B;GAA5B;;AAKA,QAAM,gBAAN,EAAwB,OAAxB,EAAiC,GAAjC;;;AANmC,MASnC,CAAK,QAAL,CAAc,OAAd,IAAyB,GAAzB;;;AATmC,UAY3B,OAAR;AACE,SAAK,MAAL;AACE,WAAK,GAAL,CAAS,SAAT,EAAoB,YAAY,GAAZ,CAApB,EADF;AAEE,YAFF;AADF,SAIO,cAAL;AACE,WAAK,GAAL,CAAS,iBAAT,EAA4B,mBAAmB,GAAnB,CAA5B,EADF;AAEE,YAFF;AAJF,SAOO,aAAL;AACE,WAAK,GAAL,CAAS,gBAAT,EAA2B,aAAa,GAAb,CAA3B;;;AADF,YAIE,CAAO,cAAP,CAAsB,KAAK,QAAL,EAAe,uBAArC,EAA8D;AAC5D,sBAAc,IAAd;AACA,eAAO,KAAP;OAFF,EAJF;;AASE,YATF;AAPF,GAZmC;;AA+BnC,SAAO,IAAP,CA/BmC;CAA3B;;;;;;;;;;;;;;;;AAgDV,IAAI,IAAJ,GAAW,SAAS,IAAT,GAAgB;AACzB,SAAO,KAAK,MAAL,GACH,KAAK,MAAL,CAAY,IAAZ,KAAqB,KAAK,SAAL,GACrB,EAFG,CADkB;CAAhB;;;;;;;;;;;;;;;;;AAqBX,IAAI,OAAJ,GAAc,SAAS,OAAT,CAAiB,OAAjB,EAA0B;AACtC,SAAO,QAAQ,KAAK,GAAL,CAAS,OAAT,CAAR,CAAP,CADsC;CAA1B;;;;;;;;;;;;;;;;;AAmBd,IAAI,QAAJ,GAAe,SAAS,QAAT,CAAkB,OAAlB,EAA2B;AACxC,SAAO,CAAC,KAAK,GAAL,CAAS,OAAT,CAAD,CADiC;CAA3B;;;;;;;;;;AAYf,IAAI,MAAJ,GAAa,SAAS,MAAT,CAAgB,OAAhB,EAAyB;AACpC,SAAO,KAAK,GAAL,CAAS,OAAT,EAAkB,IAAlB,CAAP,CADoC;CAAzB;;;;;;;;;;AAYb,IAAI,OAAJ,GAAc,SAAS,OAAT,CAAiB,OAAjB,EAA0B;AACtC,SAAO,KAAK,GAAL,CAAS,OAAT,EAAkB,KAAlB,CAAP,CADsC;CAA1B;;;;;;AAQd,QAAQ,OAAR,CAAgB,UAAS,MAAT,EAAgB;AAC9B,MAAI,MAAJ,IAAc,UAAS,IAAT,EAAc;AAC1B,QAAI,WAAW,KAAX,IAAoB,UAAU,MAAV,KAAqB,CAArB,EAAwB;;AAE9C,aAAO,KAAK,GAAL,CAAS,IAAT,CAAP,CAF8C;KAAhD;;AAKA,SAAK,UAAL,GAN0B;;AAQ1B,QAAI,QAAQ,KAAK,OAAL,CAAa,KAAb,CAAmB,IAAnB,CAAR,CARsB;AAS1B,UAAM,MAAN,EAAc,KAAd,CAAoB,KAApB,EAA2B,MAAM,IAAN,CAAW,SAAX,EAAsB,CAAtB,CAA3B,EAT0B;AAU1B,WAAO,IAAP,CAV0B;GAAd,CADgB;CAAhB,CAAhB;;;;;;;;;;;;AAyBA,IAAI,GAAJ,GAAU,SAAS,GAAT,CAAa,IAAb,EAAmB;AAC3B,OAAK,UAAL,GAD2B;;AAG3B,MAAI,QAAQ,KAAK,OAAL,CAAa,KAAb,CAAmB,IAAnB,CAAR,CAHuB;AAI3B,MAAI,OAAO,MAAM,IAAN,CAAW,SAAX,EAAsB,CAAtB,CAAP,CAJuB;;AAM3B,OAAK,IAAI,IAAI,CAAJ,EAAO,IAAI,QAAQ,MAAR,EAAgB,GAApC,EAAyC;AACvC,UAAM,QAAQ,CAAR,CAAN,EAAkB,KAAlB,CAAwB,KAAxB,EAA+B,IAA/B,EADuC;GAAzC;;AAIA,SAAO,IAAP,CAV2B;CAAnB;;;;AAeV,IAAI,GAAJ,GAAU,UAAU,QAAV,CAAmB,IAAI,MAAJ,EAAY,iCAA/B,CAAV;;;;;;;;;;;;;;;;;;;AAmBA,IAAI,MAAJ,GAAa,SAAS,MAAT,CAAgB,IAAhB,EAAsB,OAAtB,EAA+B,QAA/B,EAAyC;AACpD,MAAI,QAAQ,KAAK,KAAL,CADwC;AAEpD,MAAI,OAAO,QAAP,CAFgD;AAGpD,MAAI,UAAU,KAAK,OAAL,CAHsC;AAIpD,MAAI,OAAO,OAAP,CAJgD;AAKpD,MAAI,gBAAgB,EAAhB,CALgD;AAMpD,MAAI,IAAJ;;;AANoD,MAShD,OAAO,OAAP,KAAmB,UAAnB,EAA+B;AACjC,WAAO,OAAP,CADiC;AAEjC,WAAO,EAAP,CAFiC;GAAnC;;;AAToD,OAepD,CAAM,aAAN,EAAqB,KAAK,MAAL,CAArB;;;AAfoD,MAkBhD,KAAK,OAAL,EAAc;AAChB,UAAM,aAAN,EAAqB,KAAK,OAAL,CAArB,CADgB;GAAlB;;;AAlBoD,OAuBpD,CAAM,aAAN,EAAqB,IAArB;;;AAvBoD,MA0BhD,cAAc,KAAd,IAAuB,IAAvB,EAA6B;AAC/B,kBAAc,KAAd,GAAsB,KAAK,OAAL,CAAa,YAAb,CAAtB,CAD+B;GAAjC;;;AA1BoD,MA+BhD,cAAc,KAAd,EAAqB;AACvB,WAAO,MAAM,IAAN,CAAP,CADuB;GAAzB;;;AA/BoD,MAoChD,CAAC,IAAD,EAAO;AACT,QAAI,OAAO,KAAK,GAAL,CAAS,MAAT,CAAP,CADK;;AAGT,WAAO,IAAI,IAAJ,CAAS,IAAT,EAAe;AACpB,qBAAe,KAAK,GAAL,CAAS,aAAT,CAAf;AACA,YAAM,KAAK,GAAL,CAAS,OAAT,CAAN;AACA,eAAS,OAAT;KAHK,CAAP,CAHS;;AAST,QAAI,CAAC,KAAK,IAAL,EAAW;AACd,UAAI,OAAO,MAAM,OAAN,CAAc,KAAK,IAAL,CAAd,IAA4B,KAAK,IAAL,CAAU,MAAV,GAAmB,CAAnB,GACnC,kBAAkB,KAAK,IAAL,CAAU,KAAV,CAAgB,CAAhB,EAAmB,CAAC,CAAD,CAAnB,CAAuB,IAAvB,CAA4B,MAA5B,CAAlB,GAAwD,QAAxD,GAAmE,KAAK,IAAL,CAAU,KAAK,IAAL,CAAU,MAAV,GAAmB,CAAnB,CAA7E,GAAqG,GAArG,GACA,gBAAgB,KAAK,IAAL,GAAY,GAA5B,CAHU;AAId,UAAI,MAAM,IAAI,KAAJ,CAAU,4BAA4B,IAA5B,GAAmC,aAAnC,GAAmD,IAAnD,CAAhB,CAJU;AAKd,UAAI,IAAJ,GAAW,IAAX,CALc;AAMd,aAAO,KAAK,GAAL,CAAP,CANc;KAAhB;;;AATS,QAmBL,cAAc,KAAd,EAAqB;AACvB,YAAM,IAAN,IAAc,IAAd,CADuB;KAAzB;GAnBF;;;AApCoD,WA6DpD,CAAU,IAAV,EAAgB,aAAhB,EAA+B,IAA/B,EA7DoD;CAAzC;;;;;;;;;;;;;;;;;;;;;;;AAqFb,IAAI,MAAJ,GAAa,SAAS,MAAT,GAAkB;AAC7B,MAAI,SAAS,KAAK,YAAL,CAAkB,IAAlB,CAAT,CADyB;AAE7B,SAAO,OAAO,MAAP,CAAc,KAAd,CAAoB,MAApB,EAA4B,SAA5B,CAAP,CAF6B;CAAlB;;;;;;;;;AAYb,SAAS,QAAT,CAAkB,GAAlB,EAAuB;;AAErB,MAAI,KAAK,GAAL,CAAS,KAAT,MAAoB,MAApB,EAA4B,QAAQ,KAAR,CAAc,IAAI,KAAJ,IAAa,IAAI,QAAJ,EAAb,CAAd,CAAhC;CAFF;;;;;;;AAUA,SAAS,SAAT,CAAmB,IAAnB,EAAyB,OAAzB,EAAkC,QAAlC,EAA4C;AAC1C,MAAI;AACF,SAAK,MAAL,CAAY,OAAZ,EAAqB,QAArB,EADE;GAAJ,CAEE,OAAO,GAAP,EAAY;AACZ,aAAS,GAAT,EADY;GAAZ;CAHJ","file":"application-compiled.js","sourcesContent":["/*!\n * express\n * Copyright(c) 2009-2013 TJ Holowaychuk\n * Copyright(c) 2013 Roman Shtylman\n * Copyright(c) 2014-2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module dependencies.\n * @private\n */\n\nvar finalhandler = require('finalhandler');\nvar Router = require('./router');\nvar methods = require('methods');\nvar middleware = require('./middleware/init');\nvar query = require('./middleware/query');\nvar debug = require('debug')('express:application');\nvar View = require('./view');\nvar http = require('http');\nvar compileETag = require('./utils').compileETag;\nvar compileQueryParser = require('./utils').compileQueryParser;\nvar compileTrust = require('./utils').compileTrust;\nvar deprecate = require('depd')('express');\nvar flatten = require('array-flatten');\nvar merge = require('utils-merge');\nvar resolve = require('path').resolve;\nvar slice = Array.prototype.slice;\n\n/**\n * Application prototype.\n */\n\nvar app = exports = module.exports = {};\n\n/**\n * Variable for trust proxy inheritance back-compat\n * @private\n */\n\nvar trustProxyDefaultSymbol = '@@symbol:trust_proxy_default';\n\n/**\n * Initialize the server.\n *\n *   - setup default configuration\n *   - setup default middleware\n *   - setup route reflection methods\n *\n * @private\n */\n\napp.init = function init() {\n  this.cache = {};\n  this.engines = {};\n  this.settings = {};\n\n  this.defaultConfiguration();\n};\n\n/**\n * Initialize application configuration.\n * @private\n */\n\napp.defaultConfiguration = function defaultConfiguration() {\n  var env = process.env.NODE_ENV || 'development';\n\n  // default settings\n  this.enable('x-powered-by');\n  this.set('etag', 'weak');\n  this.set('env', env);\n  this.set('query parser', 'extended');\n  this.set('subdomain offset', 2);\n  this.set('trust proxy', false);\n\n  // trust proxy inherit back-compat\n  Object.defineProperty(this.settings, trustProxyDefaultSymbol, {\n    configurable: true,\n    value: true\n  });\n\n  debug('booting in %s mode', env);\n\n  this.on('mount', function onmount(parent) {\n    // inherit trust proxy\n    if (this.settings[trustProxyDefaultSymbol] === true\n      && typeof parent.settings['trust proxy fn'] === 'function') {\n      delete this.settings['trust proxy'];\n      delete this.settings['trust proxy fn'];\n    }\n\n    // inherit protos\n    this.request.__proto__ = parent.request;\n    this.response.__proto__ = parent.response;\n    this.engines.__proto__ = parent.engines;\n    this.settings.__proto__ = parent.settings;\n  });\n\n  // setup locals\n  this.locals = Object.create(null);\n\n  // top-most app is mounted at /\n  this.mountpath = '/';\n\n  // default locals\n  this.locals.settings = this.settings;\n\n  // default configuration\n  this.set('view', View);\n  this.set('views', resolve('views'));\n  this.set('jsonp callback name', 'callback');\n\n  if (env === 'production') {\n    this.enable('view cache');\n  }\n\n  Object.defineProperty(this, 'router', {\n    get: function() {\n      throw new Error('\\'app.router\\' is deprecated!\\nPlease see the 3.x to 4.x migration guide for details on how to update your app.');\n    }\n  });\n};\n\n/**\n * lazily adds the base router if it has not yet been added.\n *\n * We cannot add the base router in the defaultConfiguration because\n * it reads app settings which might be set after that has run.\n *\n * @private\n */\napp.lazyrouter = function lazyrouter() {\n  if (!this._router) {\n    this._router = new Router({\n      caseSensitive: this.enabled('case sensitive routing'),\n      strict: this.enabled('strict routing')\n    });\n\n    this._router.use(query(this.get('query parser fn')));\n    this._router.use(middleware.init(this));\n  }\n};\n\n/**\n * Dispatch a req, res pair into the application. Starts pipeline processing.\n *\n * If no callback is provided, then default error handlers will respond\n * in the event of an error bubbling through the stack.\n *\n * @private\n */\n\napp.handle = function handle(req, res, callback) {\n  var router = this._router;\n\n  // final handler\n  var done = callback || finalhandler(req, res, {\n    env: this.get('env'),\n    onerror: logerror.bind(this)\n  });\n\n  // no routes\n  if (!router) {\n    debug('no routes defined on app');\n    done();\n    return;\n  }\n\n  router.handle(req, res, done);\n};\n\n/**\n * Proxy `Router#use()` to add middleware to the app router.\n * See Router#use() documentation for details.\n *\n * If the _fn_ parameter is an express app, then it will be\n * mounted at the _route_ specified.\n *\n * @public\n */\n\napp.use = function use(fn) {\n  var offset = 0;\n  var path = '/';\n\n  // default path to '/'\n  // disambiguate app.use([fn])\n  if (typeof fn !== 'function') {\n    var arg = fn;\n\n    while (Array.isArray(arg) && arg.length !== 0) {\n      arg = arg[0];\n    }\n\n    // first arg is the path\n    if (typeof arg !== 'function') {\n      offset = 1;\n      path = fn;\n    }\n  }\n\n  var fns = flatten(slice.call(arguments, offset));\n\n  if (fns.length === 0) {\n    throw new TypeError('app.use() requires middleware functions');\n  }\n\n  // setup router\n  this.lazyrouter();\n  var router = this._router;\n\n  fns.forEach(function (fn) {\n    // non-express app\n    if (!fn || !fn.handle || !fn.set) {\n      return router.use(path, fn);\n    }\n\n    debug('.use app under %s', path);\n    fn.mountpath = path;\n    fn.parent = this;\n\n    // restore .app property on req and res\n    router.use(path, function mounted_app(req, res, next) {\n      var orig = req.app;\n      fn.handle(req, res, function (err) {\n        req.__proto__ = orig.request;\n        res.__proto__ = orig.response;\n        next(err);\n      });\n    });\n\n    // mounted an app\n    fn.emit('mount', this);\n  }, this);\n\n  return this;\n};\n\n/**\n * Proxy to the app `Router#route()`\n * Returns a new `Route` instance for the _path_.\n *\n * Routes are isolated middleware stacks for specific paths.\n * See the Route api docs for details.\n *\n * @public\n */\n\napp.route = function route(path) {\n  this.lazyrouter();\n  return this._router.route(path);\n};\n\n/**\n * Register the given template engine callback `fn`\n * as `ext`.\n *\n * By default will `require()` the engine based on the\n * file extension. For example if you try to render\n * a \"foo.jade\" file Express will invoke the following internally:\n *\n *     app.engine('jade', require('jade').__express);\n *\n * For engines that do not provide `.__express` out of the box,\n * or if you wish to \"map\" a different extension to the template engine\n * you may use this method. For example mapping the EJS template engine to\n * \".html\" files:\n *\n *     app.engine('html', require('ejs').renderFile);\n *\n * In this case EJS provides a `.renderFile()` method with\n * the same signature that Express expects: `(path, options, callback)`,\n * though note that it aliases this method as `ejs.__express` internally\n * so if you're using \".ejs\" extensions you dont need to do anything.\n *\n * Some template engines do not follow this convention, the\n * [Consolidate.js](https://github.com/tj/consolidate.js)\n * library was created to map all of node's popular template\n * engines to follow this convention, thus allowing them to\n * work seamlessly within Express.\n *\n * @param {String} ext\n * @param {Function} fn\n * @return {app} for chaining\n * @public\n */\n\napp.engine = function engine(ext, fn) {\n  if (typeof fn !== 'function') {\n    throw new Error('callback function required');\n  }\n\n  // get file extension\n  var extension = ext[0] !== '.'\n    ? '.' + ext\n    : ext;\n\n  // store engine\n  this.engines[extension] = fn;\n\n  return this;\n};\n\n/**\n * Proxy to `Router#param()` with one added api feature. The _name_ parameter\n * can be an array of names.\n *\n * See the Router#param() docs for more details.\n *\n * @param {String|Array} name\n * @param {Function} fn\n * @return {app} for chaining\n * @public\n */\n\napp.param = function param(name, fn) {\n  this.lazyrouter();\n\n  if (Array.isArray(name)) {\n    for (var i = 0; i < name.length; i++) {\n      this.param(name[i], fn);\n    }\n\n    return this;\n  }\n\n  this._router.param(name, fn);\n\n  return this;\n};\n\n/**\n * Assign `setting` to `val`, or return `setting`'s value.\n *\n *    app.set('foo', 'bar');\n *    app.get('foo');\n *    // => \"bar\"\n *\n * Mounted servers inherit their parent server's settings.\n *\n * @param {String} setting\n * @param {*} [val]\n * @return {Server} for chaining\n * @public\n */\n\napp.set = function set(setting, val) {\n  if (arguments.length === 1) {\n    // app.get(setting)\n    return this.settings[setting];\n  }\n\n  debug('set \"%s\" to %o', setting, val);\n\n  // set value\n  this.settings[setting] = val;\n\n  // trigger matched settings\n  switch (setting) {\n    case 'etag':\n      this.set('etag fn', compileETag(val));\n      break;\n    case 'query parser':\n      this.set('query parser fn', compileQueryParser(val));\n      break;\n    case 'trust proxy':\n      this.set('trust proxy fn', compileTrust(val));\n\n      // trust proxy inherit back-compat\n      Object.defineProperty(this.settings, trustProxyDefaultSymbol, {\n        configurable: true,\n        value: false\n      });\n\n      break;\n  }\n\n  return this;\n};\n\n/**\n * Return the app's absolute pathname\n * based on the parent(s) that have\n * mounted it.\n *\n * For example if the application was\n * mounted as \"/admin\", which itself\n * was mounted as \"/blog\" then the\n * return value would be \"/blog/admin\".\n *\n * @return {String}\n * @private\n */\n\napp.path = function path() {\n  return this.parent\n    ? this.parent.path() + this.mountpath\n    : '';\n};\n\n/**\n * Check if `setting` is enabled (truthy).\n *\n *    app.enabled('foo')\n *    // => false\n *\n *    app.enable('foo')\n *    app.enabled('foo')\n *    // => true\n *\n * @param {String} setting\n * @return {Boolean}\n * @public\n */\n\napp.enabled = function enabled(setting) {\n  return Boolean(this.set(setting));\n};\n\n/**\n * Check if `setting` is disabled.\n *\n *    app.disabled('foo')\n *    // => true\n *\n *    app.enable('foo')\n *    app.disabled('foo')\n *    // => false\n *\n * @param {String} setting\n * @return {Boolean}\n * @public\n */\n\napp.disabled = function disabled(setting) {\n  return !this.set(setting);\n};\n\n/**\n * Enable `setting`.\n *\n * @param {String} setting\n * @return {app} for chaining\n * @public\n */\n\napp.enable = function enable(setting) {\n  return this.set(setting, true);\n};\n\n/**\n * Disable `setting`.\n *\n * @param {String} setting\n * @return {app} for chaining\n * @public\n */\n\napp.disable = function disable(setting) {\n  return this.set(setting, false);\n};\n\n/**\n * Delegate `.VERB(...)` calls to `router.VERB(...)`.\n */\n\nmethods.forEach(function(method){\n  app[method] = function(path){\n    if (method === 'get' && arguments.length === 1) {\n      // app.get(setting)\n      return this.set(path);\n    }\n\n    this.lazyrouter();\n\n    var route = this._router.route(path);\n    route[method].apply(route, slice.call(arguments, 1));\n    return this;\n  };\n});\n\n/**\n * Special-cased \"all\" method, applying the given route `path`,\n * middleware, and callback to _every_ HTTP method.\n *\n * @param {String} path\n * @param {Function} ...\n * @return {app} for chaining\n * @public\n */\n\napp.all = function all(path) {\n  this.lazyrouter();\n\n  var route = this._router.route(path);\n  var args = slice.call(arguments, 1);\n\n  for (var i = 0; i < methods.length; i++) {\n    route[methods[i]].apply(route, args);\n  }\n\n  return this;\n};\n\n// del -> delete alias\n\napp.del = deprecate.function(app.delete, 'app.del: Use app.delete instead');\n\n/**\n * Render the given view `name` name with `options`\n * and a callback accepting an error and the\n * rendered template string.\n *\n * Example:\n *\n *    app.render('email', { name: 'Tobi' }, function(err, html){\n *      // ...\n *    })\n *\n * @param {String} name\n * @param {Object|Function} options or fn\n * @param {Function} callback\n * @public\n */\n\napp.render = function render(name, options, callback) {\n  var cache = this.cache;\n  var done = callback;\n  var engines = this.engines;\n  var opts = options;\n  var renderOptions = {};\n  var view;\n\n  // support callback function as second arg\n  if (typeof options === 'function') {\n    done = options;\n    opts = {};\n  }\n\n  // merge app.locals\n  merge(renderOptions, this.locals);\n\n  // merge options._locals\n  if (opts._locals) {\n    merge(renderOptions, opts._locals);\n  }\n\n  // merge options\n  merge(renderOptions, opts);\n\n  // set .cache unless explicitly provided\n  if (renderOptions.cache == null) {\n    renderOptions.cache = this.enabled('view cache');\n  }\n\n  // primed cache\n  if (renderOptions.cache) {\n    view = cache[name];\n  }\n\n  // view\n  if (!view) {\n    var View = this.get('view');\n\n    view = new View(name, {\n      defaultEngine: this.get('view engine'),\n      root: this.get('views'),\n      engines: engines\n    });\n\n    if (!view.path) {\n      var dirs = Array.isArray(view.root) && view.root.length > 1\n        ? 'directories \"' + view.root.slice(0, -1).join('\", \"') + '\" or \"' + view.root[view.root.length - 1] + '\"'\n        : 'directory \"' + view.root + '\"'\n      var err = new Error('Failed to lookup view \"' + name + '\" in views ' + dirs);\n      err.view = view;\n      return done(err);\n    }\n\n    // prime the cache\n    if (renderOptions.cache) {\n      cache[name] = view;\n    }\n  }\n\n  // render\n  tryRender(view, renderOptions, done);\n};\n\n/**\n * Listen for connections.\n *\n * A node `http.Server` is returned, with this\n * application (which is a `Function`) as its\n * callback. If you wish to create both an HTTP\n * and HTTPS server you may do so with the \"http\"\n * and \"https\" modules as shown here:\n *\n *    var http = require('http')\n *      , https = require('https')\n *      , express = require('express')\n *      , app = express();\n *\n *    http.createServer(app).listen(80);\n *    https.createServer({ ... }, app).listen(443);\n *\n * @return {http.Server}\n * @public\n */\n\napp.listen = function listen() {\n  var server = http.createServer(this);\n  return server.listen.apply(server, arguments);\n};\n\n/**\n * Log error using console.error.\n *\n * @param {Error} err\n * @private\n */\n\nfunction logerror(err) {\n  /* istanbul ignore next */\n  if (this.get('env') !== 'test') console.error(err.stack || err.toString());\n}\n\n/**\n * Try rendering a view.\n * @private\n */\n\nfunction tryRender(view, options, callback) {\n  try {\n    view.render(options, callback);\n  } catch (err) {\n    callback(err);\n  }\n}\n"]}